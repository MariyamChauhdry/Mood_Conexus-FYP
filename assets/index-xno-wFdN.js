var AP=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var IH=AP((RH,iP)=>{function PP(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const o=Object.getOwnPropertyDescriptor(r,i);o&&Object.defineProperty(n,i,o.get?o:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function w2(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var _2={exports:{}},Hf={},x2={exports:{}},Me={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gc=Symbol.for("react.element"),NP=Symbol.for("react.portal"),DP=Symbol.for("react.fragment"),OP=Symbol.for("react.strict_mode"),MP=Symbol.for("react.profiler"),FP=Symbol.for("react.provider"),LP=Symbol.for("react.context"),VP=Symbol.for("react.forward_ref"),BP=Symbol.for("react.suspense"),UP=Symbol.for("react.memo"),jP=Symbol.for("react.lazy"),c_=Symbol.iterator;function zP(n){return n===null||typeof n!="object"?null:(n=c_&&n[c_]||n["@@iterator"],typeof n=="function"?n:null)}var b2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E2=Object.assign,C2={};function yu(n,e,t){this.props=n,this.context=e,this.refs=C2,this.updater=t||b2}yu.prototype.isReactComponent={};yu.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};yu.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function I2(){}I2.prototype=yu.prototype;function Ey(n,e,t){this.props=n,this.context=e,this.refs=C2,this.updater=t||b2}var Cy=Ey.prototype=new I2;Cy.constructor=Ey;E2(Cy,yu.prototype);Cy.isPureReactComponent=!0;var h_=Array.isArray,T2=Object.prototype.hasOwnProperty,Iy={current:null},S2={key:!0,ref:!0,__self:!0,__source:!0};function R2(n,e,t){var r,i={},o=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(o=""+e.key),e)T2.call(e,r)&&!S2.hasOwnProperty(r)&&(i[r]=e[r]);var s=arguments.length-2;if(s===1)i.children=t;else if(1<s){for(var u=Array(s),l=0;l<s;l++)u[l]=arguments[l+2];i.children=u}if(n&&n.defaultProps)for(r in s=n.defaultProps,s)i[r]===void 0&&(i[r]=s[r]);return{$$typeof:gc,type:n,key:o,ref:a,props:i,_owner:Iy.current}}function WP(n,e){return{$$typeof:gc,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Ty(n){return typeof n=="object"&&n!==null&&n.$$typeof===gc}function $P(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var d_=/\/+/g;function cm(n,e){return typeof n=="object"&&n!==null&&n.key!=null?$P(""+n.key):e.toString(36)}function Xh(n,e,t,r,i){var o=typeof n;(o==="undefined"||o==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(o){case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case gc:case NP:a=!0}}if(a)return a=n,i=i(a),n=r===""?"."+cm(a,0):r,h_(i)?(t="",n!=null&&(t=n.replace(d_,"$&/")+"/"),Xh(i,e,t,"",function(l){return l})):i!=null&&(Ty(i)&&(i=WP(i,t+(!i.key||a&&a.key===i.key?"":(""+i.key).replace(d_,"$&/")+"/")+n)),e.push(i)),1;if(a=0,r=r===""?".":r+":",h_(n))for(var s=0;s<n.length;s++){o=n[s];var u=r+cm(o,s);a+=Xh(o,e,t,u,i)}else if(u=zP(n),typeof u=="function")for(n=u.call(n),s=0;!(o=n.next()).done;)o=o.value,u=r+cm(o,s++),a+=Xh(o,e,t,u,i);else if(o==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function ch(n,e,t){if(n==null)return n;var r=[],i=0;return Xh(n,r,"","",function(o){return e.call(t,o,i++)}),r}function HP(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var In={current:null},Qh={transition:null},GP={ReactCurrentDispatcher:In,ReactCurrentBatchConfig:Qh,ReactCurrentOwner:Iy};function k2(){throw Error("act(...) is not supported in production builds of React.")}Me.Children={map:ch,forEach:function(n,e,t){ch(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return ch(n,function(){e++}),e},toArray:function(n){return ch(n,function(e){return e})||[]},only:function(n){if(!Ty(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Me.Component=yu;Me.Fragment=DP;Me.Profiler=MP;Me.PureComponent=Ey;Me.StrictMode=OP;Me.Suspense=BP;Me.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=GP;Me.act=k2;Me.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=E2({},n.props),i=n.key,o=n.ref,a=n._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,a=Iy.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var s=n.type.defaultProps;for(u in e)T2.call(e,u)&&!S2.hasOwnProperty(u)&&(r[u]=e[u]===void 0&&s!==void 0?s[u]:e[u])}var u=arguments.length-2;if(u===1)r.children=t;else if(1<u){s=Array(u);for(var l=0;l<u;l++)s[l]=arguments[l+2];r.children=s}return{$$typeof:gc,type:n.type,key:i,ref:o,props:r,_owner:a}};Me.createContext=function(n){return n={$$typeof:LP,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:FP,_context:n},n.Consumer=n};Me.createElement=R2;Me.createFactory=function(n){var e=R2.bind(null,n);return e.type=n,e};Me.createRef=function(){return{current:null}};Me.forwardRef=function(n){return{$$typeof:VP,render:n}};Me.isValidElement=Ty;Me.lazy=function(n){return{$$typeof:jP,_payload:{_status:-1,_result:n},_init:HP}};Me.memo=function(n,e){return{$$typeof:UP,type:n,compare:e===void 0?null:e}};Me.startTransition=function(n){var e=Qh.transition;Qh.transition={};try{n()}finally{Qh.transition=e}};Me.unstable_act=k2;Me.useCallback=function(n,e){return In.current.useCallback(n,e)};Me.useContext=function(n){return In.current.useContext(n)};Me.useDebugValue=function(){};Me.useDeferredValue=function(n){return In.current.useDeferredValue(n)};Me.useEffect=function(n,e){return In.current.useEffect(n,e)};Me.useId=function(){return In.current.useId()};Me.useImperativeHandle=function(n,e,t){return In.current.useImperativeHandle(n,e,t)};Me.useInsertionEffect=function(n,e){return In.current.useInsertionEffect(n,e)};Me.useLayoutEffect=function(n,e){return In.current.useLayoutEffect(n,e)};Me.useMemo=function(n,e){return In.current.useMemo(n,e)};Me.useReducer=function(n,e,t){return In.current.useReducer(n,e,t)};Me.useRef=function(n){return In.current.useRef(n)};Me.useState=function(n){return In.current.useState(n)};Me.useSyncExternalStore=function(n,e,t){return In.current.useSyncExternalStore(n,e,t)};Me.useTransition=function(){return In.current.useTransition()};Me.version="18.3.1";x2.exports=Me;var Q=x2.exports;const Ri=w2(Q),Cv=PP({__proto__:null,default:Ri},[Q]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qP=Q,KP=Symbol.for("react.element"),XP=Symbol.for("react.fragment"),QP=Object.prototype.hasOwnProperty,YP=qP.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,JP={key:!0,ref:!0,__self:!0,__source:!0};function A2(n,e,t){var r,i={},o=null,a=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)QP.call(e,r)&&!JP.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:KP,type:n,key:o,ref:a,props:i,_owner:YP.current}}Hf.Fragment=XP;Hf.jsx=A2;Hf.jsxs=A2;_2.exports=Hf;var D=_2.exports,P2={exports:{}},tr={},N2={exports:{}},D2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(V,$){var G=V.length;V.push($);e:for(;0<G;){var te=G-1>>>1,re=V[te];if(0<i(re,$))V[te]=$,V[G]=re,G=te;else break e}}function t(V){return V.length===0?null:V[0]}function r(V){if(V.length===0)return null;var $=V[0],G=V.pop();if(G!==$){V[0]=G;e:for(var te=0,re=V.length,oe=re>>>1;te<oe;){var _e=2*(te+1)-1,pe=V[_e],xe=_e+1,Te=V[xe];if(0>i(pe,G))xe<re&&0>i(Te,pe)?(V[te]=Te,V[xe]=G,te=xe):(V[te]=pe,V[_e]=G,te=_e);else if(xe<re&&0>i(Te,G))V[te]=Te,V[xe]=G,te=xe;else break e}}return $}function i(V,$){var G=V.sortIndex-$.sortIndex;return G!==0?G:V.id-$.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var a=Date,s=a.now();n.unstable_now=function(){return a.now()-s}}var u=[],l=[],c=1,h=null,d=3,p=!1,m=!1,g=!1,y=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(V){for(var $=t(l);$!==null;){if($.callback===null)r(l);else if($.startTime<=V)r(l),$.sortIndex=$.expirationTime,e(u,$);else break;$=t(l)}}function x(V){if(g=!1,_(V),!m)if(t(u)!==null)m=!0,W(C);else{var $=t(l);$!==null&&X(x,$.startTime-V)}}function C(V,$){m=!1,g&&(g=!1,v(E),E=-1),p=!0;var G=d;try{for(_($),h=t(u);h!==null&&(!(h.expirationTime>$)||V&&!N());){var te=h.callback;if(typeof te=="function"){h.callback=null,d=h.priorityLevel;var re=te(h.expirationTime<=$);$=n.unstable_now(),typeof re=="function"?h.callback=re:h===t(u)&&r(u),_($)}else r(u);h=t(u)}if(h!==null)var oe=!0;else{var _e=t(l);_e!==null&&X(x,_e.startTime-$),oe=!1}return oe}finally{h=null,d=G,p=!1}}var A=!1,T=null,E=-1,I=5,S=-1;function N(){return!(n.unstable_now()-S<I)}function P(){if(T!==null){var V=n.unstable_now();S=V;var $=!0;try{$=T(!0,V)}finally{$?k():(A=!1,T=null)}}else A=!1}var k;if(typeof w=="function")k=function(){w(P)};else if(typeof MessageChannel<"u"){var j=new MessageChannel,B=j.port2;j.port1.onmessage=P,k=function(){B.postMessage(null)}}else k=function(){y(P,0)};function W(V){T=V,A||(A=!0,k())}function X(V,$){E=y(function(){V(n.unstable_now())},$)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(V){V.callback=null},n.unstable_continueExecution=function(){m||p||(m=!0,W(C))},n.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<V?Math.floor(1e3/V):5},n.unstable_getCurrentPriorityLevel=function(){return d},n.unstable_getFirstCallbackNode=function(){return t(u)},n.unstable_next=function(V){switch(d){case 1:case 2:case 3:var $=3;break;default:$=d}var G=d;d=$;try{return V()}finally{d=G}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(V,$){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var G=d;d=V;try{return $()}finally{d=G}},n.unstable_scheduleCallback=function(V,$,G){var te=n.unstable_now();switch(typeof G=="object"&&G!==null?(G=G.delay,G=typeof G=="number"&&0<G?te+G:te):G=te,V){case 1:var re=-1;break;case 2:re=250;break;case 5:re=1073741823;break;case 4:re=1e4;break;default:re=5e3}return re=G+re,V={id:c++,callback:$,priorityLevel:V,startTime:G,expirationTime:re,sortIndex:-1},G>te?(V.sortIndex=G,e(l,V),t(u)===null&&V===t(l)&&(g?(v(E),E=-1):g=!0,X(x,G-te))):(V.sortIndex=re,e(u,V),m||p||(m=!0,W(C))),V},n.unstable_shouldYield=N,n.unstable_wrapCallback=function(V){var $=d;return function(){var G=d;d=$;try{return V.apply(this,arguments)}finally{d=G}}}})(D2);N2.exports=D2;var ZP=N2.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eN=Q,Jn=ZP;function ne(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var O2=new Set,Pl={};function za(n,e){Js(n,e),Js(n+"Capture",e)}function Js(n,e){for(Pl[n]=e,n=0;n<e.length;n++)O2.add(e[n])}var Pi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Iv=Object.prototype.hasOwnProperty,tN=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f_={},p_={};function nN(n){return Iv.call(p_,n)?!0:Iv.call(f_,n)?!1:tN.test(n)?p_[n]=!0:(f_[n]=!0,!1)}function rN(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function iN(n,e,t,r){if(e===null||typeof e>"u"||rN(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Tn(n,e,t,r,i,o,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=o,this.removeEmptyString=a}var Zt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Zt[n]=new Tn(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Zt[e]=new Tn(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Zt[n]=new Tn(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Zt[n]=new Tn(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Zt[n]=new Tn(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Zt[n]=new Tn(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Zt[n]=new Tn(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Zt[n]=new Tn(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Zt[n]=new Tn(n,5,!1,n.toLowerCase(),null,!1,!1)});var Sy=/[\-:]([a-z])/g;function Ry(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Sy,Ry);Zt[e]=new Tn(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Sy,Ry);Zt[e]=new Tn(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Sy,Ry);Zt[e]=new Tn(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Zt[n]=new Tn(n,1,!1,n.toLowerCase(),null,!1,!1)});Zt.xlinkHref=new Tn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Zt[n]=new Tn(n,1,!1,n.toLowerCase(),null,!0,!0)});function ky(n,e,t,r){var i=Zt.hasOwnProperty(e)?Zt[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(iN(e,t,i,r)&&(t=null),r||i===null?nN(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var Ui=eN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,hh=Symbol.for("react.element"),xs=Symbol.for("react.portal"),bs=Symbol.for("react.fragment"),Ay=Symbol.for("react.strict_mode"),Tv=Symbol.for("react.profiler"),M2=Symbol.for("react.provider"),F2=Symbol.for("react.context"),Py=Symbol.for("react.forward_ref"),Sv=Symbol.for("react.suspense"),Rv=Symbol.for("react.suspense_list"),Ny=Symbol.for("react.memo"),ro=Symbol.for("react.lazy"),L2=Symbol.for("react.offscreen"),m_=Symbol.iterator;function $u(n){return n===null||typeof n!="object"?null:(n=m_&&n[m_]||n["@@iterator"],typeof n=="function"?n:null)}var dt=Object.assign,hm;function nl(n){if(hm===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);hm=e&&e[1]||""}return`
`+hm+n}var dm=!1;function fm(n,e){if(!n||dm)return"";dm=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var r=l}Reflect.construct(n,[],e)}else{try{e.call()}catch(l){r=l}n.call(e.prototype)}else{try{throw Error()}catch(l){r=l}n()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),o=r.stack.split(`
`),a=i.length-1,s=o.length-1;1<=a&&0<=s&&i[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(i[a]!==o[s]){if(a!==1||s!==1)do if(a--,s--,0>s||i[a]!==o[s]){var u=`
`+i[a].replace(" at new "," at ");return n.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",n.displayName)),u}while(1<=a&&0<=s);break}}}finally{dm=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?nl(n):""}function oN(n){switch(n.tag){case 5:return nl(n.type);case 16:return nl("Lazy");case 13:return nl("Suspense");case 19:return nl("SuspenseList");case 0:case 2:case 15:return n=fm(n.type,!1),n;case 11:return n=fm(n.type.render,!1),n;case 1:return n=fm(n.type,!0),n;default:return""}}function kv(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case bs:return"Fragment";case xs:return"Portal";case Tv:return"Profiler";case Ay:return"StrictMode";case Sv:return"Suspense";case Rv:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case F2:return(n.displayName||"Context")+".Consumer";case M2:return(n._context.displayName||"Context")+".Provider";case Py:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Ny:return e=n.displayName||null,e!==null?e:kv(n.type)||"Memo";case ro:e=n._payload,n=n._init;try{return kv(n(e))}catch{}}return null}function aN(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return kv(e);case 8:return e===Ay?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Lo(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function V2(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function sN(n){var e=V2(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,o=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(a){r=""+a,o.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function dh(n){n._valueTracker||(n._valueTracker=sN(n))}function B2(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=V2(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function yd(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Av(n,e){var t=e.checked;return dt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function v_(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Lo(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function U2(n,e){e=e.checked,e!=null&&ky(n,"checked",e,!1)}function Pv(n,e){U2(n,e);var t=Lo(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Nv(n,e.type,t):e.hasOwnProperty("defaultValue")&&Nv(n,e.type,Lo(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function g_(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Nv(n,e,t){(e!=="number"||yd(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var rl=Array.isArray;function Os(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Lo(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function Dv(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ne(91));return dt({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function y_(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(ne(92));if(rl(t)){if(1<t.length)throw Error(ne(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Lo(t)}}function j2(n,e){var t=Lo(e.value),r=Lo(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function w_(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function z2(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ov(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?z2(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var fh,W2=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(fh=fh||document.createElement("div"),fh.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=fh.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Nl(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var pl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},uN=["Webkit","ms","Moz","O"];Object.keys(pl).forEach(function(n){uN.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),pl[e]=pl[n]})});function $2(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||pl.hasOwnProperty(n)&&pl[n]?(""+e).trim():e+"px"}function H2(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=$2(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var lN=dt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Mv(n,e){if(e){if(lN[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ne(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ne(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ne(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ne(62))}}function Fv(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Lv=null;function Dy(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Vv=null,Ms=null,Fs=null;function __(n){if(n=_c(n)){if(typeof Vv!="function")throw Error(ne(280));var e=n.stateNode;e&&(e=Qf(e),Vv(n.stateNode,n.type,e))}}function G2(n){Ms?Fs?Fs.push(n):Fs=[n]:Ms=n}function q2(){if(Ms){var n=Ms,e=Fs;if(Fs=Ms=null,__(n),e)for(n=0;n<e.length;n++)__(e[n])}}function K2(n,e){return n(e)}function X2(){}var pm=!1;function Q2(n,e,t){if(pm)return n(e,t);pm=!0;try{return K2(n,e,t)}finally{pm=!1,(Ms!==null||Fs!==null)&&(X2(),q2())}}function Dl(n,e){var t=n.stateNode;if(t===null)return null;var r=Qf(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(ne(231,e,typeof t));return t}var Bv=!1;if(Pi)try{var Hu={};Object.defineProperty(Hu,"passive",{get:function(){Bv=!0}}),window.addEventListener("test",Hu,Hu),window.removeEventListener("test",Hu,Hu)}catch{Bv=!1}function cN(n,e,t,r,i,o,a,s,u){var l=Array.prototype.slice.call(arguments,3);try{e.apply(t,l)}catch(c){this.onError(c)}}var ml=!1,wd=null,_d=!1,Uv=null,hN={onError:function(n){ml=!0,wd=n}};function dN(n,e,t,r,i,o,a,s,u){ml=!1,wd=null,cN.apply(hN,arguments)}function fN(n,e,t,r,i,o,a,s,u){if(dN.apply(this,arguments),ml){if(ml){var l=wd;ml=!1,wd=null}else throw Error(ne(198));_d||(_d=!0,Uv=l)}}function Wa(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function Y2(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function x_(n){if(Wa(n)!==n)throw Error(ne(188))}function pN(n){var e=n.alternate;if(!e){if(e=Wa(n),e===null)throw Error(ne(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var o=i.alternate;if(o===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===t)return x_(i),n;if(o===r)return x_(i),e;o=o.sibling}throw Error(ne(188))}if(t.return!==r.return)t=i,r=o;else{for(var a=!1,s=i.child;s;){if(s===t){a=!0,t=i,r=o;break}if(s===r){a=!0,r=i,t=o;break}s=s.sibling}if(!a){for(s=o.child;s;){if(s===t){a=!0,t=o,r=i;break}if(s===r){a=!0,r=o,t=i;break}s=s.sibling}if(!a)throw Error(ne(189))}}if(t.alternate!==r)throw Error(ne(190))}if(t.tag!==3)throw Error(ne(188));return t.stateNode.current===t?n:e}function J2(n){return n=pN(n),n!==null?Z2(n):null}function Z2(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=Z2(n);if(e!==null)return e;n=n.sibling}return null}var eC=Jn.unstable_scheduleCallback,b_=Jn.unstable_cancelCallback,mN=Jn.unstable_shouldYield,vN=Jn.unstable_requestPaint,_t=Jn.unstable_now,gN=Jn.unstable_getCurrentPriorityLevel,Oy=Jn.unstable_ImmediatePriority,tC=Jn.unstable_UserBlockingPriority,xd=Jn.unstable_NormalPriority,yN=Jn.unstable_LowPriority,nC=Jn.unstable_IdlePriority,Gf=null,ei=null;function wN(n){if(ei&&typeof ei.onCommitFiberRoot=="function")try{ei.onCommitFiberRoot(Gf,n,void 0,(n.current.flags&128)===128)}catch{}}var Nr=Math.clz32?Math.clz32:bN,_N=Math.log,xN=Math.LN2;function bN(n){return n>>>=0,n===0?32:31-(_N(n)/xN|0)|0}var ph=64,mh=4194304;function il(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function bd(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,o=n.pingedLanes,a=t&268435455;if(a!==0){var s=a&~i;s!==0?r=il(s):(o&=a,o!==0&&(r=il(o)))}else a=t&~i,a!==0?r=il(a):o!==0&&(r=il(o));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,o=e&-e,i>=o||i===16&&(o&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-Nr(e),i=1<<t,r|=n[t],e&=~i;return r}function EN(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function CN(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,o=n.pendingLanes;0<o;){var a=31-Nr(o),s=1<<a,u=i[a];u===-1?(!(s&t)||s&r)&&(i[a]=EN(s,e)):u<=e&&(n.expiredLanes|=s),o&=~s}}function jv(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function rC(){var n=ph;return ph<<=1,!(ph&4194240)&&(ph=64),n}function mm(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function yc(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Nr(e),n[e]=t}function IN(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-Nr(t),o=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~o}}function My(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-Nr(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var Ke=0;function iC(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var oC,Fy,aC,sC,uC,zv=!1,vh=[],wo=null,_o=null,xo=null,Ol=new Map,Ml=new Map,oo=[],TN="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function E_(n,e){switch(n){case"focusin":case"focusout":wo=null;break;case"dragenter":case"dragleave":_o=null;break;case"mouseover":case"mouseout":xo=null;break;case"pointerover":case"pointerout":Ol.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ml.delete(e.pointerId)}}function Gu(n,e,t,r,i,o){return n===null||n.nativeEvent!==o?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},e!==null&&(e=_c(e),e!==null&&Fy(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function SN(n,e,t,r,i){switch(e){case"focusin":return wo=Gu(wo,n,e,t,r,i),!0;case"dragenter":return _o=Gu(_o,n,e,t,r,i),!0;case"mouseover":return xo=Gu(xo,n,e,t,r,i),!0;case"pointerover":var o=i.pointerId;return Ol.set(o,Gu(Ol.get(o)||null,n,e,t,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Ml.set(o,Gu(Ml.get(o)||null,n,e,t,r,i)),!0}return!1}function lC(n){var e=va(n.target);if(e!==null){var t=Wa(e);if(t!==null){if(e=t.tag,e===13){if(e=Y2(t),e!==null){n.blockedOn=e,uC(n.priority,function(){aC(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Yh(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Wv(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);Lv=r,t.target.dispatchEvent(r),Lv=null}else return e=_c(t),e!==null&&Fy(e),n.blockedOn=t,!1;e.shift()}return!0}function C_(n,e,t){Yh(n)&&t.delete(e)}function RN(){zv=!1,wo!==null&&Yh(wo)&&(wo=null),_o!==null&&Yh(_o)&&(_o=null),xo!==null&&Yh(xo)&&(xo=null),Ol.forEach(C_),Ml.forEach(C_)}function qu(n,e){n.blockedOn===e&&(n.blockedOn=null,zv||(zv=!0,Jn.unstable_scheduleCallback(Jn.unstable_NormalPriority,RN)))}function Fl(n){function e(i){return qu(i,n)}if(0<vh.length){qu(vh[0],n);for(var t=1;t<vh.length;t++){var r=vh[t];r.blockedOn===n&&(r.blockedOn=null)}}for(wo!==null&&qu(wo,n),_o!==null&&qu(_o,n),xo!==null&&qu(xo,n),Ol.forEach(e),Ml.forEach(e),t=0;t<oo.length;t++)r=oo[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<oo.length&&(t=oo[0],t.blockedOn===null);)lC(t),t.blockedOn===null&&oo.shift()}var Ls=Ui.ReactCurrentBatchConfig,Ed=!0;function kN(n,e,t,r){var i=Ke,o=Ls.transition;Ls.transition=null;try{Ke=1,Ly(n,e,t,r)}finally{Ke=i,Ls.transition=o}}function AN(n,e,t,r){var i=Ke,o=Ls.transition;Ls.transition=null;try{Ke=4,Ly(n,e,t,r)}finally{Ke=i,Ls.transition=o}}function Ly(n,e,t,r){if(Ed){var i=Wv(n,e,t,r);if(i===null)Im(n,e,r,Cd,t),E_(n,r);else if(SN(i,n,e,t,r))r.stopPropagation();else if(E_(n,r),e&4&&-1<TN.indexOf(n)){for(;i!==null;){var o=_c(i);if(o!==null&&oC(o),o=Wv(n,e,t,r),o===null&&Im(n,e,r,Cd,t),o===i)break;i=o}i!==null&&r.stopPropagation()}else Im(n,e,r,null,t)}}var Cd=null;function Wv(n,e,t,r){if(Cd=null,n=Dy(r),n=va(n),n!==null)if(e=Wa(n),e===null)n=null;else if(t=e.tag,t===13){if(n=Y2(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Cd=n,null}function cC(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(gN()){case Oy:return 1;case tC:return 4;case xd:case yN:return 16;case nC:return 536870912;default:return 16}default:return 16}}var ho=null,Vy=null,Jh=null;function hC(){if(Jh)return Jh;var n,e=Vy,t=e.length,r,i="value"in ho?ho.value:ho.textContent,o=i.length;for(n=0;n<t&&e[n]===i[n];n++);var a=t-n;for(r=1;r<=a&&e[t-r]===i[o-r];r++);return Jh=i.slice(n,1<r?1-r:void 0)}function Zh(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function gh(){return!0}function I_(){return!1}function nr(n){function e(t,r,i,o,a){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=o,this.target=a,this.currentTarget=null;for(var s in n)n.hasOwnProperty(s)&&(t=n[s],this[s]=t?t(o):o[s]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?gh:I_,this.isPropagationStopped=I_,this}return dt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=gh)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=gh)},persist:function(){},isPersistent:gh}),e}var wu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},By=nr(wu),wc=dt({},wu,{view:0,detail:0}),PN=nr(wc),vm,gm,Ku,qf=dt({},wc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Uy,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Ku&&(Ku&&n.type==="mousemove"?(vm=n.screenX-Ku.screenX,gm=n.screenY-Ku.screenY):gm=vm=0,Ku=n),vm)},movementY:function(n){return"movementY"in n?n.movementY:gm}}),T_=nr(qf),NN=dt({},qf,{dataTransfer:0}),DN=nr(NN),ON=dt({},wc,{relatedTarget:0}),ym=nr(ON),MN=dt({},wu,{animationName:0,elapsedTime:0,pseudoElement:0}),FN=nr(MN),LN=dt({},wu,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),VN=nr(LN),BN=dt({},wu,{data:0}),S_=nr(BN),UN={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},jN={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zN={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function WN(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=zN[n])?!!e[n]:!1}function Uy(){return WN}var $N=dt({},wc,{key:function(n){if(n.key){var e=UN[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Zh(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?jN[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Uy,charCode:function(n){return n.type==="keypress"?Zh(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Zh(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),HN=nr($N),GN=dt({},qf,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),R_=nr(GN),qN=dt({},wc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Uy}),KN=nr(qN),XN=dt({},wu,{propertyName:0,elapsedTime:0,pseudoElement:0}),QN=nr(XN),YN=dt({},qf,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),JN=nr(YN),ZN=[9,13,27,32],jy=Pi&&"CompositionEvent"in window,vl=null;Pi&&"documentMode"in document&&(vl=document.documentMode);var eD=Pi&&"TextEvent"in window&&!vl,dC=Pi&&(!jy||vl&&8<vl&&11>=vl),k_=" ",A_=!1;function fC(n,e){switch(n){case"keyup":return ZN.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function pC(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Es=!1;function tD(n,e){switch(n){case"compositionend":return pC(e);case"keypress":return e.which!==32?null:(A_=!0,k_);case"textInput":return n=e.data,n===k_&&A_?null:n;default:return null}}function nD(n,e){if(Es)return n==="compositionend"||!jy&&fC(n,e)?(n=hC(),Jh=Vy=ho=null,Es=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return dC&&e.locale!=="ko"?null:e.data;default:return null}}var rD={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function P_(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!rD[n.type]:e==="textarea"}function mC(n,e,t,r){G2(r),e=Id(e,"onChange"),0<e.length&&(t=new By("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var gl=null,Ll=null;function iD(n){TC(n,0)}function Kf(n){var e=Ts(n);if(B2(e))return n}function oD(n,e){if(n==="change")return e}var vC=!1;if(Pi){var wm;if(Pi){var _m="oninput"in document;if(!_m){var N_=document.createElement("div");N_.setAttribute("oninput","return;"),_m=typeof N_.oninput=="function"}wm=_m}else wm=!1;vC=wm&&(!document.documentMode||9<document.documentMode)}function D_(){gl&&(gl.detachEvent("onpropertychange",gC),Ll=gl=null)}function gC(n){if(n.propertyName==="value"&&Kf(Ll)){var e=[];mC(e,Ll,n,Dy(n)),Q2(iD,e)}}function aD(n,e,t){n==="focusin"?(D_(),gl=e,Ll=t,gl.attachEvent("onpropertychange",gC)):n==="focusout"&&D_()}function sD(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Kf(Ll)}function uD(n,e){if(n==="click")return Kf(e)}function lD(n,e){if(n==="input"||n==="change")return Kf(e)}function cD(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Fr=typeof Object.is=="function"?Object.is:cD;function Vl(n,e){if(Fr(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!Iv.call(e,i)||!Fr(n[i],e[i]))return!1}return!0}function O_(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function M_(n,e){var t=O_(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=O_(t)}}function yC(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?yC(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function wC(){for(var n=window,e=yd();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=yd(n.document)}return e}function zy(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function hD(n){var e=wC(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&yC(t.ownerDocument.documentElement,t)){if(r!==null&&zy(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,o=Math.min(r.start,i);r=r.end===void 0?o:Math.min(r.end,i),!n.extend&&o>r&&(i=r,r=o,o=i),i=M_(t,o);var a=M_(t,r);i&&a&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),o>r?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var dD=Pi&&"documentMode"in document&&11>=document.documentMode,Cs=null,$v=null,yl=null,Hv=!1;function F_(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Hv||Cs==null||Cs!==yd(r)||(r=Cs,"selectionStart"in r&&zy(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),yl&&Vl(yl,r)||(yl=r,r=Id($v,"onSelect"),0<r.length&&(e=new By("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Cs)))}function yh(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Is={animationend:yh("Animation","AnimationEnd"),animationiteration:yh("Animation","AnimationIteration"),animationstart:yh("Animation","AnimationStart"),transitionend:yh("Transition","TransitionEnd")},xm={},_C={};Pi&&(_C=document.createElement("div").style,"AnimationEvent"in window||(delete Is.animationend.animation,delete Is.animationiteration.animation,delete Is.animationstart.animation),"TransitionEvent"in window||delete Is.transitionend.transition);function Xf(n){if(xm[n])return xm[n];if(!Is[n])return n;var e=Is[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in _C)return xm[n]=e[t];return n}var xC=Xf("animationend"),bC=Xf("animationiteration"),EC=Xf("animationstart"),CC=Xf("transitionend"),IC=new Map,L_="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ko(n,e){IC.set(n,e),za(e,[n])}for(var bm=0;bm<L_.length;bm++){var Em=L_[bm],fD=Em.toLowerCase(),pD=Em[0].toUpperCase()+Em.slice(1);Ko(fD,"on"+pD)}Ko(xC,"onAnimationEnd");Ko(bC,"onAnimationIteration");Ko(EC,"onAnimationStart");Ko("dblclick","onDoubleClick");Ko("focusin","onFocus");Ko("focusout","onBlur");Ko(CC,"onTransitionEnd");Js("onMouseEnter",["mouseout","mouseover"]);Js("onMouseLeave",["mouseout","mouseover"]);Js("onPointerEnter",["pointerout","pointerover"]);Js("onPointerLeave",["pointerout","pointerover"]);za("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));za("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));za("onBeforeInput",["compositionend","keypress","textInput","paste"]);za("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));za("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));za("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ol="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mD=new Set("cancel close invalid load scroll toggle".split(" ").concat(ol));function V_(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,fN(r,e,void 0,n),n.currentTarget=null}function TC(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var o=void 0;if(e)for(var a=r.length-1;0<=a;a--){var s=r[a],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==o&&i.isPropagationStopped())break e;V_(i,s,l),o=u}else for(a=0;a<r.length;a++){if(s=r[a],u=s.instance,l=s.currentTarget,s=s.listener,u!==o&&i.isPropagationStopped())break e;V_(i,s,l),o=u}}}if(_d)throw n=Uv,_d=!1,Uv=null,n}function rt(n,e){var t=e[Qv];t===void 0&&(t=e[Qv]=new Set);var r=n+"__bubble";t.has(r)||(SC(e,n,2,!1),t.add(r))}function Cm(n,e,t){var r=0;e&&(r|=4),SC(t,n,r,e)}var wh="_reactListening"+Math.random().toString(36).slice(2);function Bl(n){if(!n[wh]){n[wh]=!0,O2.forEach(function(t){t!=="selectionchange"&&(mD.has(t)||Cm(t,!1,n),Cm(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[wh]||(e[wh]=!0,Cm("selectionchange",!1,e))}}function SC(n,e,t,r){switch(cC(e)){case 1:var i=kN;break;case 4:i=AN;break;default:i=Ly}t=i.bind(null,e,t,n),i=void 0,!Bv||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function Im(n,e,t,r,i){var o=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var s=r.stateNode.containerInfo;if(s===i||s.nodeType===8&&s.parentNode===i)break;if(a===4)for(a=r.return;a!==null;){var u=a.tag;if((u===3||u===4)&&(u=a.stateNode.containerInfo,u===i||u.nodeType===8&&u.parentNode===i))return;a=a.return}for(;s!==null;){if(a=va(s),a===null)return;if(u=a.tag,u===5||u===6){r=o=a;continue e}s=s.parentNode}}r=r.return}Q2(function(){var l=o,c=Dy(t),h=[];e:{var d=IC.get(n);if(d!==void 0){var p=By,m=n;switch(n){case"keypress":if(Zh(t)===0)break e;case"keydown":case"keyup":p=HN;break;case"focusin":m="focus",p=ym;break;case"focusout":m="blur",p=ym;break;case"beforeblur":case"afterblur":p=ym;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=T_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=DN;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=KN;break;case xC:case bC:case EC:p=FN;break;case CC:p=QN;break;case"scroll":p=PN;break;case"wheel":p=JN;break;case"copy":case"cut":case"paste":p=VN;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=R_}var g=(e&4)!==0,y=!g&&n==="scroll",v=g?d!==null?d+"Capture":null:d;g=[];for(var w=l,_;w!==null;){_=w;var x=_.stateNode;if(_.tag===5&&x!==null&&(_=x,v!==null&&(x=Dl(w,v),x!=null&&g.push(Ul(w,x,_)))),y)break;w=w.return}0<g.length&&(d=new p(d,m,null,t,c),h.push({event:d,listeners:g}))}}if(!(e&7)){e:{if(d=n==="mouseover"||n==="pointerover",p=n==="mouseout"||n==="pointerout",d&&t!==Lv&&(m=t.relatedTarget||t.fromElement)&&(va(m)||m[Ni]))break e;if((p||d)&&(d=c.window===c?c:(d=c.ownerDocument)?d.defaultView||d.parentWindow:window,p?(m=t.relatedTarget||t.toElement,p=l,m=m?va(m):null,m!==null&&(y=Wa(m),m!==y||m.tag!==5&&m.tag!==6)&&(m=null)):(p=null,m=l),p!==m)){if(g=T_,x="onMouseLeave",v="onMouseEnter",w="mouse",(n==="pointerout"||n==="pointerover")&&(g=R_,x="onPointerLeave",v="onPointerEnter",w="pointer"),y=p==null?d:Ts(p),_=m==null?d:Ts(m),d=new g(x,w+"leave",p,t,c),d.target=y,d.relatedTarget=_,x=null,va(c)===l&&(g=new g(v,w+"enter",m,t,c),g.target=_,g.relatedTarget=y,x=g),y=x,p&&m)t:{for(g=p,v=m,w=0,_=g;_;_=us(_))w++;for(_=0,x=v;x;x=us(x))_++;for(;0<w-_;)g=us(g),w--;for(;0<_-w;)v=us(v),_--;for(;w--;){if(g===v||v!==null&&g===v.alternate)break t;g=us(g),v=us(v)}g=null}else g=null;p!==null&&B_(h,d,p,g,!1),m!==null&&y!==null&&B_(h,y,m,g,!0)}}e:{if(d=l?Ts(l):window,p=d.nodeName&&d.nodeName.toLowerCase(),p==="select"||p==="input"&&d.type==="file")var C=oD;else if(P_(d))if(vC)C=lD;else{C=sD;var A=aD}else(p=d.nodeName)&&p.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(C=uD);if(C&&(C=C(n,l))){mC(h,C,t,c);break e}A&&A(n,d,l),n==="focusout"&&(A=d._wrapperState)&&A.controlled&&d.type==="number"&&Nv(d,"number",d.value)}switch(A=l?Ts(l):window,n){case"focusin":(P_(A)||A.contentEditable==="true")&&(Cs=A,$v=l,yl=null);break;case"focusout":yl=$v=Cs=null;break;case"mousedown":Hv=!0;break;case"contextmenu":case"mouseup":case"dragend":Hv=!1,F_(h,t,c);break;case"selectionchange":if(dD)break;case"keydown":case"keyup":F_(h,t,c)}var T;if(jy)e:{switch(n){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else Es?fC(n,t)&&(E="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(E="onCompositionStart");E&&(dC&&t.locale!=="ko"&&(Es||E!=="onCompositionStart"?E==="onCompositionEnd"&&Es&&(T=hC()):(ho=c,Vy="value"in ho?ho.value:ho.textContent,Es=!0)),A=Id(l,E),0<A.length&&(E=new S_(E,n,null,t,c),h.push({event:E,listeners:A}),T?E.data=T:(T=pC(t),T!==null&&(E.data=T)))),(T=eD?tD(n,t):nD(n,t))&&(l=Id(l,"onBeforeInput"),0<l.length&&(c=new S_("onBeforeInput","beforeinput",null,t,c),h.push({event:c,listeners:l}),c.data=T))}TC(h,e)})}function Ul(n,e,t){return{instance:n,listener:e,currentTarget:t}}function Id(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=Dl(n,t),o!=null&&r.unshift(Ul(n,o,i)),o=Dl(n,e),o!=null&&r.push(Ul(n,o,i))),n=n.return}return r}function us(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function B_(n,e,t,r,i){for(var o=e._reactName,a=[];t!==null&&t!==r;){var s=t,u=s.alternate,l=s.stateNode;if(u!==null&&u===r)break;s.tag===5&&l!==null&&(s=l,i?(u=Dl(t,o),u!=null&&a.unshift(Ul(t,u,s))):i||(u=Dl(t,o),u!=null&&a.push(Ul(t,u,s)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}var vD=/\r\n?/g,gD=/\u0000|\uFFFD/g;function U_(n){return(typeof n=="string"?n:""+n).replace(vD,`
`).replace(gD,"")}function _h(n,e,t){if(e=U_(e),U_(n)!==e&&t)throw Error(ne(425))}function Td(){}var Gv=null,qv=null;function Kv(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Xv=typeof setTimeout=="function"?setTimeout:void 0,yD=typeof clearTimeout=="function"?clearTimeout:void 0,j_=typeof Promise=="function"?Promise:void 0,wD=typeof queueMicrotask=="function"?queueMicrotask:typeof j_<"u"?function(n){return j_.resolve(null).then(n).catch(_D)}:Xv;function _D(n){setTimeout(function(){throw n})}function Tm(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),Fl(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);Fl(e)}function bo(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function z_(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var _u=Math.random().toString(36).slice(2),Qr="__reactFiber$"+_u,jl="__reactProps$"+_u,Ni="__reactContainer$"+_u,Qv="__reactEvents$"+_u,xD="__reactListeners$"+_u,bD="__reactHandles$"+_u;function va(n){var e=n[Qr];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Ni]||t[Qr]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=z_(n);n!==null;){if(t=n[Qr])return t;n=z_(n)}return e}n=t,t=n.parentNode}return null}function _c(n){return n=n[Qr]||n[Ni],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Ts(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(ne(33))}function Qf(n){return n[jl]||null}var Yv=[],Ss=-1;function Xo(n){return{current:n}}function at(n){0>Ss||(n.current=Yv[Ss],Yv[Ss]=null,Ss--)}function et(n,e){Ss++,Yv[Ss]=n.current,n.current=e}var Vo={},yn=Xo(Vo),Dn=Xo(!1),Sa=Vo;function Zs(n,e){var t=n.type.contextTypes;if(!t)return Vo;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in t)i[o]=e[o];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function On(n){return n=n.childContextTypes,n!=null}function Sd(){at(Dn),at(yn)}function W_(n,e,t){if(yn.current!==Vo)throw Error(ne(168));et(yn,e),et(Dn,t)}function RC(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(ne(108,aN(n)||"Unknown",i));return dt({},t,r)}function Rd(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Vo,Sa=yn.current,et(yn,n),et(Dn,Dn.current),!0}function $_(n,e,t){var r=n.stateNode;if(!r)throw Error(ne(169));t?(n=RC(n,e,Sa),r.__reactInternalMemoizedMergedChildContext=n,at(Dn),at(yn),et(yn,n)):at(Dn),et(Dn,t)}var bi=null,Yf=!1,Sm=!1;function kC(n){bi===null?bi=[n]:bi.push(n)}function ED(n){Yf=!0,kC(n)}function Qo(){if(!Sm&&bi!==null){Sm=!0;var n=0,e=Ke;try{var t=bi;for(Ke=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}bi=null,Yf=!1}catch(i){throw bi!==null&&(bi=bi.slice(n+1)),eC(Oy,Qo),i}finally{Ke=e,Sm=!1}}return null}var Rs=[],ks=0,kd=null,Ad=0,sr=[],ur=0,Ra=null,Ci=1,Ii="";function la(n,e){Rs[ks++]=Ad,Rs[ks++]=kd,kd=n,Ad=e}function AC(n,e,t){sr[ur++]=Ci,sr[ur++]=Ii,sr[ur++]=Ra,Ra=n;var r=Ci;n=Ii;var i=32-Nr(r)-1;r&=~(1<<i),t+=1;var o=32-Nr(e)+i;if(30<o){var a=i-i%5;o=(r&(1<<a)-1).toString(32),r>>=a,i-=a,Ci=1<<32-Nr(e)+i|t<<i|r,Ii=o+n}else Ci=1<<o|t<<i|r,Ii=n}function Wy(n){n.return!==null&&(la(n,1),AC(n,1,0))}function $y(n){for(;n===kd;)kd=Rs[--ks],Rs[ks]=null,Ad=Rs[--ks],Rs[ks]=null;for(;n===Ra;)Ra=sr[--ur],sr[ur]=null,Ii=sr[--ur],sr[ur]=null,Ci=sr[--ur],sr[ur]=null}var Qn=null,Hn=null,st=!1,Ir=null;function PC(n,e){var t=fr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function H_(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Qn=n,Hn=bo(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Qn=n,Hn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Ra!==null?{id:Ci,overflow:Ii}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=fr(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Qn=n,Hn=null,!0):!1;default:return!1}}function Jv(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Zv(n){if(st){var e=Hn;if(e){var t=e;if(!H_(n,e)){if(Jv(n))throw Error(ne(418));e=bo(t.nextSibling);var r=Qn;e&&H_(n,e)?PC(r,t):(n.flags=n.flags&-4097|2,st=!1,Qn=n)}}else{if(Jv(n))throw Error(ne(418));n.flags=n.flags&-4097|2,st=!1,Qn=n}}}function G_(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Qn=n}function xh(n){if(n!==Qn)return!1;if(!st)return G_(n),st=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!Kv(n.type,n.memoizedProps)),e&&(e=Hn)){if(Jv(n))throw NC(),Error(ne(418));for(;e;)PC(n,e),e=bo(e.nextSibling)}if(G_(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(ne(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Hn=bo(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Hn=null}}else Hn=Qn?bo(n.stateNode.nextSibling):null;return!0}function NC(){for(var n=Hn;n;)n=bo(n.nextSibling)}function eu(){Hn=Qn=null,st=!1}function Hy(n){Ir===null?Ir=[n]:Ir.push(n)}var CD=Ui.ReactCurrentBatchConfig;function Xu(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(ne(309));var r=t.stateNode}if(!r)throw Error(ne(147,n));var i=r,o=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(a){var s=i.refs;a===null?delete s[o]:s[o]=a},e._stringRef=o,e)}if(typeof n!="string")throw Error(ne(284));if(!t._owner)throw Error(ne(290,n))}return n}function bh(n,e){throw n=Object.prototype.toString.call(e),Error(ne(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function q_(n){var e=n._init;return e(n._payload)}function DC(n){function e(v,w){if(n){var _=v.deletions;_===null?(v.deletions=[w],v.flags|=16):_.push(w)}}function t(v,w){if(!n)return null;for(;w!==null;)e(v,w),w=w.sibling;return null}function r(v,w){for(v=new Map;w!==null;)w.key!==null?v.set(w.key,w):v.set(w.index,w),w=w.sibling;return v}function i(v,w){return v=To(v,w),v.index=0,v.sibling=null,v}function o(v,w,_){return v.index=_,n?(_=v.alternate,_!==null?(_=_.index,_<w?(v.flags|=2,w):_):(v.flags|=2,w)):(v.flags|=1048576,w)}function a(v){return n&&v.alternate===null&&(v.flags|=2),v}function s(v,w,_,x){return w===null||w.tag!==6?(w=Om(_,v.mode,x),w.return=v,w):(w=i(w,_),w.return=v,w)}function u(v,w,_,x){var C=_.type;return C===bs?c(v,w,_.props.children,x,_.key):w!==null&&(w.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===ro&&q_(C)===w.type)?(x=i(w,_.props),x.ref=Xu(v,w,_),x.return=v,x):(x=ad(_.type,_.key,_.props,null,v.mode,x),x.ref=Xu(v,w,_),x.return=v,x)}function l(v,w,_,x){return w===null||w.tag!==4||w.stateNode.containerInfo!==_.containerInfo||w.stateNode.implementation!==_.implementation?(w=Mm(_,v.mode,x),w.return=v,w):(w=i(w,_.children||[]),w.return=v,w)}function c(v,w,_,x,C){return w===null||w.tag!==7?(w=Ea(_,v.mode,x,C),w.return=v,w):(w=i(w,_),w.return=v,w)}function h(v,w,_){if(typeof w=="string"&&w!==""||typeof w=="number")return w=Om(""+w,v.mode,_),w.return=v,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case hh:return _=ad(w.type,w.key,w.props,null,v.mode,_),_.ref=Xu(v,null,w),_.return=v,_;case xs:return w=Mm(w,v.mode,_),w.return=v,w;case ro:var x=w._init;return h(v,x(w._payload),_)}if(rl(w)||$u(w))return w=Ea(w,v.mode,_,null),w.return=v,w;bh(v,w)}return null}function d(v,w,_,x){var C=w!==null?w.key:null;if(typeof _=="string"&&_!==""||typeof _=="number")return C!==null?null:s(v,w,""+_,x);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case hh:return _.key===C?u(v,w,_,x):null;case xs:return _.key===C?l(v,w,_,x):null;case ro:return C=_._init,d(v,w,C(_._payload),x)}if(rl(_)||$u(_))return C!==null?null:c(v,w,_,x,null);bh(v,_)}return null}function p(v,w,_,x,C){if(typeof x=="string"&&x!==""||typeof x=="number")return v=v.get(_)||null,s(w,v,""+x,C);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case hh:return v=v.get(x.key===null?_:x.key)||null,u(w,v,x,C);case xs:return v=v.get(x.key===null?_:x.key)||null,l(w,v,x,C);case ro:var A=x._init;return p(v,w,_,A(x._payload),C)}if(rl(x)||$u(x))return v=v.get(_)||null,c(w,v,x,C,null);bh(w,x)}return null}function m(v,w,_,x){for(var C=null,A=null,T=w,E=w=0,I=null;T!==null&&E<_.length;E++){T.index>E?(I=T,T=null):I=T.sibling;var S=d(v,T,_[E],x);if(S===null){T===null&&(T=I);break}n&&T&&S.alternate===null&&e(v,T),w=o(S,w,E),A===null?C=S:A.sibling=S,A=S,T=I}if(E===_.length)return t(v,T),st&&la(v,E),C;if(T===null){for(;E<_.length;E++)T=h(v,_[E],x),T!==null&&(w=o(T,w,E),A===null?C=T:A.sibling=T,A=T);return st&&la(v,E),C}for(T=r(v,T);E<_.length;E++)I=p(T,v,E,_[E],x),I!==null&&(n&&I.alternate!==null&&T.delete(I.key===null?E:I.key),w=o(I,w,E),A===null?C=I:A.sibling=I,A=I);return n&&T.forEach(function(N){return e(v,N)}),st&&la(v,E),C}function g(v,w,_,x){var C=$u(_);if(typeof C!="function")throw Error(ne(150));if(_=C.call(_),_==null)throw Error(ne(151));for(var A=C=null,T=w,E=w=0,I=null,S=_.next();T!==null&&!S.done;E++,S=_.next()){T.index>E?(I=T,T=null):I=T.sibling;var N=d(v,T,S.value,x);if(N===null){T===null&&(T=I);break}n&&T&&N.alternate===null&&e(v,T),w=o(N,w,E),A===null?C=N:A.sibling=N,A=N,T=I}if(S.done)return t(v,T),st&&la(v,E),C;if(T===null){for(;!S.done;E++,S=_.next())S=h(v,S.value,x),S!==null&&(w=o(S,w,E),A===null?C=S:A.sibling=S,A=S);return st&&la(v,E),C}for(T=r(v,T);!S.done;E++,S=_.next())S=p(T,v,E,S.value,x),S!==null&&(n&&S.alternate!==null&&T.delete(S.key===null?E:S.key),w=o(S,w,E),A===null?C=S:A.sibling=S,A=S);return n&&T.forEach(function(P){return e(v,P)}),st&&la(v,E),C}function y(v,w,_,x){if(typeof _=="object"&&_!==null&&_.type===bs&&_.key===null&&(_=_.props.children),typeof _=="object"&&_!==null){switch(_.$$typeof){case hh:e:{for(var C=_.key,A=w;A!==null;){if(A.key===C){if(C=_.type,C===bs){if(A.tag===7){t(v,A.sibling),w=i(A,_.props.children),w.return=v,v=w;break e}}else if(A.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===ro&&q_(C)===A.type){t(v,A.sibling),w=i(A,_.props),w.ref=Xu(v,A,_),w.return=v,v=w;break e}t(v,A);break}else e(v,A);A=A.sibling}_.type===bs?(w=Ea(_.props.children,v.mode,x,_.key),w.return=v,v=w):(x=ad(_.type,_.key,_.props,null,v.mode,x),x.ref=Xu(v,w,_),x.return=v,v=x)}return a(v);case xs:e:{for(A=_.key;w!==null;){if(w.key===A)if(w.tag===4&&w.stateNode.containerInfo===_.containerInfo&&w.stateNode.implementation===_.implementation){t(v,w.sibling),w=i(w,_.children||[]),w.return=v,v=w;break e}else{t(v,w);break}else e(v,w);w=w.sibling}w=Mm(_,v.mode,x),w.return=v,v=w}return a(v);case ro:return A=_._init,y(v,w,A(_._payload),x)}if(rl(_))return m(v,w,_,x);if($u(_))return g(v,w,_,x);bh(v,_)}return typeof _=="string"&&_!==""||typeof _=="number"?(_=""+_,w!==null&&w.tag===6?(t(v,w.sibling),w=i(w,_),w.return=v,v=w):(t(v,w),w=Om(_,v.mode,x),w.return=v,v=w),a(v)):t(v,w)}return y}var tu=DC(!0),OC=DC(!1),Pd=Xo(null),Nd=null,As=null,Gy=null;function qy(){Gy=As=Nd=null}function Ky(n){var e=Pd.current;at(Pd),n._currentValue=e}function eg(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Vs(n,e){Nd=n,Gy=As=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Nn=!0),n.firstContext=null)}function yr(n){var e=n._currentValue;if(Gy!==n)if(n={context:n,memoizedValue:e,next:null},As===null){if(Nd===null)throw Error(ne(308));As=n,Nd.dependencies={lanes:0,firstContext:n}}else As=As.next=n;return e}var ga=null;function Xy(n){ga===null?ga=[n]:ga.push(n)}function MC(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,Xy(e)):(t.next=i.next,i.next=t),e.interleaved=t,Di(n,r)}function Di(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var io=!1;function Qy(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function FC(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function ki(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Eo(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,ze&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Di(n,t)}return i=r.interleaved,i===null?(e.next=e,Xy(r)):(e.next=i.next,i.next=e),r.interleaved=e,Di(n,t)}function ed(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,My(n,t)}}function K_(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,o=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};o===null?i=o=a:o=o.next=a,t=t.next}while(t!==null);o===null?i=o=e:o=o.next=e}else i=o=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Dd(n,e,t,r){var i=n.updateQueue;io=!1;var o=i.firstBaseUpdate,a=i.lastBaseUpdate,s=i.shared.pending;if(s!==null){i.shared.pending=null;var u=s,l=u.next;u.next=null,a===null?o=l:a.next=l,a=u;var c=n.alternate;c!==null&&(c=c.updateQueue,s=c.lastBaseUpdate,s!==a&&(s===null?c.firstBaseUpdate=l:s.next=l,c.lastBaseUpdate=u))}if(o!==null){var h=i.baseState;a=0,c=l=u=null,s=o;do{var d=s.lane,p=s.eventTime;if((r&d)===d){c!==null&&(c=c.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var m=n,g=s;switch(d=e,p=t,g.tag){case 1:if(m=g.payload,typeof m=="function"){h=m.call(p,h,d);break e}h=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=g.payload,d=typeof m=="function"?m.call(p,h,d):m,d==null)break e;h=dt({},h,d);break e;case 2:io=!0}}s.callback!==null&&s.lane!==0&&(n.flags|=64,d=i.effects,d===null?i.effects=[s]:d.push(s))}else p={eventTime:p,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},c===null?(l=c=p,u=h):c=c.next=p,a|=d;if(s=s.next,s===null){if(s=i.shared.pending,s===null)break;d=s,s=d.next,d.next=null,i.lastBaseUpdate=d,i.shared.pending=null}}while(!0);if(c===null&&(u=h),i.baseState=u,i.firstBaseUpdate=l,i.lastBaseUpdate=c,e=i.shared.interleaved,e!==null){i=e;do a|=i.lane,i=i.next;while(i!==e)}else o===null&&(i.shared.lanes=0);Aa|=a,n.lanes=a,n.memoizedState=h}}function X_(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(ne(191,i));i.call(r)}}}var xc={},ti=Xo(xc),zl=Xo(xc),Wl=Xo(xc);function ya(n){if(n===xc)throw Error(ne(174));return n}function Yy(n,e){switch(et(Wl,e),et(zl,n),et(ti,xc),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Ov(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Ov(e,n)}at(ti),et(ti,e)}function nu(){at(ti),at(zl),at(Wl)}function LC(n){ya(Wl.current);var e=ya(ti.current),t=Ov(e,n.type);e!==t&&(et(zl,n),et(ti,t))}function Jy(n){zl.current===n&&(at(ti),at(zl))}var ut=Xo(0);function Od(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Rm=[];function Zy(){for(var n=0;n<Rm.length;n++)Rm[n]._workInProgressVersionPrimary=null;Rm.length=0}var td=Ui.ReactCurrentDispatcher,km=Ui.ReactCurrentBatchConfig,ka=0,ht=null,kt=null,Ut=null,Md=!1,wl=!1,$l=0,ID=0;function on(){throw Error(ne(321))}function e0(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Fr(n[t],e[t]))return!1;return!0}function t0(n,e,t,r,i,o){if(ka=o,ht=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,td.current=n===null||n.memoizedState===null?kD:AD,n=t(r,i),wl){o=0;do{if(wl=!1,$l=0,25<=o)throw Error(ne(301));o+=1,Ut=kt=null,e.updateQueue=null,td.current=PD,n=t(r,i)}while(wl)}if(td.current=Fd,e=kt!==null&&kt.next!==null,ka=0,Ut=kt=ht=null,Md=!1,e)throw Error(ne(300));return n}function n0(){var n=$l!==0;return $l=0,n}function Gr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ut===null?ht.memoizedState=Ut=n:Ut=Ut.next=n,Ut}function wr(){if(kt===null){var n=ht.alternate;n=n!==null?n.memoizedState:null}else n=kt.next;var e=Ut===null?ht.memoizedState:Ut.next;if(e!==null)Ut=e,kt=n;else{if(n===null)throw Error(ne(310));kt=n,n={memoizedState:kt.memoizedState,baseState:kt.baseState,baseQueue:kt.baseQueue,queue:kt.queue,next:null},Ut===null?ht.memoizedState=Ut=n:Ut=Ut.next=n}return Ut}function Hl(n,e){return typeof e=="function"?e(n):e}function Am(n){var e=wr(),t=e.queue;if(t===null)throw Error(ne(311));t.lastRenderedReducer=n;var r=kt,i=r.baseQueue,o=t.pending;if(o!==null){if(i!==null){var a=i.next;i.next=o.next,o.next=a}r.baseQueue=i=o,t.pending=null}if(i!==null){o=i.next,r=r.baseState;var s=a=null,u=null,l=o;do{var c=l.lane;if((ka&c)===c)u!==null&&(u=u.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:n(r,l.action);else{var h={lane:c,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};u===null?(s=u=h,a=r):u=u.next=h,ht.lanes|=c,Aa|=c}l=l.next}while(l!==null&&l!==o);u===null?a=r:u.next=s,Fr(r,e.memoizedState)||(Nn=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=u,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do o=i.lane,ht.lanes|=o,Aa|=o,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Pm(n){var e=wr(),t=e.queue;if(t===null)throw Error(ne(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,o=e.memoizedState;if(i!==null){t.pending=null;var a=i=i.next;do o=n(o,a.action),a=a.next;while(a!==i);Fr(o,e.memoizedState)||(Nn=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),t.lastRenderedState=o}return[o,r]}function VC(){}function BC(n,e){var t=ht,r=wr(),i=e(),o=!Fr(r.memoizedState,i);if(o&&(r.memoizedState=i,Nn=!0),r=r.queue,r0(zC.bind(null,t,r,n),[n]),r.getSnapshot!==e||o||Ut!==null&&Ut.memoizedState.tag&1){if(t.flags|=2048,Gl(9,jC.bind(null,t,r,i,e),void 0,null),jt===null)throw Error(ne(349));ka&30||UC(t,e,i)}return i}function UC(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=ht.updateQueue,e===null?(e={lastEffect:null,stores:null},ht.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function jC(n,e,t,r){e.value=t,e.getSnapshot=r,WC(e)&&$C(n)}function zC(n,e,t){return t(function(){WC(e)&&$C(n)})}function WC(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Fr(n,t)}catch{return!0}}function $C(n){var e=Di(n,1);e!==null&&Dr(e,n,1,-1)}function Q_(n){var e=Gr();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Hl,lastRenderedState:n},e.queue=n,n=n.dispatch=RD.bind(null,ht,n),[e.memoizedState,n]}function Gl(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=ht.updateQueue,e===null?(e={lastEffect:null,stores:null},ht.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function HC(){return wr().memoizedState}function nd(n,e,t,r){var i=Gr();ht.flags|=n,i.memoizedState=Gl(1|e,t,void 0,r===void 0?null:r)}function Jf(n,e,t,r){var i=wr();r=r===void 0?null:r;var o=void 0;if(kt!==null){var a=kt.memoizedState;if(o=a.destroy,r!==null&&e0(r,a.deps)){i.memoizedState=Gl(e,t,o,r);return}}ht.flags|=n,i.memoizedState=Gl(1|e,t,o,r)}function Y_(n,e){return nd(8390656,8,n,e)}function r0(n,e){return Jf(2048,8,n,e)}function GC(n,e){return Jf(4,2,n,e)}function qC(n,e){return Jf(4,4,n,e)}function KC(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function XC(n,e,t){return t=t!=null?t.concat([n]):null,Jf(4,4,KC.bind(null,e,n),t)}function i0(){}function QC(n,e){var t=wr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&e0(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function YC(n,e){var t=wr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&e0(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function JC(n,e,t){return ka&21?(Fr(t,e)||(t=rC(),ht.lanes|=t,Aa|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Nn=!0),n.memoizedState=t)}function TD(n,e){var t=Ke;Ke=t!==0&&4>t?t:4,n(!0);var r=km.transition;km.transition={};try{n(!1),e()}finally{Ke=t,km.transition=r}}function ZC(){return wr().memoizedState}function SD(n,e,t){var r=Io(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},eI(n))tI(e,t);else if(t=MC(n,e,t,r),t!==null){var i=Cn();Dr(t,n,r,i),nI(t,e,r)}}function RD(n,e,t){var r=Io(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(eI(n))tI(e,i);else{var o=n.alternate;if(n.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var a=e.lastRenderedState,s=o(a,t);if(i.hasEagerState=!0,i.eagerState=s,Fr(s,a)){var u=e.interleaved;u===null?(i.next=i,Xy(e)):(i.next=u.next,u.next=i),e.interleaved=i;return}}catch{}finally{}t=MC(n,e,i,r),t!==null&&(i=Cn(),Dr(t,n,r,i),nI(t,e,r))}}function eI(n){var e=n.alternate;return n===ht||e!==null&&e===ht}function tI(n,e){wl=Md=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function nI(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,My(n,t)}}var Fd={readContext:yr,useCallback:on,useContext:on,useEffect:on,useImperativeHandle:on,useInsertionEffect:on,useLayoutEffect:on,useMemo:on,useReducer:on,useRef:on,useState:on,useDebugValue:on,useDeferredValue:on,useTransition:on,useMutableSource:on,useSyncExternalStore:on,useId:on,unstable_isNewReconciler:!1},kD={readContext:yr,useCallback:function(n,e){return Gr().memoizedState=[n,e===void 0?null:e],n},useContext:yr,useEffect:Y_,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,nd(4194308,4,KC.bind(null,e,n),t)},useLayoutEffect:function(n,e){return nd(4194308,4,n,e)},useInsertionEffect:function(n,e){return nd(4,2,n,e)},useMemo:function(n,e){var t=Gr();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Gr();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=SD.bind(null,ht,n),[r.memoizedState,n]},useRef:function(n){var e=Gr();return n={current:n},e.memoizedState=n},useState:Q_,useDebugValue:i0,useDeferredValue:function(n){return Gr().memoizedState=n},useTransition:function(){var n=Q_(!1),e=n[0];return n=TD.bind(null,n[1]),Gr().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=ht,i=Gr();if(st){if(t===void 0)throw Error(ne(407));t=t()}else{if(t=e(),jt===null)throw Error(ne(349));ka&30||UC(r,e,t)}i.memoizedState=t;var o={value:t,getSnapshot:e};return i.queue=o,Y_(zC.bind(null,r,o,n),[n]),r.flags|=2048,Gl(9,jC.bind(null,r,o,t,e),void 0,null),t},useId:function(){var n=Gr(),e=jt.identifierPrefix;if(st){var t=Ii,r=Ci;t=(r&~(1<<32-Nr(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=$l++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=ID++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},AD={readContext:yr,useCallback:QC,useContext:yr,useEffect:r0,useImperativeHandle:XC,useInsertionEffect:GC,useLayoutEffect:qC,useMemo:YC,useReducer:Am,useRef:HC,useState:function(){return Am(Hl)},useDebugValue:i0,useDeferredValue:function(n){var e=wr();return JC(e,kt.memoizedState,n)},useTransition:function(){var n=Am(Hl)[0],e=wr().memoizedState;return[n,e]},useMutableSource:VC,useSyncExternalStore:BC,useId:ZC,unstable_isNewReconciler:!1},PD={readContext:yr,useCallback:QC,useContext:yr,useEffect:r0,useImperativeHandle:XC,useInsertionEffect:GC,useLayoutEffect:qC,useMemo:YC,useReducer:Pm,useRef:HC,useState:function(){return Pm(Hl)},useDebugValue:i0,useDeferredValue:function(n){var e=wr();return kt===null?e.memoizedState=n:JC(e,kt.memoizedState,n)},useTransition:function(){var n=Pm(Hl)[0],e=wr().memoizedState;return[n,e]},useMutableSource:VC,useSyncExternalStore:BC,useId:ZC,unstable_isNewReconciler:!1};function Er(n,e){if(n&&n.defaultProps){e=dt({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function tg(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:dt({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Zf={isMounted:function(n){return(n=n._reactInternals)?Wa(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Cn(),i=Io(n),o=ki(r,i);o.payload=e,t!=null&&(o.callback=t),e=Eo(n,o,i),e!==null&&(Dr(e,n,i,r),ed(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Cn(),i=Io(n),o=ki(r,i);o.tag=1,o.payload=e,t!=null&&(o.callback=t),e=Eo(n,o,i),e!==null&&(Dr(e,n,i,r),ed(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Cn(),r=Io(n),i=ki(t,r);i.tag=2,e!=null&&(i.callback=e),e=Eo(n,i,r),e!==null&&(Dr(e,n,r,t),ed(e,n,r))}};function J_(n,e,t,r,i,o,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,o,a):e.prototype&&e.prototype.isPureReactComponent?!Vl(t,r)||!Vl(i,o):!0}function rI(n,e,t){var r=!1,i=Vo,o=e.contextType;return typeof o=="object"&&o!==null?o=yr(o):(i=On(e)?Sa:yn.current,r=e.contextTypes,o=(r=r!=null)?Zs(n,i):Vo),e=new e(t,o),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Zf,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=o),e}function Z_(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&Zf.enqueueReplaceState(e,e.state,null)}function ng(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs={},Qy(n);var o=e.contextType;typeof o=="object"&&o!==null?i.context=yr(o):(o=On(e)?Sa:yn.current,i.context=Zs(n,o)),i.state=n.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(tg(n,e,o,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Zf.enqueueReplaceState(i,i.state,null),Dd(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function ru(n,e){try{var t="",r=e;do t+=oN(r),r=r.return;while(r);var i=t}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:n,source:e,stack:i,digest:null}}function Nm(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function rg(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var ND=typeof WeakMap=="function"?WeakMap:Map;function iI(n,e,t){t=ki(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Vd||(Vd=!0,fg=r),rg(n,e)},t}function oI(n,e,t){t=ki(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){rg(n,e)}}var o=n.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(t.callback=function(){rg(n,e),typeof r!="function"&&(Co===null?Co=new Set([this]):Co.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function ex(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new ND;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=GD.bind(null,n,e,t),e.then(n,n))}function tx(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function nx(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=ki(-1,1),e.tag=2,Eo(t,e,1))),t.lanes|=1),n)}var DD=Ui.ReactCurrentOwner,Nn=!1;function En(n,e,t,r){e.child=n===null?OC(e,null,t,r):tu(e,n.child,t,r)}function rx(n,e,t,r,i){t=t.render;var o=e.ref;return Vs(e,i),r=t0(n,e,t,r,o,i),t=n0(),n!==null&&!Nn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,Oi(n,e,i)):(st&&t&&Wy(e),e.flags|=1,En(n,e,r,i),e.child)}function ix(n,e,t,r,i){if(n===null){var o=t.type;return typeof o=="function"&&!d0(o)&&o.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=o,aI(n,e,o,r,i)):(n=ad(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(o=n.child,!(n.lanes&i)){var a=o.memoizedProps;if(t=t.compare,t=t!==null?t:Vl,t(a,r)&&n.ref===e.ref)return Oi(n,e,i)}return e.flags|=1,n=To(o,r),n.ref=e.ref,n.return=e,e.child=n}function aI(n,e,t,r,i){if(n!==null){var o=n.memoizedProps;if(Vl(o,r)&&n.ref===e.ref)if(Nn=!1,e.pendingProps=r=o,(n.lanes&i)!==0)n.flags&131072&&(Nn=!0);else return e.lanes=n.lanes,Oi(n,e,i)}return ig(n,e,t,r,i)}function sI(n,e,t){var r=e.pendingProps,i=r.children,o=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},et(Ns,zn),zn|=t;else{if(!(t&1073741824))return n=o!==null?o.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,et(Ns,zn),zn|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:t,et(Ns,zn),zn|=r}else o!==null?(r=o.baseLanes|t,e.memoizedState=null):r=t,et(Ns,zn),zn|=r;return En(n,e,i,t),e.child}function uI(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function ig(n,e,t,r,i){var o=On(t)?Sa:yn.current;return o=Zs(e,o),Vs(e,i),t=t0(n,e,t,r,o,i),r=n0(),n!==null&&!Nn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,Oi(n,e,i)):(st&&r&&Wy(e),e.flags|=1,En(n,e,t,i),e.child)}function ox(n,e,t,r,i){if(On(t)){var o=!0;Rd(e)}else o=!1;if(Vs(e,i),e.stateNode===null)rd(n,e),rI(e,t,r),ng(e,t,r,i),r=!0;else if(n===null){var a=e.stateNode,s=e.memoizedProps;a.props=s;var u=a.context,l=t.contextType;typeof l=="object"&&l!==null?l=yr(l):(l=On(t)?Sa:yn.current,l=Zs(e,l));var c=t.getDerivedStateFromProps,h=typeof c=="function"||typeof a.getSnapshotBeforeUpdate=="function";h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==r||u!==l)&&Z_(e,a,r,l),io=!1;var d=e.memoizedState;a.state=d,Dd(e,r,a,i),u=e.memoizedState,s!==r||d!==u||Dn.current||io?(typeof c=="function"&&(tg(e,t,c,r),u=e.memoizedState),(s=io||J_(e,t,s,r,d,u,l))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),a.props=r,a.state=u,a.context=l,r=s):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,FC(n,e),s=e.memoizedProps,l=e.type===e.elementType?s:Er(e.type,s),a.props=l,h=e.pendingProps,d=a.context,u=t.contextType,typeof u=="object"&&u!==null?u=yr(u):(u=On(t)?Sa:yn.current,u=Zs(e,u));var p=t.getDerivedStateFromProps;(c=typeof p=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==h||d!==u)&&Z_(e,a,r,u),io=!1,d=e.memoizedState,a.state=d,Dd(e,r,a,i);var m=e.memoizedState;s!==h||d!==m||Dn.current||io?(typeof p=="function"&&(tg(e,t,p,r),m=e.memoizedState),(l=io||J_(e,t,l,r,d,m,u)||!1)?(c||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,m,u),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,m,u)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||s===n.memoizedProps&&d===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===n.memoizedProps&&d===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=m),a.props=r,a.state=m,a.context=u,r=l):(typeof a.componentDidUpdate!="function"||s===n.memoizedProps&&d===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===n.memoizedProps&&d===n.memoizedState||(e.flags|=1024),r=!1)}return og(n,e,t,r,o,i)}function og(n,e,t,r,i,o){uI(n,e);var a=(e.flags&128)!==0;if(!r&&!a)return i&&$_(e,t,!1),Oi(n,e,o);r=e.stateNode,DD.current=e;var s=a&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&a?(e.child=tu(e,n.child,null,o),e.child=tu(e,null,s,o)):En(n,e,s,o),e.memoizedState=r.state,i&&$_(e,t,!0),e.child}function lI(n){var e=n.stateNode;e.pendingContext?W_(n,e.pendingContext,e.pendingContext!==e.context):e.context&&W_(n,e.context,!1),Yy(n,e.containerInfo)}function ax(n,e,t,r,i){return eu(),Hy(i),e.flags|=256,En(n,e,t,r),e.child}var ag={dehydrated:null,treeContext:null,retryLane:0};function sg(n){return{baseLanes:n,cachePool:null,transitions:null}}function cI(n,e,t){var r=e.pendingProps,i=ut.current,o=!1,a=(e.flags&128)!==0,s;if((s=a)||(s=n!==null&&n.memoizedState===null?!1:(i&2)!==0),s?(o=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),et(ut,i&1),n===null)return Zv(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,n=r.fallback,o?(r=e.mode,o=e.child,a={mode:"hidden",children:a},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=a):o=np(a,r,0,null),n=Ea(n,r,t,null),o.return=e,n.return=e,o.sibling=n,e.child=o,e.child.memoizedState=sg(t),e.memoizedState=ag,n):o0(e,a));if(i=n.memoizedState,i!==null&&(s=i.dehydrated,s!==null))return OD(n,e,a,r,s,i,t);if(o){o=r.fallback,a=e.mode,i=n.child,s=i.sibling;var u={mode:"hidden",children:r.children};return!(a&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=u,e.deletions=null):(r=To(i,u),r.subtreeFlags=i.subtreeFlags&14680064),s!==null?o=To(s,o):(o=Ea(o,a,t,null),o.flags|=2),o.return=e,r.return=e,r.sibling=o,e.child=r,r=o,o=e.child,a=n.child.memoizedState,a=a===null?sg(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},o.memoizedState=a,o.childLanes=n.childLanes&~t,e.memoizedState=ag,r}return o=n.child,n=o.sibling,r=To(o,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function o0(n,e){return e=np({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function Eh(n,e,t,r){return r!==null&&Hy(r),tu(e,n.child,null,t),n=o0(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function OD(n,e,t,r,i,o,a){if(t)return e.flags&256?(e.flags&=-257,r=Nm(Error(ne(422))),Eh(n,e,a,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(o=r.fallback,i=e.mode,r=np({mode:"visible",children:r.children},i,0,null),o=Ea(o,i,a,null),o.flags|=2,r.return=e,o.return=e,r.sibling=o,e.child=r,e.mode&1&&tu(e,n.child,null,a),e.child.memoizedState=sg(a),e.memoizedState=ag,o);if(!(e.mode&1))return Eh(n,e,a,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var s=r.dgst;return r=s,o=Error(ne(419)),r=Nm(o,r,void 0),Eh(n,e,a,r)}if(s=(a&n.childLanes)!==0,Nn||s){if(r=jt,r!==null){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|a)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,Di(n,i),Dr(r,n,i,-1))}return h0(),r=Nm(Error(ne(421))),Eh(n,e,a,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=qD.bind(null,n),i._reactRetry=e,null):(n=o.treeContext,Hn=bo(i.nextSibling),Qn=e,st=!0,Ir=null,n!==null&&(sr[ur++]=Ci,sr[ur++]=Ii,sr[ur++]=Ra,Ci=n.id,Ii=n.overflow,Ra=e),e=o0(e,r.children),e.flags|=4096,e)}function sx(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),eg(n.return,e,t)}function Dm(n,e,t,r,i){var o=n.memoizedState;o===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=t,o.tailMode=i)}function hI(n,e,t){var r=e.pendingProps,i=r.revealOrder,o=r.tail;if(En(n,e,r.children,t),r=ut.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&sx(n,t,e);else if(n.tag===19)sx(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(et(ut,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&Od(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),Dm(e,!1,i,t,o);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&Od(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}Dm(e,!0,t,null,o);break;case"together":Dm(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function rd(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Oi(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Aa|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(ne(153));if(e.child!==null){for(n=e.child,t=To(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=To(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function MD(n,e,t){switch(e.tag){case 3:lI(e),eu();break;case 5:LC(e);break;case 1:On(e.type)&&Rd(e);break;case 4:Yy(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;et(Pd,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(et(ut,ut.current&1),e.flags|=128,null):t&e.child.childLanes?cI(n,e,t):(et(ut,ut.current&1),n=Oi(n,e,t),n!==null?n.sibling:null);et(ut,ut.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return hI(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),et(ut,ut.current),r)break;return null;case 22:case 23:return e.lanes=0,sI(n,e,t)}return Oi(n,e,t)}var dI,ug,fI,pI;dI=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};ug=function(){};fI=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,ya(ti.current);var o=null;switch(t){case"input":i=Av(n,i),r=Av(n,r),o=[];break;case"select":i=dt({},i,{value:void 0}),r=dt({},r,{value:void 0}),o=[];break;case"textarea":i=Dv(n,i),r=Dv(n,r),o=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Td)}Mv(t,r);var a;t=null;for(l in i)if(!r.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var s=i[l];for(a in s)s.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Pl.hasOwnProperty(l)?o||(o=[]):(o=o||[]).push(l,null));for(l in r){var u=r[l];if(s=i!=null?i[l]:void 0,r.hasOwnProperty(l)&&u!==s&&(u!=null||s!=null))if(l==="style")if(s){for(a in s)!s.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in u)u.hasOwnProperty(a)&&s[a]!==u[a]&&(t||(t={}),t[a]=u[a])}else t||(o||(o=[]),o.push(l,t)),t=u;else l==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,s=s?s.__html:void 0,u!=null&&s!==u&&(o=o||[]).push(l,u)):l==="children"?typeof u!="string"&&typeof u!="number"||(o=o||[]).push(l,""+u):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Pl.hasOwnProperty(l)?(u!=null&&l==="onScroll"&&rt("scroll",n),o||s===u||(o=[])):(o=o||[]).push(l,u))}t&&(o=o||[]).push("style",t);var l=o;(e.updateQueue=l)&&(e.flags|=4)}};pI=function(n,e,t,r){t!==r&&(e.flags|=4)};function Qu(n,e){if(!st)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function an(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function FD(n,e,t){var r=e.pendingProps;switch($y(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return an(e),null;case 1:return On(e.type)&&Sd(),an(e),null;case 3:return r=e.stateNode,nu(),at(Dn),at(yn),Zy(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(xh(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ir!==null&&(vg(Ir),Ir=null))),ug(n,e),an(e),null;case 5:Jy(e);var i=ya(Wl.current);if(t=e.type,n!==null&&e.stateNode!=null)fI(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(ne(166));return an(e),null}if(n=ya(ti.current),xh(e)){r=e.stateNode,t=e.type;var o=e.memoizedProps;switch(r[Qr]=e,r[jl]=o,n=(e.mode&1)!==0,t){case"dialog":rt("cancel",r),rt("close",r);break;case"iframe":case"object":case"embed":rt("load",r);break;case"video":case"audio":for(i=0;i<ol.length;i++)rt(ol[i],r);break;case"source":rt("error",r);break;case"img":case"image":case"link":rt("error",r),rt("load",r);break;case"details":rt("toggle",r);break;case"input":v_(r,o),rt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},rt("invalid",r);break;case"textarea":y_(r,o),rt("invalid",r)}Mv(t,o),i=null;for(var a in o)if(o.hasOwnProperty(a)){var s=o[a];a==="children"?typeof s=="string"?r.textContent!==s&&(o.suppressHydrationWarning!==!0&&_h(r.textContent,s,n),i=["children",s]):typeof s=="number"&&r.textContent!==""+s&&(o.suppressHydrationWarning!==!0&&_h(r.textContent,s,n),i=["children",""+s]):Pl.hasOwnProperty(a)&&s!=null&&a==="onScroll"&&rt("scroll",r)}switch(t){case"input":dh(r),g_(r,o,!0);break;case"textarea":dh(r),w_(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=Td)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=z2(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=a.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=a.createElement(t,{is:r.is}):(n=a.createElement(t),t==="select"&&(a=n,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):n=a.createElementNS(n,t),n[Qr]=e,n[jl]=r,dI(n,e,!1,!1),e.stateNode=n;e:{switch(a=Fv(t,r),t){case"dialog":rt("cancel",n),rt("close",n),i=r;break;case"iframe":case"object":case"embed":rt("load",n),i=r;break;case"video":case"audio":for(i=0;i<ol.length;i++)rt(ol[i],n);i=r;break;case"source":rt("error",n),i=r;break;case"img":case"image":case"link":rt("error",n),rt("load",n),i=r;break;case"details":rt("toggle",n),i=r;break;case"input":v_(n,r),i=Av(n,r),rt("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=dt({},r,{value:void 0}),rt("invalid",n);break;case"textarea":y_(n,r),i=Dv(n,r),rt("invalid",n);break;default:i=r}Mv(t,i),s=i;for(o in s)if(s.hasOwnProperty(o)){var u=s[o];o==="style"?H2(n,u):o==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&W2(n,u)):o==="children"?typeof u=="string"?(t!=="textarea"||u!=="")&&Nl(n,u):typeof u=="number"&&Nl(n,""+u):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Pl.hasOwnProperty(o)?u!=null&&o==="onScroll"&&rt("scroll",n):u!=null&&ky(n,o,u,a))}switch(t){case"input":dh(n),g_(n,r,!1);break;case"textarea":dh(n),w_(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Lo(r.value));break;case"select":n.multiple=!!r.multiple,o=r.value,o!=null?Os(n,!!r.multiple,o,!1):r.defaultValue!=null&&Os(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=Td)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return an(e),null;case 6:if(n&&e.stateNode!=null)pI(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(ne(166));if(t=ya(Wl.current),ya(ti.current),xh(e)){if(r=e.stateNode,t=e.memoizedProps,r[Qr]=e,(o=r.nodeValue!==t)&&(n=Qn,n!==null))switch(n.tag){case 3:_h(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&_h(r.nodeValue,t,(n.mode&1)!==0)}o&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Qr]=e,e.stateNode=r}return an(e),null;case 13:if(at(ut),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(st&&Hn!==null&&e.mode&1&&!(e.flags&128))NC(),eu(),e.flags|=98560,o=!1;else if(o=xh(e),r!==null&&r.dehydrated!==null){if(n===null){if(!o)throw Error(ne(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(ne(317));o[Qr]=e}else eu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;an(e),o=!1}else Ir!==null&&(vg(Ir),Ir=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||ut.current&1?At===0&&(At=3):h0())),e.updateQueue!==null&&(e.flags|=4),an(e),null);case 4:return nu(),ug(n,e),n===null&&Bl(e.stateNode.containerInfo),an(e),null;case 10:return Ky(e.type._context),an(e),null;case 17:return On(e.type)&&Sd(),an(e),null;case 19:if(at(ut),o=e.memoizedState,o===null)return an(e),null;if(r=(e.flags&128)!==0,a=o.rendering,a===null)if(r)Qu(o,!1);else{if(At!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(a=Od(n),a!==null){for(e.flags|=128,Qu(o,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)o=t,n=r,o.flags&=14680066,a=o.alternate,a===null?(o.childLanes=0,o.lanes=n,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=a.childLanes,o.lanes=a.lanes,o.child=a.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=a.memoizedProps,o.memoizedState=a.memoizedState,o.updateQueue=a.updateQueue,o.type=a.type,n=a.dependencies,o.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return et(ut,ut.current&1|2),e.child}n=n.sibling}o.tail!==null&&_t()>iu&&(e.flags|=128,r=!0,Qu(o,!1),e.lanes=4194304)}else{if(!r)if(n=Od(a),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Qu(o,!0),o.tail===null&&o.tailMode==="hidden"&&!a.alternate&&!st)return an(e),null}else 2*_t()-o.renderingStartTime>iu&&t!==1073741824&&(e.flags|=128,r=!0,Qu(o,!1),e.lanes=4194304);o.isBackwards?(a.sibling=e.child,e.child=a):(t=o.last,t!==null?t.sibling=a:e.child=a,o.last=a)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=_t(),e.sibling=null,t=ut.current,et(ut,r?t&1|2:t&1),e):(an(e),null);case 22:case 23:return c0(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?zn&1073741824&&(an(e),e.subtreeFlags&6&&(e.flags|=8192)):an(e),null;case 24:return null;case 25:return null}throw Error(ne(156,e.tag))}function LD(n,e){switch($y(e),e.tag){case 1:return On(e.type)&&Sd(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return nu(),at(Dn),at(yn),Zy(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Jy(e),null;case 13:if(at(ut),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(ne(340));eu()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return at(ut),null;case 4:return nu(),null;case 10:return Ky(e.type._context),null;case 22:case 23:return c0(),null;case 24:return null;default:return null}}var Ch=!1,cn=!1,VD=typeof WeakSet=="function"?WeakSet:Set,le=null;function Ps(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){yt(n,e,r)}else t.current=null}function lg(n,e,t){try{t()}catch(r){yt(n,e,r)}}var ux=!1;function BD(n,e){if(Gv=Ed,n=wC(),zy(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{t.nodeType,o.nodeType}catch{t=null;break e}var a=0,s=-1,u=-1,l=0,c=0,h=n,d=null;t:for(;;){for(var p;h!==t||i!==0&&h.nodeType!==3||(s=a+i),h!==o||r!==0&&h.nodeType!==3||(u=a+r),h.nodeType===3&&(a+=h.nodeValue.length),(p=h.firstChild)!==null;)d=h,h=p;for(;;){if(h===n)break t;if(d===t&&++l===i&&(s=a),d===o&&++c===r&&(u=a),(p=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=p}t=s===-1||u===-1?null:{start:s,end:u}}else t=null}t=t||{start:0,end:0}}else t=null;for(qv={focusedElem:n,selectionRange:t},Ed=!1,le=e;le!==null;)if(e=le,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,le=n;else for(;le!==null;){e=le;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var g=m.memoizedProps,y=m.memoizedState,v=e.stateNode,w=v.getSnapshotBeforeUpdate(e.elementType===e.type?g:Er(e.type,g),y);v.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var _=e.stateNode.containerInfo;_.nodeType===1?_.textContent="":_.nodeType===9&&_.documentElement&&_.removeChild(_.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ne(163))}}catch(x){yt(e,e.return,x)}if(n=e.sibling,n!==null){n.return=e.return,le=n;break}le=e.return}return m=ux,ux=!1,m}function _l(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var o=i.destroy;i.destroy=void 0,o!==void 0&&lg(e,t,o)}i=i.next}while(i!==r)}}function ep(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function cg(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function mI(n){var e=n.alternate;e!==null&&(n.alternate=null,mI(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Qr],delete e[jl],delete e[Qv],delete e[xD],delete e[bD])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function vI(n){return n.tag===5||n.tag===3||n.tag===4}function lx(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||vI(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function hg(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Td));else if(r!==4&&(n=n.child,n!==null))for(hg(n,e,t),n=n.sibling;n!==null;)hg(n,e,t),n=n.sibling}function dg(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(dg(n,e,t),n=n.sibling;n!==null;)dg(n,e,t),n=n.sibling}var Gt=null,Cr=!1;function Zi(n,e,t){for(t=t.child;t!==null;)gI(n,e,t),t=t.sibling}function gI(n,e,t){if(ei&&typeof ei.onCommitFiberUnmount=="function")try{ei.onCommitFiberUnmount(Gf,t)}catch{}switch(t.tag){case 5:cn||Ps(t,e);case 6:var r=Gt,i=Cr;Gt=null,Zi(n,e,t),Gt=r,Cr=i,Gt!==null&&(Cr?(n=Gt,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Gt.removeChild(t.stateNode));break;case 18:Gt!==null&&(Cr?(n=Gt,t=t.stateNode,n.nodeType===8?Tm(n.parentNode,t):n.nodeType===1&&Tm(n,t),Fl(n)):Tm(Gt,t.stateNode));break;case 4:r=Gt,i=Cr,Gt=t.stateNode.containerInfo,Cr=!0,Zi(n,e,t),Gt=r,Cr=i;break;case 0:case 11:case 14:case 15:if(!cn&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var o=i,a=o.destroy;o=o.tag,a!==void 0&&(o&2||o&4)&&lg(t,e,a),i=i.next}while(i!==r)}Zi(n,e,t);break;case 1:if(!cn&&(Ps(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(s){yt(t,e,s)}Zi(n,e,t);break;case 21:Zi(n,e,t);break;case 22:t.mode&1?(cn=(r=cn)||t.memoizedState!==null,Zi(n,e,t),cn=r):Zi(n,e,t);break;default:Zi(n,e,t)}}function cx(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new VD),e.forEach(function(r){var i=KD.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function br(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var o=n,a=e,s=a;e:for(;s!==null;){switch(s.tag){case 5:Gt=s.stateNode,Cr=!1;break e;case 3:Gt=s.stateNode.containerInfo,Cr=!0;break e;case 4:Gt=s.stateNode.containerInfo,Cr=!0;break e}s=s.return}if(Gt===null)throw Error(ne(160));gI(o,a,i),Gt=null,Cr=!1;var u=i.alternate;u!==null&&(u.return=null),i.return=null}catch(l){yt(i,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)yI(e,n),e=e.sibling}function yI(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(br(e,n),$r(n),r&4){try{_l(3,n,n.return),ep(3,n)}catch(g){yt(n,n.return,g)}try{_l(5,n,n.return)}catch(g){yt(n,n.return,g)}}break;case 1:br(e,n),$r(n),r&512&&t!==null&&Ps(t,t.return);break;case 5:if(br(e,n),$r(n),r&512&&t!==null&&Ps(t,t.return),n.flags&32){var i=n.stateNode;try{Nl(i,"")}catch(g){yt(n,n.return,g)}}if(r&4&&(i=n.stateNode,i!=null)){var o=n.memoizedProps,a=t!==null?t.memoizedProps:o,s=n.type,u=n.updateQueue;if(n.updateQueue=null,u!==null)try{s==="input"&&o.type==="radio"&&o.name!=null&&U2(i,o),Fv(s,a);var l=Fv(s,o);for(a=0;a<u.length;a+=2){var c=u[a],h=u[a+1];c==="style"?H2(i,h):c==="dangerouslySetInnerHTML"?W2(i,h):c==="children"?Nl(i,h):ky(i,c,h,l)}switch(s){case"input":Pv(i,o);break;case"textarea":j2(i,o);break;case"select":var d=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var p=o.value;p!=null?Os(i,!!o.multiple,p,!1):d!==!!o.multiple&&(o.defaultValue!=null?Os(i,!!o.multiple,o.defaultValue,!0):Os(i,!!o.multiple,o.multiple?[]:"",!1))}i[jl]=o}catch(g){yt(n,n.return,g)}}break;case 6:if(br(e,n),$r(n),r&4){if(n.stateNode===null)throw Error(ne(162));i=n.stateNode,o=n.memoizedProps;try{i.nodeValue=o}catch(g){yt(n,n.return,g)}}break;case 3:if(br(e,n),$r(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Fl(e.containerInfo)}catch(g){yt(n,n.return,g)}break;case 4:br(e,n),$r(n);break;case 13:br(e,n),$r(n),i=n.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(u0=_t())),r&4&&cx(n);break;case 22:if(c=t!==null&&t.memoizedState!==null,n.mode&1?(cn=(l=cn)||c,br(e,n),cn=l):br(e,n),$r(n),r&8192){if(l=n.memoizedState!==null,(n.stateNode.isHidden=l)&&!c&&n.mode&1)for(le=n,c=n.child;c!==null;){for(h=le=c;le!==null;){switch(d=le,p=d.child,d.tag){case 0:case 11:case 14:case 15:_l(4,d,d.return);break;case 1:Ps(d,d.return);var m=d.stateNode;if(typeof m.componentWillUnmount=="function"){r=d,t=d.return;try{e=r,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(g){yt(r,t,g)}}break;case 5:Ps(d,d.return);break;case 22:if(d.memoizedState!==null){dx(h);continue}}p!==null?(p.return=d,le=p):dx(h)}c=c.sibling}e:for(c=null,h=n;;){if(h.tag===5){if(c===null){c=h;try{i=h.stateNode,l?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(s=h.stateNode,u=h.memoizedProps.style,a=u!=null&&u.hasOwnProperty("display")?u.display:null,s.style.display=$2("display",a))}catch(g){yt(n,n.return,g)}}}else if(h.tag===6){if(c===null)try{h.stateNode.nodeValue=l?"":h.memoizedProps}catch(g){yt(n,n.return,g)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===n)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===n)break e;for(;h.sibling===null;){if(h.return===null||h.return===n)break e;c===h&&(c=null),h=h.return}c===h&&(c=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:br(e,n),$r(n),r&4&&cx(n);break;case 21:break;default:br(e,n),$r(n)}}function $r(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(vI(t)){var r=t;break e}t=t.return}throw Error(ne(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Nl(i,""),r.flags&=-33);var o=lx(n);dg(n,o,i);break;case 3:case 4:var a=r.stateNode.containerInfo,s=lx(n);hg(n,s,a);break;default:throw Error(ne(161))}}catch(u){yt(n,n.return,u)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function UD(n,e,t){le=n,wI(n)}function wI(n,e,t){for(var r=(n.mode&1)!==0;le!==null;){var i=le,o=i.child;if(i.tag===22&&r){var a=i.memoizedState!==null||Ch;if(!a){var s=i.alternate,u=s!==null&&s.memoizedState!==null||cn;s=Ch;var l=cn;if(Ch=a,(cn=u)&&!l)for(le=i;le!==null;)a=le,u=a.child,a.tag===22&&a.memoizedState!==null?fx(i):u!==null?(u.return=a,le=u):fx(i);for(;o!==null;)le=o,wI(o),o=o.sibling;le=i,Ch=s,cn=l}hx(n)}else i.subtreeFlags&8772&&o!==null?(o.return=i,le=o):hx(n)}}function hx(n){for(;le!==null;){var e=le;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:cn||ep(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!cn)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:Er(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&X_(e,o,r);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}X_(e,a,t)}break;case 5:var s=e.stateNode;if(t===null&&e.flags&4){t=s;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&t.focus();break;case"img":u.src&&(t.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var c=l.memoizedState;if(c!==null){var h=c.dehydrated;h!==null&&Fl(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ne(163))}cn||e.flags&512&&cg(e)}catch(d){yt(e,e.return,d)}}if(e===n){le=null;break}if(t=e.sibling,t!==null){t.return=e.return,le=t;break}le=e.return}}function dx(n){for(;le!==null;){var e=le;if(e===n){le=null;break}var t=e.sibling;if(t!==null){t.return=e.return,le=t;break}le=e.return}}function fx(n){for(;le!==null;){var e=le;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{ep(4,e)}catch(u){yt(e,t,u)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(u){yt(e,i,u)}}var o=e.return;try{cg(e)}catch(u){yt(e,o,u)}break;case 5:var a=e.return;try{cg(e)}catch(u){yt(e,a,u)}}}catch(u){yt(e,e.return,u)}if(e===n){le=null;break}var s=e.sibling;if(s!==null){s.return=e.return,le=s;break}le=e.return}}var jD=Math.ceil,Ld=Ui.ReactCurrentDispatcher,a0=Ui.ReactCurrentOwner,vr=Ui.ReactCurrentBatchConfig,ze=0,jt=null,Ct=null,Jt=0,zn=0,Ns=Xo(0),At=0,ql=null,Aa=0,tp=0,s0=0,xl=null,Rn=null,u0=0,iu=1/0,xi=null,Vd=!1,fg=null,Co=null,Ih=!1,fo=null,Bd=0,bl=0,pg=null,id=-1,od=0;function Cn(){return ze&6?_t():id!==-1?id:id=_t()}function Io(n){return n.mode&1?ze&2&&Jt!==0?Jt&-Jt:CD.transition!==null?(od===0&&(od=rC()),od):(n=Ke,n!==0||(n=window.event,n=n===void 0?16:cC(n.type)),n):1}function Dr(n,e,t,r){if(50<bl)throw bl=0,pg=null,Error(ne(185));yc(n,t,r),(!(ze&2)||n!==jt)&&(n===jt&&(!(ze&2)&&(tp|=t),At===4&&ao(n,Jt)),Mn(n,r),t===1&&ze===0&&!(e.mode&1)&&(iu=_t()+500,Yf&&Qo()))}function Mn(n,e){var t=n.callbackNode;CN(n,e);var r=bd(n,n===jt?Jt:0);if(r===0)t!==null&&b_(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&b_(t),e===1)n.tag===0?ED(px.bind(null,n)):kC(px.bind(null,n)),wD(function(){!(ze&6)&&Qo()}),t=null;else{switch(iC(r)){case 1:t=Oy;break;case 4:t=tC;break;case 16:t=xd;break;case 536870912:t=nC;break;default:t=xd}t=SI(t,_I.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function _I(n,e){if(id=-1,od=0,ze&6)throw Error(ne(327));var t=n.callbackNode;if(Bs()&&n.callbackNode!==t)return null;var r=bd(n,n===jt?Jt:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Ud(n,r);else{e=r;var i=ze;ze|=2;var o=bI();(jt!==n||Jt!==e)&&(xi=null,iu=_t()+500,ba(n,e));do try{$D();break}catch(s){xI(n,s)}while(!0);qy(),Ld.current=o,ze=i,Ct!==null?e=0:(jt=null,Jt=0,e=At)}if(e!==0){if(e===2&&(i=jv(n),i!==0&&(r=i,e=mg(n,i))),e===1)throw t=ql,ba(n,0),ao(n,r),Mn(n,_t()),t;if(e===6)ao(n,r);else{if(i=n.current.alternate,!(r&30)&&!zD(i)&&(e=Ud(n,r),e===2&&(o=jv(n),o!==0&&(r=o,e=mg(n,o))),e===1))throw t=ql,ba(n,0),ao(n,r),Mn(n,_t()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(ne(345));case 2:ca(n,Rn,xi);break;case 3:if(ao(n,r),(r&130023424)===r&&(e=u0+500-_t(),10<e)){if(bd(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){Cn(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=Xv(ca.bind(null,n,Rn,xi),e);break}ca(n,Rn,xi);break;case 4:if(ao(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var a=31-Nr(r);o=1<<a,a=e[a],a>i&&(i=a),r&=~o}if(r=i,r=_t()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*jD(r/1960))-r,10<r){n.timeoutHandle=Xv(ca.bind(null,n,Rn,xi),r);break}ca(n,Rn,xi);break;case 5:ca(n,Rn,xi);break;default:throw Error(ne(329))}}}return Mn(n,_t()),n.callbackNode===t?_I.bind(null,n):null}function mg(n,e){var t=xl;return n.current.memoizedState.isDehydrated&&(ba(n,e).flags|=256),n=Ud(n,e),n!==2&&(e=Rn,Rn=t,e!==null&&vg(e)),n}function vg(n){Rn===null?Rn=n:Rn.push.apply(Rn,n)}function zD(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],o=i.getSnapshot;i=i.value;try{if(!Fr(o(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ao(n,e){for(e&=~s0,e&=~tp,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Nr(e),r=1<<t;n[t]=-1,e&=~r}}function px(n){if(ze&6)throw Error(ne(327));Bs();var e=bd(n,0);if(!(e&1))return Mn(n,_t()),null;var t=Ud(n,e);if(n.tag!==0&&t===2){var r=jv(n);r!==0&&(e=r,t=mg(n,r))}if(t===1)throw t=ql,ba(n,0),ao(n,e),Mn(n,_t()),t;if(t===6)throw Error(ne(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,ca(n,Rn,xi),Mn(n,_t()),null}function l0(n,e){var t=ze;ze|=1;try{return n(e)}finally{ze=t,ze===0&&(iu=_t()+500,Yf&&Qo())}}function Pa(n){fo!==null&&fo.tag===0&&!(ze&6)&&Bs();var e=ze;ze|=1;var t=vr.transition,r=Ke;try{if(vr.transition=null,Ke=1,n)return n()}finally{Ke=r,vr.transition=t,ze=e,!(ze&6)&&Qo()}}function c0(){zn=Ns.current,at(Ns)}function ba(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,yD(t)),Ct!==null)for(t=Ct.return;t!==null;){var r=t;switch($y(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Sd();break;case 3:nu(),at(Dn),at(yn),Zy();break;case 5:Jy(r);break;case 4:nu();break;case 13:at(ut);break;case 19:at(ut);break;case 10:Ky(r.type._context);break;case 22:case 23:c0()}t=t.return}if(jt=n,Ct=n=To(n.current,null),Jt=zn=e,At=0,ql=null,s0=tp=Aa=0,Rn=xl=null,ga!==null){for(e=0;e<ga.length;e++)if(t=ga[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,o=t.pending;if(o!==null){var a=o.next;o.next=i,r.next=a}t.pending=r}ga=null}return n}function xI(n,e){do{var t=Ct;try{if(qy(),td.current=Fd,Md){for(var r=ht.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Md=!1}if(ka=0,Ut=kt=ht=null,wl=!1,$l=0,a0.current=null,t===null||t.return===null){At=1,ql=e,Ct=null;break}e:{var o=n,a=t.return,s=t,u=e;if(e=Jt,s.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var l=u,c=s,h=c.tag;if(!(c.mode&1)&&(h===0||h===11||h===15)){var d=c.alternate;d?(c.updateQueue=d.updateQueue,c.memoizedState=d.memoizedState,c.lanes=d.lanes):(c.updateQueue=null,c.memoizedState=null)}var p=tx(a);if(p!==null){p.flags&=-257,nx(p,a,s,o,e),p.mode&1&&ex(o,l,e),e=p,u=l;var m=e.updateQueue;if(m===null){var g=new Set;g.add(u),e.updateQueue=g}else m.add(u);break e}else{if(!(e&1)){ex(o,l,e),h0();break e}u=Error(ne(426))}}else if(st&&s.mode&1){var y=tx(a);if(y!==null){!(y.flags&65536)&&(y.flags|=256),nx(y,a,s,o,e),Hy(ru(u,s));break e}}o=u=ru(u,s),At!==4&&(At=2),xl===null?xl=[o]:xl.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var v=iI(o,u,e);K_(o,v);break e;case 1:s=u;var w=o.type,_=o.stateNode;if(!(o.flags&128)&&(typeof w.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(Co===null||!Co.has(_)))){o.flags|=65536,e&=-e,o.lanes|=e;var x=oI(o,s,e);K_(o,x);break e}}o=o.return}while(o!==null)}CI(t)}catch(C){e=C,Ct===t&&t!==null&&(Ct=t=t.return);continue}break}while(!0)}function bI(){var n=Ld.current;return Ld.current=Fd,n===null?Fd:n}function h0(){(At===0||At===3||At===2)&&(At=4),jt===null||!(Aa&268435455)&&!(tp&268435455)||ao(jt,Jt)}function Ud(n,e){var t=ze;ze|=2;var r=bI();(jt!==n||Jt!==e)&&(xi=null,ba(n,e));do try{WD();break}catch(i){xI(n,i)}while(!0);if(qy(),ze=t,Ld.current=r,Ct!==null)throw Error(ne(261));return jt=null,Jt=0,At}function WD(){for(;Ct!==null;)EI(Ct)}function $D(){for(;Ct!==null&&!mN();)EI(Ct)}function EI(n){var e=TI(n.alternate,n,zn);n.memoizedProps=n.pendingProps,e===null?CI(n):Ct=e,a0.current=null}function CI(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=LD(t,e),t!==null){t.flags&=32767,Ct=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{At=6,Ct=null;return}}else if(t=FD(t,e,zn),t!==null){Ct=t;return}if(e=e.sibling,e!==null){Ct=e;return}Ct=e=n}while(e!==null);At===0&&(At=5)}function ca(n,e,t){var r=Ke,i=vr.transition;try{vr.transition=null,Ke=1,HD(n,e,t,r)}finally{vr.transition=i,Ke=r}return null}function HD(n,e,t,r){do Bs();while(fo!==null);if(ze&6)throw Error(ne(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(ne(177));n.callbackNode=null,n.callbackPriority=0;var o=t.lanes|t.childLanes;if(IN(n,o),n===jt&&(Ct=jt=null,Jt=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Ih||(Ih=!0,SI(xd,function(){return Bs(),null})),o=(t.flags&15990)!==0,t.subtreeFlags&15990||o){o=vr.transition,vr.transition=null;var a=Ke;Ke=1;var s=ze;ze|=4,a0.current=null,BD(n,t),yI(t,n),hD(qv),Ed=!!Gv,qv=Gv=null,n.current=t,UD(t),vN(),ze=s,Ke=a,vr.transition=o}else n.current=t;if(Ih&&(Ih=!1,fo=n,Bd=i),o=n.pendingLanes,o===0&&(Co=null),wN(t.stateNode),Mn(n,_t()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(Vd)throw Vd=!1,n=fg,fg=null,n;return Bd&1&&n.tag!==0&&Bs(),o=n.pendingLanes,o&1?n===pg?bl++:(bl=0,pg=n):bl=0,Qo(),null}function Bs(){if(fo!==null){var n=iC(Bd),e=vr.transition,t=Ke;try{if(vr.transition=null,Ke=16>n?16:n,fo===null)var r=!1;else{if(n=fo,fo=null,Bd=0,ze&6)throw Error(ne(331));var i=ze;for(ze|=4,le=n.current;le!==null;){var o=le,a=o.child;if(le.flags&16){var s=o.deletions;if(s!==null){for(var u=0;u<s.length;u++){var l=s[u];for(le=l;le!==null;){var c=le;switch(c.tag){case 0:case 11:case 15:_l(8,c,o)}var h=c.child;if(h!==null)h.return=c,le=h;else for(;le!==null;){c=le;var d=c.sibling,p=c.return;if(mI(c),c===l){le=null;break}if(d!==null){d.return=p,le=d;break}le=p}}}var m=o.alternate;if(m!==null){var g=m.child;if(g!==null){m.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(g!==null)}}le=o}}if(o.subtreeFlags&2064&&a!==null)a.return=o,le=a;else e:for(;le!==null;){if(o=le,o.flags&2048)switch(o.tag){case 0:case 11:case 15:_l(9,o,o.return)}var v=o.sibling;if(v!==null){v.return=o.return,le=v;break e}le=o.return}}var w=n.current;for(le=w;le!==null;){a=le;var _=a.child;if(a.subtreeFlags&2064&&_!==null)_.return=a,le=_;else e:for(a=w;le!==null;){if(s=le,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:ep(9,s)}}catch(C){yt(s,s.return,C)}if(s===a){le=null;break e}var x=s.sibling;if(x!==null){x.return=s.return,le=x;break e}le=s.return}}if(ze=i,Qo(),ei&&typeof ei.onPostCommitFiberRoot=="function")try{ei.onPostCommitFiberRoot(Gf,n)}catch{}r=!0}return r}finally{Ke=t,vr.transition=e}}return!1}function mx(n,e,t){e=ru(t,e),e=iI(n,e,1),n=Eo(n,e,1),e=Cn(),n!==null&&(yc(n,1,e),Mn(n,e))}function yt(n,e,t){if(n.tag===3)mx(n,n,t);else for(;e!==null;){if(e.tag===3){mx(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Co===null||!Co.has(r))){n=ru(t,n),n=oI(e,n,1),e=Eo(e,n,1),n=Cn(),e!==null&&(yc(e,1,n),Mn(e,n));break}}e=e.return}}function GD(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Cn(),n.pingedLanes|=n.suspendedLanes&t,jt===n&&(Jt&t)===t&&(At===4||At===3&&(Jt&130023424)===Jt&&500>_t()-u0?ba(n,0):s0|=t),Mn(n,e)}function II(n,e){e===0&&(n.mode&1?(e=mh,mh<<=1,!(mh&130023424)&&(mh=4194304)):e=1);var t=Cn();n=Di(n,e),n!==null&&(yc(n,e,t),Mn(n,t))}function qD(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),II(n,t)}function KD(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(ne(314))}r!==null&&r.delete(e),II(n,t)}var TI;TI=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Dn.current)Nn=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Nn=!1,MD(n,e,t);Nn=!!(n.flags&131072)}else Nn=!1,st&&e.flags&1048576&&AC(e,Ad,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;rd(n,e),n=e.pendingProps;var i=Zs(e,yn.current);Vs(e,t),i=t0(null,e,r,n,i,t);var o=n0();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,On(r)?(o=!0,Rd(e)):o=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Qy(e),i.updater=Zf,e.stateNode=i,i._reactInternals=e,ng(e,r,n,t),e=og(null,e,r,!0,o,t)):(e.tag=0,st&&o&&Wy(e),En(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(rd(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=QD(r),n=Er(r,n),i){case 0:e=ig(null,e,r,n,t);break e;case 1:e=ox(null,e,r,n,t);break e;case 11:e=rx(null,e,r,n,t);break e;case 14:e=ix(null,e,r,Er(r.type,n),t);break e}throw Error(ne(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Er(r,i),ig(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Er(r,i),ox(n,e,r,i,t);case 3:e:{if(lI(e),n===null)throw Error(ne(387));r=e.pendingProps,o=e.memoizedState,i=o.element,FC(n,e),Dd(e,r,null,t);var a=e.memoizedState;if(r=a.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){i=ru(Error(ne(423)),e),e=ax(n,e,r,t,i);break e}else if(r!==i){i=ru(Error(ne(424)),e),e=ax(n,e,r,t,i);break e}else for(Hn=bo(e.stateNode.containerInfo.firstChild),Qn=e,st=!0,Ir=null,t=OC(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(eu(),r===i){e=Oi(n,e,t);break e}En(n,e,r,t)}e=e.child}return e;case 5:return LC(e),n===null&&Zv(e),r=e.type,i=e.pendingProps,o=n!==null?n.memoizedProps:null,a=i.children,Kv(r,i)?a=null:o!==null&&Kv(r,o)&&(e.flags|=32),uI(n,e),En(n,e,a,t),e.child;case 6:return n===null&&Zv(e),null;case 13:return cI(n,e,t);case 4:return Yy(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=tu(e,null,r,t):En(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Er(r,i),rx(n,e,r,i,t);case 7:return En(n,e,e.pendingProps,t),e.child;case 8:return En(n,e,e.pendingProps.children,t),e.child;case 12:return En(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,o=e.memoizedProps,a=i.value,et(Pd,r._currentValue),r._currentValue=a,o!==null)if(Fr(o.value,a)){if(o.children===i.children&&!Dn.current){e=Oi(n,e,t);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var s=o.dependencies;if(s!==null){a=o.child;for(var u=s.firstContext;u!==null;){if(u.context===r){if(o.tag===1){u=ki(-1,t&-t),u.tag=2;var l=o.updateQueue;if(l!==null){l=l.shared;var c=l.pending;c===null?u.next=u:(u.next=c.next,c.next=u),l.pending=u}}o.lanes|=t,u=o.alternate,u!==null&&(u.lanes|=t),eg(o.return,t,e),s.lanes|=t;break}u=u.next}}else if(o.tag===10)a=o.type===e.type?null:o.child;else if(o.tag===18){if(a=o.return,a===null)throw Error(ne(341));a.lanes|=t,s=a.alternate,s!==null&&(s.lanes|=t),eg(a,t,e),a=o.sibling}else a=o.child;if(a!==null)a.return=o;else for(a=o;a!==null;){if(a===e){a=null;break}if(o=a.sibling,o!==null){o.return=a.return,a=o;break}a=a.return}o=a}En(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,Vs(e,t),i=yr(i),r=r(i),e.flags|=1,En(n,e,r,t),e.child;case 14:return r=e.type,i=Er(r,e.pendingProps),i=Er(r.type,i),ix(n,e,r,i,t);case 15:return aI(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Er(r,i),rd(n,e),e.tag=1,On(r)?(n=!0,Rd(e)):n=!1,Vs(e,t),rI(e,r,i),ng(e,r,i,t),og(null,e,r,!0,n,t);case 19:return hI(n,e,t);case 22:return sI(n,e,t)}throw Error(ne(156,e.tag))};function SI(n,e){return eC(n,e)}function XD(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function fr(n,e,t,r){return new XD(n,e,t,r)}function d0(n){return n=n.prototype,!(!n||!n.isReactComponent)}function QD(n){if(typeof n=="function")return d0(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Py)return 11;if(n===Ny)return 14}return 2}function To(n,e){var t=n.alternate;return t===null?(t=fr(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function ad(n,e,t,r,i,o){var a=2;if(r=n,typeof n=="function")d0(n)&&(a=1);else if(typeof n=="string")a=5;else e:switch(n){case bs:return Ea(t.children,i,o,e);case Ay:a=8,i|=8;break;case Tv:return n=fr(12,t,e,i|2),n.elementType=Tv,n.lanes=o,n;case Sv:return n=fr(13,t,e,i),n.elementType=Sv,n.lanes=o,n;case Rv:return n=fr(19,t,e,i),n.elementType=Rv,n.lanes=o,n;case L2:return np(t,i,o,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case M2:a=10;break e;case F2:a=9;break e;case Py:a=11;break e;case Ny:a=14;break e;case ro:a=16,r=null;break e}throw Error(ne(130,n==null?n:typeof n,""))}return e=fr(a,t,e,i),e.elementType=n,e.type=r,e.lanes=o,e}function Ea(n,e,t,r){return n=fr(7,n,r,e),n.lanes=t,n}function np(n,e,t,r){return n=fr(22,n,r,e),n.elementType=L2,n.lanes=t,n.stateNode={isHidden:!1},n}function Om(n,e,t){return n=fr(6,n,null,e),n.lanes=t,n}function Mm(n,e,t){return e=fr(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function YD(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mm(0),this.expirationTimes=mm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mm(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function f0(n,e,t,r,i,o,a,s,u){return n=new YD(n,e,t,s,u),e===1?(e=1,o===!0&&(e|=8)):e=0,o=fr(3,null,null,e),n.current=o,o.stateNode=n,o.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Qy(o),n}function JD(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:xs,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function RI(n){if(!n)return Vo;n=n._reactInternals;e:{if(Wa(n)!==n||n.tag!==1)throw Error(ne(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(On(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ne(171))}if(n.tag===1){var t=n.type;if(On(t))return RC(n,t,e)}return e}function kI(n,e,t,r,i,o,a,s,u){return n=f0(t,r,!0,n,i,o,a,s,u),n.context=RI(null),t=n.current,r=Cn(),i=Io(t),o=ki(r,i),o.callback=e??null,Eo(t,o,i),n.current.lanes=i,yc(n,i,r),Mn(n,r),n}function rp(n,e,t,r){var i=e.current,o=Cn(),a=Io(i);return t=RI(t),e.context===null?e.context=t:e.pendingContext=t,e=ki(o,a),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Eo(i,e,a),n!==null&&(Dr(n,i,a,o),ed(n,i,a)),a}function jd(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function vx(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function p0(n,e){vx(n,e),(n=n.alternate)&&vx(n,e)}function ZD(){return null}var AI=typeof reportError=="function"?reportError:function(n){console.error(n)};function m0(n){this._internalRoot=n}ip.prototype.render=m0.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(ne(409));rp(n,e,null,null)};ip.prototype.unmount=m0.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Pa(function(){rp(null,n,null,null)}),e[Ni]=null}};function ip(n){this._internalRoot=n}ip.prototype.unstable_scheduleHydration=function(n){if(n){var e=sC();n={blockedOn:null,target:n,priority:e};for(var t=0;t<oo.length&&e!==0&&e<oo[t].priority;t++);oo.splice(t,0,n),t===0&&lC(n)}};function v0(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function op(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function gx(){}function e4(n,e,t,r,i){if(i){if(typeof r=="function"){var o=r;r=function(){var l=jd(a);o.call(l)}}var a=kI(e,r,n,0,null,!1,!1,"",gx);return n._reactRootContainer=a,n[Ni]=a.current,Bl(n.nodeType===8?n.parentNode:n),Pa(),a}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var s=r;r=function(){var l=jd(u);s.call(l)}}var u=f0(n,0,!1,null,null,!1,!1,"",gx);return n._reactRootContainer=u,n[Ni]=u.current,Bl(n.nodeType===8?n.parentNode:n),Pa(function(){rp(e,u,t,r)}),u}function ap(n,e,t,r,i){var o=t._reactRootContainer;if(o){var a=o;if(typeof i=="function"){var s=i;i=function(){var u=jd(a);s.call(u)}}rp(e,a,n,i)}else a=e4(t,e,n,i,r);return jd(a)}oC=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=il(e.pendingLanes);t!==0&&(My(e,t|1),Mn(e,_t()),!(ze&6)&&(iu=_t()+500,Qo()))}break;case 13:Pa(function(){var r=Di(n,1);if(r!==null){var i=Cn();Dr(r,n,1,i)}}),p0(n,1)}};Fy=function(n){if(n.tag===13){var e=Di(n,134217728);if(e!==null){var t=Cn();Dr(e,n,134217728,t)}p0(n,134217728)}};aC=function(n){if(n.tag===13){var e=Io(n),t=Di(n,e);if(t!==null){var r=Cn();Dr(t,n,e,r)}p0(n,e)}};sC=function(){return Ke};uC=function(n,e){var t=Ke;try{return Ke=n,e()}finally{Ke=t}};Vv=function(n,e,t){switch(e){case"input":if(Pv(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=Qf(r);if(!i)throw Error(ne(90));B2(r),Pv(r,i)}}}break;case"textarea":j2(n,t);break;case"select":e=t.value,e!=null&&Os(n,!!t.multiple,e,!1)}};K2=l0;X2=Pa;var t4={usingClientEntryPoint:!1,Events:[_c,Ts,Qf,G2,q2,l0]},Yu={findFiberByHostInstance:va,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},n4={bundleType:Yu.bundleType,version:Yu.version,rendererPackageName:Yu.rendererPackageName,rendererConfig:Yu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ui.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=J2(n),n===null?null:n.stateNode},findFiberByHostInstance:Yu.findFiberByHostInstance||ZD,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Th=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Th.isDisabled&&Th.supportsFiber)try{Gf=Th.inject(n4),ei=Th}catch{}}tr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=t4;tr.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!v0(e))throw Error(ne(200));return JD(n,e,null,t)};tr.createRoot=function(n,e){if(!v0(n))throw Error(ne(299));var t=!1,r="",i=AI;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=f0(n,1,!1,null,null,t,!1,r,i),n[Ni]=e.current,Bl(n.nodeType===8?n.parentNode:n),new m0(e)};tr.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(ne(188)):(n=Object.keys(n).join(","),Error(ne(268,n)));return n=J2(e),n=n===null?null:n.stateNode,n};tr.flushSync=function(n){return Pa(n)};tr.hydrate=function(n,e,t){if(!op(e))throw Error(ne(200));return ap(null,n,e,!0,t)};tr.hydrateRoot=function(n,e,t){if(!v0(n))throw Error(ne(405));var r=t!=null&&t.hydratedSources||null,i=!1,o="",a=AI;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(o=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=kI(e,null,n,1,t??null,i,!1,o,a),n[Ni]=e.current,Bl(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new ip(e)};tr.render=function(n,e,t){if(!op(e))throw Error(ne(200));return ap(null,n,e,!1,t)};tr.unmountComponentAtNode=function(n){if(!op(n))throw Error(ne(40));return n._reactRootContainer?(Pa(function(){ap(null,null,n,!1,function(){n._reactRootContainer=null,n[Ni]=null})}),!0):!1};tr.unstable_batchedUpdates=l0;tr.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!op(t))throw Error(ne(200));if(n==null||n._reactInternals===void 0)throw Error(ne(38));return ap(n,e,t,!1,r)};tr.version="18.3.1-next-f1338f8080-20240426";function PI(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(PI)}catch(n){console.error(n)}}PI(),P2.exports=tr;var r4=P2.exports,NI,yx=r4;NI=yx.createRoot,yx.hydrateRoot;var DI={exports:{}},OI={};/**
 * @license React
 * use-sync-external-store-with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bc=Q;function i4(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var o4=typeof Object.is=="function"?Object.is:i4,a4=bc.useSyncExternalStore,s4=bc.useRef,u4=bc.useEffect,l4=bc.useMemo,c4=bc.useDebugValue;OI.useSyncExternalStoreWithSelector=function(n,e,t,r,i){var o=s4(null);if(o.current===null){var a={hasValue:!1,value:null};o.current=a}else a=o.current;o=l4(function(){function u(p){if(!l){if(l=!0,c=p,p=r(p),i!==void 0&&a.hasValue){var m=a.value;if(i(m,p))return h=m}return h=p}if(m=h,o4(c,p))return m;var g=r(p);return i!==void 0&&i(m,g)?m:(c=p,h=g)}var l=!1,c,h,d=t===void 0?null:t;return[function(){return u(e())},d===null?void 0:function(){return u(d())}]},[e,t,r,i]);var s=a4(n,o[0],o[1]);return u4(function(){a.hasValue=!0,a.value=s},[s]),c4(s),s};DI.exports=OI;var h4=DI.exports,Gn="default"in Cv?Ri:Cv,wx=Symbol.for("react-redux-context"),_x=typeof globalThis<"u"?globalThis:{};function d4(){if(!Gn.createContext)return{};const n=_x[wx]??(_x[wx]=new Map);let e=n.get(Gn.createContext);return e||(e=Gn.createContext(null),n.set(Gn.createContext,e)),e}var Bo=d4(),f4=()=>{throw new Error("uSES not initialized!")};function g0(n=Bo){return function(){return Gn.useContext(n)}}var MI=g0(),FI=f4,p4=n=>{FI=n},m4=(n,e)=>n===e;function v4(n=Bo){const e=n===Bo?MI:g0(n),t=(r,i={})=>{const{equalityFn:o=m4,devModeChecks:a={}}=typeof i=="function"?{equalityFn:i}:i,{store:s,subscription:u,getServerState:l,stabilityCheck:c,identityFunctionCheck:h}=e();Gn.useRef(!0);const d=Gn.useCallback({[r.name](m){return r(m)}}[r.name],[r,c,a.stabilityCheck]),p=FI(u.addNestedSub,s.getState,l||s.getState,d,o);return Gn.useDebugValue(p),p};return Object.assign(t,{withTypes:()=>t}),t}var Ec=v4();function g4(n){n()}function y4(){let n=null,e=null;return{clear(){n=null,e=null},notify(){g4(()=>{let t=n;for(;t;)t.callback(),t=t.next})},get(){const t=[];let r=n;for(;r;)t.push(r),r=r.next;return t},subscribe(t){let r=!0;const i=e={callback:t,next:null,prev:e};return i.prev?i.prev.next=i:n=i,function(){!r||n===null||(r=!1,i.next?i.next.prev=i.prev:e=i.prev,i.prev?i.prev.next=i.next:n=i.next)}}}}var xx={notify(){},get:()=>[]};function w4(n,e){let t,r=xx,i=0,o=!1;function a(g){c();const y=r.subscribe(g);let v=!1;return()=>{v||(v=!0,y(),h())}}function s(){r.notify()}function u(){m.onStateChange&&m.onStateChange()}function l(){return o}function c(){i++,t||(t=n.subscribe(u),r=y4())}function h(){i--,t&&i===0&&(t(),t=void 0,r.clear(),r=xx)}function d(){o||(o=!0,c())}function p(){o&&(o=!1,h())}const m={addNestedSub:a,notifyNestedSubs:s,handleChangeWrapper:u,isSubscribed:l,trySubscribe:d,tryUnsubscribe:p,getListeners:()=>r};return m}var _4=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",x4=typeof navigator<"u"&&navigator.product==="ReactNative",b4=_4||x4?Gn.useLayoutEffect:Gn.useEffect;function E4({store:n,context:e,children:t,serverState:r,stabilityCheck:i="once",identityFunctionCheck:o="once"}){const a=Gn.useMemo(()=>{const l=w4(n);return{store:n,subscription:l,getServerState:r?()=>r:void 0,stabilityCheck:i,identityFunctionCheck:o}},[n,r,i,o]),s=Gn.useMemo(()=>n.getState(),[n]);b4(()=>{const{subscription:l}=a;return l.onStateChange=l.notifyNestedSubs,l.trySubscribe(),s!==n.getState()&&l.notifyNestedSubs(),()=>{l.tryUnsubscribe(),l.onStateChange=void 0}},[a,s]);const u=e||Bo;return Gn.createElement(u.Provider,{value:a},t)}var LI=E4;function VI(n=Bo){const e=n===Bo?MI:g0(n),t=()=>{const{store:r}=e();return r};return Object.assign(t,{withTypes:()=>t}),t}var C4=VI();function I4(n=Bo){const e=n===Bo?C4:VI(n),t=()=>e().dispatch;return Object.assign(t,{withTypes:()=>t}),t}var BI=I4();p4(h4.useSyncExternalStoreWithSelector);var UI={exports:{}},T4="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",S4=T4,R4=S4;function jI(){}function zI(){}zI.resetWarningCache=jI;var k4=function(){function n(r,i,o,a,s,u){if(u!==R4){var l=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw l.name="Invariant Violation",l}}n.isRequired=n;function e(){return n}var t={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:e,element:n,elementType:n,instanceOf:e,node:n,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:zI,resetWarningCache:jI};return t.PropTypes=t,t};UI.exports=k4();var A4=UI.exports;const pr=w2(A4);/**
 * @remix-run/router v1.19.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Kl(){return Kl=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Kl.apply(this,arguments)}var po;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(po||(po={}));const bx="popstate";function P4(n){n===void 0&&(n={});function e(r,i){let{pathname:o,search:a,hash:s}=r.location;return gg("",{pathname:o,search:a,hash:s},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(r,i){return typeof i=="string"?i:zd(i)}return D4(e,t,null,n)}function St(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function WI(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function N4(){return Math.random().toString(36).substr(2,8)}function Ex(n,e){return{usr:n.state,key:n.key,idx:e}}function gg(n,e,t,r){return t===void 0&&(t=null),Kl({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?xu(e):e,{state:t,key:e&&e.key||r||N4()})}function zd(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function xu(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function D4(n,e,t,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:o=!1}=r,a=i.history,s=po.Pop,u=null,l=c();l==null&&(l=0,a.replaceState(Kl({},a.state,{idx:l}),""));function c(){return(a.state||{idx:null}).idx}function h(){s=po.Pop;let y=c(),v=y==null?null:y-l;l=y,u&&u({action:s,location:g.location,delta:v})}function d(y,v){s=po.Push;let w=gg(g.location,y,v);l=c()+1;let _=Ex(w,l),x=g.createHref(w);try{a.pushState(_,"",x)}catch(C){if(C instanceof DOMException&&C.name==="DataCloneError")throw C;i.location.assign(x)}o&&u&&u({action:s,location:g.location,delta:1})}function p(y,v){s=po.Replace;let w=gg(g.location,y,v);l=c();let _=Ex(w,l),x=g.createHref(w);a.replaceState(_,"",x),o&&u&&u({action:s,location:g.location,delta:0})}function m(y){let v=i.location.origin!=="null"?i.location.origin:i.location.href,w=typeof y=="string"?y:zd(y);return w=w.replace(/ $/,"%20"),St(v,"No window.location.(origin|href) available to create URL for href: "+w),new URL(w,v)}let g={get action(){return s},get location(){return n(i,a)},listen(y){if(u)throw new Error("A history only accepts one active listener");return i.addEventListener(bx,h),u=y,()=>{i.removeEventListener(bx,h),u=null}},createHref(y){return e(i,y)},createURL:m,encodeLocation(y){let v=m(y);return{pathname:v.pathname,search:v.search,hash:v.hash}},push:d,replace:p,go(y){return a.go(y)}};return g}var Cx;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(Cx||(Cx={}));function O4(n,e,t){return t===void 0&&(t="/"),M4(n,e,t,!1)}function M4(n,e,t,r){let i=typeof e=="string"?xu(e):e,o=y0(i.pathname||"/",t);if(o==null)return null;let a=$I(n);F4(a);let s=null;for(let u=0;s==null&&u<a.length;++u){let l=q4(o);s=H4(a[u],l,r)}return s}function $I(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let i=(o,a,s)=>{let u={relativePath:s===void 0?o.path||"":s,caseSensitive:o.caseSensitive===!0,childrenIndex:a,route:o};u.relativePath.startsWith("/")&&(St(u.relativePath.startsWith(r),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(r.length));let l=So([r,u.relativePath]),c=t.concat(u);o.children&&o.children.length>0&&(St(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+l+'".')),$I(o.children,e,c,l)),!(o.path==null&&!o.index)&&e.push({path:l,score:W4(l,o.index),routesMeta:c})};return n.forEach((o,a)=>{var s;if(o.path===""||!((s=o.path)!=null&&s.includes("?")))i(o,a);else for(let u of HI(o.path))i(o,a,u)}),e}function HI(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,i=t.endsWith("?"),o=t.replace(/\?$/,"");if(r.length===0)return i?[o,""]:[o];let a=HI(r.join("/")),s=[];return s.push(...a.map(u=>u===""?o:[o,u].join("/"))),i&&s.push(...a),s.map(u=>n.startsWith("/")&&u===""?"/":u)}function F4(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:$4(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const L4=/^:[\w-]+$/,V4=3,B4=2,U4=1,j4=10,z4=-2,Ix=n=>n==="*";function W4(n,e){let t=n.split("/"),r=t.length;return t.some(Ix)&&(r+=z4),e&&(r+=B4),t.filter(i=>!Ix(i)).reduce((i,o)=>i+(L4.test(o)?V4:o===""?U4:j4),r)}function $4(n,e){return n.length===e.length&&n.slice(0,-1).every((r,i)=>r===e[i])?n[n.length-1]-e[e.length-1]:0}function H4(n,e,t){let{routesMeta:r}=n,i={},o="/",a=[];for(let s=0;s<r.length;++s){let u=r[s],l=s===r.length-1,c=o==="/"?e:e.slice(o.length)||"/",h=Tx({path:u.relativePath,caseSensitive:u.caseSensitive,end:l},c),d=u.route;if(!h&&l&&t&&!r[r.length-1].route.index&&(h=Tx({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},c)),!h)return null;Object.assign(i,h.params),a.push({params:i,pathname:So([o,h.pathname]),pathnameBase:Y4(So([o,h.pathnameBase])),route:d}),h.pathnameBase!=="/"&&(o=So([o,h.pathnameBase]))}return a}function Tx(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=G4(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let o=i[0],a=o.replace(/(.)\/+$/,"$1"),s=i.slice(1);return{params:r.reduce((l,c,h)=>{let{paramName:d,isOptional:p}=c;if(d==="*"){let g=s[h]||"";a=o.slice(0,o.length-g.length).replace(/(.)\/+$/,"$1")}const m=s[h];return p&&!m?l[d]=void 0:l[d]=(m||"").replace(/%2F/g,"/"),l},{}),pathname:o,pathnameBase:a,pattern:n}}function G4(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),WI(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,s,u)=>(r.push({paramName:s,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function q4(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return WI(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function y0(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function K4(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:i=""}=typeof n=="string"?xu(n):n;return{pathname:t?t.startsWith("/")?t:X4(t,e):e,search:J4(r),hash:Z4(i)}}function X4(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function Fm(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Q4(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function GI(n,e){let t=Q4(n);return e?t.map((r,i)=>i===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function qI(n,e,t,r){r===void 0&&(r=!1);let i;typeof n=="string"?i=xu(n):(i=Kl({},n),St(!i.pathname||!i.pathname.includes("?"),Fm("?","pathname","search",i)),St(!i.pathname||!i.pathname.includes("#"),Fm("#","pathname","hash",i)),St(!i.search||!i.search.includes("#"),Fm("#","search","hash",i)));let o=n===""||i.pathname==="",a=o?"/":i.pathname,s;if(a==null)s=t;else{let h=e.length-1;if(!r&&a.startsWith("..")){let d=a.split("/");for(;d[0]==="..";)d.shift(),h-=1;i.pathname=d.join("/")}s=h>=0?e[h]:"/"}let u=K4(i,s),l=a&&a!=="/"&&a.endsWith("/"),c=(o||a===".")&&t.endsWith("/");return!u.pathname.endsWith("/")&&(l||c)&&(u.pathname+="/"),u}const So=n=>n.join("/").replace(/\/\/+/g,"/"),Y4=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),J4=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,Z4=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function e3(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const KI=["post","put","patch","delete"];new Set(KI);const t3=["get",...KI];new Set(t3);/**
 * React Router v6.26.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Xl(){return Xl=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Xl.apply(this,arguments)}const w0=Q.createContext(null),n3=Q.createContext(null),$a=Q.createContext(null),sp=Q.createContext(null),Ha=Q.createContext({outlet:null,matches:[],isDataRoute:!1}),XI=Q.createContext(null);function r3(n,e){let{relative:t}=e===void 0?{}:e;Cc()||St(!1);let{basename:r,navigator:i}=Q.useContext($a),{hash:o,pathname:a,search:s}=YI(n,{relative:t}),u=a;return r!=="/"&&(u=a==="/"?r:So([r,a])),i.createHref({pathname:u,search:s,hash:o})}function Cc(){return Q.useContext(sp)!=null}function Ic(){return Cc()||St(!1),Q.useContext(sp).location}function QI(n){Q.useContext($a).static||Q.useLayoutEffect(n)}function up(){let{isDataRoute:n}=Q.useContext(Ha);return n?v3():i3()}function i3(){Cc()||St(!1);let n=Q.useContext(w0),{basename:e,future:t,navigator:r}=Q.useContext($a),{matches:i}=Q.useContext(Ha),{pathname:o}=Ic(),a=JSON.stringify(GI(i,t.v7_relativeSplatPath)),s=Q.useRef(!1);return QI(()=>{s.current=!0}),Q.useCallback(function(l,c){if(c===void 0&&(c={}),!s.current)return;if(typeof l=="number"){r.go(l);return}let h=qI(l,JSON.parse(a),o,c.relative==="path");n==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:So([e,h.pathname])),(c.replace?r.replace:r.push)(h,c.state,c)},[e,r,a,o,n])}function YI(n,e){let{relative:t}=e===void 0?{}:e,{future:r}=Q.useContext($a),{matches:i}=Q.useContext(Ha),{pathname:o}=Ic(),a=JSON.stringify(GI(i,r.v7_relativeSplatPath));return Q.useMemo(()=>qI(n,JSON.parse(a),o,t==="path"),[n,a,o,t])}function o3(n,e){return a3(n,e)}function a3(n,e,t,r){Cc()||St(!1);let{navigator:i}=Q.useContext($a),{matches:o}=Q.useContext(Ha),a=o[o.length-1],s=a?a.params:{};a&&a.pathname;let u=a?a.pathnameBase:"/";a&&a.route;let l=Ic(),c;if(e){var h;let y=typeof e=="string"?xu(e):e;u==="/"||(h=y.pathname)!=null&&h.startsWith(u)||St(!1),c=y}else c=l;let d=c.pathname||"/",p=d;if(u!=="/"){let y=u.replace(/^\//,"").split("/");p="/"+d.replace(/^\//,"").split("/").slice(y.length).join("/")}let m=O4(n,{pathname:p}),g=h3(m&&m.map(y=>Object.assign({},y,{params:Object.assign({},s,y.params),pathname:So([u,i.encodeLocation?i.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?u:So([u,i.encodeLocation?i.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),o,t,r);return e&&g?Q.createElement(sp.Provider,{value:{location:Xl({pathname:"/",search:"",hash:"",state:null,key:"default"},c),navigationType:po.Pop}},g):g}function s3(){let n=m3(),e=e3(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Q.createElement(Q.Fragment,null,Q.createElement("h2",null,"Unexpected Application Error!"),Q.createElement("h3",{style:{fontStyle:"italic"}},e),t?Q.createElement("pre",{style:i},t):null,null)}const u3=Q.createElement(s3,null);class l3 extends Q.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?Q.createElement(Ha.Provider,{value:this.props.routeContext},Q.createElement(XI.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function c3(n){let{routeContext:e,match:t,children:r}=n,i=Q.useContext(w0);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),Q.createElement(Ha.Provider,{value:e},r)}function h3(n,e,t,r){var i;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var o;if(!t)return null;if(t.errors)n=t.matches;else if((o=r)!=null&&o.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let a=n,s=(i=t)==null?void 0:i.errors;if(s!=null){let c=a.findIndex(h=>h.route.id&&(s==null?void 0:s[h.route.id])!==void 0);c>=0||St(!1),a=a.slice(0,Math.min(a.length,c+1))}let u=!1,l=-1;if(t&&r&&r.v7_partialHydration)for(let c=0;c<a.length;c++){let h=a[c];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(l=c),h.route.id){let{loaderData:d,errors:p}=t,m=h.route.loader&&d[h.route.id]===void 0&&(!p||p[h.route.id]===void 0);if(h.route.lazy||m){u=!0,l>=0?a=a.slice(0,l+1):a=[a[0]];break}}}return a.reduceRight((c,h,d)=>{let p,m=!1,g=null,y=null;t&&(p=s&&h.route.id?s[h.route.id]:void 0,g=h.route.errorElement||u3,u&&(l<0&&d===0?(m=!0,y=null):l===d&&(m=!0,y=h.route.hydrateFallbackElement||null)));let v=e.concat(a.slice(0,d+1)),w=()=>{let _;return p?_=g:m?_=y:h.route.Component?_=Q.createElement(h.route.Component,null):h.route.element?_=h.route.element:_=c,Q.createElement(c3,{match:h,routeContext:{outlet:c,matches:v,isDataRoute:t!=null},children:_})};return t&&(h.route.ErrorBoundary||h.route.errorElement||d===0)?Q.createElement(l3,{location:t.location,revalidation:t.revalidation,component:g,error:p,children:w(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):w()},null)}var JI=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(JI||{}),Wd=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(Wd||{});function d3(n){let e=Q.useContext(w0);return e||St(!1),e}function f3(n){let e=Q.useContext(n3);return e||St(!1),e}function p3(n){let e=Q.useContext(Ha);return e||St(!1),e}function ZI(n){let e=p3(),t=e.matches[e.matches.length-1];return t.route.id||St(!1),t.route.id}function m3(){var n;let e=Q.useContext(XI),t=f3(Wd.UseRouteError),r=ZI(Wd.UseRouteError);return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function v3(){let{router:n}=d3(JI.UseNavigateStable),e=ZI(Wd.UseNavigateStable),t=Q.useRef(!1);return QI(()=>{t.current=!0}),Q.useCallback(function(i,o){o===void 0&&(o={}),t.current&&(typeof i=="number"?n.navigate(i):n.navigate(i,Xl({fromRouteId:e},o)))},[n,e])}function wi(n){St(!1)}function g3(n){let{basename:e="/",children:t=null,location:r,navigationType:i=po.Pop,navigator:o,static:a=!1,future:s}=n;Cc()&&St(!1);let u=e.replace(/^\/*/,"/"),l=Q.useMemo(()=>({basename:u,navigator:o,static:a,future:Xl({v7_relativeSplatPath:!1},s)}),[u,s,o,a]);typeof r=="string"&&(r=xu(r));let{pathname:c="/",search:h="",hash:d="",state:p=null,key:m="default"}=r,g=Q.useMemo(()=>{let y=y0(c,u);return y==null?null:{location:{pathname:y,search:h,hash:d,state:p,key:m},navigationType:i}},[u,c,h,d,p,m,i]);return g==null?null:Q.createElement($a.Provider,{value:l},Q.createElement(sp.Provider,{children:t,value:g}))}function y3(n){let{children:e,location:t}=n;return o3(yg(e),t)}new Promise(()=>{});function yg(n,e){e===void 0&&(e=[]);let t=[];return Q.Children.forEach(n,(r,i)=>{if(!Q.isValidElement(r))return;let o=[...e,i];if(r.type===Q.Fragment){t.push.apply(t,yg(r.props.children,o));return}r.type!==wi&&St(!1),!r.props.index||!r.props.children||St(!1);let a={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=yg(r.props.children,o)),t.push(a)}),t}/**
 * React Router DOM v6.26.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function wg(){return wg=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},wg.apply(this,arguments)}function w3(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,o;for(o=0;o<r.length;o++)i=r[o],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function _3(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function x3(n,e){return n.button===0&&(!e||e==="_self")&&!_3(n)}const b3=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],E3="6";try{window.__reactRouterVersion=E3}catch{}const C3="startTransition",Sx=Cv[C3];function I3(n){let{basename:e,children:t,future:r,window:i}=n,o=Q.useRef();o.current==null&&(o.current=P4({window:i,v5Compat:!0}));let a=o.current,[s,u]=Q.useState({action:a.action,location:a.location}),{v7_startTransition:l}=r||{},c=Q.useCallback(h=>{l&&Sx?Sx(()=>u(h)):u(h)},[u,l]);return Q.useLayoutEffect(()=>a.listen(c),[a,c]),Q.createElement(g3,{basename:e,children:t,location:s.location,navigationType:s.action,navigator:a,future:r})}const T3=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",S3=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,mn=Q.forwardRef(function(e,t){let{onClick:r,relative:i,reloadDocument:o,replace:a,state:s,target:u,to:l,preventScrollReset:c,unstable_viewTransition:h}=e,d=w3(e,b3),{basename:p}=Q.useContext($a),m,g=!1;if(typeof l=="string"&&S3.test(l)&&(m=l,T3))try{let _=new URL(window.location.href),x=l.startsWith("//")?new URL(_.protocol+l):new URL(l),C=y0(x.pathname,p);x.origin===_.origin&&C!=null?l=C+x.search+x.hash:g=!0}catch{}let y=r3(l,{relative:i}),v=R3(l,{replace:a,state:s,target:u,preventScrollReset:c,relative:i,unstable_viewTransition:h});function w(_){r&&r(_),_.defaultPrevented||v(_)}return Q.createElement("a",wg({},d,{href:m||y,onClick:g||o?r:w,ref:t,target:u}))});var Rx;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(Rx||(Rx={}));var kx;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(kx||(kx={}));function R3(n,e){let{target:t,replace:r,state:i,preventScrollReset:o,relative:a,unstable_viewTransition:s}=e===void 0?{}:e,u=up(),l=Ic(),c=YI(n,{relative:a});return Q.useCallback(h=>{if(x3(h,t)){h.preventDefault();let d=r!==void 0?r:zd(l)===zd(c);u(n,{replace:d,state:i,preventScrollReset:o,relative:a,unstable_viewTransition:s})}},[l,u,c,r,i,t,n,o,a,s])}function Ht(n){return`Minified Redux error #${n}; visit https://redux.js.org/Errors?code=${n} for the full message or use the non-minified dev environment for full errors. `}var k3=typeof Symbol=="function"&&Symbol.observable||"@@observable",Ax=k3,Lm=()=>Math.random().toString(36).substring(7).split("").join("."),A3={INIT:`@@redux/INIT${Lm()}`,REPLACE:`@@redux/REPLACE${Lm()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${Lm()}`},$d=A3;function _0(n){if(typeof n!="object"||n===null)return!1;let e=n;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(n)===e||Object.getPrototypeOf(n)===null}function eT(n,e,t){if(typeof n!="function")throw new Error(Ht(2));if(typeof e=="function"&&typeof t=="function"||typeof t=="function"&&typeof arguments[3]=="function")throw new Error(Ht(0));if(typeof e=="function"&&typeof t>"u"&&(t=e,e=void 0),typeof t<"u"){if(typeof t!="function")throw new Error(Ht(1));return t(eT)(n,e)}let r=n,i=e,o=new Map,a=o,s=0,u=!1;function l(){a===o&&(a=new Map,o.forEach((y,v)=>{a.set(v,y)}))}function c(){if(u)throw new Error(Ht(3));return i}function h(y){if(typeof y!="function")throw new Error(Ht(4));if(u)throw new Error(Ht(5));let v=!0;l();const w=s++;return a.set(w,y),function(){if(v){if(u)throw new Error(Ht(6));v=!1,l(),a.delete(w),o=null}}}function d(y){if(!_0(y))throw new Error(Ht(7));if(typeof y.type>"u")throw new Error(Ht(8));if(typeof y.type!="string")throw new Error(Ht(17));if(u)throw new Error(Ht(9));try{u=!0,i=r(i,y)}finally{u=!1}return(o=a).forEach(w=>{w()}),y}function p(y){if(typeof y!="function")throw new Error(Ht(10));r=y,d({type:$d.REPLACE})}function m(){const y=h;return{subscribe(v){if(typeof v!="object"||v===null)throw new Error(Ht(11));function w(){const x=v;x.next&&x.next(c())}return w(),{unsubscribe:y(w)}},[Ax](){return this}}}return d({type:$d.INIT}),{dispatch:d,subscribe:h,getState:c,replaceReducer:p,[Ax]:m}}function P3(n){Object.keys(n).forEach(e=>{const t=n[e];if(typeof t(void 0,{type:$d.INIT})>"u")throw new Error(Ht(12));if(typeof t(void 0,{type:$d.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Ht(13))})}function N3(n){const e=Object.keys(n),t={};for(let o=0;o<e.length;o++){const a=e[o];typeof n[a]=="function"&&(t[a]=n[a])}const r=Object.keys(t);let i;try{P3(t)}catch(o){i=o}return function(a={},s){if(i)throw i;let u=!1;const l={};for(let c=0;c<r.length;c++){const h=r[c],d=t[h],p=a[h],m=d(p,s);if(typeof m>"u")throw s&&s.type,new Error(Ht(14));l[h]=m,u=u||m!==p}return u=u||r.length!==Object.keys(a).length,u?l:a}}function Hd(...n){return n.length===0?e=>e:n.length===1?n[0]:n.reduce((e,t)=>(...r)=>e(t(...r)))}function D3(...n){return e=>(t,r)=>{const i=e(t,r);let o=()=>{throw new Error(Ht(15))};const a={getState:i.getState,dispatch:(u,...l)=>o(u,...l)},s=n.map(u=>u(a));return o=Hd(...s)(i.dispatch),{...i,dispatch:o}}}function O3(n){return _0(n)&&"type"in n&&typeof n.type=="string"}var tT=Symbol.for("immer-nothing"),Px=Symbol.for("immer-draftable"),Zn=Symbol.for("immer-state");function Sr(n,...e){throw new Error(`[Immer] minified error nr: ${n}. Full error at: https://bit.ly/3cXEKWf`)}var ou=Object.getPrototypeOf;function Na(n){return!!n&&!!n[Zn]}function Mi(n){var e;return n?nT(n)||Array.isArray(n)||!!n[Px]||!!((e=n.constructor)!=null&&e[Px])||cp(n)||hp(n):!1}var M3=Object.prototype.constructor.toString();function nT(n){if(!n||typeof n!="object")return!1;const e=ou(n);if(e===null)return!0;const t=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return t===Object?!0:typeof t=="function"&&Function.toString.call(t)===M3}function Gd(n,e){lp(n)===0?Reflect.ownKeys(n).forEach(t=>{e(t,n[t],n)}):n.forEach((t,r)=>e(r,t,n))}function lp(n){const e=n[Zn];return e?e.type_:Array.isArray(n)?1:cp(n)?2:hp(n)?3:0}function _g(n,e){return lp(n)===2?n.has(e):Object.prototype.hasOwnProperty.call(n,e)}function rT(n,e,t){const r=lp(n);r===2?n.set(e,t):r===3?n.add(t):n[e]=t}function F3(n,e){return n===e?n!==0||1/n===1/e:n!==n&&e!==e}function cp(n){return n instanceof Map}function hp(n){return n instanceof Set}function ha(n){return n.copy_||n.base_}function xg(n,e){if(cp(n))return new Map(n);if(hp(n))return new Set(n);if(Array.isArray(n))return Array.prototype.slice.call(n);const t=nT(n);if(e===!0||e==="class_only"&&!t){const r=Object.getOwnPropertyDescriptors(n);delete r[Zn];let i=Reflect.ownKeys(r);for(let o=0;o<i.length;o++){const a=i[o],s=r[a];s.writable===!1&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(r[a]={configurable:!0,writable:!0,enumerable:s.enumerable,value:n[a]})}return Object.create(ou(n),r)}else{const r=ou(n);if(r!==null&&t)return{...n};const i=Object.create(r);return Object.assign(i,n)}}function x0(n,e=!1){return dp(n)||Na(n)||!Mi(n)||(lp(n)>1&&(n.set=n.add=n.clear=n.delete=L3),Object.freeze(n),e&&Object.entries(n).forEach(([t,r])=>x0(r,!0))),n}function L3(){Sr(2)}function dp(n){return Object.isFrozen(n)}var V3={};function Da(n){const e=V3[n];return e||Sr(0,n),e}var Ql;function iT(){return Ql}function B3(n,e){return{drafts_:[],parent_:n,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Nx(n,e){e&&(Da("Patches"),n.patches_=[],n.inversePatches_=[],n.patchListener_=e)}function bg(n){Eg(n),n.drafts_.forEach(U3),n.drafts_=null}function Eg(n){n===Ql&&(Ql=n.parent_)}function Dx(n){return Ql=B3(Ql,n)}function U3(n){const e=n[Zn];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function Ox(n,e){e.unfinalizedDrafts_=e.drafts_.length;const t=e.drafts_[0];return n!==void 0&&n!==t?(t[Zn].modified_&&(bg(e),Sr(4)),Mi(n)&&(n=qd(e,n),e.parent_||Kd(e,n)),e.patches_&&Da("Patches").generateReplacementPatches_(t[Zn].base_,n,e.patches_,e.inversePatches_)):n=qd(e,t,[]),bg(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),n!==tT?n:void 0}function qd(n,e,t){if(dp(e))return e;const r=e[Zn];if(!r)return Gd(e,(i,o)=>Mx(n,r,e,i,o,t)),e;if(r.scope_!==n)return e;if(!r.modified_)return Kd(n,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const i=r.copy_;let o=i,a=!1;r.type_===3&&(o=new Set(i),i.clear(),a=!0),Gd(o,(s,u)=>Mx(n,r,i,s,u,t,a)),Kd(n,i,!1),t&&n.patches_&&Da("Patches").generatePatches_(r,t,n.patches_,n.inversePatches_)}return r.copy_}function Mx(n,e,t,r,i,o,a){if(Na(i)){const s=o&&e&&e.type_!==3&&!_g(e.assigned_,r)?o.concat(r):void 0,u=qd(n,i,s);if(rT(t,r,u),Na(u))n.canAutoFreeze_=!1;else return}else a&&t.add(i);if(Mi(i)&&!dp(i)){if(!n.immer_.autoFreeze_&&n.unfinalizedDrafts_<1)return;qd(n,i),(!e||!e.scope_.parent_)&&typeof r!="symbol"&&Object.prototype.propertyIsEnumerable.call(t,r)&&Kd(n,i)}}function Kd(n,e,t=!1){!n.parent_&&n.immer_.autoFreeze_&&n.canAutoFreeze_&&x0(e,t)}function j3(n,e){const t=Array.isArray(n),r={type_:t?1:0,scope_:e?e.scope_:iT(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:n,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=r,o=b0;t&&(i=[r],o=Yl);const{revoke:a,proxy:s}=Proxy.revocable(i,o);return r.draft_=s,r.revoke_=a,s}var b0={get(n,e){if(e===Zn)return n;const t=ha(n);if(!_g(t,e))return z3(n,t,e);const r=t[e];return n.finalized_||!Mi(r)?r:r===Vm(n.base_,e)?(Bm(n),n.copy_[e]=Ig(r,n)):r},has(n,e){return e in ha(n)},ownKeys(n){return Reflect.ownKeys(ha(n))},set(n,e,t){const r=oT(ha(n),e);if(r!=null&&r.set)return r.set.call(n.draft_,t),!0;if(!n.modified_){const i=Vm(ha(n),e),o=i==null?void 0:i[Zn];if(o&&o.base_===t)return n.copy_[e]=t,n.assigned_[e]=!1,!0;if(F3(t,i)&&(t!==void 0||_g(n.base_,e)))return!0;Bm(n),Cg(n)}return n.copy_[e]===t&&(t!==void 0||e in n.copy_)||Number.isNaN(t)&&Number.isNaN(n.copy_[e])||(n.copy_[e]=t,n.assigned_[e]=!0),!0},deleteProperty(n,e){return Vm(n.base_,e)!==void 0||e in n.base_?(n.assigned_[e]=!1,Bm(n),Cg(n)):delete n.assigned_[e],n.copy_&&delete n.copy_[e],!0},getOwnPropertyDescriptor(n,e){const t=ha(n),r=Reflect.getOwnPropertyDescriptor(t,e);return r&&{writable:!0,configurable:n.type_!==1||e!=="length",enumerable:r.enumerable,value:t[e]}},defineProperty(){Sr(11)},getPrototypeOf(n){return ou(n.base_)},setPrototypeOf(){Sr(12)}},Yl={};Gd(b0,(n,e)=>{Yl[n]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});Yl.deleteProperty=function(n,e){return Yl.set.call(this,n,e,void 0)};Yl.set=function(n,e,t){return b0.set.call(this,n[0],e,t,n[0])};function Vm(n,e){const t=n[Zn];return(t?ha(t):n)[e]}function z3(n,e,t){var i;const r=oT(e,t);return r?"value"in r?r.value:(i=r.get)==null?void 0:i.call(n.draft_):void 0}function oT(n,e){if(!(e in n))return;let t=ou(n);for(;t;){const r=Object.getOwnPropertyDescriptor(t,e);if(r)return r;t=ou(t)}}function Cg(n){n.modified_||(n.modified_=!0,n.parent_&&Cg(n.parent_))}function Bm(n){n.copy_||(n.copy_=xg(n.base_,n.scope_.immer_.useStrictShallowCopy_))}var W3=class{constructor(n){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,r)=>{if(typeof e=="function"&&typeof t!="function"){const o=t;t=e;const a=this;return function(u=o,...l){return a.produce(u,c=>t.call(this,c,...l))}}typeof t!="function"&&Sr(6),r!==void 0&&typeof r!="function"&&Sr(7);let i;if(Mi(e)){const o=Dx(this),a=Ig(e,void 0);let s=!0;try{i=t(a),s=!1}finally{s?bg(o):Eg(o)}return Nx(o,r),Ox(i,o)}else if(!e||typeof e!="object"){if(i=t(e),i===void 0&&(i=e),i===tT&&(i=void 0),this.autoFreeze_&&x0(i,!0),r){const o=[],a=[];Da("Patches").generateReplacementPatches_(e,i,o,a),r(o,a)}return i}else Sr(1,e)},this.produceWithPatches=(e,t)=>{if(typeof e=="function")return(a,...s)=>this.produceWithPatches(a,u=>e(u,...s));let r,i;return[this.produce(e,t,(a,s)=>{r=a,i=s}),r,i]},typeof(n==null?void 0:n.autoFreeze)=="boolean"&&this.setAutoFreeze(n.autoFreeze),typeof(n==null?void 0:n.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(n.useStrictShallowCopy)}createDraft(n){Mi(n)||Sr(8),Na(n)&&(n=$3(n));const e=Dx(this),t=Ig(n,void 0);return t[Zn].isManual_=!0,Eg(e),t}finishDraft(n,e){const t=n&&n[Zn];(!t||!t.isManual_)&&Sr(9);const{scope_:r}=t;return Nx(r,e),Ox(void 0,r)}setAutoFreeze(n){this.autoFreeze_=n}setUseStrictShallowCopy(n){this.useStrictShallowCopy_=n}applyPatches(n,e){let t;for(t=e.length-1;t>=0;t--){const i=e[t];if(i.path.length===0&&i.op==="replace"){n=i.value;break}}t>-1&&(e=e.slice(t+1));const r=Da("Patches").applyPatches_;return Na(n)?r(n,e):this.produce(n,i=>r(i,e))}};function Ig(n,e){const t=cp(n)?Da("MapSet").proxyMap_(n,e):hp(n)?Da("MapSet").proxySet_(n,e):j3(n,e);return(e?e.scope_:iT()).drafts_.push(t),t}function $3(n){return Na(n)||Sr(10,n),aT(n)}function aT(n){if(!Mi(n)||dp(n))return n;const e=n[Zn];let t;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,t=xg(n,e.scope_.immer_.useStrictShallowCopy_)}else t=xg(n,!0);return Gd(t,(r,i)=>{rT(t,r,aT(i))}),e&&(e.finalized_=!1),t}var er=new W3,sT=er.produce;er.produceWithPatches.bind(er);er.setAutoFreeze.bind(er);er.setUseStrictShallowCopy.bind(er);er.applyPatches.bind(er);er.createDraft.bind(er);er.finishDraft.bind(er);function uT(n){return({dispatch:t,getState:r})=>i=>o=>typeof o=="function"?o(t,r,n):i(o)}var H3=uT(),G3=uT,q3=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Hd:Hd.apply(null,arguments)};function Fx(n,e){function t(...r){if(e){let i=e(...r);if(!i)throw new Error(Or(0));return{type:n,payload:i.payload,..."meta"in i&&{meta:i.meta},..."error"in i&&{error:i.error}}}return{type:n,payload:r[0]}}return t.toString=()=>`${n}`,t.type=n,t.match=r=>O3(r)&&r.type===n,t}var lT=class al extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,al.prototype)}static get[Symbol.species](){return al}concat(...e){return super.concat.apply(this,e)}prepend(...e){return e.length===1&&Array.isArray(e[0])?new al(...e[0].concat(this)):new al(...e.concat(this))}};function Lx(n){return Mi(n)?sT(n,()=>{}):n}function Vx(n,e,t){if(n.has(e)){let i=n.get(e);return t.update&&(i=t.update(i,e,n),n.set(e,i)),i}if(!t.insert)throw new Error(Or(10));const r=t.insert(e,n);return n.set(e,r),r}function K3(n){return typeof n=="boolean"}var X3=()=>function(e){const{thunk:t=!0,immutableCheck:r=!0,serializableCheck:i=!0,actionCreatorCheck:o=!0}=e??{};let a=new lT;return t&&(K3(t)?a.push(H3):a.push(G3(t.extraArgument))),a},Q3="RTK_autoBatch",cT=n=>e=>{setTimeout(e,n)},Y3=typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:cT(10),J3=(n={type:"raf"})=>e=>(...t)=>{const r=e(...t);let i=!0,o=!1,a=!1;const s=new Set,u=n.type==="tick"?queueMicrotask:n.type==="raf"?Y3:n.type==="callback"?n.queueNotification:cT(n.timeout),l=()=>{a=!1,o&&(o=!1,s.forEach(c=>c()))};return Object.assign({},r,{subscribe(c){const h=()=>i&&c(),d=r.subscribe(h);return s.add(c),()=>{d(),s.delete(c)}},dispatch(c){var h;try{return i=!((h=c==null?void 0:c.meta)!=null&&h[Q3]),o=!i,o&&(a||(a=!0,u(l))),r.dispatch(c)}finally{i=!0}}})},Z3=n=>function(t){const{autoBatch:r=!0}=t??{};let i=new lT(n);return r&&i.push(J3(typeof r=="object"?r:void 0)),i};function eO(n){const e=X3(),{reducer:t=void 0,middleware:r,devTools:i=!0,preloadedState:o=void 0,enhancers:a=void 0}=n||{};let s;if(typeof t=="function")s=t;else if(_0(t))s=N3(t);else throw new Error(Or(1));let u;typeof r=="function"?u=r(e):u=e();let l=Hd;i&&(l=q3({trace:!1,...typeof i=="object"&&i}));const c=D3(...u),h=Z3(c);let d=typeof a=="function"?a(h):h();const p=l(...d);return eT(s,o,p)}function hT(n){const e={},t=[];let r;const i={addCase(o,a){const s=typeof o=="string"?o:o.type;if(!s)throw new Error(Or(28));if(s in e)throw new Error(Or(29));return e[s]=a,i},addMatcher(o,a){return t.push({matcher:o,reducer:a}),i},addDefaultCase(o){return r=o,i}};return n(i),[e,t,r]}function tO(n){return typeof n=="function"}function nO(n,e){let[t,r,i]=hT(e),o;if(tO(n))o=()=>Lx(n());else{const s=Lx(n);o=()=>s}function a(s=o(),u){let l=[t[u.type],...r.filter(({matcher:c})=>c(u)).map(({reducer:c})=>c)];return l.filter(c=>!!c).length===0&&(l=[i]),l.reduce((c,h)=>{if(h)if(Na(c)){const p=h(c,u);return p===void 0?c:p}else{if(Mi(c))return sT(c,d=>h(d,u));{const d=h(c,u);if(d===void 0){if(c===null)return c;throw new Error(Or(9))}return d}}return c},s)}return a.getInitialState=o,a}var rO=Symbol.for("rtk-slice-createasyncthunk");function iO(n,e){return`${n}/${e}`}function oO({creators:n}={}){var t;const e=(t=n==null?void 0:n.asyncThunk)==null?void 0:t[rO];return function(i){const{name:o,reducerPath:a=o}=i;if(!o)throw new Error(Or(11));typeof process<"u";const s=(typeof i.reducers=="function"?i.reducers(uO()):i.reducers)||{},u=Object.keys(s),l={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},c={addCase(_,x){const C=typeof _=="string"?_:_.type;if(!C)throw new Error(Or(12));if(C in l.sliceCaseReducersByType)throw new Error(Or(13));return l.sliceCaseReducersByType[C]=x,c},addMatcher(_,x){return l.sliceMatchers.push({matcher:_,reducer:x}),c},exposeAction(_,x){return l.actionCreators[_]=x,c},exposeCaseReducer(_,x){return l.sliceCaseReducersByName[_]=x,c}};u.forEach(_=>{const x=s[_],C={reducerName:_,type:iO(o,_),createNotation:typeof i.reducers=="function"};cO(x)?dO(C,x,c,e):lO(C,x,c)});function h(){const[_={},x=[],C=void 0]=typeof i.extraReducers=="function"?hT(i.extraReducers):[i.extraReducers],A={..._,...l.sliceCaseReducersByType};return nO(i.initialState,T=>{for(let E in A)T.addCase(E,A[E]);for(let E of l.sliceMatchers)T.addMatcher(E.matcher,E.reducer);for(let E of x)T.addMatcher(E.matcher,E.reducer);C&&T.addDefaultCase(C)})}const d=_=>_,p=new Map;let m;function g(_,x){return m||(m=h()),m(_,x)}function y(){return m||(m=h()),m.getInitialState()}function v(_,x=!1){function C(T){let E=T[_];return typeof E>"u"&&x&&(E=y()),E}function A(T=d){const E=Vx(p,x,{insert:()=>new WeakMap});return Vx(E,T,{insert:()=>{const I={};for(const[S,N]of Object.entries(i.selectors??{}))I[S]=aO(N,T,y,x);return I}})}return{reducerPath:_,getSelectors:A,get selectors(){return A(C)},selectSlice:C}}const w={name:o,reducer:g,actions:l.actionCreators,caseReducers:l.sliceCaseReducersByName,getInitialState:y,...v(a),injectInto(_,{reducerPath:x,...C}={}){const A=x??a;return _.inject({reducerPath:A,reducer:g},C),{...w,...v(A,!0)}}};return w}}function aO(n,e,t,r){function i(o,...a){let s=e(o);return typeof s>"u"&&r&&(s=t()),n(s,...a)}return i.unwrapped=n,i}var sO=oO();function uO(){function n(e,t){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...t}}return n.withTypes=()=>n,{reducer(e){return Object.assign({[e.name](...t){return e(...t)}}[e.name],{_reducerDefinitionType:"reducer"})},preparedReducer(e,t){return{_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}},asyncThunk:n}}function lO({type:n,reducerName:e,createNotation:t},r,i){let o,a;if("reducer"in r){if(t&&!hO(r))throw new Error(Or(17));o=r.reducer,a=r.prepare}else o=r;i.addCase(n,o).exposeCaseReducer(e,o).exposeAction(e,a?Fx(n,a):Fx(n))}function cO(n){return n._reducerDefinitionType==="asyncThunk"}function hO(n){return n._reducerDefinitionType==="reducerWithPrepare"}function dO({type:n,reducerName:e},t,r,i){if(!i)throw new Error(Or(18));const{payloadCreator:o,fulfilled:a,pending:s,rejected:u,settled:l,options:c}=t,h=i(n,o,c);r.exposeAction(e,h),a&&r.addCase(h.fulfilled,a),s&&r.addCase(h.pending,s),u&&r.addCase(h.rejected,u),l&&r.addMatcher(h.settled,l),r.exposeCaseReducer(e,{fulfilled:a||Sh,pending:s||Sh,rejected:u||Sh,settled:l||Sh})}function Sh(){}function Or(n){return`Minified Redux Toolkit error #${n}; visit https://redux-toolkit.js.org/Errors?code=${n} for the full message or use the non-minified dev environment for full errors. `}const fO=()=>{try{const n=localStorage.getItem("authState");return n===null?{user:{name:"",email:""},isAuthenticated:!1,token:""}:JSON.parse(n)}catch{return{user:{name:"",email:""},isAuthenticated:!1,token:""}}},dT=sO({name:"auth",initialState:fO(),reducers:{loginSuccess:(n,e)=>{const{user:t,token:r}=e.payload;n.user=t,n.isAuthenticated=!0,n.token=r,localStorage.setItem("authState",JSON.stringify(n))},logout:n=>{n.user={name:"",email:""},n.isAuthenticated=!1,n.token="",localStorage.removeItem("authState")}}}),{loginSuccess:pO,logout:mO}=dT.actions,vO=dT.reducer,sl=({to:n,children:e})=>D.jsx(mn,{to:n,className:"text-white hover:text-purple-300 transition duration-300 px-2 py-1",children:e});sl.propTypes={to:pr.string.isRequired,children:pr.node.isRequired};const ul=({to:n,children:e})=>D.jsx(mn,{to:n,className:"text-white hover:text-purple-300 transition duration-300 px-3 py-2 rounded hover:bg-purple-700 block",children:e});ul.propTypes={to:pr.string.isRequired,children:pr.node.isRequired};const Tg=({to:n,children:e,primary:t=!1})=>D.jsx(mn,{to:n,className:`${t?"bg-purple-600 hover:bg-purple-700":"bg-white text-purple-600 hover:bg-gray-100"} 
      border border-purple-500 px-4 py-2 rounded-lg font-medium transition duration-300 flex items-center justify-center`,children:e}),bu=({theme:n})=>{const e=BI(),t=up(),{isAuthenticated:r,user:i}=Ec(u=>u.auth);console.log("Current user data:",i);const o=()=>{e(mO()),t("/login")},a={purple:"bg-purple-950 text-white",blue:"bg-blue-950 text-white",grey:"bg-gray-950 text-white",red:"text-red-400 bg-red-900",pink:"bg-pink-950 text-white"},s=()=>i!=null&&i.name?i.name:i!=null&&i.email?i.email.split("@")[0].split(".").map(l=>l.charAt(0).toUpperCase()+l.slice(1)).join(" "):"User";return D.jsxs("nav",{className:`${a[n]} p-4 shadow-lg`,children:[D.jsxs("div",{className:"container mx-auto flex flex-col md:flex-row justify-between items-center",children:[D.jsxs("div",{className:"flex items-center space-x-6 mb-4 md:mb-0",children:[D.jsxs("div",{className:"flex items-center",children:[D.jsx("div",{className:"bg-purple-500 rounded-full p-2 mr-3",children:D.jsx("img",{src:"/logo.jpeg",alt:"Logo",className:"w-10 h-10 rounded-full"})}),D.jsx(mn,{to:"/home",className:"text-2xl font-semibold text-white hover:text-purple-300 transition",children:"Mood Conexus"})]}),D.jsxs("div",{className:"hidden md:flex items-center space-x-6",children:[D.jsx(sl,{to:"/home",children:"Home"}),D.jsx(sl,{to:"/about",children:"About"}),D.jsx(sl,{to:"/contact",children:"Contact"}),r&&D.jsx(sl,{to:"/favorites",children:"My Favorites"})]})]}),D.jsx("div",{className:"md:hidden mb-4",children:D.jsx("button",{className:"text-white",children:D.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})}),D.jsx("div",{className:"flex items-center space-x-4",children:r?D.jsxs(D.Fragment,{children:[D.jsxs("div",{className:"text-white font-medium bg-purple-800 px-3 py-1 rounded-lg",children:["Welcome, ",s()]}),D.jsxs("button",{onClick:o,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition duration-300 flex items-center","aria-label":"Logout",children:[D.jsx("svg",{className:"w-5 h-5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),"Logout"]})]}):D.jsxs(D.Fragment,{children:[D.jsx(Tg,{to:"/login",children:"Login"}),D.jsx(Tg,{to:"/register",primary:!0,children:"Register"})]})})]}),D.jsx("div",{className:"md:hidden bg-purple-900 mt-2 py-2 px-4 rounded-lg",children:D.jsxs("div",{className:"flex flex-col space-y-2",children:[D.jsx(ul,{to:"/home",children:"Home"}),D.jsx(ul,{to:"/about",children:"About"}),D.jsx(ul,{to:"/contact",children:"Contact"}),r&&D.jsx(ul,{to:"/favorites",children:"My Favorites"})]})})]})};Tg.propTypes={to:pr.string.isRequired,children:pr.node.isRequired,primary:pr.bool};bu.propTypes={theme:pr.string};var fT={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Bx=Ri.createContext&&Ri.createContext(fT),gO=["attr","size","title"];function yO(n,e){if(n==null)return{};var t=wO(n,e),r,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(i=0;i<o.length;i++)r=o[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function wO(n,e){if(n==null)return{};var t={};for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){if(e.indexOf(r)>=0)continue;t[r]=n[r]}return t}function Xd(){return Xd=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Xd.apply(this,arguments)}function Ux(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function Qd(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ux(Object(t),!0).forEach(function(r){_O(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ux(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function _O(n,e,t){return e=xO(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function xO(n){var e=bO(n,"string");return typeof e=="symbol"?e:e+""}function bO(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function pT(n){return n&&n.map((e,t)=>Ri.createElement(e.tag,Qd({key:t},e.attr),pT(e.child)))}function Yo(n){return e=>Ri.createElement(EO,Xd({attr:Qd({},n.attr)},e),pT(n.child))}function EO(n){var e=t=>{var{attr:r,size:i,title:o}=n,a=yO(n,gO),s=i||t.size||"1em",u;return t.className&&(u=t.className),n.className&&(u=(u?u+" ":"")+n.className),Ri.createElement("svg",Xd({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,a,{className:u,style:Qd(Qd({color:n.color||t.color},t.style),n.style),height:s,width:s,xmlns:"http://www.w3.org/2000/svg"}),o&&Ri.createElement("title",null,o),n.children)};return Bx!==void 0?Ri.createElement(Bx.Consumer,null,t=>e(t)):e(fT)}function CO(n){return Yo({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M279.14 288l14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.43 0 225.36 0c-73.22 0-121.08 44.38-121.08 124.72v70.62H22.89V288h81.39v224h100.17V288z"},child:[]}]})(n)}function IO(n){return Yo({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"},child:[]}]})(n)}function TO(n){return Yo({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"},child:[]}]})(n)}function SO(n){return Yo({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"},child:[]}]})(n)}function RO(n){return Yo({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"},child:[]}]})(n)}function kO(n){return Yo({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"},child:[]}]})(n)}function Jl(n){return Yo({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"},child:[]}]})(n)}function Sg(n){return Yo({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M458.4 64.3C400.6 15.7 311.3 23 256 79.3 200.7 23 111.4 15.6 53.6 64.3-21.6 127.6-10.6 230.8 43 285.5l175.4 178.7c10 10.2 23.4 15.9 37.6 15.9 14.3 0 27.6-5.6 37.6-15.8L469 285.6c53.5-54.7 64.7-157.9-10.6-221.3zm-23.6 187.5L259.4 430.5c-2.4 2.4-4.4 2.4-6.8 0L77.2 251.8c-36.5-37.2-43.9-107.6 7.3-150.7 38.9-32.7 98.9-27.8 136.5 10.5l35 35.7 35-35.7c37.8-38.5 97.8-43.2 136.5-10.6 51.1 43.1 43.5 113.9 7.3 150.8z"},child:[]}]})(n)}const Tc=({theme:n})=>{const e={purple:"bg-purple-950 text-gray-300",blue:"bg-blue-950 text-gray-300",grey:"bg-gray-950 text-gray-300",pink:"bg-pink-950 text-gray-300"};return D.jsx("footer",{className:`${e[n]} py-6`,children:D.jsxs("div",{className:"container mx-auto px-6",children:[D.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0",children:[D.jsxs("div",{className:"flex flex-col items-center md:items-start space-y-2",children:[D.jsx("h2",{className:"text-lg font-bold text-purple-200",children:"Mood Conexus"}),D.jsxs("div",{className:"flex space-x-4",children:[D.jsx("a",{href:"https://www.facebook.com/share/1PxDs7X1Pa/",target:"_blank",rel:"noopener noreferrer","aria-label":"Facebook",className:"text-black-200 hover:text-blue-200 transition duration-300",children:D.jsx(CO,{size:24,className:"opacity-100"})}),D.jsx("a",{href:"https://www.twitter.com",target:"_blank",rel:"noopener noreferrer","aria-label":"Twitter",className:"text-blue-200 hover:text-blue-600 transition duration-300",children:D.jsx(SO,{size:24,className:"opacity-100"})}),D.jsx("a",{href:"https://www.instagram.com/seemab_h24?igsh=Nnhzc2hucnIwM3l1",target:"_blank",rel:"noopener noreferrer","aria-label":"Instagram",className:"text-pink-200 hover:text-pink-500 transition duration-300",children:D.jsx(IO,{size:24,className:"opacity-100"})}),D.jsx("a",{href:"https://www.linkedin.com/in/mariyam-chauhdry-592231270",target:"_blank",rel:"noopener noreferrer","aria-label":"LinkedIn",className:"text-blue-200 hover:text-blue-500 transition duration-300",children:D.jsx(TO,{size:24,className:"opacity-100"})})]})]}),D.jsxs("div",{className:"flex space-x-6",children:[D.jsx(mn,{to:"/home",className:"text-gray-300 hover:text-purple-400 transition duration-300",children:"Home"}),D.jsx(mn,{to:"/about",className:"text-gray-300 hover:text-purple-400 transition duration-300",children:"About"}),D.jsx(mn,{to:"/contact",className:"text-gray-300 hover:text-purple-400 transition duration-300",children:"Contact"}),D.jsx(mn,{to:"/favorites",className:"text-gray-300 hover:text-purple-400 transition duration-300",children:"My Favorites"})]})]}),D.jsx("div",{className:"mt-6 border-t border-purple-700 pt-4 text-center",children:D.jsxs("p",{className:"text-sm text-gray-400",children:[" ",new Date().getFullYear()," Mood Conexus. All rights reserved."]})})]})})},AO=()=>{};var jx={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mT=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},PO=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=n[t++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){const o=n[t++],a=n[t++],s=n[t++],u=((i&7)<<18|(o&63)<<12|(a&63)<<6|s&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const o=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|a&63)}}return e.join("")},vT={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const o=n[i],a=i+1<n.length,s=a?n[i+1]:0,u=i+2<n.length,l=u?n[i+2]:0,c=o>>2,h=(o&3)<<4|s>>4;let d=(s&15)<<2|l>>6,p=l&63;u||(p=64,a||(d=64)),r.push(t[c],t[h],t[d],t[p])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(mT(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):PO(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const o=t[n.charAt(i++)],s=i<n.length?t[n.charAt(i)]:0;++i;const l=i<n.length?t[n.charAt(i)]:64;++i;const h=i<n.length?t[n.charAt(i)]:64;if(++i,o==null||s==null||l==null||h==null)throw new NO;const d=o<<2|s>>4;if(r.push(d),l!==64){const p=s<<4&240|l>>2;if(r.push(p),h!==64){const m=l<<6&192|h;r.push(m)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class NO extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const DO=function(n){const e=mT(n);return vT.encodeByteArray(e,!0)},Yd=function(n){return DO(n).replace(/\./g,"")},gT=function(n){try{return vT.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OO(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MO=()=>OO().__FIREBASE_DEFAULTS__,FO=()=>{if(typeof process>"u"||typeof jx>"u")return;const n=jx.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},LO=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&gT(n[1]);return e&&JSON.parse(e)},fp=()=>{try{return AO()||MO()||FO()||LO()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},yT=n=>{var e,t;return(t=(e=fp())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},VO=n=>{const e=yT(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},wT=()=>{var n;return(n=fp())===null||n===void 0?void 0:n.config},_T=n=>{var e;return(e=fp())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BO{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UO(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Yd(JSON.stringify(t)),Yd(JSON.stringify(a)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function jO(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(wn())}function zO(){var n;const e=(n=fp())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function WO(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function $O(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function HO(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function GO(){const n=wn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function qO(){return!zO()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function KO(){try{return typeof indexedDB=="object"}catch{return!1}}function XO(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var o;e(((o=i.error)===null||o===void 0?void 0:o.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QO="FirebaseError";class ji extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=QO,Object.setPrototypeOf(this,ji.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Sc.prototype.create)}}class Sc{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,o=this.errors[e],a=o?YO(o,r):"Error",s=`${this.serviceName}: ${a} (${i}).`;return new ji(i,s,r)}}function YO(n,e){return n.replace(JO,(t,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const JO=/\{\$([^}]+)}/g;function ZO(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Oa(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const o=n[i],a=e[i];if(zx(o)&&zx(a)){if(!Oa(o,a))return!1}else if(o!==a)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function zx(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rc(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function ll(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,o]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(o)}}),e}function cl(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function eM(n,e){const t=new tM(n,e);return t.subscribe.bind(t)}class tM{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");nM(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=Um),i.error===void 0&&(i.error=Um),i.complete===void 0&&(i.complete=Um);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function nM(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Um(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ln(n){return n&&n._delegate?n._delegate:n}class Ma{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const da="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rM{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new BO;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(o){if(i)return null;throw o}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(oM(e))try{this.getOrInitializeService({instanceIdentifier:da})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=da){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=da){return this.instances.has(e)}getOptions(e=da){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[o,a]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(o);r===s&&a.resolve(i)}return i}onInit(e,t){var r;const i=this.normalizeInstanceIdentifier(t),o=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;o.add(e),this.onInitCallbacks.set(i,o);const a=this.instances.get(i);return a&&e(a,i),()=>{o.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:iM(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=da){return this.component?this.component.multipleInstances?e:da:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function iM(n){return n===da?void 0:n}function oM(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aM{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new rM(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Le;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Le||(Le={}));const sM={debug:Le.DEBUG,verbose:Le.VERBOSE,info:Le.INFO,warn:Le.WARN,error:Le.ERROR,silent:Le.SILENT},uM=Le.INFO,lM={[Le.DEBUG]:"log",[Le.VERBOSE]:"log",[Le.INFO]:"info",[Le.WARN]:"warn",[Le.ERROR]:"error"},cM=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=lM[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class E0{constructor(e){this.name=e,this._logLevel=uM,this._logHandler=cM,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Le))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?sM[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Le.DEBUG,...e),this._logHandler(this,Le.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Le.VERBOSE,...e),this._logHandler(this,Le.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Le.INFO,...e),this._logHandler(this,Le.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Le.WARN,...e),this._logHandler(this,Le.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Le.ERROR,...e),this._logHandler(this,Le.ERROR,...e)}}const hM=(n,e)=>e.some(t=>n instanceof t);let Wx,$x;function dM(){return Wx||(Wx=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function fM(){return $x||($x=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const xT=new WeakMap,Rg=new WeakMap,bT=new WeakMap,jm=new WeakMap,C0=new WeakMap;function pM(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(Ro(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&xT.set(t,n)}).catch(()=>{}),C0.set(e,n),e}function mM(n){if(Rg.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});Rg.set(n,e)}let kg={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Rg.get(n);if(e==="objectStoreNames")return n.objectStoreNames||bT.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ro(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function vM(n){kg=n(kg)}function gM(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(zm(this),e,...t);return bT.set(r,e.sort?e.sort():[e]),Ro(r)}:fM().includes(n)?function(...e){return n.apply(zm(this),e),Ro(xT.get(this))}:function(...e){return Ro(n.apply(zm(this),e))}}function yM(n){return typeof n=="function"?gM(n):(n instanceof IDBTransaction&&mM(n),hM(n,dM())?new Proxy(n,kg):n)}function Ro(n){if(n instanceof IDBRequest)return pM(n);if(jm.has(n))return jm.get(n);const e=yM(n);return e!==n&&(jm.set(n,e),C0.set(e,n)),e}const zm=n=>C0.get(n);function wM(n,e,{blocked:t,upgrade:r,blocking:i,terminated:o}={}){const a=indexedDB.open(n,e),s=Ro(a);return r&&a.addEventListener("upgradeneeded",u=>{r(Ro(a.result),u.oldVersion,u.newVersion,Ro(a.transaction),u)}),t&&a.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),s.then(u=>{o&&u.addEventListener("close",()=>o()),i&&u.addEventListener("versionchange",l=>i(l.oldVersion,l.newVersion,l))}).catch(()=>{}),s}const _M=["get","getKey","getAll","getAllKeys","count"],xM=["put","add","delete","clear"],Wm=new Map;function Hx(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Wm.get(e))return Wm.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=xM.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||_M.includes(t)))return;const o=async function(a,...s){const u=this.transaction(a,i?"readwrite":"readonly");let l=u.store;return r&&(l=l.index(s.shift())),(await Promise.all([l[t](...s),i&&u.done]))[0]};return Wm.set(e,o),o}vM(n=>({...n,get:(e,t,r)=>Hx(e,t)||n.get(e,t,r),has:(e,t)=>!!Hx(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bM{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(EM(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function EM(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Ag="@firebase/app",Gx="0.11.5";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fi=new E0("@firebase/app"),CM="@firebase/app-compat",IM="@firebase/analytics-compat",TM="@firebase/analytics",SM="@firebase/app-check-compat",RM="@firebase/app-check",kM="@firebase/auth",AM="@firebase/auth-compat",PM="@firebase/database",NM="@firebase/data-connect",DM="@firebase/database-compat",OM="@firebase/functions",MM="@firebase/functions-compat",FM="@firebase/installations",LM="@firebase/installations-compat",VM="@firebase/messaging",BM="@firebase/messaging-compat",UM="@firebase/performance",jM="@firebase/performance-compat",zM="@firebase/remote-config",WM="@firebase/remote-config-compat",$M="@firebase/storage",HM="@firebase/storage-compat",GM="@firebase/firestore",qM="@firebase/vertexai",KM="@firebase/firestore-compat",XM="firebase",QM="11.6.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pg="[DEFAULT]",YM={[Ag]:"fire-core",[CM]:"fire-core-compat",[TM]:"fire-analytics",[IM]:"fire-analytics-compat",[RM]:"fire-app-check",[SM]:"fire-app-check-compat",[kM]:"fire-auth",[AM]:"fire-auth-compat",[PM]:"fire-rtdb",[NM]:"fire-data-connect",[DM]:"fire-rtdb-compat",[OM]:"fire-fn",[MM]:"fire-fn-compat",[FM]:"fire-iid",[LM]:"fire-iid-compat",[VM]:"fire-fcm",[BM]:"fire-fcm-compat",[UM]:"fire-perf",[jM]:"fire-perf-compat",[zM]:"fire-rc",[WM]:"fire-rc-compat",[$M]:"fire-gcs",[HM]:"fire-gcs-compat",[GM]:"fire-fst",[KM]:"fire-fst-compat",[qM]:"fire-vertex","fire-js":"fire-js",[XM]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jd=new Map,JM=new Map,Ng=new Map;function qx(n,e){try{n.container.addComponent(e)}catch(t){Fi.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function au(n){const e=n.name;if(Ng.has(e))return Fi.debug(`There were multiple attempts to register component ${e}.`),!1;Ng.set(e,n);for(const t of Jd.values())qx(t,n);for(const t of JM.values())qx(t,n);return!0}function I0(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function cr(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZM={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ko=new Sc("app","Firebase",ZM);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eF{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ma("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ko.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eu=QM;function ET(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Pg,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw ko.create("bad-app-name",{appName:String(i)});if(t||(t=wT()),!t)throw ko.create("no-options");const o=Jd.get(i);if(o){if(Oa(t,o.options)&&Oa(r,o.config))return o;throw ko.create("duplicate-app",{appName:i})}const a=new aM(i);for(const u of Ng.values())a.addComponent(u);const s=new eF(t,r,a);return Jd.set(i,s),s}function CT(n=Pg){const e=Jd.get(n);if(!e&&n===Pg&&wT())return ET();if(!e)throw ko.create("no-app",{appName:n});return e}function Ao(n,e,t){var r;let i=(r=YM[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);const o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){const s=[`Unable to register library "${i}" with version "${e}":`];o&&s.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&a&&s.push("and"),a&&s.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Fi.warn(s.join(" "));return}au(new Ma(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tF="firebase-heartbeat-database",nF=1,Zl="firebase-heartbeat-store";let $m=null;function IT(){return $m||($m=wM(tF,nF,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Zl)}catch(t){console.warn(t)}}}}).catch(n=>{throw ko.create("idb-open",{originalErrorMessage:n.message})})),$m}async function rF(n){try{const t=(await IT()).transaction(Zl),r=await t.objectStore(Zl).get(TT(n));return await t.done,r}catch(e){if(e instanceof ji)Fi.warn(e.message);else{const t=ko.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Fi.warn(t.message)}}}async function Kx(n,e){try{const r=(await IT()).transaction(Zl,"readwrite");await r.objectStore(Zl).put(e,TT(n)),await r.done}catch(t){if(t instanceof ji)Fi.warn(t.message);else{const r=ko.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Fi.warn(r.message)}}}function TT(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iF=1024,oF=30;class aF{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new uF(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=Xx();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(a=>a.date===o))return;if(this._heartbeatsCache.heartbeats.push({date:o,agent:i}),this._heartbeatsCache.heartbeats.length>oF){const a=lF(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Fi.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Xx(),{heartbeatsToSend:r,unsentEntries:i}=sF(this._heartbeatsCache.heartbeats),o=Yd(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(t){return Fi.warn(t),""}}}function Xx(){return new Date().toISOString().substring(0,10)}function sF(n,e=iF){const t=[];let r=n.slice();for(const i of n){const o=t.find(a=>a.agent===i.agent);if(o){if(o.dates.push(i.date),Qx(t)>e){o.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Qx(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class uF{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return KO()?XO().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await rF(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return Kx(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return Kx(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function Qx(n){return Yd(JSON.stringify({version:2,heartbeats:n})).length}function lF(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cF(n){au(new Ma("platform-logger",e=>new bM(e),"PRIVATE")),au(new Ma("heartbeat",e=>new aF(e),"PRIVATE")),Ao(Ag,Gx,n),Ao(Ag,Gx,"esm2017"),Ao("fire-js","")}cF("");var hF="firebase",dF="11.6.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ao(hF,dF,"app");function T0(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function ST(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const fF=ST,RT=new Sc("auth","Firebase",ST());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zd=new E0("@firebase/auth");function pF(n,...e){Zd.logLevel<=Le.WARN&&Zd.warn(`Auth (${Eu}): ${n}`,...e)}function sd(n,...e){Zd.logLevel<=Le.ERROR&&Zd.error(`Auth (${Eu}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lr(n,...e){throw S0(n,...e)}function ni(n,...e){return S0(n,...e)}function kT(n,e,t){const r=Object.assign(Object.assign({},fF()),{[e]:t});return new Sc("auth","Firebase",r).create(e,{appName:n.name})}function Ai(n){return kT(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function S0(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return RT.create(n,...e)}function ye(n,e,...t){if(!n)throw S0(e,...t)}function Ti(n){const e="INTERNAL ASSERTION FAILED: "+n;throw sd(e),new Error(e)}function Li(n,e){n||Ti(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dg(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function mF(){return Yx()==="http:"||Yx()==="https:"}function Yx(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vF(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(mF()||$O()||"connection"in navigator)?navigator.onLine:!0}function gF(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kc{constructor(e,t){this.shortDelay=e,this.longDelay=t,Li(t>e,"Short delay should be less than long delay!"),this.isMobile=jO()||HO()}get(){return vF()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R0(n,e){Li(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AT{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ti("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ti("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ti("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yF={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wF=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],_F=new kc(3e4,6e4);function zi(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Wi(n,e,t,r,i={}){return PT(n,i,async()=>{let o={},a={};r&&(e==="GET"?a=r:o={body:JSON.stringify(r)});const s=Rc(Object.assign({key:n.config.apiKey},a)).slice(1),u=await n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);const l=Object.assign({method:e,headers:u},o);return WO()||(l.referrerPolicy="no-referrer"),AT.fetch()(await NT(n,n.config.apiHost,t,s),l)})}async function PT(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},yF),e);try{const i=new bF(n),o=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const a=await o.json();if("needConfirmation"in a)throw Rh(n,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{const s=o.ok?a.errorMessage:a.error.message,[u,l]=s.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw Rh(n,"credential-already-in-use",a);if(u==="EMAIL_EXISTS")throw Rh(n,"email-already-in-use",a);if(u==="USER_DISABLED")throw Rh(n,"user-disabled",a);const c=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw kT(n,c,l);Lr(n,c)}}catch(i){if(i instanceof ji)throw i;Lr(n,"network-request-failed",{message:String(i)})}}async function Ac(n,e,t,r,i={}){const o=await Wi(n,e,t,r,i);return"mfaPendingCredential"in o&&Lr(n,"multi-factor-auth-required",{_serverResponse:o}),o}async function NT(n,e,t,r){const i=`${e}${t}?${r}`,o=n,a=o.config.emulator?R0(n.config,i):`${n.config.apiScheme}://${i}`;return wF.includes(t)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(a).toString():a}function xF(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class bF{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(ni(this.auth,"network-request-failed")),_F.get())})}}function Rh(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const i=ni(n,e,r);return i.customData._tokenResponse=t,i}function Jx(n){return n!==void 0&&n.enterprise!==void 0}class EF{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return xF(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function CF(n,e){return Wi(n,"GET","/v2/recaptchaConfig",zi(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IF(n,e){return Wi(n,"POST","/v1/accounts:delete",e)}async function ef(n,e){return Wi(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function El(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function TF(n,e=!1){const t=Ln(n),r=await t.getIdToken(e),i=k0(r);ye(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const o=typeof i.firebase=="object"?i.firebase:void 0,a=o==null?void 0:o.sign_in_provider;return{claims:i,token:r,authTime:El(Hm(i.auth_time)),issuedAtTime:El(Hm(i.iat)),expirationTime:El(Hm(i.exp)),signInProvider:a||null,signInSecondFactor:(o==null?void 0:o.sign_in_second_factor)||null}}function Hm(n){return Number(n)*1e3}function k0(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return sd("JWT malformed, contained fewer than 3 sections"),null;try{const i=gT(t);return i?JSON.parse(i):(sd("Failed to decode base64 JWT payload"),null)}catch(i){return sd("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function Zx(n){const e=k0(n);return ye(e,"internal-error"),ye(typeof e.exp<"u","internal-error"),ye(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ec(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof ji&&SF(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function SF({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RF{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Og{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=El(this.lastLoginAt),this.creationTime=El(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tf(n){var e;const t=n.auth,r=await n.getIdToken(),i=await ec(n,ef(t,{idToken:r}));ye(i==null?void 0:i.users.length,t,"internal-error");const o=i.users[0];n._notifyReloadListener(o);const a=!((e=o.providerUserInfo)===null||e===void 0)&&e.length?DT(o.providerUserInfo):[],s=AF(n.providerData,a),u=n.isAnonymous,l=!(n.email&&o.passwordHash)&&!(s!=null&&s.length),c=u?l:!1,h={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:s,metadata:new Og(o.createdAt,o.lastLoginAt),isAnonymous:c};Object.assign(n,h)}async function kF(n){const e=Ln(n);await tf(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function AF(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function DT(n){return n.map(e=>{var{providerId:t}=e,r=T0(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PF(n,e){const t=await PT(n,{},async()=>{const r=Rc({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=n.config,a=await NT(n,i,"/v1/token",`key=${o}`),s=await n._getAdditionalHeaders();return s["Content-Type"]="application/x-www-form-urlencoded",AT.fetch()(a,{method:"POST",headers:s,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function NF(n,e){return Wi(n,"POST","/v2/accounts:revokeToken",zi(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Us{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ye(e.idToken,"internal-error"),ye(typeof e.idToken<"u","internal-error"),ye(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Zx(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ye(e.length!==0,"internal-error");const t=Zx(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ye(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:i,expiresIn:o}=await PF(e,t);this.updateTokensAndExpiration(r,i,Number(o))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:i,expirationTime:o}=t,a=new Us;return r&&(ye(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(ye(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),o&&(ye(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Us,this.toJSON())}_performRefresh(){return Ti("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eo(n,e){ye(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Rr{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,o=T0(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new RF(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=o.displayName||null,this.email=o.email||null,this.emailVerified=o.emailVerified||!1,this.phoneNumber=o.phoneNumber||null,this.photoURL=o.photoURL||null,this.isAnonymous=o.isAnonymous||!1,this.tenantId=o.tenantId||null,this.providerData=o.providerData?[...o.providerData]:[],this.metadata=new Og(o.createdAt||void 0,o.lastLoginAt||void 0)}async getIdToken(e){const t=await ec(this,this.stsTokenManager.getToken(this.auth,e));return ye(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return TF(this,e)}reload(){return kF(this)}_assign(e){this!==e&&(ye(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Rr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){ye(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await tf(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(cr(this.auth.app))return Promise.reject(Ai(this.auth));const e=await this.getIdToken();return await ec(this,IF(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,o,a,s,u,l,c;const h=(r=t.displayName)!==null&&r!==void 0?r:void 0,d=(i=t.email)!==null&&i!==void 0?i:void 0,p=(o=t.phoneNumber)!==null&&o!==void 0?o:void 0,m=(a=t.photoURL)!==null&&a!==void 0?a:void 0,g=(s=t.tenantId)!==null&&s!==void 0?s:void 0,y=(u=t._redirectEventId)!==null&&u!==void 0?u:void 0,v=(l=t.createdAt)!==null&&l!==void 0?l:void 0,w=(c=t.lastLoginAt)!==null&&c!==void 0?c:void 0,{uid:_,emailVerified:x,isAnonymous:C,providerData:A,stsTokenManager:T}=t;ye(_&&T,e,"internal-error");const E=Us.fromJSON(this.name,T);ye(typeof _=="string",e,"internal-error"),eo(h,e.name),eo(d,e.name),ye(typeof x=="boolean",e,"internal-error"),ye(typeof C=="boolean",e,"internal-error"),eo(p,e.name),eo(m,e.name),eo(g,e.name),eo(y,e.name),eo(v,e.name),eo(w,e.name);const I=new Rr({uid:_,auth:e,email:d,emailVerified:x,displayName:h,isAnonymous:C,photoURL:m,phoneNumber:p,tenantId:g,stsTokenManager:E,createdAt:v,lastLoginAt:w});return A&&Array.isArray(A)&&(I.providerData=A.map(S=>Object.assign({},S))),y&&(I._redirectEventId=y),I}static async _fromIdTokenResponse(e,t,r=!1){const i=new Us;i.updateFromServerResponse(t);const o=new Rr({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await tf(o),o}static async _fromGetAccountInfoResponse(e,t,r){const i=t.users[0];ye(i.localId!==void 0,"internal-error");const o=i.providerUserInfo!==void 0?DT(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!(o!=null&&o.length),s=new Us;s.updateFromIdToken(r);const u=new Rr({uid:i.localId,auth:e,stsTokenManager:s,isAnonymous:a}),l={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new Og(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(o!=null&&o.length)};return Object.assign(u,l),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eb=new Map;function Si(n){Li(n instanceof Function,"Expected a class definition");let e=eb.get(n);return e?(Li(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,eb.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OT{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}OT.type="NONE";const tb=OT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ud(n,e,t){return`firebase:${n}:${e}:${t}`}class js{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:i,name:o}=this.auth;this.fullUserKey=ud(this.userKey,i.apiKey,o),this.fullPersistenceKey=ud("persistence",i.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await ef(this.auth,{idToken:e}).catch(()=>{});return t?Rr._fromGetAccountInfoResponse(this.auth,t,e):null}return Rr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new js(Si(tb),e,r);const i=(await Promise.all(t.map(async l=>{if(await l._isAvailable())return l}))).filter(l=>l);let o=i[0]||Si(tb);const a=ud(r,e.config.apiKey,e.name);let s=null;for(const l of t)try{const c=await l._get(a);if(c){let h;if(typeof c=="string"){const d=await ef(e,{idToken:c}).catch(()=>{});if(!d)break;h=await Rr._fromGetAccountInfoResponse(e,d,c)}else h=Rr._fromJSON(e,c);l!==o&&(s=h),o=l;break}}catch{}const u=i.filter(l=>l._shouldAllowMigration);return!o._shouldAllowMigration||!u.length?new js(o,e,r):(o=u[0],s&&await o._set(a,s.toJSON()),await Promise.all(t.map(async l=>{if(l!==o)try{await l._remove(a)}catch{}})),new js(o,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nb(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(VT(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(MT(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(UT(e))return"Blackberry";if(jT(e))return"Webos";if(FT(e))return"Safari";if((e.includes("chrome/")||LT(e))&&!e.includes("edge/"))return"Chrome";if(BT(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function MT(n=wn()){return/firefox\//i.test(n)}function FT(n=wn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function LT(n=wn()){return/crios\//i.test(n)}function VT(n=wn()){return/iemobile/i.test(n)}function BT(n=wn()){return/android/i.test(n)}function UT(n=wn()){return/blackberry/i.test(n)}function jT(n=wn()){return/webos/i.test(n)}function A0(n=wn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function DF(n=wn()){var e;return A0(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function OF(){return GO()&&document.documentMode===10}function zT(n=wn()){return A0(n)||BT(n)||jT(n)||UT(n)||/windows phone/i.test(n)||VT(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WT(n,e=[]){let t;switch(n){case"Browser":t=nb(wn());break;case"Worker":t=`${nb(wn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Eu}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MF{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=o=>new Promise((a,s)=>{try{const u=e(o);a(u)}catch(u){s(u)}});r.onAbort=t,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FF(n,e={}){return Wi(n,"GET","/v2/passwordPolicy",zi(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LF=6;class VF{constructor(e){var t,r,i,o;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:LF,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(o=e.forceUpgradeOnSignin)!==null&&o!==void 0?o:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,o,a,s;const u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(t=u.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),u.isValid&&(u.isValid=(r=u.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),u.isValid&&(u.isValid=(i=u.containsLowercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(o=u.containsUppercaseLetter)!==null&&o!==void 0?o:!0),u.isValid&&(u.isValid=(a=u.containsNumericCharacter)!==null&&a!==void 0?a:!0),u.isValid&&(u.isValid=(s=u.containsNonAlphanumericCharacter)!==null&&s!==void 0?s:!0),u}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BF{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new rb(this),this.idTokenSubscription=new rb(this),this.beforeStateQueue=new MF(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=RT,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Si(t)),this._initializationPromise=this.queue(async()=>{var r,i,o;if(!this._deleted&&(this.persistenceManager=await js.create(this,e),(r=this._resolvePersistenceManagerAvailable)===null||r===void 0||r.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((o=this.currentUser)===null||o===void 0?void 0:o.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await ef(this,{idToken:e}),r=await Rr._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(cr(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(s=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(s,s))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let i=r,o=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,s=i==null?void 0:i._redirectEventId,u=await this.tryRedirectSignIn(e);(!a||a===s)&&(u!=null&&u.user)&&(i=u.user,o=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(o)try{await this.beforeStateQueue.runMiddleware(i)}catch(a){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return ye(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await tf(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=gF()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(cr(this.app))return Promise.reject(Ai(this));const t=e?Ln(e):null;return t&&ye(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ye(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return cr(this.app)?Promise.reject(Ai(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return cr(this.app)?Promise.reject(Ai(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Si(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await FF(this),t=new VF(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Sc("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await NF(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Si(e)||this._popupRedirectResolver;ye(t,this,"argument-error"),this.redirectPersistenceManager=await js.create(this,[Si(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};const o=typeof t=="function"?t:t.next.bind(t);let a=!1;const s=this._isInitialized?Promise.resolve():this._initializationPromise;if(ye(s,this,"internal-error"),s.then(()=>{a||o(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,r,i);return()=>{a=!0,u()}}else{const u=e.addObserver(t);return()=>{a=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ye(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=WT(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;if(cr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&pF(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Jo(n){return Ln(n)}class rb{constructor(e){this.auth=e,this.observer=null,this.addObserver=eM(t=>this.observer=t)}get next(){return ye(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pp={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function UF(n){pp=n}function $T(n){return pp.loadJS(n)}function jF(){return pp.recaptchaEnterpriseScript}function zF(){return pp.gapiScript}function WF(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class $F{constructor(){this.enterprise=new HF}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class HF{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const GF="recaptcha-enterprise",HT="NO_RECAPTCHA";class qF{constructor(e){this.type=GF,this.auth=Jo(e)}async verify(e="verify",t=!1){async function r(o){if(!t){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(a,s)=>{CF(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)s(new Error("recaptcha Enterprise site key undefined"));else{const l=new EF(u);return o.tenantId==null?o._agentRecaptchaConfig=l:o._tenantRecaptchaConfigs[o.tenantId]=l,a(l.siteKey)}}).catch(u=>{s(u)})})}function i(o,a,s){const u=window.grecaptcha;Jx(u)?u.enterprise.ready(()=>{u.enterprise.execute(o,{action:e}).then(l=>{a(l)}).catch(()=>{a(HT)})}):s(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new $F().execute("siteKey",{action:"verify"}):new Promise((o,a)=>{r(this.auth).then(s=>{if(!t&&Jx(window.grecaptcha))i(s,o,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let u=jF();u.length!==0&&(u+=s),$T(u).then(()=>{i(s,o,a)}).catch(l=>{a(l)})}}).catch(s=>{a(s)})})}}async function ib(n,e,t,r=!1,i=!1){const o=new qF(n);let a;if(i)a=HT;else try{a=await o.verify(t)}catch{a=await o.verify(t,!0)}const s=Object.assign({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in s){const u=s.phoneEnrollmentInfo.phoneNumber,l=s.phoneEnrollmentInfo.recaptchaToken;Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:l,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in s){const u=s.phoneSignInInfo.recaptchaToken;Object.assign(s,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return s}return r?Object.assign(s,{captchaResp:a}):Object.assign(s,{captchaResponse:a}),Object.assign(s,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(s,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),s}async function nf(n,e,t,r,i){var o;if(!((o=n._getRecaptchaConfig())===null||o===void 0)&&o.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await ib(n,e,t,t==="getOobCode");return r(n,a)}else return r(n,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const s=await ib(n,e,t,t==="getOobCode");return r(n,s)}else return Promise.reject(a)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KF(n,e){const t=I0(n,"auth");if(t.isInitialized()){const i=t.getImmediate(),o=t.getOptions();if(Oa(o,e??{}))return i;Lr(i,"already-initialized")}return t.initialize({options:e})}function XF(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Si);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function QF(n,e,t){const r=Jo(n);ye(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,o=GT(e),{host:a,port:s}=YF(e),u=s===null?"":`:${s}`,l={url:`${o}//${a}${u}/`},c=Object.freeze({host:a,port:s,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){ye(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),ye(Oa(l,r.config.emulator)&&Oa(c,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=l,r.emulatorConfig=c,r.settings.appVerificationDisabledForTesting=!0,JF()}function GT(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function YF(n){const e=GT(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const o=i[1];return{host:o,port:ob(r.substr(o.length+1))}}else{const[o,a]=r.split(":");return{host:o,port:ob(a)}}}function ob(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function JF(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P0{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ti("not implemented")}_getIdTokenResponse(e){return Ti("not implemented")}_linkToIdToken(e,t){return Ti("not implemented")}_getReauthenticationResolver(e){return Ti("not implemented")}}async function ZF(n,e){return Wi(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eL(n,e){return Ac(n,"POST","/v1/accounts:signInWithPassword",zi(n,e))}async function tL(n,e){return Wi(n,"POST","/v1/accounts:sendOobCode",zi(n,e))}async function nL(n,e){return tL(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rL(n,e){return Ac(n,"POST","/v1/accounts:signInWithEmailLink",zi(n,e))}async function iL(n,e){return Ac(n,"POST","/v1/accounts:signInWithEmailLink",zi(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc extends P0{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new tc(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new tc(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return nf(e,t,"signInWithPassword",eL);case"emailLink":return rL(e,{email:this._email,oobCode:this._password});default:Lr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return nf(e,r,"signUpPassword",ZF);case"emailLink":return iL(e,{idToken:t,email:this._email,oobCode:this._password});default:Lr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zs(n,e){return Ac(n,"POST","/v1/accounts:signInWithIdp",zi(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oL="http://localhost";class Fa extends P0{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Fa(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Lr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=t,o=T0(t,["providerId","signInMethod"]);if(!r||!i)return null;const a=new Fa(r,i);return a.idToken=o.idToken||void 0,a.accessToken=o.accessToken||void 0,a.secret=o.secret,a.nonce=o.nonce,a.pendingToken=o.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return zs(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,zs(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,zs(e,t)}buildRequest(){const e={requestUri:oL,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Rc(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aL(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function sL(n){const e=ll(cl(n)).link,t=e?ll(cl(e)).deep_link_id:null,r=ll(cl(n)).deep_link_id;return(r?ll(cl(r)).link:null)||r||t||e||n}class N0{constructor(e){var t,r,i,o,a,s;const u=ll(cl(e)),l=(t=u.apiKey)!==null&&t!==void 0?t:null,c=(r=u.oobCode)!==null&&r!==void 0?r:null,h=aL((i=u.mode)!==null&&i!==void 0?i:null);ye(l&&c&&h,"argument-error"),this.apiKey=l,this.operation=h,this.code=c,this.continueUrl=(o=u.continueUrl)!==null&&o!==void 0?o:null,this.languageCode=(a=u.lang)!==null&&a!==void 0?a:null,this.tenantId=(s=u.tenantId)!==null&&s!==void 0?s:null}static parseLink(e){const t=sL(e);try{return new N0(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cu{constructor(){this.providerId=Cu.PROVIDER_ID}static credential(e,t){return tc._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=N0.parseLink(t);return ye(r,"argument-error"),tc._fromEmailAndCode(e,r.code,r.tenantId)}}Cu.PROVIDER_ID="password";Cu.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Cu.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qT{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pc extends qT{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class so extends Pc{constructor(){super("facebook.com")}static credential(e){return Fa._fromParams({providerId:so.PROVIDER_ID,signInMethod:so.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return so.credentialFromTaggedObject(e)}static credentialFromError(e){return so.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return so.credential(e.oauthAccessToken)}catch{return null}}}so.FACEBOOK_SIGN_IN_METHOD="facebook.com";so.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uo extends Pc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Fa._fromParams({providerId:uo.PROVIDER_ID,signInMethod:uo.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return uo.credentialFromTaggedObject(e)}static credentialFromError(e){return uo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return uo.credential(t,r)}catch{return null}}}uo.GOOGLE_SIGN_IN_METHOD="google.com";uo.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lo extends Pc{constructor(){super("github.com")}static credential(e){return Fa._fromParams({providerId:lo.PROVIDER_ID,signInMethod:lo.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return lo.credentialFromTaggedObject(e)}static credentialFromError(e){return lo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return lo.credential(e.oauthAccessToken)}catch{return null}}}lo.GITHUB_SIGN_IN_METHOD="github.com";lo.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co extends Pc{constructor(){super("twitter.com")}static credential(e,t){return Fa._fromParams({providerId:co.PROVIDER_ID,signInMethod:co.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return co.credentialFromTaggedObject(e)}static credentialFromError(e){return co.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return co.credential(t,r)}catch{return null}}}co.TWITTER_SIGN_IN_METHOD="twitter.com";co.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uL(n,e){return Ac(n,"POST","/v1/accounts:signUp",zi(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class La{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,i=!1){const o=await Rr._fromIdTokenResponse(e,r,i),a=ab(r);return new La({user:o,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const i=ab(r);return new La({user:e,providerId:i,_tokenResponse:r,operationType:t})}}function ab(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rf extends ji{constructor(e,t,r,i){var o;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,rf.prototype),this.customData={appName:e.name,tenantId:(o=e.tenantId)!==null&&o!==void 0?o:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new rf(e,t,r,i)}}function KT(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?rf._fromErrorAndOperation(n,o,e,r):o})}async function lL(n,e,t=!1){const r=await ec(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return La._forOperation(n,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cL(n,e,t=!1){const{auth:r}=n;if(cr(r.app))return Promise.reject(Ai(r));const i="reauthenticate";try{const o=await ec(n,KT(r,i,e,n),t);ye(o.idToken,r,"internal-error");const a=k0(o.idToken);ye(a,r,"internal-error");const{sub:s}=a;return ye(n.uid===s,r,"user-mismatch"),La._forOperation(n,i,o)}catch(o){throw(o==null?void 0:o.code)==="auth/user-not-found"&&Lr(r,"user-mismatch"),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XT(n,e,t=!1){if(cr(n.app))return Promise.reject(Ai(n));const r="signIn",i=await KT(n,r,e),o=await La._fromIdTokenResponse(n,r,i);return t||await n._updateCurrentUser(o.user),o}async function hL(n,e){return XT(Jo(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dL(n,e,t){var r;ye(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),ye(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),ye(typeof t.linkDomain>"u"||t.linkDomain.length>0,n,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(ye(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(ye(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QT(n){const e=Jo(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function fL(n,e,t){const r=Jo(n),i={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&dL(r,i,t),await nf(r,i,"getOobCode",nL)}async function pL(n,e,t){if(cr(n.app))return Promise.reject(Ai(n));const r=Jo(n),a=await nf(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",uL).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&QT(n),u}),s=await La._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(s.user),s}function mL(n,e,t){return cr(n.app)?Promise.reject(Ai(n)):hL(Ln(n),Cu.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&QT(n),r})}function vL(n,e,t,r){return Ln(n).onIdTokenChanged(e,t,r)}function gL(n,e,t){return Ln(n).beforeAuthStateChanged(e,t)}function yL(n,e,t,r){return Ln(n).onAuthStateChanged(e,t,r)}const of="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YT{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(of,"1"),this.storage.removeItem(of),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wL=1e3,_L=10;class JT extends YT{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=zT(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),i=this.localCache[t];r!==i&&e(t,i,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,s,u)=>{this.notifyListeners(a,u)});return}const r=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},o=this.storage.getItem(r);OF()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,_L):i()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},wL)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}JT.type="LOCAL";const xL=JT;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZT extends YT{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ZT.type="SESSION";const eS=ZT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bL(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mp{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const r=new mp(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:i,data:o}=t.data,a=this.handlersMap[i];if(!(a!=null&&a.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const s=Array.from(a).map(async l=>l(t.origin,o)),u=await bL(s);t.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}mp.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D0(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EL{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let o,a;return new Promise((s,u)=>{const l=D0("",20);i.port1.start();const c=setTimeout(()=>{u(new Error("unsupported_event"))},r);a={messageChannel:i,onMessage(h){const d=h;if(d.data.eventId===l)switch(d.data.status){case"ack":clearTimeout(c),o=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),s(d.data.response);break;default:clearTimeout(c),clearTimeout(o),u(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ri(){return window}function CL(n){ri().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tS(){return typeof ri().WorkerGlobalScope<"u"&&typeof ri().importScripts=="function"}async function IL(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function TL(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function SL(){return tS()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nS="firebaseLocalStorageDb",RL=1,af="firebaseLocalStorage",rS="fbase_key";class Nc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function vp(n,e){return n.transaction([af],e?"readwrite":"readonly").objectStore(af)}function kL(){const n=indexedDB.deleteDatabase(nS);return new Nc(n).toPromise()}function Mg(){const n=indexedDB.open(nS,RL);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(af,{keyPath:rS})}catch(i){t(i)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(af)?e(r):(r.close(),await kL(),e(await Mg()))})})}async function sb(n,e,t){const r=vp(n,!0).put({[rS]:e,value:t});return new Nc(r).toPromise()}async function AL(n,e){const t=vp(n,!1).get(e),r=await new Nc(t).toPromise();return r===void 0?null:r.value}function ub(n,e){const t=vp(n,!0).delete(e);return new Nc(t).toPromise()}const PL=800,NL=3;class iS{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Mg(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>NL)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return tS()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=mp._getInstance(SL()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await IL(),!this.activeServiceWorker)return;this.sender=new EL(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||TL()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Mg();return await sb(e,of,"1"),await ub(e,of),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>sb(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>AL(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>ub(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const o=vp(i,!1).getAll();return new Nc(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:o}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(o)&&(this.notifyListeners(i,o),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),PL)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}iS.type="LOCAL";const DL=iS;new kc(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OL(n,e){return e?Si(e):(ye(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O0 extends P0{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return zs(e,this._buildIdpRequest())}_linkToIdToken(e,t){return zs(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return zs(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function ML(n){return XT(n.auth,new O0(n),n.bypassAuthState)}function FL(n){const{auth:e,user:t}=n;return ye(t,e,"internal-error"),cL(t,new O0(n),n.bypassAuthState)}async function LL(n){const{auth:e,user:t}=n;return ye(t,e,"internal-error"),lL(t,new O0(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oS{constructor(e,t,r,i,o=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:i,tenantId:o,error:a,type:s}=e;if(a){this.reject(a);return}const u={auth:this.auth,requestUri:t,sessionId:r,tenantId:o||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(u))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return ML;case"linkViaPopup":case"linkViaRedirect":return LL;case"reauthViaPopup":case"reauthViaRedirect":return FL;default:Lr(this.auth,"internal-error")}}resolve(e){Li(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Li(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VL=new kc(2e3,1e4);class Ds extends oS{constructor(e,t,r,i,o){super(e,t,i,o),this.provider=r,this.authWindow=null,this.pollId=null,Ds.currentPopupAction&&Ds.currentPopupAction.cancel(),Ds.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ye(e,this.auth,"internal-error"),e}async onExecution(){Li(this.filter.length===1,"Popup operations only handle one event");const e=D0();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(ni(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(ni(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ds.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ni(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,VL.get())};e()}}Ds.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BL="pendingRedirect",ld=new Map;class UL extends oS{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=ld.get(this.auth._key());if(!e){try{const r=await jL(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}ld.set(this.auth._key(),e)}return this.bypassAuthState||ld.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function jL(n,e){const t=$L(e),r=WL(n);if(!await r._isAvailable())return!1;const i=await r._get(t)==="true";return await r._remove(t),i}function zL(n,e){ld.set(n._key(),e)}function WL(n){return Si(n._redirectPersistence)}function $L(n){return ud(BL,n.config.apiKey,n.name)}async function HL(n,e,t=!1){if(cr(n.app))return Promise.reject(Ai(n));const r=Jo(n),i=OL(r,e),a=await new UL(r,i,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GL=10*60*1e3;class qL{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!KL(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!aS(e)){const i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(ni(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=GL&&this.cachedEventUids.clear(),this.cachedEventUids.has(lb(e))}saveEventToCache(e){this.cachedEventUids.add(lb(e)),this.lastProcessedEventTime=Date.now()}}function lb(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function aS({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function KL(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return aS(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XL(n,e={}){return Wi(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QL=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,YL=/^https?/;async function JL(n){if(n.config.emulator)return;const{authorizedDomains:e}=await XL(n);for(const t of e)try{if(ZL(t))return}catch{}Lr(n,"unauthorized-domain")}function ZL(n){const e=Dg(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!YL.test(t))return!1;if(QL.test(n))return r===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eV=new kc(3e4,6e4);function cb(){const n=ri().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function tV(n){return new Promise((e,t)=>{var r,i,o;function a(){cb(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{cb(),t(ni(n,"network-request-failed"))},timeout:eV.get()})}if(!((i=(r=ri().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((o=ri().gapi)===null||o===void 0)&&o.load)a();else{const s=WF("iframefcb");return ri()[s]=()=>{gapi.load?a():t(ni(n,"network-request-failed"))},$T(`${zF()}?onload=${s}`).catch(u=>t(u))}}).catch(e=>{throw cd=null,e})}let cd=null;function nV(n){return cd=cd||tV(n),cd}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rV=new kc(5e3,15e3),iV="__/auth/iframe",oV="emulator/auth/iframe",aV={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},sV=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function uV(n){const e=n.config;ye(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?R0(e,oV):`https://${n.config.authDomain}/${iV}`,r={apiKey:e.apiKey,appName:n.name,v:Eu},i=sV.get(n.config.apiHost);i&&(r.eid=i);const o=n._getFrameworks();return o.length&&(r.fw=o.join(",")),`${t}?${Rc(r).slice(1)}`}async function lV(n){const e=await nV(n),t=ri().gapi;return ye(t,n,"internal-error"),e.open({where:document.body,url:uV(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:aV,dontclear:!0},r=>new Promise(async(i,o)=>{await r.restyle({setHideOnLeave:!1});const a=ni(n,"network-request-failed"),s=ri().setTimeout(()=>{o(a)},rV.get());function u(){ri().clearTimeout(s),i(r)}r.ping(u).then(u,()=>{o(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cV={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},hV=500,dV=600,fV="_blank",pV="http://localhost";class hb{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function mV(n,e,t,r=hV,i=dV){const o=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let s="";const u=Object.assign(Object.assign({},cV),{width:r.toString(),height:i.toString(),top:o,left:a}),l=wn().toLowerCase();t&&(s=LT(l)?fV:t),MT(l)&&(e=e||pV,u.scrollbars="yes");const c=Object.entries(u).reduce((d,[p,m])=>`${d}${p}=${m},`,"");if(DF(l)&&s!=="_self")return vV(e||"",s),new hb(null);const h=window.open(e||"",s,c);ye(h,n,"popup-blocked");try{h.focus()}catch{}return new hb(h)}function vV(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gV="__/auth/handler",yV="emulator/auth/handler",wV=encodeURIComponent("fac");async function db(n,e,t,r,i,o){ye(n.config.authDomain,n,"auth-domain-config-required"),ye(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Eu,eventId:i};if(e instanceof qT){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",ZO(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[c,h]of Object.entries({}))a[c]=h}if(e instanceof Pc){const c=e.getScopes().filter(h=>h!=="");c.length>0&&(a.scopes=c.join(","))}n.tenantId&&(a.tid=n.tenantId);const s=a;for(const c of Object.keys(s))s[c]===void 0&&delete s[c];const u=await n._getAppCheckToken(),l=u?`#${wV}=${encodeURIComponent(u)}`:"";return`${_V(n)}?${Rc(s).slice(1)}${l}`}function _V({config:n}){return n.emulator?R0(n,yV):`https://${n.authDomain}/${gV}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gm="webStorageSupport";class xV{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=eS,this._completeRedirectFn=HL,this._overrideRedirectResult=zL}async _openPopup(e,t,r,i){var o;Li((o=this.eventManagers[e._key()])===null||o===void 0?void 0:o.manager,"_initialize() not called before _openPopup()");const a=await db(e,t,r,Dg(),i);return mV(e,a,D0())}async _openRedirect(e,t,r,i){await this._originValidation(e);const o=await db(e,t,r,Dg(),i);return CL(o),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:o}=this.eventManagers[t];return i?Promise.resolve(i):(Li(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await lV(e),r=new qL(e);return t.register("authEvent",i=>(ye(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Gm,{type:Gm},i=>{var o;const a=(o=i==null?void 0:i[0])===null||o===void 0?void 0:o[Gm];a!==void 0&&t(!!a),Lr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=JL(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return zT()||FT()||A0()}}const bV=xV;var fb="@firebase/auth",pb="1.10.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EV{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ye(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CV(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function IV(n){au(new Ma("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:s}=r.options;ye(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:a,authDomain:s,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:WT(n)},l=new BF(r,i,o,u);return XF(l,t),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),au(new Ma("auth-internal",e=>{const t=Jo(e.getProvider("auth").getImmediate());return(r=>new EV(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ao(fb,pb,CV(n)),Ao(fb,pb,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TV=5*60,SV=_T("authIdTokenMaxAge")||TV;let mb=null;const RV=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>SV)return;const i=t==null?void 0:t.token;mb!==i&&(mb=i,await fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function sS(n=CT()){const e=I0(n,"auth");if(e.isInitialized())return e.getImmediate();const t=KF(n,{popupRedirectResolver:bV,persistence:[DL,xL,eS]}),r=_T("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const a=RV(o.toString());gL(t,a,()=>a(t.currentUser)),vL(t,s=>a(s))}}const i=yT("auth");return i&&QF(t,`http://${i}`),t}function kV(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}UF({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{const o=ni("internal-error");o.customData=i,t(o)},r.type="text/javascript",r.charset="UTF-8",kV().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});IV("Browser");var vb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Po,uS;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(T,E){function I(){}I.prototype=E.prototype,T.D=E.prototype,T.prototype=new I,T.prototype.constructor=T,T.C=function(S,N,P){for(var k=Array(arguments.length-2),j=2;j<arguments.length;j++)k[j-2]=arguments[j];return E.prototype[N].apply(S,k)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(T,E,I){I||(I=0);var S=Array(16);if(typeof E=="string")for(var N=0;16>N;++N)S[N]=E.charCodeAt(I++)|E.charCodeAt(I++)<<8|E.charCodeAt(I++)<<16|E.charCodeAt(I++)<<24;else for(N=0;16>N;++N)S[N]=E[I++]|E[I++]<<8|E[I++]<<16|E[I++]<<24;E=T.g[0],I=T.g[1],N=T.g[2];var P=T.g[3],k=E+(P^I&(N^P))+S[0]+3614090360&4294967295;E=I+(k<<7&4294967295|k>>>25),k=P+(N^E&(I^N))+S[1]+3905402710&4294967295,P=E+(k<<12&4294967295|k>>>20),k=N+(I^P&(E^I))+S[2]+606105819&4294967295,N=P+(k<<17&4294967295|k>>>15),k=I+(E^N&(P^E))+S[3]+3250441966&4294967295,I=N+(k<<22&4294967295|k>>>10),k=E+(P^I&(N^P))+S[4]+4118548399&4294967295,E=I+(k<<7&4294967295|k>>>25),k=P+(N^E&(I^N))+S[5]+1200080426&4294967295,P=E+(k<<12&4294967295|k>>>20),k=N+(I^P&(E^I))+S[6]+2821735955&4294967295,N=P+(k<<17&4294967295|k>>>15),k=I+(E^N&(P^E))+S[7]+4249261313&4294967295,I=N+(k<<22&4294967295|k>>>10),k=E+(P^I&(N^P))+S[8]+1770035416&4294967295,E=I+(k<<7&4294967295|k>>>25),k=P+(N^E&(I^N))+S[9]+2336552879&4294967295,P=E+(k<<12&4294967295|k>>>20),k=N+(I^P&(E^I))+S[10]+4294925233&4294967295,N=P+(k<<17&4294967295|k>>>15),k=I+(E^N&(P^E))+S[11]+2304563134&4294967295,I=N+(k<<22&4294967295|k>>>10),k=E+(P^I&(N^P))+S[12]+1804603682&4294967295,E=I+(k<<7&4294967295|k>>>25),k=P+(N^E&(I^N))+S[13]+4254626195&4294967295,P=E+(k<<12&4294967295|k>>>20),k=N+(I^P&(E^I))+S[14]+2792965006&4294967295,N=P+(k<<17&4294967295|k>>>15),k=I+(E^N&(P^E))+S[15]+1236535329&4294967295,I=N+(k<<22&4294967295|k>>>10),k=E+(N^P&(I^N))+S[1]+4129170786&4294967295,E=I+(k<<5&4294967295|k>>>27),k=P+(I^N&(E^I))+S[6]+3225465664&4294967295,P=E+(k<<9&4294967295|k>>>23),k=N+(E^I&(P^E))+S[11]+643717713&4294967295,N=P+(k<<14&4294967295|k>>>18),k=I+(P^E&(N^P))+S[0]+3921069994&4294967295,I=N+(k<<20&4294967295|k>>>12),k=E+(N^P&(I^N))+S[5]+3593408605&4294967295,E=I+(k<<5&4294967295|k>>>27),k=P+(I^N&(E^I))+S[10]+38016083&4294967295,P=E+(k<<9&4294967295|k>>>23),k=N+(E^I&(P^E))+S[15]+3634488961&4294967295,N=P+(k<<14&4294967295|k>>>18),k=I+(P^E&(N^P))+S[4]+3889429448&4294967295,I=N+(k<<20&4294967295|k>>>12),k=E+(N^P&(I^N))+S[9]+568446438&4294967295,E=I+(k<<5&4294967295|k>>>27),k=P+(I^N&(E^I))+S[14]+3275163606&4294967295,P=E+(k<<9&4294967295|k>>>23),k=N+(E^I&(P^E))+S[3]+4107603335&4294967295,N=P+(k<<14&4294967295|k>>>18),k=I+(P^E&(N^P))+S[8]+1163531501&4294967295,I=N+(k<<20&4294967295|k>>>12),k=E+(N^P&(I^N))+S[13]+2850285829&4294967295,E=I+(k<<5&4294967295|k>>>27),k=P+(I^N&(E^I))+S[2]+4243563512&4294967295,P=E+(k<<9&4294967295|k>>>23),k=N+(E^I&(P^E))+S[7]+1735328473&4294967295,N=P+(k<<14&4294967295|k>>>18),k=I+(P^E&(N^P))+S[12]+2368359562&4294967295,I=N+(k<<20&4294967295|k>>>12),k=E+(I^N^P)+S[5]+4294588738&4294967295,E=I+(k<<4&4294967295|k>>>28),k=P+(E^I^N)+S[8]+2272392833&4294967295,P=E+(k<<11&4294967295|k>>>21),k=N+(P^E^I)+S[11]+1839030562&4294967295,N=P+(k<<16&4294967295|k>>>16),k=I+(N^P^E)+S[14]+4259657740&4294967295,I=N+(k<<23&4294967295|k>>>9),k=E+(I^N^P)+S[1]+2763975236&4294967295,E=I+(k<<4&4294967295|k>>>28),k=P+(E^I^N)+S[4]+1272893353&4294967295,P=E+(k<<11&4294967295|k>>>21),k=N+(P^E^I)+S[7]+4139469664&4294967295,N=P+(k<<16&4294967295|k>>>16),k=I+(N^P^E)+S[10]+3200236656&4294967295,I=N+(k<<23&4294967295|k>>>9),k=E+(I^N^P)+S[13]+681279174&4294967295,E=I+(k<<4&4294967295|k>>>28),k=P+(E^I^N)+S[0]+3936430074&4294967295,P=E+(k<<11&4294967295|k>>>21),k=N+(P^E^I)+S[3]+3572445317&4294967295,N=P+(k<<16&4294967295|k>>>16),k=I+(N^P^E)+S[6]+76029189&4294967295,I=N+(k<<23&4294967295|k>>>9),k=E+(I^N^P)+S[9]+3654602809&4294967295,E=I+(k<<4&4294967295|k>>>28),k=P+(E^I^N)+S[12]+3873151461&4294967295,P=E+(k<<11&4294967295|k>>>21),k=N+(P^E^I)+S[15]+530742520&4294967295,N=P+(k<<16&4294967295|k>>>16),k=I+(N^P^E)+S[2]+3299628645&4294967295,I=N+(k<<23&4294967295|k>>>9),k=E+(N^(I|~P))+S[0]+4096336452&4294967295,E=I+(k<<6&4294967295|k>>>26),k=P+(I^(E|~N))+S[7]+1126891415&4294967295,P=E+(k<<10&4294967295|k>>>22),k=N+(E^(P|~I))+S[14]+2878612391&4294967295,N=P+(k<<15&4294967295|k>>>17),k=I+(P^(N|~E))+S[5]+4237533241&4294967295,I=N+(k<<21&4294967295|k>>>11),k=E+(N^(I|~P))+S[12]+1700485571&4294967295,E=I+(k<<6&4294967295|k>>>26),k=P+(I^(E|~N))+S[3]+2399980690&4294967295,P=E+(k<<10&4294967295|k>>>22),k=N+(E^(P|~I))+S[10]+4293915773&4294967295,N=P+(k<<15&4294967295|k>>>17),k=I+(P^(N|~E))+S[1]+2240044497&4294967295,I=N+(k<<21&4294967295|k>>>11),k=E+(N^(I|~P))+S[8]+1873313359&4294967295,E=I+(k<<6&4294967295|k>>>26),k=P+(I^(E|~N))+S[15]+4264355552&4294967295,P=E+(k<<10&4294967295|k>>>22),k=N+(E^(P|~I))+S[6]+2734768916&4294967295,N=P+(k<<15&4294967295|k>>>17),k=I+(P^(N|~E))+S[13]+1309151649&4294967295,I=N+(k<<21&4294967295|k>>>11),k=E+(N^(I|~P))+S[4]+4149444226&4294967295,E=I+(k<<6&4294967295|k>>>26),k=P+(I^(E|~N))+S[11]+3174756917&4294967295,P=E+(k<<10&4294967295|k>>>22),k=N+(E^(P|~I))+S[2]+718787259&4294967295,N=P+(k<<15&4294967295|k>>>17),k=I+(P^(N|~E))+S[9]+3951481745&4294967295,T.g[0]=T.g[0]+E&4294967295,T.g[1]=T.g[1]+(N+(k<<21&4294967295|k>>>11))&4294967295,T.g[2]=T.g[2]+N&4294967295,T.g[3]=T.g[3]+P&4294967295}r.prototype.u=function(T,E){E===void 0&&(E=T.length);for(var I=E-this.blockSize,S=this.B,N=this.h,P=0;P<E;){if(N==0)for(;P<=I;)i(this,T,P),P+=this.blockSize;if(typeof T=="string"){for(;P<E;)if(S[N++]=T.charCodeAt(P++),N==this.blockSize){i(this,S),N=0;break}}else for(;P<E;)if(S[N++]=T[P++],N==this.blockSize){i(this,S),N=0;break}}this.h=N,this.o+=E},r.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var E=1;E<T.length-8;++E)T[E]=0;var I=8*this.o;for(E=T.length-8;E<T.length;++E)T[E]=I&255,I/=256;for(this.u(T),T=Array(16),E=I=0;4>E;++E)for(var S=0;32>S;S+=8)T[I++]=this.g[E]>>>S&255;return T};function o(T,E){var I=s;return Object.prototype.hasOwnProperty.call(I,T)?I[T]:I[T]=E(T)}function a(T,E){this.h=E;for(var I=[],S=!0,N=T.length-1;0<=N;N--){var P=T[N]|0;S&&P==E||(I[N]=P,S=!1)}this.g=I}var s={};function u(T){return-128<=T&&128>T?o(T,function(E){return new a([E|0],0>E?-1:0)}):new a([T|0],0>T?-1:0)}function l(T){if(isNaN(T)||!isFinite(T))return h;if(0>T)return y(l(-T));for(var E=[],I=1,S=0;T>=I;S++)E[S]=T/I|0,I*=4294967296;return new a(E,0)}function c(T,E){if(T.length==0)throw Error("number format error: empty string");if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(T.charAt(0)=="-")return y(c(T.substring(1),E));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=l(Math.pow(E,8)),S=h,N=0;N<T.length;N+=8){var P=Math.min(8,T.length-N),k=parseInt(T.substring(N,N+P),E);8>P?(P=l(Math.pow(E,P)),S=S.j(P).add(l(k))):(S=S.j(I),S=S.add(l(k)))}return S}var h=u(0),d=u(1),p=u(16777216);n=a.prototype,n.m=function(){if(g(this))return-y(this).m();for(var T=0,E=1,I=0;I<this.g.length;I++){var S=this.i(I);T+=(0<=S?S:4294967296+S)*E,E*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(m(this))return"0";if(g(this))return"-"+y(this).toString(T);for(var E=l(Math.pow(T,6)),I=this,S="";;){var N=x(I,E).g;I=v(I,N.j(E));var P=((0<I.g.length?I.g[0]:I.h)>>>0).toString(T);if(I=N,m(I))return P+S;for(;6>P.length;)P="0"+P;S=P+S}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function m(T){if(T.h!=0)return!1;for(var E=0;E<T.g.length;E++)if(T.g[E]!=0)return!1;return!0}function g(T){return T.h==-1}n.l=function(T){return T=v(this,T),g(T)?-1:m(T)?0:1};function y(T){for(var E=T.g.length,I=[],S=0;S<E;S++)I[S]=~T.g[S];return new a(I,~T.h).add(d)}n.abs=function(){return g(this)?y(this):this},n.add=function(T){for(var E=Math.max(this.g.length,T.g.length),I=[],S=0,N=0;N<=E;N++){var P=S+(this.i(N)&65535)+(T.i(N)&65535),k=(P>>>16)+(this.i(N)>>>16)+(T.i(N)>>>16);S=k>>>16,P&=65535,k&=65535,I[N]=k<<16|P}return new a(I,I[I.length-1]&-2147483648?-1:0)};function v(T,E){return T.add(y(E))}n.j=function(T){if(m(this)||m(T))return h;if(g(this))return g(T)?y(this).j(y(T)):y(y(this).j(T));if(g(T))return y(this.j(y(T)));if(0>this.l(p)&&0>T.l(p))return l(this.m()*T.m());for(var E=this.g.length+T.g.length,I=[],S=0;S<2*E;S++)I[S]=0;for(S=0;S<this.g.length;S++)for(var N=0;N<T.g.length;N++){var P=this.i(S)>>>16,k=this.i(S)&65535,j=T.i(N)>>>16,B=T.i(N)&65535;I[2*S+2*N]+=k*B,w(I,2*S+2*N),I[2*S+2*N+1]+=P*B,w(I,2*S+2*N+1),I[2*S+2*N+1]+=k*j,w(I,2*S+2*N+1),I[2*S+2*N+2]+=P*j,w(I,2*S+2*N+2)}for(S=0;S<E;S++)I[S]=I[2*S+1]<<16|I[2*S];for(S=E;S<2*E;S++)I[S]=0;return new a(I,0)};function w(T,E){for(;(T[E]&65535)!=T[E];)T[E+1]+=T[E]>>>16,T[E]&=65535,E++}function _(T,E){this.g=T,this.h=E}function x(T,E){if(m(E))throw Error("division by zero");if(m(T))return new _(h,h);if(g(T))return E=x(y(T),E),new _(y(E.g),y(E.h));if(g(E))return E=x(T,y(E)),new _(y(E.g),E.h);if(30<T.g.length){if(g(T)||g(E))throw Error("slowDivide_ only works with positive integers.");for(var I=d,S=E;0>=S.l(T);)I=C(I),S=C(S);var N=A(I,1),P=A(S,1);for(S=A(S,2),I=A(I,2);!m(S);){var k=P.add(S);0>=k.l(T)&&(N=N.add(I),P=k),S=A(S,1),I=A(I,1)}return E=v(T,N.j(E)),new _(N,E)}for(N=h;0<=T.l(E);){for(I=Math.max(1,Math.floor(T.m()/E.m())),S=Math.ceil(Math.log(I)/Math.LN2),S=48>=S?1:Math.pow(2,S-48),P=l(I),k=P.j(E);g(k)||0<k.l(T);)I-=S,P=l(I),k=P.j(E);m(P)&&(P=d),N=N.add(P),T=v(T,k)}return new _(N,T)}n.A=function(T){return x(this,T).h},n.and=function(T){for(var E=Math.max(this.g.length,T.g.length),I=[],S=0;S<E;S++)I[S]=this.i(S)&T.i(S);return new a(I,this.h&T.h)},n.or=function(T){for(var E=Math.max(this.g.length,T.g.length),I=[],S=0;S<E;S++)I[S]=this.i(S)|T.i(S);return new a(I,this.h|T.h)},n.xor=function(T){for(var E=Math.max(this.g.length,T.g.length),I=[],S=0;S<E;S++)I[S]=this.i(S)^T.i(S);return new a(I,this.h^T.h)};function C(T){for(var E=T.g.length+1,I=[],S=0;S<E;S++)I[S]=T.i(S)<<1|T.i(S-1)>>>31;return new a(I,T.h)}function A(T,E){var I=E>>5;E%=32;for(var S=T.g.length-I,N=[],P=0;P<S;P++)N[P]=0<E?T.i(P+I)>>>E|T.i(P+I+1)<<32-E:T.i(P+I);return new a(N,T.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,uS=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=l,a.fromString=c,Po=a}).apply(typeof vb<"u"?vb:typeof self<"u"?self:typeof window<"u"?window:{});var kh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var lS,hl,cS,hd,Fg,hS,dS,fS;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(f,b,R){return f==Array.prototype||f==Object.prototype||(f[b]=R.value),f};function t(f){f=[typeof globalThis=="object"&&globalThis,f,typeof window=="object"&&window,typeof self=="object"&&self,typeof kh=="object"&&kh];for(var b=0;b<f.length;++b){var R=f[b];if(R&&R.Math==Math)return R}throw Error("Cannot find global object")}var r=t(this);function i(f,b){if(b)e:{var R=r;f=f.split(".");for(var O=0;O<f.length-1;O++){var z=f[O];if(!(z in R))break e;R=R[z]}f=f[f.length-1],O=R[f],b=b(O),b!=O&&b!=null&&e(R,f,{configurable:!0,writable:!0,value:b})}}function o(f,b){f instanceof String&&(f+="");var R=0,O=!1,z={next:function(){if(!O&&R<f.length){var K=R++;return{value:b(K,f[K]),done:!1}}return O=!0,{done:!0,value:void 0}}};return z[Symbol.iterator]=function(){return z},z}i("Array.prototype.values",function(f){return f||function(){return o(this,function(b,R){return R})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},s=this||self;function u(f){var b=typeof f;return b=b!="object"?b:f?Array.isArray(f)?"array":b:"null",b=="array"||b=="object"&&typeof f.length=="number"}function l(f){var b=typeof f;return b=="object"&&f!=null||b=="function"}function c(f,b,R){return f.call.apply(f.bind,arguments)}function h(f,b,R){if(!f)throw Error();if(2<arguments.length){var O=Array.prototype.slice.call(arguments,2);return function(){var z=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(z,O),f.apply(b,z)}}return function(){return f.apply(b,arguments)}}function d(f,b,R){return d=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?c:h,d.apply(null,arguments)}function p(f,b){var R=Array.prototype.slice.call(arguments,1);return function(){var O=R.slice();return O.push.apply(O,arguments),f.apply(this,O)}}function m(f,b){function R(){}R.prototype=b.prototype,f.aa=b.prototype,f.prototype=new R,f.prototype.constructor=f,f.Qb=function(O,z,K){for(var ie=Array(arguments.length-2),Qe=2;Qe<arguments.length;Qe++)ie[Qe-2]=arguments[Qe];return b.prototype[z].apply(O,ie)}}function g(f){const b=f.length;if(0<b){const R=Array(b);for(let O=0;O<b;O++)R[O]=f[O];return R}return[]}function y(f,b){for(let R=1;R<arguments.length;R++){const O=arguments[R];if(u(O)){const z=f.length||0,K=O.length||0;f.length=z+K;for(let ie=0;ie<K;ie++)f[z+ie]=O[ie]}else f.push(O)}}class v{constructor(b,R){this.i=b,this.j=R,this.h=0,this.g=null}get(){let b;return 0<this.h?(this.h--,b=this.g,this.g=b.next,b.next=null):b=this.i(),b}}function w(f){return/^[\s\xa0]*$/.test(f)}function _(){var f=s.navigator;return f&&(f=f.userAgent)?f:""}function x(f){return x[" "](f),f}x[" "]=function(){};var C=_().indexOf("Gecko")!=-1&&!(_().toLowerCase().indexOf("webkit")!=-1&&_().indexOf("Edge")==-1)&&!(_().indexOf("Trident")!=-1||_().indexOf("MSIE")!=-1)&&_().indexOf("Edge")==-1;function A(f,b,R){for(const O in f)b.call(R,f[O],O,f)}function T(f,b){for(const R in f)b.call(void 0,f[R],R,f)}function E(f){const b={};for(const R in f)b[R]=f[R];return b}const I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function S(f,b){let R,O;for(let z=1;z<arguments.length;z++){O=arguments[z];for(R in O)f[R]=O[R];for(let K=0;K<I.length;K++)R=I[K],Object.prototype.hasOwnProperty.call(O,R)&&(f[R]=O[R])}}function N(f){var b=1;f=f.split(":");const R=[];for(;0<b&&f.length;)R.push(f.shift()),b--;return f.length&&R.push(f.join(":")),R}function P(f){s.setTimeout(()=>{throw f},0)}function k(){var f=$;let b=null;return f.g&&(b=f.g,f.g=f.g.next,f.g||(f.h=null),b.next=null),b}class j{constructor(){this.h=this.g=null}add(b,R){const O=B.get();O.set(b,R),this.h?this.h.next=O:this.g=O,this.h=O}}var B=new v(()=>new W,f=>f.reset());class W{constructor(){this.next=this.g=this.h=null}set(b,R){this.h=b,this.g=R,this.next=null}reset(){this.next=this.g=this.h=null}}let X,V=!1,$=new j,G=()=>{const f=s.Promise.resolve(void 0);X=()=>{f.then(te)}};var te=()=>{for(var f;f=k();){try{f.h.call(f.g)}catch(R){P(R)}var b=B;b.j(f),100>b.h&&(b.h++,f.next=b.g,b.g=f)}V=!1};function re(){this.s=this.s,this.C=this.C}re.prototype.s=!1,re.prototype.ma=function(){this.s||(this.s=!0,this.N())},re.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function oe(f,b){this.type=f,this.g=this.target=b,this.defaultPrevented=!1}oe.prototype.h=function(){this.defaultPrevented=!0};var _e=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var f=!1,b=Object.defineProperty({},"passive",{get:function(){f=!0}});try{const R=()=>{};s.addEventListener("test",R,b),s.removeEventListener("test",R,b)}catch{}return f}();function pe(f,b){if(oe.call(this,f?f.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,f){var R=this.type=f.type,O=f.changedTouches&&f.changedTouches.length?f.changedTouches[0]:null;if(this.target=f.target||f.srcElement,this.g=b,b=f.relatedTarget){if(C){e:{try{x(b.nodeName);var z=!0;break e}catch{}z=!1}z||(b=null)}}else R=="mouseover"?b=f.fromElement:R=="mouseout"&&(b=f.toElement);this.relatedTarget=b,O?(this.clientX=O.clientX!==void 0?O.clientX:O.pageX,this.clientY=O.clientY!==void 0?O.clientY:O.pageY,this.screenX=O.screenX||0,this.screenY=O.screenY||0):(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0),this.button=f.button,this.key=f.key||"",this.ctrlKey=f.ctrlKey,this.altKey=f.altKey,this.shiftKey=f.shiftKey,this.metaKey=f.metaKey,this.pointerId=f.pointerId||0,this.pointerType=typeof f.pointerType=="string"?f.pointerType:xe[f.pointerType]||"",this.state=f.state,this.i=f,f.defaultPrevented&&pe.aa.h.call(this)}}m(pe,oe);var xe={2:"touch",3:"pen",4:"mouse"};pe.prototype.h=function(){pe.aa.h.call(this);var f=this.i;f.preventDefault?f.preventDefault():f.returnValue=!1};var Te="closure_listenable_"+(1e6*Math.random()|0),De=0;function Fe(f,b,R,O,z){this.listener=f,this.proxy=null,this.src=b,this.type=R,this.capture=!!O,this.ha=z,this.key=++De,this.da=this.fa=!1}function Ye(f){f.da=!0,f.listener=null,f.proxy=null,f.src=null,f.ha=null}function Ae(f){this.src=f,this.g={},this.h=0}Ae.prototype.add=function(f,b,R,O,z){var K=f.toString();f=this.g[K],f||(f=this.g[K]=[],this.h++);var ie=Be(f,b,O,z);return-1<ie?(b=f[ie],R||(b.fa=!1)):(b=new Fe(b,this.src,K,!!O,z),b.fa=R,f.push(b)),b};function We(f,b){var R=b.type;if(R in f.g){var O=f.g[R],z=Array.prototype.indexOf.call(O,b,void 0),K;(K=0<=z)&&Array.prototype.splice.call(O,z,1),K&&(Ye(b),f.g[R].length==0&&(delete f.g[R],f.h--))}}function Be(f,b,R,O){for(var z=0;z<f.length;++z){var K=f[z];if(!K.da&&K.listener==b&&K.capture==!!R&&K.ha==O)return z}return-1}var Je="closure_lm_"+(1e6*Math.random()|0),Xe={};function Ze(f,b,R,O,z){if(Array.isArray(b)){for(var K=0;K<b.length;K++)Ze(f,b[K],R,O,z);return null}return R=ar(R),f&&f[Te]?f.K(b,R,l(O)?!!O.capture:!!O,z):rr(f,b,R,!1,O,z)}function rr(f,b,R,O,z,K){if(!b)throw Error("Invalid event type");var ie=l(z)?!!z.capture:!!z,Qe=Un(f);if(Qe||(f[Je]=Qe=new Ae(f)),R=Qe.add(b,R,O,ie,K),R.proxy)return R;if(O=ir(),R.proxy=O,O.src=f,O.listener=R,f.addEventListener)_e||(z=ie),z===void 0&&(z=!1),f.addEventListener(b.toString(),O,z);else if(f.attachEvent)f.attachEvent(or(b.toString()),O);else if(f.addListener&&f.removeListener)f.addListener(O);else throw Error("addEventListener and attachEvent are unavailable.");return R}function ir(){function f(R){return b.call(f.src,f.listener,R)}const b=zr;return f}function tn(f,b,R,O,z){if(Array.isArray(b))for(var K=0;K<b.length;K++)tn(f,b[K],R,O,z);else O=l(O)?!!O.capture:!!O,R=ar(R),f&&f[Te]?(f=f.i,b=String(b).toString(),b in f.g&&(K=f.g[b],R=Be(K,R,O,z),-1<R&&(Ye(K[R]),Array.prototype.splice.call(K,R,1),K.length==0&&(delete f.g[b],f.h--)))):f&&(f=Un(f))&&(b=f.g[b.toString()],f=-1,b&&(f=Be(b,R,O,z)),(R=-1<f?b[f]:null)&&jr(R))}function jr(f){if(typeof f!="number"&&f&&!f.da){var b=f.src;if(b&&b[Te])We(b.i,f);else{var R=f.type,O=f.proxy;b.removeEventListener?b.removeEventListener(R,O,f.capture):b.detachEvent?b.detachEvent(or(R),O):b.addListener&&b.removeListener&&b.removeListener(O),(R=Un(b))?(We(R,f),R.h==0&&(R.src=null,b[Je]=null)):Ye(f)}}}function or(f){return f in Xe?Xe[f]:Xe[f]="on"+f}function zr(f,b){if(f.da)f=!0;else{b=new pe(b,this);var R=f.listener,O=f.ha||f.src;f.fa&&jr(f),f=R.call(O,b)}return f}function Un(f){return f=f[Je],f instanceof Ae?f:null}var Wr="__closure_events_fn_"+(1e9*Math.random()>>>0);function ar(f){return typeof f=="function"?f:(f[Wr]||(f[Wr]=function(b){return f.handleEvent(b)}),f[Wr])}function bt(){re.call(this),this.i=new Ae(this),this.M=this,this.F=null}m(bt,re),bt.prototype[Te]=!0,bt.prototype.removeEventListener=function(f,b,R,O){tn(this,f,b,R,O)};function mt(f,b){var R,O=f.F;if(O)for(R=[];O;O=O.F)R.push(O);if(f=f.M,O=b.type||b,typeof b=="string")b=new oe(b,f);else if(b instanceof oe)b.target=b.target||f;else{var z=b;b=new oe(O,f),S(b,z)}if(z=!0,R)for(var K=R.length-1;0<=K;K--){var ie=b.g=R[K];z=xn(ie,O,!0,b)&&z}if(ie=b.g=f,z=xn(ie,O,!0,b)&&z,z=xn(ie,O,!1,b)&&z,R)for(K=0;K<R.length;K++)ie=b.g=R[K],z=xn(ie,O,!1,b)&&z}bt.prototype.N=function(){if(bt.aa.N.call(this),this.i){var f=this.i,b;for(b in f.g){for(var R=f.g[b],O=0;O<R.length;O++)Ye(R[O]);delete f.g[b],f.h--}}this.F=null},bt.prototype.K=function(f,b,R,O){return this.i.add(String(f),b,!1,R,O)},bt.prototype.L=function(f,b,R,O){return this.i.add(String(f),b,!0,R,O)};function xn(f,b,R,O){if(b=f.i.g[String(b)],!b)return!0;b=b.concat();for(var z=!0,K=0;K<b.length;++K){var ie=b[K];if(ie&&!ie.da&&ie.capture==R){var Qe=ie.listener,$t=ie.ha||ie.src;ie.fa&&We(f.i,ie),z=Qe.call($t,O)!==!1&&z}}return z&&!O.defaultPrevented}function ts(f,b,R){if(typeof f=="function")R&&(f=d(f,R));else if(f&&typeof f.handleEvent=="function")f=d(f.handleEvent,f);else throw Error("Invalid listener argument");return 2147483647<Number(b)?-1:s.setTimeout(f,b||0)}function Kc(f){f.g=ts(()=>{f.g=null,f.i&&(f.i=!1,Kc(f))},f.l);const b=f.h;f.h=null,f.m.apply(null,b)}class Kp extends re{constructor(b,R){super(),this.m=b,this.l=R,this.h=null,this.i=!1,this.g=null}j(b){this.h=arguments,this.g?this.i=!0:Kc(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function na(f){re.call(this),this.h=f,this.g={}}m(na,re);var ns=[];function rs(f){A(f.g,function(b,R){this.g.hasOwnProperty(R)&&jr(b)},f),f.g={}}na.prototype.N=function(){na.aa.N.call(this),rs(this)},na.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ra=s.JSON.stringify,oP=s.JSON.parse,aP=class{stringify(f){return s.JSON.stringify(f,void 0)}parse(f){return s.JSON.parse(f,void 0)}};function Xp(){}Xp.prototype.h=null;function ww(f){return f.h||(f.h=f.i())}function _w(){}var Nu={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Qp(){oe.call(this,"d")}m(Qp,oe);function Yp(){oe.call(this,"c")}m(Yp,oe);var ia={},xw=null;function Xc(){return xw=xw||new bt}ia.La="serverreachability";function bw(f){oe.call(this,ia.La,f)}m(bw,oe);function Du(f){const b=Xc();mt(b,new bw(b))}ia.STAT_EVENT="statevent";function Ew(f,b){oe.call(this,ia.STAT_EVENT,f),this.stat=b}m(Ew,oe);function bn(f){const b=Xc();mt(b,new Ew(b,f))}ia.Ma="timingevent";function Cw(f,b){oe.call(this,ia.Ma,f),this.size=b}m(Cw,oe);function Ou(f,b){if(typeof f!="function")throw Error("Fn must not be null and must be a function");return s.setTimeout(function(){f()},b)}function Mu(){this.g=!0}Mu.prototype.xa=function(){this.g=!1};function sP(f,b,R,O,z,K){f.info(function(){if(f.g)if(K)for(var ie="",Qe=K.split("&"),$t=0;$t<Qe.length;$t++){var $e=Qe[$t].split("=");if(1<$e.length){var nn=$e[0];$e=$e[1];var rn=nn.split("_");ie=2<=rn.length&&rn[1]=="type"?ie+(nn+"="+$e+"&"):ie+(nn+"=redacted&")}}else ie=null;else ie=K;return"XMLHTTP REQ ("+O+") [attempt "+z+"]: "+b+`
`+R+`
`+ie})}function uP(f,b,R,O,z,K,ie){f.info(function(){return"XMLHTTP RESP ("+O+") [ attempt "+z+"]: "+b+`
`+R+`
`+K+" "+ie})}function is(f,b,R,O){f.info(function(){return"XMLHTTP TEXT ("+b+"): "+cP(f,R)+(O?" "+O:"")})}function lP(f,b){f.info(function(){return"TIMEOUT: "+b})}Mu.prototype.info=function(){};function cP(f,b){if(!f.g)return b;if(!b)return null;try{var R=JSON.parse(b);if(R){for(f=0;f<R.length;f++)if(Array.isArray(R[f])){var O=R[f];if(!(2>O.length)){var z=O[1];if(Array.isArray(z)&&!(1>z.length)){var K=z[0];if(K!="noop"&&K!="stop"&&K!="close")for(var ie=1;ie<z.length;ie++)z[ie]=""}}}}return ra(R)}catch{return b}}var Qc={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Iw={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Jp;function Yc(){}m(Yc,Xp),Yc.prototype.g=function(){return new XMLHttpRequest},Yc.prototype.i=function(){return{}},Jp=new Yc;function Qi(f,b,R,O){this.j=f,this.i=b,this.l=R,this.R=O||1,this.U=new na(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Tw}function Tw(){this.i=null,this.g="",this.h=!1}var Sw={},Zp={};function em(f,b,R){f.L=1,f.v=th(vi(b)),f.m=R,f.P=!0,Rw(f,null)}function Rw(f,b){f.F=Date.now(),Jc(f),f.A=vi(f.v);var R=f.A,O=f.R;Array.isArray(O)||(O=[String(O)]),zw(R.i,"t",O),f.C=0,R=f.j.J,f.h=new Tw,f.g=a_(f.j,R?b:null,!f.m),0<f.O&&(f.M=new Kp(d(f.Y,f,f.g),f.O)),b=f.U,R=f.g,O=f.ca;var z="readystatechange";Array.isArray(z)||(z&&(ns[0]=z.toString()),z=ns);for(var K=0;K<z.length;K++){var ie=Ze(R,z[K],O||b.handleEvent,!1,b.h||b);if(!ie)break;b.g[ie.key]=ie}b=f.H?E(f.H):{},f.m?(f.u||(f.u="POST"),b["Content-Type"]="application/x-www-form-urlencoded",f.g.ea(f.A,f.u,f.m,b)):(f.u="GET",f.g.ea(f.A,f.u,null,b)),Du(),sP(f.i,f.u,f.A,f.l,f.R,f.m)}Qi.prototype.ca=function(f){f=f.target;const b=this.M;b&&gi(f)==3?b.j():this.Y(f)},Qi.prototype.Y=function(f){try{if(f==this.g)e:{const rn=gi(this.g);var b=this.g.Ba();const ss=this.g.Z();if(!(3>rn)&&(rn!=3||this.g&&(this.h.h||this.g.oa()||Xw(this.g)))){this.J||rn!=4||b==7||(b==8||0>=ss?Du(3):Du(2)),tm(this);var R=this.g.Z();this.X=R;t:if(kw(this)){var O=Xw(this.g);f="";var z=O.length,K=gi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){oa(this),Fu(this);var ie="";break t}this.h.i=new s.TextDecoder}for(b=0;b<z;b++)this.h.h=!0,f+=this.h.i.decode(O[b],{stream:!(K&&b==z-1)});O.length=0,this.h.g+=f,this.C=0,ie=this.h.g}else ie=this.g.oa();if(this.o=R==200,uP(this.i,this.u,this.A,this.l,this.R,rn,R),this.o){if(this.T&&!this.K){t:{if(this.g){var Qe,$t=this.g;if((Qe=$t.g?$t.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!w(Qe)){var $e=Qe;break t}}$e=null}if(R=$e)is(this.i,this.l,R,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,nm(this,R);else{this.o=!1,this.s=3,bn(12),oa(this),Fu(this);break e}}if(this.P){R=!0;let xr;for(;!this.J&&this.C<ie.length;)if(xr=hP(this,ie),xr==Zp){rn==4&&(this.s=4,bn(14),R=!1),is(this.i,this.l,null,"[Incomplete Response]");break}else if(xr==Sw){this.s=4,bn(15),is(this.i,this.l,ie,"[Invalid Chunk]"),R=!1;break}else is(this.i,this.l,xr,null),nm(this,xr);if(kw(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),rn!=4||ie.length!=0||this.h.h||(this.s=1,bn(16),R=!1),this.o=this.o&&R,!R)is(this.i,this.l,ie,"[Invalid Chunked Response]"),oa(this),Fu(this);else if(0<ie.length&&!this.W){this.W=!0;var nn=this.j;nn.g==this&&nn.ba&&!nn.M&&(nn.j.info("Great, no buffering proxy detected. Bytes received: "+ie.length),um(nn),nn.M=!0,bn(11))}}else is(this.i,this.l,ie,null),nm(this,ie);rn==4&&oa(this),this.o&&!this.J&&(rn==4?n_(this.j,this):(this.o=!1,Jc(this)))}else RP(this.g),R==400&&0<ie.indexOf("Unknown SID")?(this.s=3,bn(12)):(this.s=0,bn(13)),oa(this),Fu(this)}}}catch{}finally{}};function kw(f){return f.g?f.u=="GET"&&f.L!=2&&f.j.Ca:!1}function hP(f,b){var R=f.C,O=b.indexOf(`
`,R);return O==-1?Zp:(R=Number(b.substring(R,O)),isNaN(R)?Sw:(O+=1,O+R>b.length?Zp:(b=b.slice(O,O+R),f.C=O+R,b)))}Qi.prototype.cancel=function(){this.J=!0,oa(this)};function Jc(f){f.S=Date.now()+f.I,Aw(f,f.I)}function Aw(f,b){if(f.B!=null)throw Error("WatchDog timer not null");f.B=Ou(d(f.ba,f),b)}function tm(f){f.B&&(s.clearTimeout(f.B),f.B=null)}Qi.prototype.ba=function(){this.B=null;const f=Date.now();0<=f-this.S?(lP(this.i,this.A),this.L!=2&&(Du(),bn(17)),oa(this),this.s=2,Fu(this)):Aw(this,this.S-f)};function Fu(f){f.j.G==0||f.J||n_(f.j,f)}function oa(f){tm(f);var b=f.M;b&&typeof b.ma=="function"&&b.ma(),f.M=null,rs(f.U),f.g&&(b=f.g,f.g=null,b.abort(),b.ma())}function nm(f,b){try{var R=f.j;if(R.G!=0&&(R.g==f||rm(R.h,f))){if(!f.K&&rm(R.h,f)&&R.G==3){try{var O=R.Da.g.parse(b)}catch{O=null}if(Array.isArray(O)&&O.length==3){var z=O;if(z[0]==0){e:if(!R.u){if(R.g)if(R.g.F+3e3<f.F)sh(R),oh(R);else break e;sm(R),bn(18)}}else R.za=z[1],0<R.za-R.T&&37500>z[2]&&R.F&&R.v==0&&!R.C&&(R.C=Ou(d(R.Za,R),6e3));if(1>=Dw(R.h)&&R.ca){try{R.ca()}catch{}R.ca=void 0}}else sa(R,11)}else if((f.K||R.g==f)&&sh(R),!w(b))for(z=R.Da.g.parse(b),b=0;b<z.length;b++){let $e=z[b];if(R.T=$e[0],$e=$e[1],R.G==2)if($e[0]=="c"){R.K=$e[1],R.ia=$e[2];const nn=$e[3];nn!=null&&(R.la=nn,R.j.info("VER="+R.la));const rn=$e[4];rn!=null&&(R.Aa=rn,R.j.info("SVER="+R.Aa));const ss=$e[5];ss!=null&&typeof ss=="number"&&0<ss&&(O=1.5*ss,R.L=O,R.j.info("backChannelRequestTimeoutMs_="+O)),O=R;const xr=f.g;if(xr){const lh=xr.g?xr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(lh){var K=O.h;K.g||lh.indexOf("spdy")==-1&&lh.indexOf("quic")==-1&&lh.indexOf("h2")==-1||(K.j=K.l,K.g=new Set,K.h&&(im(K,K.h),K.h=null))}if(O.D){const lm=xr.g?xr.g.getResponseHeader("X-HTTP-Session-Id"):null;lm&&(O.ya=lm,nt(O.I,O.D,lm))}}R.G=3,R.l&&R.l.ua(),R.ba&&(R.R=Date.now()-f.F,R.j.info("Handshake RTT: "+R.R+"ms")),O=R;var ie=f;if(O.qa=o_(O,O.J?O.ia:null,O.W),ie.K){Ow(O.h,ie);var Qe=ie,$t=O.L;$t&&(Qe.I=$t),Qe.B&&(tm(Qe),Jc(Qe)),O.g=ie}else e_(O);0<R.i.length&&ah(R)}else $e[0]!="stop"&&$e[0]!="close"||sa(R,7);else R.G==3&&($e[0]=="stop"||$e[0]=="close"?$e[0]=="stop"?sa(R,7):am(R):$e[0]!="noop"&&R.l&&R.l.ta($e),R.v=0)}}Du(4)}catch{}}var dP=class{constructor(f,b){this.g=f,this.map=b}};function Pw(f){this.l=f||10,s.PerformanceNavigationTiming?(f=s.performance.getEntriesByType("navigation"),f=0<f.length&&(f[0].nextHopProtocol=="hq"||f[0].nextHopProtocol=="h2")):f=!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=f?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Nw(f){return f.h?!0:f.g?f.g.size>=f.j:!1}function Dw(f){return f.h?1:f.g?f.g.size:0}function rm(f,b){return f.h?f.h==b:f.g?f.g.has(b):!1}function im(f,b){f.g?f.g.add(b):f.h=b}function Ow(f,b){f.h&&f.h==b?f.h=null:f.g&&f.g.has(b)&&f.g.delete(b)}Pw.prototype.cancel=function(){if(this.i=Mw(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const f of this.g.values())f.cancel();this.g.clear()}};function Mw(f){if(f.h!=null)return f.i.concat(f.h.D);if(f.g!=null&&f.g.size!==0){let b=f.i;for(const R of f.g.values())b=b.concat(R.D);return b}return g(f.i)}function fP(f){if(f.V&&typeof f.V=="function")return f.V();if(typeof Map<"u"&&f instanceof Map||typeof Set<"u"&&f instanceof Set)return Array.from(f.values());if(typeof f=="string")return f.split("");if(u(f)){for(var b=[],R=f.length,O=0;O<R;O++)b.push(f[O]);return b}b=[],R=0;for(O in f)b[R++]=f[O];return b}function pP(f){if(f.na&&typeof f.na=="function")return f.na();if(!f.V||typeof f.V!="function"){if(typeof Map<"u"&&f instanceof Map)return Array.from(f.keys());if(!(typeof Set<"u"&&f instanceof Set)){if(u(f)||typeof f=="string"){var b=[];f=f.length;for(var R=0;R<f;R++)b.push(R);return b}b=[],R=0;for(const O in f)b[R++]=O;return b}}}function Fw(f,b){if(f.forEach&&typeof f.forEach=="function")f.forEach(b,void 0);else if(u(f)||typeof f=="string")Array.prototype.forEach.call(f,b,void 0);else for(var R=pP(f),O=fP(f),z=O.length,K=0;K<z;K++)b.call(void 0,O[K],R&&R[K],f)}var Lw=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function mP(f,b){if(f){f=f.split("&");for(var R=0;R<f.length;R++){var O=f[R].indexOf("="),z=null;if(0<=O){var K=f[R].substring(0,O);z=f[R].substring(O+1)}else K=f[R];b(K,z?decodeURIComponent(z.replace(/\+/g," ")):"")}}}function aa(f){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,f instanceof aa){this.h=f.h,Zc(this,f.j),this.o=f.o,this.g=f.g,eh(this,f.s),this.l=f.l;var b=f.i,R=new Bu;R.i=b.i,b.g&&(R.g=new Map(b.g),R.h=b.h),Vw(this,R),this.m=f.m}else f&&(b=String(f).match(Lw))?(this.h=!1,Zc(this,b[1]||"",!0),this.o=Lu(b[2]||""),this.g=Lu(b[3]||"",!0),eh(this,b[4]),this.l=Lu(b[5]||"",!0),Vw(this,b[6]||"",!0),this.m=Lu(b[7]||"")):(this.h=!1,this.i=new Bu(null,this.h))}aa.prototype.toString=function(){var f=[],b=this.j;b&&f.push(Vu(b,Bw,!0),":");var R=this.g;return(R||b=="file")&&(f.push("//"),(b=this.o)&&f.push(Vu(b,Bw,!0),"@"),f.push(encodeURIComponent(String(R)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),R=this.s,R!=null&&f.push(":",String(R))),(R=this.l)&&(this.g&&R.charAt(0)!="/"&&f.push("/"),f.push(Vu(R,R.charAt(0)=="/"?yP:gP,!0))),(R=this.i.toString())&&f.push("?",R),(R=this.m)&&f.push("#",Vu(R,_P)),f.join("")};function vi(f){return new aa(f)}function Zc(f,b,R){f.j=R?Lu(b,!0):b,f.j&&(f.j=f.j.replace(/:$/,""))}function eh(f,b){if(b){if(b=Number(b),isNaN(b)||0>b)throw Error("Bad port number "+b);f.s=b}else f.s=null}function Vw(f,b,R){b instanceof Bu?(f.i=b,xP(f.i,f.h)):(R||(b=Vu(b,wP)),f.i=new Bu(b,f.h))}function nt(f,b,R){f.i.set(b,R)}function th(f){return nt(f,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),f}function Lu(f,b){return f?b?decodeURI(f.replace(/%25/g,"%2525")):decodeURIComponent(f):""}function Vu(f,b,R){return typeof f=="string"?(f=encodeURI(f).replace(b,vP),R&&(f=f.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f):null}function vP(f){return f=f.charCodeAt(0),"%"+(f>>4&15).toString(16)+(f&15).toString(16)}var Bw=/[#\/\?@]/g,gP=/[#\?:]/g,yP=/[#\?]/g,wP=/[#\?@]/g,_P=/#/g;function Bu(f,b){this.h=this.g=null,this.i=f||null,this.j=!!b}function Yi(f){f.g||(f.g=new Map,f.h=0,f.i&&mP(f.i,function(b,R){f.add(decodeURIComponent(b.replace(/\+/g," ")),R)}))}n=Bu.prototype,n.add=function(f,b){Yi(this),this.i=null,f=os(this,f);var R=this.g.get(f);return R||this.g.set(f,R=[]),R.push(b),this.h+=1,this};function Uw(f,b){Yi(f),b=os(f,b),f.g.has(b)&&(f.i=null,f.h-=f.g.get(b).length,f.g.delete(b))}function jw(f,b){return Yi(f),b=os(f,b),f.g.has(b)}n.forEach=function(f,b){Yi(this),this.g.forEach(function(R,O){R.forEach(function(z){f.call(b,z,O,this)},this)},this)},n.na=function(){Yi(this);const f=Array.from(this.g.values()),b=Array.from(this.g.keys()),R=[];for(let O=0;O<b.length;O++){const z=f[O];for(let K=0;K<z.length;K++)R.push(b[O])}return R},n.V=function(f){Yi(this);let b=[];if(typeof f=="string")jw(this,f)&&(b=b.concat(this.g.get(os(this,f))));else{f=Array.from(this.g.values());for(let R=0;R<f.length;R++)b=b.concat(f[R])}return b},n.set=function(f,b){return Yi(this),this.i=null,f=os(this,f),jw(this,f)&&(this.h-=this.g.get(f).length),this.g.set(f,[b]),this.h+=1,this},n.get=function(f,b){return f?(f=this.V(f),0<f.length?String(f[0]):b):b};function zw(f,b,R){Uw(f,b),0<R.length&&(f.i=null,f.g.set(os(f,b),g(R)),f.h+=R.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const f=[],b=Array.from(this.g.keys());for(var R=0;R<b.length;R++){var O=b[R];const K=encodeURIComponent(String(O)),ie=this.V(O);for(O=0;O<ie.length;O++){var z=K;ie[O]!==""&&(z+="="+encodeURIComponent(String(ie[O]))),f.push(z)}}return this.i=f.join("&")};function os(f,b){return b=String(b),f.j&&(b=b.toLowerCase()),b}function xP(f,b){b&&!f.j&&(Yi(f),f.i=null,f.g.forEach(function(R,O){var z=O.toLowerCase();O!=z&&(Uw(this,O),zw(this,z,R))},f)),f.j=b}function bP(f,b){const R=new Mu;if(s.Image){const O=new Image;O.onload=p(Ji,R,"TestLoadImage: loaded",!0,b,O),O.onerror=p(Ji,R,"TestLoadImage: error",!1,b,O),O.onabort=p(Ji,R,"TestLoadImage: abort",!1,b,O),O.ontimeout=p(Ji,R,"TestLoadImage: timeout",!1,b,O),s.setTimeout(function(){O.ontimeout&&O.ontimeout()},1e4),O.src=f}else b(!1)}function EP(f,b){const R=new Mu,O=new AbortController,z=setTimeout(()=>{O.abort(),Ji(R,"TestPingServer: timeout",!1,b)},1e4);fetch(f,{signal:O.signal}).then(K=>{clearTimeout(z),K.ok?Ji(R,"TestPingServer: ok",!0,b):Ji(R,"TestPingServer: server error",!1,b)}).catch(()=>{clearTimeout(z),Ji(R,"TestPingServer: error",!1,b)})}function Ji(f,b,R,O,z){try{z&&(z.onload=null,z.onerror=null,z.onabort=null,z.ontimeout=null),O(R)}catch{}}function CP(){this.g=new aP}function IP(f,b,R){const O=R||"";try{Fw(f,function(z,K){let ie=z;l(z)&&(ie=ra(z)),b.push(O+K+"="+encodeURIComponent(ie))})}catch(z){throw b.push(O+"type="+encodeURIComponent("_badmap")),z}}function nh(f){this.l=f.Ub||null,this.j=f.eb||!1}m(nh,Xp),nh.prototype.g=function(){return new rh(this.l,this.j)},nh.prototype.i=function(f){return function(){return f}}({});function rh(f,b){bt.call(this),this.D=f,this.o=b,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}m(rh,bt),n=rh.prototype,n.open=function(f,b){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=f,this.A=b,this.readyState=1,ju(this)},n.send=function(f){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const b={headers:this.u,method:this.B,credentials:this.m,cache:void 0};f&&(b.body=f),(this.D||s).fetch(new Request(this.A,b)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Uu(this)),this.readyState=0},n.Sa=function(f){if(this.g&&(this.l=f,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=f.headers,this.readyState=2,ju(this)),this.g&&(this.readyState=3,ju(this),this.g)))if(this.responseType==="arraybuffer")f.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof s.ReadableStream<"u"&&"body"in f){if(this.j=f.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ww(this)}else f.text().then(this.Ra.bind(this),this.ga.bind(this))};function Ww(f){f.j.read().then(f.Pa.bind(f)).catch(f.ga.bind(f))}n.Pa=function(f){if(this.g){if(this.o&&f.value)this.response.push(f.value);else if(!this.o){var b=f.value?f.value:new Uint8Array(0);(b=this.v.decode(b,{stream:!f.done}))&&(this.response=this.responseText+=b)}f.done?Uu(this):ju(this),this.readyState==3&&Ww(this)}},n.Ra=function(f){this.g&&(this.response=this.responseText=f,Uu(this))},n.Qa=function(f){this.g&&(this.response=f,Uu(this))},n.ga=function(){this.g&&Uu(this)};function Uu(f){f.readyState=4,f.l=null,f.j=null,f.v=null,ju(f)}n.setRequestHeader=function(f,b){this.u.append(f,b)},n.getResponseHeader=function(f){return this.h&&this.h.get(f.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const f=[],b=this.h.entries();for(var R=b.next();!R.done;)R=R.value,f.push(R[0]+": "+R[1]),R=b.next();return f.join(`\r
`)};function ju(f){f.onreadystatechange&&f.onreadystatechange.call(f)}Object.defineProperty(rh.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(f){this.m=f?"include":"same-origin"}});function $w(f){let b="";return A(f,function(R,O){b+=O,b+=":",b+=R,b+=`\r
`}),b}function om(f,b,R){e:{for(O in R){var O=!1;break e}O=!0}O||(R=$w(R),typeof f=="string"?R!=null&&encodeURIComponent(String(R)):nt(f,b,R))}function vt(f){bt.call(this),this.headers=new Map,this.o=f||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}m(vt,bt);var TP=/^https?$/i,SP=["POST","PUT"];n=vt.prototype,n.Ha=function(f){this.J=f},n.ea=function(f,b,R,O){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+f);b=b?b.toUpperCase():"GET",this.D=f,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Jp.g(),this.v=this.o?ww(this.o):ww(Jp),this.g.onreadystatechange=d(this.Ea,this);try{this.B=!0,this.g.open(b,String(f),!0),this.B=!1}catch(K){Hw(this,K);return}if(f=R||"",R=new Map(this.headers),O)if(Object.getPrototypeOf(O)===Object.prototype)for(var z in O)R.set(z,O[z]);else if(typeof O.keys=="function"&&typeof O.get=="function")for(const K of O.keys())R.set(K,O.get(K));else throw Error("Unknown input type for opt_headers: "+String(O));O=Array.from(R.keys()).find(K=>K.toLowerCase()=="content-type"),z=s.FormData&&f instanceof s.FormData,!(0<=Array.prototype.indexOf.call(SP,b,void 0))||O||z||R.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[K,ie]of R)this.g.setRequestHeader(K,ie);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Kw(this),this.u=!0,this.g.send(f),this.u=!1}catch(K){Hw(this,K)}};function Hw(f,b){f.h=!1,f.g&&(f.j=!0,f.g.abort(),f.j=!1),f.l=b,f.m=5,Gw(f),ih(f)}function Gw(f){f.A||(f.A=!0,mt(f,"complete"),mt(f,"error"))}n.abort=function(f){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=f||7,mt(this,"complete"),mt(this,"abort"),ih(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ih(this,!0)),vt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?qw(this):this.bb())},n.bb=function(){qw(this)};function qw(f){if(f.h&&typeof a<"u"&&(!f.v[1]||gi(f)!=4||f.Z()!=2)){if(f.u&&gi(f)==4)ts(f.Ea,0,f);else if(mt(f,"readystatechange"),gi(f)==4){f.h=!1;try{const ie=f.Z();e:switch(ie){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var b=!0;break e;default:b=!1}var R;if(!(R=b)){var O;if(O=ie===0){var z=String(f.D).match(Lw)[1]||null;!z&&s.self&&s.self.location&&(z=s.self.location.protocol.slice(0,-1)),O=!TP.test(z?z.toLowerCase():"")}R=O}if(R)mt(f,"complete"),mt(f,"success");else{f.m=6;try{var K=2<gi(f)?f.g.statusText:""}catch{K=""}f.l=K+" ["+f.Z()+"]",Gw(f)}}finally{ih(f)}}}}function ih(f,b){if(f.g){Kw(f);const R=f.g,O=f.v[0]?()=>{}:null;f.g=null,f.v=null,b||mt(f,"ready");try{R.onreadystatechange=O}catch{}}}function Kw(f){f.I&&(s.clearTimeout(f.I),f.I=null)}n.isActive=function(){return!!this.g};function gi(f){return f.g?f.g.readyState:0}n.Z=function(){try{return 2<gi(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(f){if(this.g){var b=this.g.responseText;return f&&b.indexOf(f)==0&&(b=b.substring(f.length)),oP(b)}};function Xw(f){try{if(!f.g)return null;if("response"in f.g)return f.g.response;switch(f.H){case"":case"text":return f.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in f.g)return f.g.mozResponseArrayBuffer}return null}catch{return null}}function RP(f){const b={};f=(f.g&&2<=gi(f)&&f.g.getAllResponseHeaders()||"").split(`\r
`);for(let O=0;O<f.length;O++){if(w(f[O]))continue;var R=N(f[O]);const z=R[0];if(R=R[1],typeof R!="string")continue;R=R.trim();const K=b[z]||[];b[z]=K,K.push(R)}T(b,function(O){return O.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function zu(f,b,R){return R&&R.internalChannelParams&&R.internalChannelParams[f]||b}function Qw(f){this.Aa=0,this.i=[],this.j=new Mu,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=zu("failFast",!1,f),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=zu("baseRetryDelayMs",5e3,f),this.cb=zu("retryDelaySeedMs",1e4,f),this.Wa=zu("forwardChannelMaxRetries",2,f),this.wa=zu("forwardChannelRequestTimeoutMs",2e4,f),this.pa=f&&f.xmlHttpFactory||void 0,this.Xa=f&&f.Tb||void 0,this.Ca=f&&f.useFetchStreams||!1,this.L=void 0,this.J=f&&f.supportsCrossDomainXhr||!1,this.K="",this.h=new Pw(f&&f.concurrentRequestLimit),this.Da=new CP,this.P=f&&f.fastHandshake||!1,this.O=f&&f.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=f&&f.Rb||!1,f&&f.xa&&this.j.xa(),f&&f.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&f&&f.detectBufferingProxy||!1,this.ja=void 0,f&&f.longPollingTimeout&&0<f.longPollingTimeout&&(this.ja=f.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Qw.prototype,n.la=8,n.G=1,n.connect=function(f,b,R,O){bn(0),this.W=f,this.H=b||{},R&&O!==void 0&&(this.H.OSID=R,this.H.OAID=O),this.F=this.X,this.I=o_(this,null,this.W),ah(this)};function am(f){if(Yw(f),f.G==3){var b=f.U++,R=vi(f.I);if(nt(R,"SID",f.K),nt(R,"RID",b),nt(R,"TYPE","terminate"),Wu(f,R),b=new Qi(f,f.j,b),b.L=2,b.v=th(vi(R)),R=!1,s.navigator&&s.navigator.sendBeacon)try{R=s.navigator.sendBeacon(b.v.toString(),"")}catch{}!R&&s.Image&&(new Image().src=b.v,R=!0),R||(b.g=a_(b.j,null),b.g.ea(b.v)),b.F=Date.now(),Jc(b)}i_(f)}function oh(f){f.g&&(um(f),f.g.cancel(),f.g=null)}function Yw(f){oh(f),f.u&&(s.clearTimeout(f.u),f.u=null),sh(f),f.h.cancel(),f.s&&(typeof f.s=="number"&&s.clearTimeout(f.s),f.s=null)}function ah(f){if(!Nw(f.h)&&!f.s){f.s=!0;var b=f.Ga;X||G(),V||(X(),V=!0),$.add(b,f),f.B=0}}function kP(f,b){return Dw(f.h)>=f.h.j-(f.s?1:0)?!1:f.s?(f.i=b.D.concat(f.i),!0):f.G==1||f.G==2||f.B>=(f.Va?0:f.Wa)?!1:(f.s=Ou(d(f.Ga,f,b),r_(f,f.B)),f.B++,!0)}n.Ga=function(f){if(this.s)if(this.s=null,this.G==1){if(!f){this.U=Math.floor(1e5*Math.random()),f=this.U++;const z=new Qi(this,this.j,f);let K=this.o;if(this.S&&(K?(K=E(K),S(K,this.S)):K=this.S),this.m!==null||this.O||(z.H=K,K=null),this.P)e:{for(var b=0,R=0;R<this.i.length;R++){t:{var O=this.i[R];if("__data__"in O.map&&(O=O.map.__data__,typeof O=="string")){O=O.length;break t}O=void 0}if(O===void 0)break;if(b+=O,4096<b){b=R;break e}if(b===4096||R===this.i.length-1){b=R+1;break e}}b=1e3}else b=1e3;b=Zw(this,z,b),R=vi(this.I),nt(R,"RID",f),nt(R,"CVER",22),this.D&&nt(R,"X-HTTP-Session-Id",this.D),Wu(this,R),K&&(this.O?b="headers="+encodeURIComponent(String($w(K)))+"&"+b:this.m&&om(R,this.m,K)),im(this.h,z),this.Ua&&nt(R,"TYPE","init"),this.P?(nt(R,"$req",b),nt(R,"SID","null"),z.T=!0,em(z,R,null)):em(z,R,b),this.G=2}}else this.G==3&&(f?Jw(this,f):this.i.length==0||Nw(this.h)||Jw(this))};function Jw(f,b){var R;b?R=b.l:R=f.U++;const O=vi(f.I);nt(O,"SID",f.K),nt(O,"RID",R),nt(O,"AID",f.T),Wu(f,O),f.m&&f.o&&om(O,f.m,f.o),R=new Qi(f,f.j,R,f.B+1),f.m===null&&(R.H=f.o),b&&(f.i=b.D.concat(f.i)),b=Zw(f,R,1e3),R.I=Math.round(.5*f.wa)+Math.round(.5*f.wa*Math.random()),im(f.h,R),em(R,O,b)}function Wu(f,b){f.H&&A(f.H,function(R,O){nt(b,O,R)}),f.l&&Fw({},function(R,O){nt(b,O,R)})}function Zw(f,b,R){R=Math.min(f.i.length,R);var O=f.l?d(f.l.Na,f.l,f):null;e:{var z=f.i;let K=-1;for(;;){const ie=["count="+R];K==-1?0<R?(K=z[0].g,ie.push("ofs="+K)):K=0:ie.push("ofs="+K);let Qe=!0;for(let $t=0;$t<R;$t++){let $e=z[$t].g;const nn=z[$t].map;if($e-=K,0>$e)K=Math.max(0,z[$t].g-100),Qe=!1;else try{IP(nn,ie,"req"+$e+"_")}catch{O&&O(nn)}}if(Qe){O=ie.join("&");break e}}}return f=f.i.splice(0,R),b.D=f,O}function e_(f){if(!f.g&&!f.u){f.Y=1;var b=f.Fa;X||G(),V||(X(),V=!0),$.add(b,f),f.v=0}}function sm(f){return f.g||f.u||3<=f.v?!1:(f.Y++,f.u=Ou(d(f.Fa,f),r_(f,f.v)),f.v++,!0)}n.Fa=function(){if(this.u=null,t_(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var f=2*this.R;this.j.info("BP detection timer enabled: "+f),this.A=Ou(d(this.ab,this),f)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,bn(10),oh(this),t_(this))};function um(f){f.A!=null&&(s.clearTimeout(f.A),f.A=null)}function t_(f){f.g=new Qi(f,f.j,"rpc",f.Y),f.m===null&&(f.g.H=f.o),f.g.O=0;var b=vi(f.qa);nt(b,"RID","rpc"),nt(b,"SID",f.K),nt(b,"AID",f.T),nt(b,"CI",f.F?"0":"1"),!f.F&&f.ja&&nt(b,"TO",f.ja),nt(b,"TYPE","xmlhttp"),Wu(f,b),f.m&&f.o&&om(b,f.m,f.o),f.L&&(f.g.I=f.L);var R=f.g;f=f.ia,R.L=1,R.v=th(vi(b)),R.m=null,R.P=!0,Rw(R,f)}n.Za=function(){this.C!=null&&(this.C=null,oh(this),sm(this),bn(19))};function sh(f){f.C!=null&&(s.clearTimeout(f.C),f.C=null)}function n_(f,b){var R=null;if(f.g==b){sh(f),um(f),f.g=null;var O=2}else if(rm(f.h,b))R=b.D,Ow(f.h,b),O=1;else return;if(f.G!=0){if(b.o)if(O==1){R=b.m?b.m.length:0,b=Date.now()-b.F;var z=f.B;O=Xc(),mt(O,new Cw(O,R)),ah(f)}else e_(f);else if(z=b.s,z==3||z==0&&0<b.X||!(O==1&&kP(f,b)||O==2&&sm(f)))switch(R&&0<R.length&&(b=f.h,b.i=b.i.concat(R)),z){case 1:sa(f,5);break;case 4:sa(f,10);break;case 3:sa(f,6);break;default:sa(f,2)}}}function r_(f,b){let R=f.Ta+Math.floor(Math.random()*f.cb);return f.isActive()||(R*=2),R*b}function sa(f,b){if(f.j.info("Error code "+b),b==2){var R=d(f.fb,f),O=f.Xa;const z=!O;O=new aa(O||"//www.google.com/images/cleardot.gif"),s.location&&s.location.protocol=="http"||Zc(O,"https"),th(O),z?bP(O.toString(),R):EP(O.toString(),R)}else bn(2);f.G=0,f.l&&f.l.sa(b),i_(f),Yw(f)}n.fb=function(f){f?(this.j.info("Successfully pinged google.com"),bn(2)):(this.j.info("Failed to ping google.com"),bn(1))};function i_(f){if(f.G=0,f.ka=[],f.l){const b=Mw(f.h);(b.length!=0||f.i.length!=0)&&(y(f.ka,b),y(f.ka,f.i),f.h.i.length=0,g(f.i),f.i.length=0),f.l.ra()}}function o_(f,b,R){var O=R instanceof aa?vi(R):new aa(R);if(O.g!="")b&&(O.g=b+"."+O.g),eh(O,O.s);else{var z=s.location;O=z.protocol,b=b?b+"."+z.hostname:z.hostname,z=+z.port;var K=new aa(null);O&&Zc(K,O),b&&(K.g=b),z&&eh(K,z),R&&(K.l=R),O=K}return R=f.D,b=f.ya,R&&b&&nt(O,R,b),nt(O,"VER",f.la),Wu(f,O),O}function a_(f,b,R){if(b&&!f.J)throw Error("Can't create secondary domain capable XhrIo object.");return b=f.Ca&&!f.pa?new vt(new nh({eb:R})):new vt(f.pa),b.Ha(f.J),b}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function s_(){}n=s_.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function uh(){}uh.prototype.g=function(f,b){return new jn(f,b)};function jn(f,b){bt.call(this),this.g=new Qw(b),this.l=f,this.h=b&&b.messageUrlParams||null,f=b&&b.messageHeaders||null,b&&b.clientProtocolHeaderRequired&&(f?f["X-Client-Protocol"]="webchannel":f={"X-Client-Protocol":"webchannel"}),this.g.o=f,f=b&&b.initMessageHeaders||null,b&&b.messageContentType&&(f?f["X-WebChannel-Content-Type"]=b.messageContentType:f={"X-WebChannel-Content-Type":b.messageContentType}),b&&b.va&&(f?f["X-WebChannel-Client-Profile"]=b.va:f={"X-WebChannel-Client-Profile":b.va}),this.g.S=f,(f=b&&b.Sb)&&!w(f)&&(this.g.m=f),this.v=b&&b.supportsCrossDomainXhr||!1,this.u=b&&b.sendRawJson||!1,(b=b&&b.httpSessionIdParam)&&!w(b)&&(this.g.D=b,f=this.h,f!==null&&b in f&&(f=this.h,b in f&&delete f[b])),this.j=new as(this)}m(jn,bt),jn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},jn.prototype.close=function(){am(this.g)},jn.prototype.o=function(f){var b=this.g;if(typeof f=="string"){var R={};R.__data__=f,f=R}else this.u&&(R={},R.__data__=ra(f),f=R);b.i.push(new dP(b.Ya++,f)),b.G==3&&ah(b)},jn.prototype.N=function(){this.g.l=null,delete this.j,am(this.g),delete this.g,jn.aa.N.call(this)};function u_(f){Qp.call(this),f.__headers__&&(this.headers=f.__headers__,this.statusCode=f.__status__,delete f.__headers__,delete f.__status__);var b=f.__sm__;if(b){e:{for(const R in b){f=R;break e}f=void 0}(this.i=f)&&(f=this.i,b=b!==null&&f in b?b[f]:void 0),this.data=b}else this.data=f}m(u_,Qp);function l_(){Yp.call(this),this.status=1}m(l_,Yp);function as(f){this.g=f}m(as,s_),as.prototype.ua=function(){mt(this.g,"a")},as.prototype.ta=function(f){mt(this.g,new u_(f))},as.prototype.sa=function(f){mt(this.g,new l_)},as.prototype.ra=function(){mt(this.g,"b")},uh.prototype.createWebChannel=uh.prototype.g,jn.prototype.send=jn.prototype.o,jn.prototype.open=jn.prototype.m,jn.prototype.close=jn.prototype.close,fS=function(){return new uh},dS=function(){return Xc()},hS=ia,Fg={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Qc.NO_ERROR=0,Qc.TIMEOUT=8,Qc.HTTP_ERROR=6,hd=Qc,Iw.COMPLETE="complete",cS=Iw,_w.EventType=Nu,Nu.OPEN="a",Nu.CLOSE="b",Nu.ERROR="c",Nu.MESSAGE="d",bt.prototype.listen=bt.prototype.K,hl=_w,vt.prototype.listenOnce=vt.prototype.L,vt.prototype.getLastError=vt.prototype.Ka,vt.prototype.getLastErrorCode=vt.prototype.Ba,vt.prototype.getStatus=vt.prototype.Z,vt.prototype.getResponseJson=vt.prototype.Oa,vt.prototype.getResponseText=vt.prototype.oa,vt.prototype.send=vt.prototype.ea,vt.prototype.setWithCredentials=vt.prototype.Ha,lS=vt}).apply(typeof kh<"u"?kh:typeof self<"u"?self:typeof window<"u"?window:{});const gb="@firebase/firestore",yb="4.7.11";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class un{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}un.UNAUTHENTICATED=new un(null),un.GOOGLE_CREDENTIALS=new un("google-credentials-uid"),un.FIRST_PARTY=new un("first-party-uid"),un.MOCK_USER=new un("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Iu="11.6.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Va=new E0("@firebase/firestore");function fs(){return Va.logLevel}function se(n,...e){if(Va.logLevel<=Le.DEBUG){const t=e.map(M0);Va.debug(`Firestore (${Iu}): ${n}`,...t)}}function Vi(n,...e){if(Va.logLevel<=Le.ERROR){const t=e.map(M0);Va.error(`Firestore (${Iu}): ${n}`,...t)}}function su(n,...e){if(Va.logLevel<=Le.WARN){const t=e.map(M0);Va.warn(`Firestore (${Iu}): ${n}`,...t)}}function M0(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function be(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,pS(n,r,t)}function pS(n,e,t){let r=`FIRESTORE (${Iu}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Vi(r),new Error(r)}function Ge(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||pS(e,i,r)}function Re(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ee={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class de extends ji{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class No{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mS{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class AV{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(un.UNAUTHENTICATED))}shutdown(){}}class PV{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class NV{constructor(e){this.t=e,this.currentUser=un.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Ge(this.o===void 0,42304);let r=this.i;const i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve();let o=new No;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new No,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const u=o;e.enqueueRetryable(async()=>{await u.promise,await i(this.currentUser)})},s=u=>{se("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(u=>s(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?s(u):(se("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new No)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(se("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Ge(typeof r.accessToken=="string",31837,{l:r}),new mS(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ge(e===null||typeof e=="string",2055,{h:e}),new un(e)}}class DV{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=un.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class OV{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new DV(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(un.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class wb{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class MV{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,cr(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Ge(this.o===void 0,3512);const r=o=>{o.error!=null&&se("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,se("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>r(o))};const i=o=>{se("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?i(o):se("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new wb(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Ge(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new wb(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FV(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vS(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gS{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=FV(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<t&&(r+=e.charAt(i[o]%62))}return r}}function Pe(n,e){return n<e?-1:n>e?1:0}function Lg(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=n.codePointAt(t),i=e.codePointAt(t);if(r!==i){if(r<128&&i<128)return Pe(r,i);{const o=vS(),a=LV(o.encode(_b(n,t)),o.encode(_b(e,t)));return a!==0?a:Pe(r,i)}}t+=r>65535?2:1}return Pe(n.length,e.length)}function _b(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function LV(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return Pe(n[t],e[t]);return Pe(n.length,e.length)}function uu(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xb=-62135596800,bb=1e6;class Pt{static now(){return Pt.fromMillis(Date.now())}static fromDate(e){return Pt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*bb);return new Pt(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new de(ee.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new de(ee.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<xb)throw new de(ee.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new de(ee.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/bb}_compareTo(e){return this.seconds===e.seconds?Pe(this.nanoseconds,e.nanoseconds):Pe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-xb;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ce{static fromTimestamp(e){return new Ce(e)}static min(){return new Ce(new Pt(0,0))}static max(){return new Ce(new Pt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eb="__name__";class Kr{constructor(e,t,r){t===void 0?t=0:t>e.length&&be(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&be(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Kr.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Kr?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const o=Kr.compareSegments(e.get(i),t.get(i));if(o!==0)return o}return Pe(e.length,t.length)}static compareSegments(e,t){const r=Kr.isNumericId(e),i=Kr.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?Kr.extractNumericId(e).compare(Kr.extractNumericId(t)):Lg(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Po.fromString(e.substring(4,e.length-2))}}class ot extends Kr{construct(e,t,r){return new ot(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new de(ee.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new ot(t)}static emptyPath(){return new ot([])}}const VV=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Yt extends Kr{construct(e,t,r){return new Yt(e,t,r)}static isValidIdentifier(e){return VV.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Yt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Eb}static keyField(){return new Yt([Eb])}static fromServerFormat(e){const t=[];let r="",i=0;const o=()=>{if(r.length===0)throw new de(ee.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;i<e.length;){const s=e[i];if(s==="\\"){if(i+1===e.length)throw new de(ee.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new de(ee.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else s==="`"?(a=!a,i++):s!=="."||a?(r+=s,i++):(o(),i++)}if(o(),a)throw new de(ee.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Yt(t)}static emptyPath(){return new Yt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class we{constructor(e){this.path=e}static fromPath(e){return new we(ot.fromString(e))}static fromName(e){return new we(ot.fromString(e).popFirst(5))}static empty(){return new we(ot.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ot.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ot.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new we(new ot(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nc=-1;function BV(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=Ce.fromTimestamp(r===1e9?new Pt(t+1,0):new Pt(t,r));return new Uo(i,we.empty(),e)}function UV(n){return new Uo(n.readTime,n.key,nc)}class Uo{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Uo(Ce.min(),we.empty(),nc)}static max(){return new Uo(Ce.max(),we.empty(),nc)}}function jV(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=we.comparator(n.documentKey,e.documentKey),t!==0?t:Pe(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zV="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class WV{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tu(n){if(n.code!==ee.FAILED_PRECONDITION||n.message!==zV)throw n;se("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&be(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new J((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof J?t:J.resolve(t)}catch(t){return J.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):J.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):J.reject(t)}static resolve(e){return new J((t,r)=>{t(e)})}static reject(e){return new J((t,r)=>{r(e)})}static waitFor(e){return new J((t,r)=>{let i=0,o=0,a=!1;e.forEach(s=>{++i,s.next(()=>{++o,a&&o===i&&t()},u=>r(u))}),a=!0,o===i&&t()})}static or(e){let t=J.resolve(!1);for(const r of e)t=t.next(i=>i?J.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,o)=>{r.push(t.call(this,i,o))}),this.waitFor(r)}static mapArray(e,t){return new J((r,i)=>{const o=e.length,a=new Array(o);let s=0;for(let u=0;u<o;u++){const l=u;t(e[l]).next(c=>{a[l]=c,++s,s===o&&r(a)},c=>i(c))}})}static doWhile(e,t){return new J((r,i)=>{const o=()=>{e()===!0?t().next(()=>{o()},i):r()};o()})}}function $V(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Su(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gp{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ue(r),this.ce=r=>t.writeSequenceNumber(r))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ce&&this.ce(e),e}}gp.le=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F0=-1;function yp(n){return n==null}function sf(n){return n===0&&1/n==-1/0}function HV(n){return typeof n=="number"&&Number.isInteger(n)&&!sf(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yS="";function GV(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Cb(e)),e=qV(n.get(t),e);return Cb(e)}function qV(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const o=n.charAt(i);switch(o){case"\0":t+="";break;case yS:t+="";break;default:t+=o}}return t}function Cb(n){return n+yS+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ib(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ga(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function wS(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ft{constructor(e,t){this.comparator=e,this.root=t||Kt.EMPTY}insert(e,t){return new ft(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Kt.BLACK,null,null))}remove(e){return new ft(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Kt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ah(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ah(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ah(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ah(this.root,e,this.comparator,!0)}}class Ah{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Kt{constructor(e,t,r,i,o){this.key=e,this.value=t,this.color=r??Kt.RED,this.left=i??Kt.EMPTY,this.right=o??Kt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,o){return new Kt(e??this.key,t??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,t,r),null):o===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Kt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return Kt.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Kt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Kt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw be(43730,{key:this.key,value:this.value});if(this.right.isRed())throw be(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw be(27949);return e+(this.isRed()?0:1)}}Kt.EMPTY=null,Kt.RED=!0,Kt.BLACK=!1;Kt.EMPTY=new class{constructor(){this.size=0}get key(){throw be(57766)}get value(){throw be(16141)}get color(){throw be(16727)}get left(){throw be(29726)}get right(){throw be(36894)}copy(e,t,r,i,o){return this}insert(e,t,r){return new Kt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nt{constructor(e){this.comparator=e,this.data=new ft(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Tb(this.data.getIterator())}getIteratorFrom(e){return new Tb(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Nt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Nt(this.comparator);return t.data=e,t}}class Tb{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kr{constructor(e){this.fields=e,e.sort(Yt.comparator)}static empty(){return new kr([])}unionWith(e){let t=new Nt(Yt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new kr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return uu(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _S extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class en{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new _S("Invalid base64 string: "+o):o}}(e);return new en(t)}static fromUint8Array(e){const t=function(i){let o="";for(let a=0;a<i.length;++a)o+=String.fromCharCode(i[a]);return o}(e);return new en(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Pe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}en.EMPTY_BYTE_STRING=new en("");const KV=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function jo(n){if(Ge(!!n,39018),typeof n=="string"){let e=0;const t=KV.exec(n);if(Ge(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:wt(n.seconds),nanos:wt(n.nanos)}}function wt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function zo(n){return typeof n=="string"?en.fromBase64String(n):en.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xS="server_timestamp",bS="__type__",ES="__previous_value__",CS="__local_write_time__";function L0(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[bS])===null||t===void 0?void 0:t.stringValue)===xS}function wp(n){const e=n.mapValue.fields[ES];return L0(e)?wp(e):e}function rc(n){const e=jo(n.mapValue.fields[CS].timestampValue);return new Pt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XV{constructor(e,t,r,i,o,a,s,u,l){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=s,this.longPollingOptions=u,this.useFetchStreams=l}}const uf="(default)";class ic{constructor(e,t){this.projectId=e,this.database=t||uf}static empty(){return new ic("","")}get isDefaultDatabase(){return this.database===uf}isEqual(e){return e instanceof ic&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IS="__type__",TS="__max__",Ph={mapValue:{fields:{__type__:{stringValue:TS}}}},SS="__vector__",lf="value";function Wo(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?L0(n)?4:YV(n)?9007199254740991:QV(n)?10:11:be(28295,{value:n})}function ci(n,e){if(n===e)return!0;const t=Wo(n);if(t!==Wo(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return rc(n).isEqual(rc(e));case 3:return function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;const a=jo(i.timestampValue),s=jo(o.timestampValue);return a.seconds===s.seconds&&a.nanos===s.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,o){return zo(i.bytesValue).isEqual(zo(o.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,o){return wt(i.geoPointValue.latitude)===wt(o.geoPointValue.latitude)&&wt(i.geoPointValue.longitude)===wt(o.geoPointValue.longitude)}(n,e);case 2:return function(i,o){if("integerValue"in i&&"integerValue"in o)return wt(i.integerValue)===wt(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){const a=wt(i.doubleValue),s=wt(o.doubleValue);return a===s?sf(a)===sf(s):isNaN(a)&&isNaN(s)}return!1}(n,e);case 9:return uu(n.arrayValue.values||[],e.arrayValue.values||[],ci);case 10:case 11:return function(i,o){const a=i.mapValue.fields||{},s=o.mapValue.fields||{};if(Ib(a)!==Ib(s))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(s[u]===void 0||!ci(a[u],s[u])))return!1;return!0}(n,e);default:return be(52216,{left:n})}}function oc(n,e){return(n.values||[]).find(t=>ci(t,e))!==void 0}function lu(n,e){if(n===e)return 0;const t=Wo(n),r=Wo(e);if(t!==r)return Pe(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Pe(n.booleanValue,e.booleanValue);case 2:return function(o,a){const s=wt(o.integerValue||o.doubleValue),u=wt(a.integerValue||a.doubleValue);return s<u?-1:s>u?1:s===u?0:isNaN(s)?isNaN(u)?0:-1:1}(n,e);case 3:return Sb(n.timestampValue,e.timestampValue);case 4:return Sb(rc(n),rc(e));case 5:return Lg(n.stringValue,e.stringValue);case 6:return function(o,a){const s=zo(o),u=zo(a);return s.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(o,a){const s=o.split("/"),u=a.split("/");for(let l=0;l<s.length&&l<u.length;l++){const c=Pe(s[l],u[l]);if(c!==0)return c}return Pe(s.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(o,a){const s=Pe(wt(o.latitude),wt(a.latitude));return s!==0?s:Pe(wt(o.longitude),wt(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Rb(n.arrayValue,e.arrayValue);case 10:return function(o,a){var s,u,l,c;const h=o.fields||{},d=a.fields||{},p=(s=h[lf])===null||s===void 0?void 0:s.arrayValue,m=(u=d[lf])===null||u===void 0?void 0:u.arrayValue,g=Pe(((l=p==null?void 0:p.values)===null||l===void 0?void 0:l.length)||0,((c=m==null?void 0:m.values)===null||c===void 0?void 0:c.length)||0);return g!==0?g:Rb(p,m)}(n.mapValue,e.mapValue);case 11:return function(o,a){if(o===Ph.mapValue&&a===Ph.mapValue)return 0;if(o===Ph.mapValue)return 1;if(a===Ph.mapValue)return-1;const s=o.fields||{},u=Object.keys(s),l=a.fields||{},c=Object.keys(l);u.sort(),c.sort();for(let h=0;h<u.length&&h<c.length;++h){const d=Lg(u[h],c[h]);if(d!==0)return d;const p=lu(s[u[h]],l[c[h]]);if(p!==0)return p}return Pe(u.length,c.length)}(n.mapValue,e.mapValue);default:throw be(23264,{Pe:t})}}function Sb(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Pe(n,e);const t=jo(n),r=jo(e),i=Pe(t.seconds,r.seconds);return i!==0?i:Pe(t.nanos,r.nanos)}function Rb(n,e){const t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){const o=lu(t[i],r[i]);if(o)return o}return Pe(t.length,r.length)}function cu(n){return Vg(n)}function Vg(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=jo(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return zo(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return we.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const o of t.values||[])i?i=!1:r+=",",r+=Vg(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",o=!0;for(const a of r)o?o=!1:i+=",",i+=`${a}:${Vg(t.fields[a])}`;return i+"}"}(n.mapValue):be(61005,{value:n})}function dd(n){switch(Wo(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=wp(n);return e?16+dd(e):16;case 5:return 2*n.stringValue.length;case 6:return zo(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,o)=>i+dd(o),0)}(n.arrayValue);case 10:case 11:return function(r){let i=0;return Ga(r.fields,(o,a)=>{i+=o.length+dd(a)}),i}(n.mapValue);default:throw be(13486,{value:n})}}function kb(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Bg(n){return!!n&&"integerValue"in n}function V0(n){return!!n&&"arrayValue"in n}function Ab(n){return!!n&&"nullValue"in n}function Pb(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function fd(n){return!!n&&"mapValue"in n}function QV(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[IS])===null||t===void 0?void 0:t.stringValue)===SS}function Cl(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Ga(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Cl(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Cl(n.arrayValue.values[t]);return e}return Object.assign({},n)}function YV(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===TS}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hr{constructor(e){this.value=e}static empty(){return new hr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!fd(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Cl(t)}setAll(e){let t=Yt.emptyPath(),r={},i=[];e.forEach((a,s)=>{if(!t.isImmediateParentOf(s)){const u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=s.popLast()}a?r[s.lastSegment()]=Cl(a):i.push(s.lastSegment())});const o=this.getFieldsMap(t);this.applyChanges(o,r,i)}delete(e){const t=this.field(e.popLast());fd(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ci(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];fd(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Ga(t,(i,o)=>e[i]=o);for(const i of r)delete e[i]}clone(){return new hr(Cl(this.value))}}function RS(n){const e=[];return Ga(n.fields,(t,r)=>{const i=new Yt([t]);if(fd(r)){const o=RS(r.mapValue).fields;if(o.length===0)e.push(i);else for(const a of o)e.push(i.child(a))}else e.push(i)}),new kr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hn{constructor(e,t,r,i,o,a,s){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=o,this.data=a,this.documentState=s}static newInvalidDocument(e){return new hn(e,0,Ce.min(),Ce.min(),Ce.min(),hr.empty(),0)}static newFoundDocument(e,t,r,i){return new hn(e,1,t,Ce.min(),r,i,0)}static newNoDocument(e,t){return new hn(e,2,t,Ce.min(),Ce.min(),hr.empty(),0)}static newUnknownDocument(e,t){return new hn(e,3,t,Ce.min(),Ce.min(),hr.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ce.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=hr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=hr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ce.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof hn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new hn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cf{constructor(e,t){this.position=e,this.inclusive=t}}function Nb(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const o=e[i],a=n.position[i];if(o.field.isKeyField()?r=we.comparator(we.fromName(a.referenceValue),t.key):r=lu(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Db(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!ci(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hf{constructor(e,t="asc"){this.field=e,this.dir=t}}function JV(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kS{}class It extends kS{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new eB(e,t,r):t==="array-contains"?new rB(e,r):t==="in"?new iB(e,r):t==="not-in"?new oB(e,r):t==="array-contains-any"?new aB(e,r):new It(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new tB(e,r):new nB(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(lu(t,this.value)):t!==null&&Wo(this.value)===Wo(t)&&this.matchesComparison(lu(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return be(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Vr extends kS{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new Vr(e,t)}matches(e){return AS(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Te!==null||(this.Te=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function AS(n){return n.op==="and"}function PS(n){return ZV(n)&&AS(n)}function ZV(n){for(const e of n.filters)if(e instanceof Vr)return!1;return!0}function Ug(n){if(n instanceof It)return n.field.canonicalString()+n.op.toString()+cu(n.value);if(PS(n))return n.filters.map(e=>Ug(e)).join(",");{const e=n.filters.map(t=>Ug(t)).join(",");return`${n.op}(${e})`}}function NS(n,e){return n instanceof It?function(r,i){return i instanceof It&&r.op===i.op&&r.field.isEqual(i.field)&&ci(r.value,i.value)}(n,e):n instanceof Vr?function(r,i){return i instanceof Vr&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((o,a,s)=>o&&NS(a,i.filters[s]),!0):!1}(n,e):void be(19439)}function DS(n){return n instanceof It?function(t){return`${t.field.canonicalString()} ${t.op} ${cu(t.value)}`}(n):n instanceof Vr?function(t){return t.op.toString()+" {"+t.getFilters().map(DS).join(" ,")+"}"}(n):"Filter"}class eB extends It{constructor(e,t,r){super(e,t,r),this.key=we.fromName(r.referenceValue)}matches(e){const t=we.comparator(e.key,this.key);return this.matchesComparison(t)}}class tB extends It{constructor(e,t){super(e,"in",t),this.keys=OS("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class nB extends It{constructor(e,t){super(e,"not-in",t),this.keys=OS("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function OS(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>we.fromName(r.referenceValue))}class rB extends It{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return V0(t)&&oc(t.arrayValue,this.value)}}class iB extends It{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&oc(this.value.arrayValue,t)}}class oB extends It{constructor(e,t){super(e,"not-in",t)}matches(e){if(oc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!oc(this.value.arrayValue,t)}}class aB extends It{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!V0(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>oc(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sB{constructor(e,t=null,r=[],i=[],o=null,a=null,s=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=a,this.endAt=s,this.Ie=null}}function Ob(n,e=null,t=[],r=[],i=null,o=null,a=null){return new sB(n,e,t,r,i,o,a)}function B0(n){const e=Re(n);if(e.Ie===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Ug(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(o){return o.field.canonicalString()+o.dir}(r)).join(","),yp(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>cu(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>cu(r)).join(",")),e.Ie=t}return e.Ie}function U0(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!JV(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!NS(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Db(n.startAt,e.startAt)&&Db(n.endAt,e.endAt)}function jg(n){return we.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dc{constructor(e,t=null,r=[],i=[],o=null,a="F",s=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=a,this.startAt=s,this.endAt=u,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function uB(n,e,t,r,i,o,a,s){return new Dc(n,e,t,r,i,o,a,s)}function MS(n){return new Dc(n)}function Mb(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function FS(n){return n.collectionGroup!==null}function Il(n){const e=Re(n);if(e.Ee===null){e.Ee=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ee.push(o),t.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let s=new Nt(Yt.comparator);return a.filters.forEach(u=>{u.getFlattenedFilters().forEach(l=>{l.isInequality()&&(s=s.add(l.field))})}),s})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ee.push(new hf(o,r))}),t.has(Yt.keyField().canonicalString())||e.Ee.push(new hf(Yt.keyField(),r))}return e.Ee}function ii(n){const e=Re(n);return e.de||(e.de=lB(e,Il(n))),e.de}function lB(n,e){if(n.limitType==="F")return Ob(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{const o=i.dir==="desc"?"asc":"desc";return new hf(i.field,o)});const t=n.endAt?new cf(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new cf(n.startAt.position,n.startAt.inclusive):null;return Ob(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function zg(n,e){const t=n.filters.concat([e]);return new Dc(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Wg(n,e,t){return new Dc(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function _p(n,e){return U0(ii(n),ii(e))&&n.limitType===e.limitType}function LS(n){return`${B0(ii(n))}|lt:${n.limitType}`}function ps(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>DS(i)).join(", ")}]`),yp(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>cu(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>cu(i)).join(",")),`Target(${r})`}(ii(n))}; limitType=${n.limitType})`}function xp(n,e){return e.isFoundDocument()&&function(r,i){const o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):we.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(n,e)&&function(r,i){for(const o of Il(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0}(n,e)&&function(r,i){for(const o of r.filters)if(!o.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(a,s,u){const l=Nb(a,s,u);return a.inclusive?l<=0:l<0}(r.startAt,Il(r),i)||r.endAt&&!function(a,s,u){const l=Nb(a,s,u);return a.inclusive?l>=0:l>0}(r.endAt,Il(r),i))}(n,e)}function cB(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function VS(n){return(e,t)=>{let r=!1;for(const i of Il(n)){const o=hB(i,e,t);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function hB(n,e,t){const r=n.field.isKeyField()?we.comparator(e.key,t.key):function(o,a,s){const u=a.data.field(o),l=s.data.field(o);return u!==null&&l!==null?lu(u,l):be(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return be(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qa{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Ga(this.inner,(t,r)=>{for(const[i,o]of r)e(i,o)})}isEmpty(){return wS(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dB=new ft(we.comparator);function Bi(){return dB}const BS=new ft(we.comparator);function dl(...n){let e=BS;for(const t of n)e=e.insert(t.key,t);return e}function US(n){let e=BS;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function wa(){return Tl()}function jS(){return Tl()}function Tl(){return new qa(n=>n.toString(),(n,e)=>n.isEqual(e))}const fB=new ft(we.comparator),pB=new Nt(we.comparator);function Ve(...n){let e=pB;for(const t of n)e=e.add(t);return e}const mB=new Nt(Pe);function vB(){return mB}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j0(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:sf(e)?"-0":e}}function zS(n){return{integerValue:""+n}}function gB(n,e){return HV(e)?zS(e):j0(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bp{constructor(){this._=void 0}}function yB(n,e,t){return n instanceof ac?function(i,o){const a={fields:{[bS]:{stringValue:xS},[CS]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&L0(o)&&(o=wp(o)),o&&(a.fields[ES]=o),{mapValue:a}}(t,e):n instanceof sc?$S(n,e):n instanceof uc?HS(n,e):function(i,o){const a=WS(i,o),s=Fb(a)+Fb(i.Re);return Bg(a)&&Bg(i.Re)?zS(s):j0(i.serializer,s)}(n,e)}function wB(n,e,t){return n instanceof sc?$S(n,e):n instanceof uc?HS(n,e):t}function WS(n,e){return n instanceof df?function(r){return Bg(r)||function(o){return!!o&&"doubleValue"in o}(r)}(e)?e:{integerValue:0}:null}class ac extends bp{}class sc extends bp{constructor(e){super(),this.elements=e}}function $S(n,e){const t=GS(e);for(const r of n.elements)t.some(i=>ci(i,r))||t.push(r);return{arrayValue:{values:t}}}class uc extends bp{constructor(e){super(),this.elements=e}}function HS(n,e){let t=GS(e);for(const r of n.elements)t=t.filter(i=>!ci(i,r));return{arrayValue:{values:t}}}class df extends bp{constructor(e,t){super(),this.serializer=e,this.Re=t}}function Fb(n){return wt(n.integerValue||n.doubleValue)}function GS(n){return V0(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _B{constructor(e,t){this.field=e,this.transform=t}}function xB(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof sc&&i instanceof sc||r instanceof uc&&i instanceof uc?uu(r.elements,i.elements,ci):r instanceof df&&i instanceof df?ci(r.Re,i.Re):r instanceof ac&&i instanceof ac}(n.transform,e.transform)}class bB{constructor(e,t){this.version=e,this.transformResults=t}}class oi{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new oi}static exists(e){return new oi(void 0,e)}static updateTime(e){return new oi(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function pd(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Ep{}function qS(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new z0(n.key,oi.none()):new Oc(n.key,n.data,oi.none());{const t=n.data,r=hr.empty();let i=new Nt(Yt.comparator);for(let o of e.fields)if(!i.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),i=i.add(o)}return new Ka(n.key,r,new kr(i.toArray()),oi.none())}}function EB(n,e,t){n instanceof Oc?function(i,o,a){const s=i.value.clone(),u=Vb(i.fieldTransforms,o,a.transformResults);s.setAll(u),o.convertToFoundDocument(a.version,s).setHasCommittedMutations()}(n,e,t):n instanceof Ka?function(i,o,a){if(!pd(i.precondition,o))return void o.convertToUnknownDocument(a.version);const s=Vb(i.fieldTransforms,o,a.transformResults),u=o.data;u.setAll(KS(i)),u.setAll(s),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(n,e,t):function(i,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function Sl(n,e,t,r){return n instanceof Oc?function(o,a,s,u){if(!pd(o.precondition,a))return s;const l=o.value.clone(),c=Bb(o.fieldTransforms,u,a);return l.setAll(c),a.convertToFoundDocument(a.version,l).setHasLocalMutations(),null}(n,e,t,r):n instanceof Ka?function(o,a,s,u){if(!pd(o.precondition,a))return s;const l=Bb(o.fieldTransforms,u,a),c=a.data;return c.setAll(KS(o)),c.setAll(l),a.convertToFoundDocument(a.version,c).setHasLocalMutations(),s===null?null:s.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(h=>h.field))}(n,e,t,r):function(o,a,s){return pd(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):s}(n,e,t)}function CB(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),o=WS(r.transform,i||null);o!=null&&(t===null&&(t=hr.empty()),t.set(r.field,o))}return t||null}function Lb(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&uu(r,i,(o,a)=>xB(o,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Oc extends Ep{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Ka extends Ep{constructor(e,t,r,i,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function KS(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Vb(n,e,t){const r=new Map;Ge(n.length===t.length,32656,{Ve:t.length,me:n.length});for(let i=0;i<t.length;i++){const o=n[i],a=o.transform,s=e.data.field(o.field);r.set(o.field,wB(a,s,t[i]))}return r}function Bb(n,e,t){const r=new Map;for(const i of n){const o=i.transform,a=t.data.field(i.field);r.set(i.field,yB(o,a,e))}return r}class z0 extends Ep{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class IB extends Ep{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TB{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(e.key)&&EB(o,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Sl(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Sl(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=jS();return this.mutations.forEach(i=>{const o=e.get(i.key),a=o.overlayedDocument;let s=this.applyToLocalView(a,o.mutatedFields);s=t.has(i.key)?null:s;const u=qS(a,s);u!==null&&r.set(i.key,u),a.isValidDocument()||a.convertToNoDocument(Ce.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ve())}isEqual(e){return this.batchId===e.batchId&&uu(this.mutations,e.mutations,(t,r)=>Lb(t,r))&&uu(this.baseMutations,e.baseMutations,(t,r)=>Lb(t,r))}}class W0{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Ge(e.mutations.length===r.length,58842,{fe:e.mutations.length,ge:r.length});let i=function(){return fB}();const o=e.mutations;for(let a=0;a<o.length;a++)i=i.insert(o[a].key,r[a].version);return new W0(e,t,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SB{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RB{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Et,Ue;function kB(n){switch(n){case ee.OK:return be(64938);case ee.CANCELLED:case ee.UNKNOWN:case ee.DEADLINE_EXCEEDED:case ee.RESOURCE_EXHAUSTED:case ee.INTERNAL:case ee.UNAVAILABLE:case ee.UNAUTHENTICATED:return!1;case ee.INVALID_ARGUMENT:case ee.NOT_FOUND:case ee.ALREADY_EXISTS:case ee.PERMISSION_DENIED:case ee.FAILED_PRECONDITION:case ee.ABORTED:case ee.OUT_OF_RANGE:case ee.UNIMPLEMENTED:case ee.DATA_LOSS:return!0;default:return be(15467,{code:n})}}function XS(n){if(n===void 0)return Vi("GRPC error has no .code"),ee.UNKNOWN;switch(n){case Et.OK:return ee.OK;case Et.CANCELLED:return ee.CANCELLED;case Et.UNKNOWN:return ee.UNKNOWN;case Et.DEADLINE_EXCEEDED:return ee.DEADLINE_EXCEEDED;case Et.RESOURCE_EXHAUSTED:return ee.RESOURCE_EXHAUSTED;case Et.INTERNAL:return ee.INTERNAL;case Et.UNAVAILABLE:return ee.UNAVAILABLE;case Et.UNAUTHENTICATED:return ee.UNAUTHENTICATED;case Et.INVALID_ARGUMENT:return ee.INVALID_ARGUMENT;case Et.NOT_FOUND:return ee.NOT_FOUND;case Et.ALREADY_EXISTS:return ee.ALREADY_EXISTS;case Et.PERMISSION_DENIED:return ee.PERMISSION_DENIED;case Et.FAILED_PRECONDITION:return ee.FAILED_PRECONDITION;case Et.ABORTED:return ee.ABORTED;case Et.OUT_OF_RANGE:return ee.OUT_OF_RANGE;case Et.UNIMPLEMENTED:return ee.UNIMPLEMENTED;case Et.DATA_LOSS:return ee.DATA_LOSS;default:return be(39323,{code:n})}}(Ue=Et||(Et={}))[Ue.OK=0]="OK",Ue[Ue.CANCELLED=1]="CANCELLED",Ue[Ue.UNKNOWN=2]="UNKNOWN",Ue[Ue.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ue[Ue.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ue[Ue.NOT_FOUND=5]="NOT_FOUND",Ue[Ue.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ue[Ue.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ue[Ue.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ue[Ue.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ue[Ue.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ue[Ue.ABORTED=10]="ABORTED",Ue[Ue.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ue[Ue.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ue[Ue.INTERNAL=13]="INTERNAL",Ue[Ue.UNAVAILABLE=14]="UNAVAILABLE",Ue[Ue.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AB=new Po([4294967295,4294967295],0);function Ub(n){const e=vS().encode(n),t=new uS;return t.update(e),new Uint8Array(t.digest())}function jb(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new Po([t,r],0),new Po([i,o],0)]}class $0{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new fl(`Invalid padding: ${t}`);if(r<0)throw new fl(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new fl(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new fl(`Invalid padding when bitmap length is 0: ${t}`);this.pe=8*e.length-t,this.ye=Po.fromNumber(this.pe)}we(e,t,r){let i=e.add(t.multiply(Po.fromNumber(r)));return i.compare(AB)===1&&(i=new Po([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ye).toNumber()}be(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.pe===0)return!1;const t=Ub(e),[r,i]=jb(t);for(let o=0;o<this.hashCount;o++){const a=this.we(r,i,o);if(!this.be(a))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new $0(o,i,t);return r.forEach(s=>a.insert(s)),a}insert(e){if(this.pe===0)return;const t=Ub(e),[r,i]=jb(t);for(let o=0;o<this.hashCount;o++){const a=this.we(r,i,o);this.Se(a)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class fl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cp{constructor(e,t,r,i,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,Mc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Cp(Ce.min(),i,new ft(Pe),Bi(),Ve())}}class Mc{constructor(e,t,r,i,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Mc(r,t,Ve(),Ve(),Ve())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class md{constructor(e,t,r,i){this.De=e,this.removedTargetIds=t,this.key=r,this.ve=i}}class QS{constructor(e,t){this.targetId=e,this.Ce=t}}class YS{constructor(e,t,r=en.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class zb{constructor(){this.Fe=0,this.Me=Wb(),this.xe=en.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return this.Fe!==0}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=Ve(),t=Ve(),r=Ve();return this.Me.forEach((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:be(38017,{changeType:o})}}),new Mc(this.xe,this.Oe,e,t,r)}Qe(){this.Ne=!1,this.Me=Wb()}$e(e,t){this.Ne=!0,this.Me=this.Me.insert(e,t)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,Ge(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class PB{constructor(e){this.ze=e,this.je=new Map,this.He=Bi(),this.Je=Nh(),this.Ye=Nh(),this.Ze=new ft(Pe)}Xe(e){for(const t of e.De)e.ve&&e.ve.isFoundDocument()?this.et(t,e.ve):this.tt(t,e.key,e.ve);for(const t of e.removedTargetIds)this.tt(t,e.key,e.ve)}nt(e){this.forEachTarget(e,t=>{const r=this.rt(t);switch(e.state){case 0:this.it(t)&&r.ke(e.resumeToken);break;case 1:r.We(),r.Be||r.Qe(),r.ke(e.resumeToken);break;case 2:r.We(),r.Be||this.removeTarget(t);break;case 3:this.it(t)&&(r.Ge(),r.ke(e.resumeToken));break;case 4:this.it(t)&&(this.st(t),r.ke(e.resumeToken));break;default:be(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.je.forEach((r,i)=>{this.it(i)&&t(i)})}ot(e){const t=e.targetId,r=e.Ce.count,i=this._t(t);if(i){const o=i.target;if(jg(o))if(r===0){const a=new we(o.path);this.tt(t,a,hn.newNoDocument(a,Ce.min()))}else Ge(r===1,20013,{expectedCount:r});else{const a=this.ut(t);if(a!==r){const s=this.ct(e),u=s?this.lt(s,e,a):1;if(u!==0){this.st(t);const l=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,l)}}}}}ct(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=t;let a,s;try{a=zo(r).toUint8Array()}catch(u){if(u instanceof _S)return su("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{s=new $0(a,i,o)}catch(u){return su(u instanceof fl?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return s.pe===0?null:s}lt(e,t,r){return t.Ce.count===r-this.Tt(e,t.targetId)?0:2}Tt(e,t){const r=this.ze.getRemoteKeysForTarget(t);let i=0;return r.forEach(o=>{const a=this.ze.Pt(),s=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(s)||(this.tt(t,o,null),i++)}),i}It(e){const t=new Map;this.je.forEach((o,a)=>{const s=this._t(a);if(s){if(o.current&&jg(s.target)){const u=new we(s.target.path);this.Et(u).has(a)||this.dt(a,u)||this.tt(a,u,hn.newNoDocument(u,e))}o.Le&&(t.set(a,o.qe()),o.Qe())}});let r=Ve();this.Ye.forEach((o,a)=>{let s=!0;a.forEachWhile(u=>{const l=this._t(u);return!l||l.purpose==="TargetPurposeLimboResolution"||(s=!1,!1)}),s&&(r=r.add(o))}),this.He.forEach((o,a)=>a.setReadTime(e));const i=new Cp(e,t,this.Ze,this.He,r);return this.He=Bi(),this.Je=Nh(),this.Ye=Nh(),this.Ze=new ft(Pe),i}et(e,t){if(!this.it(e))return;const r=this.dt(e,t.key)?2:0;this.rt(e).$e(t.key,r),this.He=this.He.insert(t.key,t),this.Je=this.Je.insert(t.key,this.Et(t.key).add(e)),this.Ye=this.Ye.insert(t.key,this.At(t.key).add(e))}tt(e,t,r){if(!this.it(e))return;const i=this.rt(e);this.dt(e,t)?i.$e(t,1):i.Ue(t),this.Ye=this.Ye.insert(t,this.At(t).delete(e)),this.Ye=this.Ye.insert(t,this.At(t).add(e)),r&&(this.He=this.He.insert(t,r))}removeTarget(e){this.je.delete(e)}ut(e){const t=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let t=this.je.get(e);return t||(t=new zb,this.je.set(e,t)),t}At(e){let t=this.Ye.get(e);return t||(t=new Nt(Pe),this.Ye=this.Ye.insert(e,t)),t}Et(e){let t=this.Je.get(e);return t||(t=new Nt(Pe),this.Je=this.Je.insert(e,t)),t}it(e){const t=this._t(e)!==null;return t||se("WatchChangeAggregator","Detected inactive target",e),t}_t(e){const t=this.je.get(e);return t&&t.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new zb),this.ze.getRemoteKeysForTarget(e).forEach(t=>{this.tt(e,t,null)})}dt(e,t){return this.ze.getRemoteKeysForTarget(e).has(t)}}function Nh(){return new ft(we.comparator)}function Wb(){return new ft(we.comparator)}const NB={asc:"ASCENDING",desc:"DESCENDING"},DB={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},OB={and:"AND",or:"OR"};class MB{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function $g(n,e){return n.useProto3Json||yp(e)?e:{value:e}}function ff(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function JS(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function FB(n,e){return ff(n,e.toTimestamp())}function ai(n){return Ge(!!n,49232),Ce.fromTimestamp(function(t){const r=jo(t);return new Pt(r.seconds,r.nanos)}(n))}function H0(n,e){return Hg(n,e).canonicalString()}function Hg(n,e){const t=function(i){return new ot(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function ZS(n){const e=ot.fromString(n);return Ge(iR(e),10190,{key:e.toString()}),e}function Gg(n,e){return H0(n.databaseId,e.path)}function qm(n,e){const t=ZS(e);if(t.get(1)!==n.databaseId.projectId)throw new de(ee.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new de(ee.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new we(tR(t))}function eR(n,e){return H0(n.databaseId,e)}function LB(n){const e=ZS(n);return e.length===4?ot.emptyPath():tR(e)}function qg(n){return new ot(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function tR(n){return Ge(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function $b(n,e,t){return{name:Gg(n,e),fields:t.value.mapValue.fields}}function VB(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:be(39313,{state:l})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(l,c){return l.useProto3Json?(Ge(c===void 0||typeof c=="string",58123),en.fromBase64String(c||"")):(Ge(c===void 0||c instanceof Buffer||c instanceof Uint8Array,16193),en.fromUint8Array(c||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,s=a&&function(l){const c=l.code===void 0?ee.UNKNOWN:XS(l.code);return new de(c,l.message||"")}(a);t=new YS(r,i,o,s||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=qm(n,r.document.name),o=ai(r.document.updateTime),a=r.document.createTime?ai(r.document.createTime):Ce.min(),s=new hr({mapValue:{fields:r.document.fields}}),u=hn.newFoundDocument(i,o,a,s),l=r.targetIds||[],c=r.removedTargetIds||[];t=new md(l,c,u.key,u)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=qm(n,r.document),o=r.readTime?ai(r.readTime):Ce.min(),a=hn.newNoDocument(i,o),s=r.removedTargetIds||[];t=new md([],s,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=qm(n,r.document),o=r.removedTargetIds||[];t=new md([],o,i,null)}else{if(!("filter"in e))return be(11601,{Vt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:o}=r,a=new RB(i,o),s=r.targetId;t=new QS(s,a)}}return t}function BB(n,e){let t;if(e instanceof Oc)t={update:$b(n,e.key,e.value)};else if(e instanceof z0)t={delete:Gg(n,e.key)};else if(e instanceof Ka)t={update:$b(n,e.key,e.data),updateMask:KB(e.fieldMask)};else{if(!(e instanceof IB))return be(16599,{ft:e.type});t={verify:Gg(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(o,a){const s=a.transform;if(s instanceof ac)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(s instanceof sc)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:s.elements}};if(s instanceof uc)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:s.elements}};if(s instanceof df)return{fieldPath:a.field.canonicalString(),increment:s.Re};throw be(20930,{transform:a.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,o){return o.updateTime!==void 0?{updateTime:FB(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:be(27497)}(n,e.precondition)),t}function UB(n,e){return n&&n.length>0?(Ge(e!==void 0,14353),n.map(t=>function(i,o){let a=i.updateTime?ai(i.updateTime):ai(o);return a.isEqual(Ce.min())&&(a=ai(o)),new bB(a,i.transformResults||[])}(t,e))):[]}function jB(n,e){return{documents:[eR(n,e.path)]}}function zB(n,e){const t={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=eR(n,i);const o=function(l){if(l.length!==0)return rR(Vr.create(l,"and"))}(e.filters);o&&(t.structuredQuery.where=o);const a=function(l){if(l.length!==0)return l.map(c=>function(d){return{field:ms(d.field),direction:HB(d.dir)}}(c))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const s=$g(n,e.limit);return s!==null&&(t.structuredQuery.limit=s),e.startAt&&(t.structuredQuery.startAt=function(l){return{before:l.inclusive,values:l.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(l){return{before:!l.inclusive,values:l.position}}(e.endAt)),{gt:t,parent:i}}function WB(n){let e=LB(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){Ge(r===1,65062);const c=t.from[0];c.allDescendants?i=c.collectionId:e=e.child(c.collectionId)}let o=[];t.where&&(o=function(h){const d=nR(h);return d instanceof Vr&&PS(d)?d.getFilters():[d]}(t.where));let a=[];t.orderBy&&(a=function(h){return h.map(d=>function(m){return new hf(vs(m.field),function(y){switch(y){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(m.direction))}(d))}(t.orderBy));let s=null;t.limit&&(s=function(h){let d;return d=typeof h=="object"?h.value:h,yp(d)?null:d}(t.limit));let u=null;t.startAt&&(u=function(h){const d=!!h.before,p=h.values||[];return new cf(p,d)}(t.startAt));let l=null;return t.endAt&&(l=function(h){const d=!h.before,p=h.values||[];return new cf(p,d)}(t.endAt)),uB(e,i,a,o,s,"F",u,l)}function $B(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return be(28987,{purpose:i})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function nR(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=vs(t.unaryFilter.field);return It.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=vs(t.unaryFilter.field);return It.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=vs(t.unaryFilter.field);return It.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=vs(t.unaryFilter.field);return It.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return be(61313);default:return be(60726)}}(n):n.fieldFilter!==void 0?function(t){return It.create(vs(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return be(58110);default:return be(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Vr.create(t.compositeFilter.filters.map(r=>nR(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return be(1026)}}(t.compositeFilter.op))}(n):be(30097,{filter:n})}function HB(n){return NB[n]}function GB(n){return DB[n]}function qB(n){return OB[n]}function ms(n){return{fieldPath:n.canonicalString()}}function vs(n){return Yt.fromServerFormat(n.fieldPath)}function rR(n){return n instanceof It?function(t){if(t.op==="=="){if(Pb(t.value))return{unaryFilter:{field:ms(t.field),op:"IS_NAN"}};if(Ab(t.value))return{unaryFilter:{field:ms(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Pb(t.value))return{unaryFilter:{field:ms(t.field),op:"IS_NOT_NAN"}};if(Ab(t.value))return{unaryFilter:{field:ms(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ms(t.field),op:GB(t.op),value:t.value}}}(n):n instanceof Vr?function(t){const r=t.getFilters().map(i=>rR(i));return r.length===1?r[0]:{compositeFilter:{op:qB(t.op),filters:r}}}(n):be(54877,{filter:n})}function KB(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function iR(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mo{constructor(e,t,r,i,o=Ce.min(),a=Ce.min(),s=en.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=s,this.expectedCount=u}withSequenceNumber(e){return new mo(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new mo(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new mo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new mo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XB{constructor(e){this.wt=e}}function QB(n){const e=WB({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Wg(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YB{constructor(){this.yn=new JB}addToCollectionParentIndex(e,t){return this.yn.add(t),J.resolve()}getCollectionParents(e,t){return J.resolve(this.yn.getEntries(t))}addFieldIndex(e,t){return J.resolve()}deleteFieldIndex(e,t){return J.resolve()}deleteAllFieldIndexes(e){return J.resolve()}createTargetIndexes(e,t){return J.resolve()}getDocumentsMatchingTarget(e,t){return J.resolve(null)}getIndexType(e,t){return J.resolve(0)}getFieldIndexes(e,t){return J.resolve([])}getNextCollectionGroupToUpdate(e){return J.resolve(null)}getMinOffset(e,t){return J.resolve(Uo.min())}getMinOffsetFromCollectionGroup(e,t){return J.resolve(Uo.min())}updateCollectionGroup(e,t,r){return J.resolve()}updateIndexEntries(e,t){return J.resolve()}}class JB{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Nt(ot.comparator),o=!i.has(r);return this.index[t]=i.add(r),o}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Nt(ot.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hb={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},oR=41943040;class Sn{static withCacheSize(e){return new Sn(e,Sn.DEFAULT_COLLECTION_PERCENTILE,Sn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Sn.DEFAULT_COLLECTION_PERCENTILE=10,Sn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Sn.DEFAULT=new Sn(oR,Sn.DEFAULT_COLLECTION_PERCENTILE,Sn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Sn.DISABLED=new Sn(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hu{constructor(e){this.nr=e}next(){return this.nr+=2,this.nr}static rr(){return new hu(0)}static ir(){return new hu(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gb="LruGarbageCollector",ZB=1048576;function qb([n,e],[t,r]){const i=Pe(n,t);return i===0?Pe(e,r):i}class eU{constructor(e){this.cr=e,this.buffer=new Nt(qb),this.lr=0}hr(){return++this.lr}Pr(e){const t=[e,this.hr()];if(this.buffer.size<this.cr)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();qb(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class tU{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Tr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ir(6e4)}stop(){this.Tr&&(this.Tr.cancel(),this.Tr=null)}get started(){return this.Tr!==null}Ir(e){se(Gb,`Garbage collection scheduled in ${e}ms`),this.Tr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Tr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Su(t)?se(Gb,"Ignoring IndexedDB error during garbage collection: ",t):await Tu(t)}await this.Ir(3e5)})}}class nU{constructor(e,t){this.Er=e,this.params=t}calculateTargetCount(e,t){return this.Er.dr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return J.resolve(gp.le);const r=new eU(t);return this.Er.forEachTarget(e,i=>r.Pr(i.sequenceNumber)).next(()=>this.Er.Ar(e,i=>r.Pr(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Er.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Er.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(se("LruGarbageCollector","Garbage collection skipped; disabled"),J.resolve(Hb)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(se("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Hb):this.Rr(e,t))}getCacheSize(e){return this.Er.getCacheSize(e)}Rr(e,t){let r,i,o,a,s,u,l;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(se("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,a=Date.now(),this.nthSequenceNumber(e,i))).next(h=>(r=h,s=Date.now(),this.removeTargets(e,r,t))).next(h=>(o=h,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(l=Date.now(),fs()<=Le.DEBUG&&se("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-c}ms
	Determined least recently used ${i} in `+(s-a)+`ms
	Removed ${o} targets in `+(u-s)+`ms
	Removed ${h} documents in `+(l-u)+`ms
Total Duration: ${l-c}ms`),J.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:h})))}}function rU(n,e){return new nU(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iU{constructor(){this.changes=new qa(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,hn.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?J.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oU{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aU{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Sl(r.mutation,i,kr.empty(),Pt.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Ve()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Ve()){const i=wa();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(o=>{let a=dl();return o.forEach((s,u)=>{a=a.insert(s,u.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const r=wa();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Ve()))}populateOverlays(e,t,r){const i=[];return r.forEach(o=>{t.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(e,i).next(o=>{o.forEach((a,s)=>{t.set(a,s)})})}computeViews(e,t,r,i){let o=Bi();const a=Tl(),s=function(){return Tl()}();return t.forEach((u,l)=>{const c=r.get(l.key);i.has(l.key)&&(c===void 0||c.mutation instanceof Ka)?o=o.insert(l.key,l):c!==void 0?(a.set(l.key,c.mutation.getFieldMask()),Sl(c.mutation,l,c.mutation.getFieldMask(),Pt.now())):a.set(l.key,kr.empty())}),this.recalculateAndSaveOverlays(e,o).next(u=>(u.forEach((l,c)=>a.set(l,c)),t.forEach((l,c)=>{var h;return s.set(l,new oU(c,(h=a.get(l))!==null&&h!==void 0?h:null))}),s))}recalculateAndSaveOverlays(e,t){const r=Tl();let i=new ft((a,s)=>a-s),o=Ve();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const s of a)s.keys().forEach(u=>{const l=t.get(u);if(l===null)return;let c=r.get(u)||kr.empty();c=s.applyToLocalView(l,c),r.set(u,c);const h=(i.get(s.batchId)||Ve()).add(u);i=i.insert(s.batchId,h)})}).next(()=>{const a=[],s=i.getReverseIterator();for(;s.hasNext();){const u=s.getNext(),l=u.key,c=u.value,h=jS();c.forEach(d=>{if(!o.has(d)){const p=qS(t.get(d),r.get(d));p!==null&&h.set(d,p),o=o.add(d)}}),a.push(this.documentOverlayCache.saveOverlays(e,l,h))}return J.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(a){return we.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):FS(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(o=>{const a=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-o.size):J.resolve(wa());let s=nc,u=o;return a.next(l=>J.forEach(l,(c,h)=>(s<h.largestBatchId&&(s=h.largestBatchId),o.get(c)?J.resolve():this.remoteDocumentCache.getEntry(e,c).next(d=>{u=u.insert(c,d)}))).next(()=>this.populateOverlays(e,l,o)).next(()=>this.computeViews(e,u,l,Ve())).next(c=>({batchId:s,changes:US(c)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new we(t)).next(r=>{let i=dl();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const o=t.collectionGroup;let a=dl();return this.indexManager.getCollectionParents(e,o).next(s=>J.forEach(s,u=>{const l=function(h,d){return new Dc(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,u.child(o));return this.getDocumentsMatchingCollectionQuery(e,l,r,i).next(c=>{c.forEach((h,d)=>{a=a.insert(h,d)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,i))).next(a=>{o.forEach((u,l)=>{const c=l.getKey();a.get(c)===null&&(a=a.insert(c,hn.newInvalidDocument(c)))});let s=dl();return a.forEach((u,l)=>{const c=o.get(u);c!==void 0&&Sl(c.mutation,l,kr.empty(),Pt.now()),xp(t,l)&&(s=s.insert(u,l))}),s})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sU{constructor(e){this.serializer=e,this.Fr=new Map,this.Mr=new Map}getBundleMetadata(e,t){return J.resolve(this.Fr.get(t))}saveBundleMetadata(e,t){return this.Fr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:ai(i.createTime)}}(t)),J.resolve()}getNamedQuery(e,t){return J.resolve(this.Mr.get(t))}saveNamedQuery(e,t){return this.Mr.set(t.name,function(i){return{name:i.name,query:QB(i.bundledQuery),readTime:ai(i.readTime)}}(t)),J.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uU{constructor(){this.overlays=new ft(we.comparator),this.Or=new Map}getOverlay(e,t){return J.resolve(this.overlays.get(t))}getOverlays(e,t){const r=wa();return J.forEach(t,i=>this.getOverlay(e,i).next(o=>{o!==null&&r.set(i,o)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,o)=>{this.St(e,t,o)}),J.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.Or.get(r);return i!==void 0&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.Or.delete(r)),J.resolve()}getOverlaysForCollection(e,t,r){const i=wa(),o=t.length+1,a=new we(t.child("")),s=this.overlays.getIteratorFrom(a);for(;s.hasNext();){const u=s.getNext().value,l=u.getKey();if(!t.isPrefixOf(l.path))break;l.path.length===o&&u.largestBatchId>r&&i.set(u.getKey(),u)}return J.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let o=new ft((l,c)=>l-c);const a=this.overlays.getIterator();for(;a.hasNext();){const l=a.getNext().value;if(l.getKey().getCollectionGroup()===t&&l.largestBatchId>r){let c=o.get(l.largestBatchId);c===null&&(c=wa(),o=o.insert(l.largestBatchId,c)),c.set(l.getKey(),l)}}const s=wa(),u=o.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((l,c)=>s.set(l,c)),!(s.size()>=i)););return J.resolve(s)}St(e,t,r){const i=this.overlays.get(r.key);if(i!==null){const a=this.Or.get(i.largestBatchId).delete(r.key);this.Or.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new SB(t,r));let o=this.Or.get(t);o===void 0&&(o=Ve(),this.Or.set(t,o)),this.Or.set(t,o.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lU{constructor(){this.sessionToken=en.EMPTY_BYTE_STRING}getSessionToken(e){return J.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,J.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G0{constructor(){this.Nr=new Nt(Bt.Br),this.Lr=new Nt(Bt.kr)}isEmpty(){return this.Nr.isEmpty()}addReference(e,t){const r=new Bt(e,t);this.Nr=this.Nr.add(r),this.Lr=this.Lr.add(r)}qr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Qr(new Bt(e,t))}$r(e,t){e.forEach(r=>this.removeReference(r,t))}Ur(e){const t=new we(new ot([])),r=new Bt(t,e),i=new Bt(t,e+1),o=[];return this.Lr.forEachInRange([r,i],a=>{this.Qr(a),o.push(a.key)}),o}Kr(){this.Nr.forEach(e=>this.Qr(e))}Qr(e){this.Nr=this.Nr.delete(e),this.Lr=this.Lr.delete(e)}Wr(e){const t=new we(new ot([])),r=new Bt(t,e),i=new Bt(t,e+1);let o=Ve();return this.Lr.forEachInRange([r,i],a=>{o=o.add(a.key)}),o}containsKey(e){const t=new Bt(e,0),r=this.Nr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Bt{constructor(e,t){this.key=e,this.Gr=t}static Br(e,t){return we.comparator(e.key,t.key)||Pe(e.Gr,t.Gr)}static kr(e,t){return Pe(e.Gr,t.Gr)||we.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cU{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Jn=1,this.zr=new Nt(Bt.Br)}checkEmpty(e){return J.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){const o=this.Jn;this.Jn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new TB(o,t,r,i);this.mutationQueue.push(a);for(const s of i)this.zr=this.zr.add(new Bt(s.key,o)),this.indexManager.addToCollectionParentIndex(e,s.key.path.popLast());return J.resolve(a)}lookupMutationBatch(e,t){return J.resolve(this.jr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=this.Hr(r),o=i<0?0:i;return J.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return J.resolve(this.mutationQueue.length===0?F0:this.Jn-1)}getAllMutationBatches(e){return J.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Bt(t,0),i=new Bt(t,Number.POSITIVE_INFINITY),o=[];return this.zr.forEachInRange([r,i],a=>{const s=this.jr(a.Gr);o.push(s)}),J.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Nt(Pe);return t.forEach(i=>{const o=new Bt(i,0),a=new Bt(i,Number.POSITIVE_INFINITY);this.zr.forEachInRange([o,a],s=>{r=r.add(s.Gr)})}),J.resolve(this.Jr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let o=r;we.isDocumentKey(o)||(o=o.child(""));const a=new Bt(new we(o),0);let s=new Nt(Pe);return this.zr.forEachWhile(u=>{const l=u.key.path;return!!r.isPrefixOf(l)&&(l.length===i&&(s=s.add(u.Gr)),!0)},a),J.resolve(this.Jr(s))}Jr(e){const t=[];return e.forEach(r=>{const i=this.jr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){Ge(this.Yr(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.zr;return J.forEach(t.mutations,i=>{const o=new Bt(i.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.zr=r})}Xn(e){}containsKey(e,t){const r=new Bt(t,0),i=this.zr.firstAfterOrEqual(r);return J.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,J.resolve()}Yr(e,t){return this.Hr(e)}Hr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}jr(e){const t=this.Hr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hU{constructor(e){this.Zr=e,this.docs=function(){return new ft(we.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),o=i?i.size:0,a=this.Zr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return J.resolve(r?r.document.mutableCopy():hn.newInvalidDocument(t))}getEntries(e,t){let r=Bi();return t.forEach(i=>{const o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():hn.newInvalidDocument(i))}),J.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let o=Bi();const a=t.path,s=new we(a.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(s);for(;u.hasNext();){const{key:l,value:{document:c}}=u.getNext();if(!a.isPrefixOf(l.path))break;l.path.length>a.length+1||jV(UV(c),r)<=0||(i.has(c.key)||xp(t,c))&&(o=o.insert(c.key,c.mutableCopy()))}return J.resolve(o)}getAllFromCollectionGroup(e,t,r,i){be(9500)}Xr(e,t){return J.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new dU(this)}getSize(e){return J.resolve(this.size)}}class dU extends iU{constructor(e){super(),this.vr=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.vr.addEntry(e,i)):this.vr.removeEntry(r)}),J.waitFor(t)}getFromCache(e,t){return this.vr.getEntry(e,t)}getAllFromCache(e,t){return this.vr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fU{constructor(e){this.persistence=e,this.ei=new qa(t=>B0(t),U0),this.lastRemoteSnapshotVersion=Ce.min(),this.highestTargetId=0,this.ti=0,this.ni=new G0,this.targetCount=0,this.ri=hu.rr()}forEachTarget(e,t){return this.ei.forEach((r,i)=>t(i)),J.resolve()}getLastRemoteSnapshotVersion(e){return J.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return J.resolve(this.ti)}allocateTargetId(e){return this.highestTargetId=this.ri.next(),J.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ti&&(this.ti=t),J.resolve()}ar(e){this.ei.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ri=new hu(t),this.highestTargetId=t),e.sequenceNumber>this.ti&&(this.ti=e.sequenceNumber)}addTargetData(e,t){return this.ar(t),this.targetCount+=1,J.resolve()}updateTargetData(e,t){return this.ar(t),J.resolve()}removeTargetData(e,t){return this.ei.delete(t.target),this.ni.Ur(t.targetId),this.targetCount-=1,J.resolve()}removeTargets(e,t,r){let i=0;const o=[];return this.ei.forEach((a,s)=>{s.sequenceNumber<=t&&r.get(s.targetId)===null&&(this.ei.delete(a),o.push(this.removeMatchingKeysForTargetId(e,s.targetId)),i++)}),J.waitFor(o).next(()=>i)}getTargetCount(e){return J.resolve(this.targetCount)}getTargetData(e,t){const r=this.ei.get(t)||null;return J.resolve(r)}addMatchingKeys(e,t,r){return this.ni.qr(t,r),J.resolve()}removeMatchingKeys(e,t,r){this.ni.$r(t,r);const i=this.persistence.referenceDelegate,o=[];return i&&t.forEach(a=>{o.push(i.markPotentiallyOrphaned(e,a))}),J.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.ni.Ur(t),J.resolve()}getMatchingKeysForTargetId(e,t){const r=this.ni.Wr(t);return J.resolve(r)}containsKey(e,t){return J.resolve(this.ni.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aR{constructor(e,t){this.ii={},this.overlays={},this.si=new gp(0),this.oi=!1,this.oi=!0,this._i=new lU,this.referenceDelegate=e(this),this.ai=new fU(this),this.indexManager=new YB,this.remoteDocumentCache=function(i){return new hU(i)}(r=>this.referenceDelegate.ui(r)),this.serializer=new XB(t),this.ci=new sU(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.oi=!1,Promise.resolve()}get started(){return this.oi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new uU,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ii[e.toKey()];return r||(r=new cU(t,this.referenceDelegate),this.ii[e.toKey()]=r),r}getGlobalsCache(){return this._i}getTargetCache(){return this.ai}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.ci}runTransaction(e,t,r){se("MemoryPersistence","Starting transaction:",e);const i=new pU(this.si.next());return this.referenceDelegate.li(),r(i).next(o=>this.referenceDelegate.hi(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}Pi(e,t){return J.or(Object.values(this.ii).map(r=>()=>r.containsKey(e,t)))}}class pU extends WV{constructor(e){super(),this.currentSequenceNumber=e}}class q0{constructor(e){this.persistence=e,this.Ti=new G0,this.Ii=null}static Ei(e){return new q0(e)}get di(){if(this.Ii)return this.Ii;throw be(60996)}addReference(e,t,r){return this.Ti.addReference(r,t),this.di.delete(r.toString()),J.resolve()}removeReference(e,t,r){return this.Ti.removeReference(r,t),this.di.add(r.toString()),J.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),J.resolve()}removeTarget(e,t){this.Ti.Ur(t.targetId).forEach(i=>this.di.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(o=>this.di.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}li(){this.Ii=new Set}hi(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return J.forEach(this.di,r=>{const i=we.fromPath(r);return this.Ai(e,i).next(o=>{o||t.removeEntry(i,Ce.min())})}).next(()=>(this.Ii=null,t.apply(e)))}updateLimboDocument(e,t){return this.Ai(e,t).next(r=>{r?this.di.delete(t.toString()):this.di.add(t.toString())})}ui(e){return 0}Ai(e,t){return J.or([()=>J.resolve(this.Ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Pi(e,t)])}}class pf{constructor(e,t){this.persistence=e,this.Ri=new qa(r=>GV(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=rU(this,t)}static Ei(e,t){return new pf(e,t)}li(){}hi(e){return J.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.Vr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Vr(e){let t=0;return this.Ar(e,r=>{t++}).next(()=>t)}Ar(e,t){return J.forEach(this.Ri,(r,i)=>this.gr(e,r,i).next(o=>o?J.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.Xr(e,a=>this.gr(e,a,t).next(s=>{s||(r++,o.removeEntry(a,Ce.min()))})).next(()=>o.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.Ri.set(t,e.currentSequenceNumber),J.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.Ri.set(r,e.currentSequenceNumber),J.resolve()}removeReference(e,t,r){return this.Ri.set(r,e.currentSequenceNumber),J.resolve()}updateLimboDocument(e,t){return this.Ri.set(t,e.currentSequenceNumber),J.resolve()}ui(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=dd(e.data.value)),t}gr(e,t,r){return J.or([()=>this.persistence.Pi(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.Ri.get(t);return J.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K0{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.ls=r,this.hs=i}static Ps(e,t){let r=Ve(),i=Ve();for(const o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new K0(e,t.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mU{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vU{constructor(){this.Ts=!1,this.Is=!1,this.Es=100,this.ds=function(){return qO()?8:$V(wn())>0?6:4}()}initialize(e,t){this.As=e,this.indexManager=t,this.Ts=!0}getDocumentsMatchingQuery(e,t,r,i){const o={result:null};return this.Rs(e,t).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.Vs(e,t,i,r).next(a=>{o.result=a})}).next(()=>{if(o.result)return;const a=new mU;return this.fs(e,t,a).next(s=>{if(o.result=s,this.Is)return this.gs(e,t,a,s.size)})}).next(()=>o.result)}gs(e,t,r,i){return r.documentReadCount<this.Es?(fs()<=Le.DEBUG&&se("QueryEngine","SDK will not create cache indexes for query:",ps(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Es,"documents"),J.resolve()):(fs()<=Le.DEBUG&&se("QueryEngine","Query:",ps(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.ds*i?(fs()<=Le.DEBUG&&se("QueryEngine","The SDK decides to create cache indexes for query:",ps(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ii(t))):J.resolve())}Rs(e,t){if(Mb(t))return J.resolve(null);let r=ii(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Wg(t,null,"F"),r=ii(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(o=>{const a=Ve(...o);return this.As.getDocuments(e,a).next(s=>this.indexManager.getMinOffset(e,r).next(u=>{const l=this.ps(t,s);return this.ys(t,l,a,u.readTime)?this.Rs(e,Wg(t,null,"F")):this.ws(e,l,t,u)}))})))}Vs(e,t,r,i){return Mb(t)||i.isEqual(Ce.min())?J.resolve(null):this.As.getDocuments(e,r).next(o=>{const a=this.ps(t,o);return this.ys(t,a,r,i)?J.resolve(null):(fs()<=Le.DEBUG&&se("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ps(t)),this.ws(e,a,t,BV(i,nc)).next(s=>s))})}ps(e,t){let r=new Nt(VS(e));return t.forEach((i,o)=>{xp(e,o)&&(r=r.add(o))}),r}ys(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}fs(e,t,r){return fs()<=Le.DEBUG&&se("QueryEngine","Using full collection scan to execute query:",ps(t)),this.As.getDocumentsMatchingQuery(e,t,Uo.min(),r)}ws(e,t,r,i){return this.As.getDocumentsMatchingQuery(e,r,i).next(o=>(t.forEach(a=>{o=o.insert(a.key,a)}),o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X0="LocalStore",gU=3e8;class yU{constructor(e,t,r,i){this.persistence=e,this.bs=t,this.serializer=i,this.Ss=new ft(Pe),this.Ds=new qa(o=>B0(o),U0),this.vs=new Map,this.Cs=e.getRemoteDocumentCache(),this.ai=e.getTargetCache(),this.ci=e.getBundleCache(),this.Fs(r)}Fs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new aU(this.Cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Cs.setIndexManager(this.indexManager),this.bs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ss))}}function wU(n,e,t,r){return new yU(n,e,t,r)}async function sR(n,e){const t=Re(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(o=>(i=o,t.Fs(e),t.mutationQueue.getAllMutationBatches(r))).next(o=>{const a=[],s=[];let u=Ve();for(const l of i){a.push(l.batchId);for(const c of l.mutations)u=u.add(c.key)}for(const l of o){s.push(l.batchId);for(const c of l.mutations)u=u.add(c.key)}return t.localDocuments.getDocuments(r,u).next(l=>({Ms:l,removedBatchIds:a,addedBatchIds:s}))})})}function _U(n,e){const t=Re(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),o=t.Cs.newChangeBuffer({trackRemovals:!0});return function(s,u,l,c){const h=l.batch,d=h.keys();let p=J.resolve();return d.forEach(m=>{p=p.next(()=>c.getEntry(u,m)).next(g=>{const y=l.docVersions.get(m);Ge(y!==null,48541),g.version.compareTo(y)<0&&(h.applyToRemoteDocument(g,l),g.isValidDocument()&&(g.setReadTime(l.commitVersion),c.addEntry(g)))})}),p.next(()=>s.mutationQueue.removeMutationBatch(u,h))}(t,r,e,o).next(()=>o.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(s){let u=Ve();for(let l=0;l<s.mutationResults.length;++l)s.mutationResults[l].transformResults.length>0&&(u=u.add(s.batch.mutations[l].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function uR(n){const e=Re(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.ai.getLastRemoteSnapshotVersion(t))}function xU(n,e){const t=Re(n),r=e.snapshotVersion;let i=t.Ss;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const a=t.Cs.newChangeBuffer({trackRemovals:!0});i=t.Ss;const s=[];e.targetChanges.forEach((c,h)=>{const d=i.get(h);if(!d)return;s.push(t.ai.removeMatchingKeys(o,c.removedDocuments,h).next(()=>t.ai.addMatchingKeys(o,c.addedDocuments,h)));let p=d.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(h)!==null?p=p.withResumeToken(en.EMPTY_BYTE_STRING,Ce.min()).withLastLimboFreeSnapshotVersion(Ce.min()):c.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(c.resumeToken,r)),i=i.insert(h,p),function(g,y,v){return g.resumeToken.approximateByteSize()===0||y.snapshotVersion.toMicroseconds()-g.snapshotVersion.toMicroseconds()>=gU?!0:v.addedDocuments.size+v.modifiedDocuments.size+v.removedDocuments.size>0}(d,p,c)&&s.push(t.ai.updateTargetData(o,p))});let u=Bi(),l=Ve();if(e.documentUpdates.forEach(c=>{e.resolvedLimboDocuments.has(c)&&s.push(t.persistence.referenceDelegate.updateLimboDocument(o,c))}),s.push(bU(o,a,e.documentUpdates).next(c=>{u=c.xs,l=c.Os})),!r.isEqual(Ce.min())){const c=t.ai.getLastRemoteSnapshotVersion(o).next(h=>t.ai.setTargetsMetadata(o,o.currentSequenceNumber,r));s.push(c)}return J.waitFor(s).next(()=>a.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,u,l)).next(()=>u)}).then(o=>(t.Ss=i,o))}function bU(n,e,t){let r=Ve(),i=Ve();return t.forEach(o=>r=r.add(o)),e.getEntries(n,r).next(o=>{let a=Bi();return t.forEach((s,u)=>{const l=o.get(s);u.isFoundDocument()!==l.isFoundDocument()&&(i=i.add(s)),u.isNoDocument()&&u.version.isEqual(Ce.min())?(e.removeEntry(s,u.readTime),a=a.insert(s,u)):!l.isValidDocument()||u.version.compareTo(l.version)>0||u.version.compareTo(l.version)===0&&l.hasPendingWrites?(e.addEntry(u),a=a.insert(s,u)):se(X0,"Ignoring outdated watch update for ",s,". Current version:",l.version," Watch version:",u.version)}),{xs:a,Os:i}})}function EU(n,e){const t=Re(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=F0),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function CU(n,e){const t=Re(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.ai.getTargetData(r,e).next(o=>o?(i=o,J.resolve(i)):t.ai.allocateTargetId(r).next(a=>(i=new mo(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.ai.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.Ss.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ss=t.Ss.insert(r.targetId,r),t.Ds.set(e,r.targetId)),r})}async function Kg(n,e,t){const r=Re(n),i=r.Ss.get(e),o=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",o,a=>r.persistence.referenceDelegate.removeTarget(a,i))}catch(a){if(!Su(a))throw a;se(X0,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ss=r.Ss.remove(e),r.Ds.delete(i.target)}function Kb(n,e,t){const r=Re(n);let i=Ce.min(),o=Ve();return r.persistence.runTransaction("Execute query","readwrite",a=>function(u,l,c){const h=Re(u),d=h.Ds.get(c);return d!==void 0?J.resolve(h.Ss.get(d)):h.ai.getTargetData(l,c)}(r,a,ii(e)).next(s=>{if(s)return i=s.lastLimboFreeSnapshotVersion,r.ai.getMatchingKeysForTargetId(a,s.targetId).next(u=>{o=u})}).next(()=>r.bs.getDocumentsMatchingQuery(a,e,t?i:Ce.min(),t?o:Ve())).next(s=>(IU(r,cB(e),s),{documents:s,Ns:o})))}function IU(n,e,t){let r=n.vs.get(e)||Ce.min();t.forEach((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.vs.set(e,r)}class Xb{constructor(){this.activeTargetIds=vB()}$s(e){this.activeTargetIds=this.activeTargetIds.add(e)}Us(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Qs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class TU{constructor(){this.So=new Xb,this.Do={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.So.$s(e),this.Do[e]||"not-current"}updateQueryState(e,t,r){this.Do[e]=t}removeLocalQueryTarget(e){this.So.Us(e)}isLocalQueryTarget(e){return this.So.activeTargetIds.has(e)}clearQueryState(e){delete this.Do[e]}getAllActiveQueryTargets(){return this.So.activeTargetIds}isActiveQueryTarget(e){return this.So.activeTargetIds.has(e)}start(){return this.So=new Xb,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SU{vo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qb="ConnectivityMonitor";class Yb{constructor(){this.Co=()=>this.Fo(),this.Mo=()=>this.xo(),this.Oo=[],this.No()}vo(e){this.Oo.push(e)}shutdown(){window.removeEventListener("online",this.Co),window.removeEventListener("offline",this.Mo)}No(){window.addEventListener("online",this.Co),window.addEventListener("offline",this.Mo)}Fo(){se(Qb,"Network connectivity changed: AVAILABLE");for(const e of this.Oo)e(0)}xo(){se(Qb,"Network connectivity changed: UNAVAILABLE");for(const e of this.Oo)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Dh=null;function Xg(){return Dh===null?Dh=function(){return 268435456+Math.round(2147483648*Math.random())}():Dh++,"0x"+Dh.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Km="RestConnection",RU={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class kU{get Bo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Lo=t+"://"+e.host,this.ko=`projects/${r}/databases/${i}`,this.qo=this.databaseId.database===uf?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Qo(e,t,r,i,o){const a=Xg(),s=this.$o(e,t.toUriEncodedString());se(Km,`Sending RPC '${e}' ${a}:`,s,r);const u={"google-cloud-resource-prefix":this.ko,"x-goog-request-params":this.qo};return this.Uo(u,i,o),this.Ko(e,s,u,r).then(l=>(se(Km,`Received RPC '${e}' ${a}: `,l),l),l=>{throw su(Km,`RPC '${e}' ${a} failed with error: `,l,"url: ",s,"request:",r),l})}Wo(e,t,r,i,o,a){return this.Qo(e,t,r,i,o)}Uo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Iu}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,o)=>e[o]=i),r&&r.headers.forEach((i,o)=>e[o]=i)}$o(e,t){const r=RU[e];return`${this.Lo}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AU{constructor(e){this.Go=e.Go,this.zo=e.zo}jo(e){this.Ho=e}Jo(e){this.Yo=e}Zo(e){this.Xo=e}onMessage(e){this.e_=e}close(){this.zo()}send(e){this.Go(e)}t_(){this.Ho()}n_(){this.Yo()}r_(e){this.Xo(e)}i_(e){this.e_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sn="WebChannelConnection";class PU extends kU{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ko(e,t,r,i){const o=Xg();return new Promise((a,s)=>{const u=new lS;u.setWithCredentials(!0),u.listenOnce(cS.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case hd.NO_ERROR:const c=u.getResponseJson();se(sn,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(c)),a(c);break;case hd.TIMEOUT:se(sn,`RPC '${e}' ${o} timed out`),s(new de(ee.DEADLINE_EXCEEDED,"Request time out"));break;case hd.HTTP_ERROR:const h=u.getStatus();if(se(sn,`RPC '${e}' ${o} failed with status:`,h,"response text:",u.getResponseText()),h>0){let d=u.getResponseJson();Array.isArray(d)&&(d=d[0]);const p=d==null?void 0:d.error;if(p&&p.status&&p.message){const m=function(y){const v=y.toLowerCase().replace(/_/g,"-");return Object.values(ee).indexOf(v)>=0?v:ee.UNKNOWN}(p.status);s(new de(m,p.message))}else s(new de(ee.UNKNOWN,"Server responded with status "+u.getStatus()))}else s(new de(ee.UNAVAILABLE,"Connection failed."));break;default:be(9055,{s_:e,streamId:o,o_:u.getLastErrorCode(),__:u.getLastError()})}}finally{se(sn,`RPC '${e}' ${o} completed.`)}});const l=JSON.stringify(i);se(sn,`RPC '${e}' ${o} sending request:`,i),u.send(t,"POST",l,r,15)})}a_(e,t,r){const i=Xg(),o=[this.Lo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=fS(),s=dS(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(u.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Uo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const c=o.join("");se(sn,`Creating RPC '${e}' stream ${i}: ${c}`,u);const h=a.createWebChannel(c,u);let d=!1,p=!1;const m=new AU({Go:y=>{p?se(sn,`Not sending because RPC '${e}' stream ${i} is closed:`,y):(d||(se(sn,`Opening RPC '${e}' stream ${i} transport.`),h.open(),d=!0),se(sn,`RPC '${e}' stream ${i} sending:`,y),h.send(y))},zo:()=>h.close()}),g=(y,v,w)=>{y.listen(v,_=>{try{w(_)}catch(x){setTimeout(()=>{throw x},0)}})};return g(h,hl.EventType.OPEN,()=>{p||(se(sn,`RPC '${e}' stream ${i} transport opened.`),m.t_())}),g(h,hl.EventType.CLOSE,()=>{p||(p=!0,se(sn,`RPC '${e}' stream ${i} transport closed`),m.r_())}),g(h,hl.EventType.ERROR,y=>{p||(p=!0,su(sn,`RPC '${e}' stream ${i} transport errored. Name:`,y.name,"Message:",y.message),m.r_(new de(ee.UNAVAILABLE,"The operation could not be completed")))}),g(h,hl.EventType.MESSAGE,y=>{var v;if(!p){const w=y.data[0];Ge(!!w,16349);const _=w,x=(_==null?void 0:_.error)||((v=_[0])===null||v===void 0?void 0:v.error);if(x){se(sn,`RPC '${e}' stream ${i} received error:`,x);const C=x.status;let A=function(I){const S=Et[I];if(S!==void 0)return XS(S)}(C),T=x.message;A===void 0&&(A=ee.INTERNAL,T="Unknown error status: "+C+" with message "+x.message),p=!0,m.r_(new de(A,T)),h.close()}else se(sn,`RPC '${e}' stream ${i} received:`,w),m.i_(w)}}),g(s,hS.STAT_EVENT,y=>{y.stat===Fg.PROXY?se(sn,`RPC '${e}' stream ${i} detected buffering proxy`):y.stat===Fg.NOPROXY&&se(sn,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{m.n_()},0),m}}function Xm(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ip(n){return new MB(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lR{constructor(e,t,r=1e3,i=1.5,o=6e4){this.bi=e,this.timerId=t,this.u_=r,this.c_=i,this.l_=o,this.h_=0,this.P_=null,this.T_=Date.now(),this.reset()}reset(){this.h_=0}I_(){this.h_=this.l_}E_(e){this.cancel();const t=Math.floor(this.h_+this.d_()),r=Math.max(0,Date.now()-this.T_),i=Math.max(0,t-r);i>0&&se("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.h_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.P_=this.bi.enqueueAfterDelay(this.timerId,i,()=>(this.T_=Date.now(),e())),this.h_*=this.c_,this.h_<this.u_&&(this.h_=this.u_),this.h_>this.l_&&(this.h_=this.l_)}A_(){this.P_!==null&&(this.P_.skipDelay(),this.P_=null)}cancel(){this.P_!==null&&(this.P_.cancel(),this.P_=null)}d_(){return(Math.random()-.5)*this.h_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jb="PersistentStream";class cR{constructor(e,t,r,i,o,a,s,u){this.bi=e,this.R_=r,this.V_=i,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=s,this.listener=u,this.state=0,this.m_=0,this.f_=null,this.g_=null,this.stream=null,this.p_=0,this.y_=new lR(e,t)}w_(){return this.state===1||this.state===5||this.b_()}b_(){return this.state===2||this.state===3}start(){this.p_=0,this.state!==4?this.auth():this.S_()}async stop(){this.w_()&&await this.close(0)}D_(){this.state=0,this.y_.reset()}v_(){this.b_()&&this.f_===null&&(this.f_=this.bi.enqueueAfterDelay(this.R_,6e4,()=>this.C_()))}F_(e){this.M_(),this.stream.send(e)}async C_(){if(this.b_())return this.close(0)}M_(){this.f_&&(this.f_.cancel(),this.f_=null)}x_(){this.g_&&(this.g_.cancel(),this.g_=null)}async close(e,t){this.M_(),this.x_(),this.y_.cancel(),this.m_++,e!==4?this.y_.reset():t&&t.code===ee.RESOURCE_EXHAUSTED?(Vi(t.toString()),Vi("Using maximum backoff delay to prevent overloading the backend."),this.y_.I_()):t&&t.code===ee.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.O_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zo(t)}O_(){}auth(){this.state=1;const e=this.N_(this.m_),t=this.m_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.m_===t&&this.B_(r,i)},r=>{e(()=>{const i=new de(ee.UNKNOWN,"Fetching auth token failed: "+r.message);return this.L_(i)})})}B_(e,t){const r=this.N_(this.m_);this.stream=this.k_(e,t),this.stream.jo(()=>{r(()=>this.listener.jo())}),this.stream.Jo(()=>{r(()=>(this.state=2,this.g_=this.bi.enqueueAfterDelay(this.V_,1e4,()=>(this.b_()&&(this.state=3),Promise.resolve())),this.listener.Jo()))}),this.stream.Zo(i=>{r(()=>this.L_(i))}),this.stream.onMessage(i=>{r(()=>++this.p_==1?this.q_(i):this.onNext(i))})}S_(){this.state=5,this.y_.E_(async()=>{this.state=0,this.start()})}L_(e){return se(Jb,`close with error: ${e}`),this.stream=null,this.close(4,e)}N_(e){return t=>{this.bi.enqueueAndForget(()=>this.m_===e?t():(se(Jb,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class NU extends cR{constructor(e,t,r,i,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}k_(e,t){return this.connection.a_("Listen",e,t)}q_(e){return this.onNext(e)}onNext(e){this.y_.reset();const t=VB(this.serializer,e),r=function(o){if(!("targetChange"in o))return Ce.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?Ce.min():a.readTime?ai(a.readTime):Ce.min()}(e);return this.listener.Q_(t,r)}U_(e){const t={};t.database=qg(this.serializer),t.addTarget=function(o,a){let s;const u=a.target;if(s=jg(u)?{documents:jB(o,u)}:{query:zB(o,u).gt},s.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){s.resumeToken=JS(o,a.resumeToken);const l=$g(o,a.expectedCount);l!==null&&(s.expectedCount=l)}else if(a.snapshotVersion.compareTo(Ce.min())>0){s.readTime=ff(o,a.snapshotVersion.toTimestamp());const l=$g(o,a.expectedCount);l!==null&&(s.expectedCount=l)}return s}(this.serializer,e);const r=$B(this.serializer,e);r&&(t.labels=r),this.F_(t)}K_(e){const t={};t.database=qg(this.serializer),t.removeTarget=e,this.F_(t)}}class DU extends cR{constructor(e,t,r,i,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}get W_(){return this.p_>0}start(){this.lastStreamToken=void 0,super.start()}O_(){this.W_&&this.G_([])}k_(e,t){return this.connection.a_("Write",e,t)}q_(e){return Ge(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Ge(!e.writeResults||e.writeResults.length===0,55816),this.listener.z_()}onNext(e){Ge(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.y_.reset();const t=UB(e.writeResults,e.commitTime),r=ai(e.commitTime);return this.listener.j_(r,t)}H_(){const e={};e.database=qg(this.serializer),this.F_(e)}G_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>BB(this.serializer,r))};this.F_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OU{}class MU extends OU{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.J_=!1}Y_(){if(this.J_)throw new de(ee.FAILED_PRECONDITION,"The client has already been terminated.")}Qo(e,t,r,i){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Qo(e,Hg(t,r),i,o,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===ee.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new de(ee.UNKNOWN,o.toString())})}Wo(e,t,r,i,o){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,s])=>this.connection.Wo(e,Hg(t,r),i,a,s,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===ee.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new de(ee.UNKNOWN,a.toString())})}terminate(){this.J_=!0,this.connection.terminate()}}class FU{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Z_=0,this.X_=null,this.ea=!0}ta(){this.Z_===0&&(this.na("Unknown"),this.X_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.X_=null,this.ra("Backend didn't respond within 10 seconds."),this.na("Offline"),Promise.resolve())))}ia(e){this.state==="Online"?this.na("Unknown"):(this.Z_++,this.Z_>=1&&(this.sa(),this.ra(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.na("Offline")))}set(e){this.sa(),this.Z_=0,e==="Online"&&(this.ea=!1),this.na(e)}na(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ra(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ea?(Vi(t),this.ea=!1):se("OnlineStateTracker",t)}sa(){this.X_!==null&&(this.X_.cancel(),this.X_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ba="RemoteStore";class LU{constructor(e,t,r,i,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.oa=[],this._a=new Map,this.aa=new Set,this.ua=[],this.ca=o,this.ca.vo(a=>{r.enqueueAndForget(async()=>{Xa(this)&&(se(Ba,"Restarting streams for network reachability change."),await async function(u){const l=Re(u);l.aa.add(4),await Fc(l),l.la.set("Unknown"),l.aa.delete(4),await Tp(l)}(this))})}),this.la=new FU(r,i)}}async function Tp(n){if(Xa(n))for(const e of n.ua)await e(!0)}async function Fc(n){for(const e of n.ua)await e(!1)}function hR(n,e){const t=Re(n);t._a.has(e.targetId)||(t._a.set(e.targetId,e),Z0(t)?J0(t):Ru(t).b_()&&Y0(t,e))}function Q0(n,e){const t=Re(n),r=Ru(t);t._a.delete(e),r.b_()&&dR(t,e),t._a.size===0&&(r.b_()?r.v_():Xa(t)&&t.la.set("Unknown"))}function Y0(n,e){if(n.ha.Ke(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ce.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ru(n).U_(e)}function dR(n,e){n.ha.Ke(e),Ru(n).K_(e)}function J0(n){n.ha=new PB({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Rt:e=>n._a.get(e)||null,Pt:()=>n.datastore.serializer.databaseId}),Ru(n).start(),n.la.ta()}function Z0(n){return Xa(n)&&!Ru(n).w_()&&n._a.size>0}function Xa(n){return Re(n).aa.size===0}function fR(n){n.ha=void 0}async function VU(n){n.la.set("Online")}async function BU(n){n._a.forEach((e,t)=>{Y0(n,e)})}async function UU(n,e){fR(n),Z0(n)?(n.la.ia(e),J0(n)):n.la.set("Unknown")}async function jU(n,e,t){if(n.la.set("Online"),e instanceof YS&&e.state===2&&e.cause)try{await async function(i,o){const a=o.cause;for(const s of o.targetIds)i._a.has(s)&&(await i.remoteSyncer.rejectListen(s,a),i._a.delete(s),i.ha.removeTarget(s))}(n,e)}catch(r){se(Ba,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await mf(n,r)}else if(e instanceof md?n.ha.Xe(e):e instanceof QS?n.ha.ot(e):n.ha.nt(e),!t.isEqual(Ce.min()))try{const r=await uR(n.localStore);t.compareTo(r)>=0&&await function(o,a){const s=o.ha.It(a);return s.targetChanges.forEach((u,l)=>{if(u.resumeToken.approximateByteSize()>0){const c=o._a.get(l);c&&o._a.set(l,c.withResumeToken(u.resumeToken,a))}}),s.targetMismatches.forEach((u,l)=>{const c=o._a.get(u);if(!c)return;o._a.set(u,c.withResumeToken(en.EMPTY_BYTE_STRING,c.snapshotVersion)),dR(o,u);const h=new mo(c.target,u,l,c.sequenceNumber);Y0(o,h)}),o.remoteSyncer.applyRemoteEvent(s)}(n,t)}catch(r){se(Ba,"Failed to raise snapshot:",r),await mf(n,r)}}async function mf(n,e,t){if(!Su(e))throw e;n.aa.add(1),await Fc(n),n.la.set("Offline"),t||(t=()=>uR(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{se(Ba,"Retrying IndexedDB access"),await t(),n.aa.delete(1),await Tp(n)})}function pR(n,e){return e().catch(t=>mf(n,t,e))}async function Sp(n){const e=Re(n),t=$o(e);let r=e.oa.length>0?e.oa[e.oa.length-1].batchId:F0;for(;zU(e);)try{const i=await EU(e.localStore,r);if(i===null){e.oa.length===0&&t.v_();break}r=i.batchId,WU(e,i)}catch(i){await mf(e,i)}mR(e)&&vR(e)}function zU(n){return Xa(n)&&n.oa.length<10}function WU(n,e){n.oa.push(e);const t=$o(n);t.b_()&&t.W_&&t.G_(e.mutations)}function mR(n){return Xa(n)&&!$o(n).w_()&&n.oa.length>0}function vR(n){$o(n).start()}async function $U(n){$o(n).H_()}async function HU(n){const e=$o(n);for(const t of n.oa)e.G_(t.mutations)}async function GU(n,e,t){const r=n.oa.shift(),i=W0.from(r,e,t);await pR(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),await Sp(n)}async function qU(n,e){e&&$o(n).W_&&await async function(r,i){if(function(a){return kB(a)&&a!==ee.ABORTED}(i.code)){const o=r.oa.shift();$o(r).D_(),await pR(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i)),await Sp(r)}}(n,e),mR(n)&&vR(n)}async function Zb(n,e){const t=Re(n);t.asyncQueue.verifyOperationInProgress(),se(Ba,"RemoteStore received new credentials");const r=Xa(t);t.aa.add(3),await Fc(t),r&&t.la.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.aa.delete(3),await Tp(t)}async function KU(n,e){const t=Re(n);e?(t.aa.delete(2),await Tp(t)):e||(t.aa.add(2),await Fc(t),t.la.set("Unknown"))}function Ru(n){return n.Pa||(n.Pa=function(t,r,i){const o=Re(t);return o.Y_(),new NU(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(n.datastore,n.asyncQueue,{jo:VU.bind(null,n),Jo:BU.bind(null,n),Zo:UU.bind(null,n),Q_:jU.bind(null,n)}),n.ua.push(async e=>{e?(n.Pa.D_(),Z0(n)?J0(n):n.la.set("Unknown")):(await n.Pa.stop(),fR(n))})),n.Pa}function $o(n){return n.Ta||(n.Ta=function(t,r,i){const o=Re(t);return o.Y_(),new DU(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(n.datastore,n.asyncQueue,{jo:()=>Promise.resolve(),Jo:$U.bind(null,n),Zo:qU.bind(null,n),z_:HU.bind(null,n),j_:GU.bind(null,n)}),n.ua.push(async e=>{e?(n.Ta.D_(),await Sp(n)):(await n.Ta.stop(),n.oa.length>0&&(se(Ba,`Stopping write stream with ${n.oa.length} pending writes`),n.oa=[]))})),n.Ta}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e1{constructor(e,t,r,i,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new No,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,o){const a=Date.now()+r,s=new e1(e,t,a,i,o);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new de(ee.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function t1(n,e){if(Vi("AsyncQueue",`${e}: ${n}`),Su(n))return new de(ee.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ws{static emptySet(e){return new Ws(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||we.comparator(t.key,r.key):(t,r)=>we.comparator(t.key,r.key),this.keyedMap=dl(),this.sortedSet=new ft(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ws)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Ws;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eE{constructor(){this.Ia=new ft(we.comparator)}track(e){const t=e.doc.key,r=this.Ia.get(t);r?e.type!==0&&r.type===3?this.Ia=this.Ia.insert(t,e):e.type===3&&r.type!==1?this.Ia=this.Ia.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.Ia=this.Ia.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.Ia=this.Ia.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.Ia=this.Ia.remove(t):e.type===1&&r.type===2?this.Ia=this.Ia.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.Ia=this.Ia.insert(t,{type:2,doc:e.doc}):be(63341,{Vt:e,Ea:r}):this.Ia=this.Ia.insert(t,e)}da(){const e=[];return this.Ia.inorderTraversal((t,r)=>{e.push(r)}),e}}class du{constructor(e,t,r,i,o,a,s,u,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=s,this.excludesMetadataChanges=u,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,i,o){const a=[];return t.forEach(s=>{a.push({type:0,doc:s})}),new du(e,t,Ws.emptySet(t),a,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&_p(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XU{constructor(){this.Aa=void 0,this.Ra=[]}Va(){return this.Ra.some(e=>e.ma())}}class QU{constructor(){this.queries=tE(),this.onlineState="Unknown",this.fa=new Set}terminate(){(function(t,r){const i=Re(t),o=i.queries;i.queries=tE(),o.forEach((a,s)=>{for(const u of s.Ra)u.onError(r)})})(this,new de(ee.ABORTED,"Firestore shutting down"))}}function tE(){return new qa(n=>LS(n),_p)}async function YU(n,e){const t=Re(n);let r=3;const i=e.query;let o=t.queries.get(i);o?!o.Va()&&e.ma()&&(r=2):(o=new XU,r=e.ma()?0:1);try{switch(r){case 0:o.Aa=await t.onListen(i,!0);break;case 1:o.Aa=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(a){const s=t1(a,`Initialization of query '${ps(e.query)}' failed`);return void e.onError(s)}t.queries.set(i,o),o.Ra.push(e),e.ga(t.onlineState),o.Aa&&e.pa(o.Aa)&&n1(t)}async function JU(n,e){const t=Re(n),r=e.query;let i=3;const o=t.queries.get(r);if(o){const a=o.Ra.indexOf(e);a>=0&&(o.Ra.splice(a,1),o.Ra.length===0?i=e.ma()?0:1:!o.Va()&&e.ma()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function ZU(n,e){const t=Re(n);let r=!1;for(const i of e){const o=i.query,a=t.queries.get(o);if(a){for(const s of a.Ra)s.pa(i)&&(r=!0);a.Aa=i}}r&&n1(t)}function e6(n,e,t){const r=Re(n),i=r.queries.get(e);if(i)for(const o of i.Ra)o.onError(t);r.queries.delete(e)}function n1(n){n.fa.forEach(e=>{e.next()})}var Qg,nE;(nE=Qg||(Qg={})).ya="default",nE.Cache="cache";class t6{constructor(e,t,r){this.query=e,this.wa=t,this.ba=!1,this.Sa=null,this.onlineState="Unknown",this.options=r||{}}pa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new du(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ba?this.Da(e)&&(this.wa.next(e),t=!0):this.va(e,this.onlineState)&&(this.Ca(e),t=!0),this.Sa=e,t}onError(e){this.wa.error(e)}ga(e){this.onlineState=e;let t=!1;return this.Sa&&!this.ba&&this.va(this.Sa,e)&&(this.Ca(this.Sa),t=!0),t}va(e,t){if(!e.fromCache||!this.ma())return!0;const r=t!=="Offline";return(!this.options.Fa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Da(e){if(e.docChanges.length>0)return!0;const t=this.Sa&&this.Sa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}Ca(e){e=du.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ba=!0,this.wa.next(e)}ma(){return this.options.source!==Qg.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{constructor(e){this.key=e}}class yR{constructor(e){this.key=e}}class n6{constructor(e,t){this.query=e,this.qa=t,this.Qa=null,this.hasCachedResults=!1,this.current=!1,this.$a=Ve(),this.mutatedKeys=Ve(),this.Ua=VS(e),this.Ka=new Ws(this.Ua)}get Wa(){return this.qa}Ga(e,t){const r=t?t.za:new eE,i=t?t.Ka:this.Ka;let o=t?t.mutatedKeys:this.mutatedKeys,a=i,s=!1;const u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,l=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((c,h)=>{const d=i.get(c),p=xp(this.query,h)?h:null,m=!!d&&this.mutatedKeys.has(d.key),g=!!p&&(p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations);let y=!1;d&&p?d.data.isEqual(p.data)?m!==g&&(r.track({type:3,doc:p}),y=!0):this.ja(d,p)||(r.track({type:2,doc:p}),y=!0,(u&&this.Ua(p,u)>0||l&&this.Ua(p,l)<0)&&(s=!0)):!d&&p?(r.track({type:0,doc:p}),y=!0):d&&!p&&(r.track({type:1,doc:d}),y=!0,(u||l)&&(s=!0)),y&&(p?(a=a.add(p),o=g?o.add(c):o.delete(c)):(a=a.delete(c),o=o.delete(c)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const c=this.query.limitType==="F"?a.last():a.first();a=a.delete(c.key),o=o.delete(c.key),r.track({type:1,doc:c})}return{Ka:a,za:r,ys:s,mutatedKeys:o}}ja(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const o=this.Ka;this.Ka=e.Ka,this.mutatedKeys=e.mutatedKeys;const a=e.za.da();a.sort((c,h)=>function(p,m){const g=y=>{switch(y){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return be(20277,{Vt:y})}};return g(p)-g(m)}(c.type,h.type)||this.Ua(c.doc,h.doc)),this.Ha(r),i=i!=null&&i;const s=t&&!i?this.Ja():[],u=this.$a.size===0&&this.current&&!i?1:0,l=u!==this.Qa;return this.Qa=u,a.length!==0||l?{snapshot:new du(this.query,e.Ka,o,a,e.mutatedKeys,u===0,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ya:s}:{Ya:s}}ga(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ka:this.Ka,za:new eE,mutatedKeys:this.mutatedKeys,ys:!1},!1)):{Ya:[]}}Za(e){return!this.qa.has(e)&&!!this.Ka.has(e)&&!this.Ka.get(e).hasLocalMutations}Ha(e){e&&(e.addedDocuments.forEach(t=>this.qa=this.qa.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.qa=this.qa.delete(t)),this.current=e.current)}Ja(){if(!this.current)return[];const e=this.$a;this.$a=Ve(),this.Ka.forEach(r=>{this.Za(r.key)&&(this.$a=this.$a.add(r.key))});const t=[];return e.forEach(r=>{this.$a.has(r)||t.push(new yR(r))}),this.$a.forEach(r=>{e.has(r)||t.push(new gR(r))}),t}Xa(e){this.qa=e.Ns,this.$a=Ve();const t=this.Ga(e.documents);return this.applyChanges(t,!0)}eu(){return du.fromInitialDocuments(this.query,this.Ka,this.mutatedKeys,this.Qa===0,this.hasCachedResults)}}const r1="SyncEngine";class r6{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class i6{constructor(e){this.key=e,this.tu=!1}}class o6{constructor(e,t,r,i,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.nu={},this.ru=new qa(s=>LS(s),_p),this.iu=new Map,this.su=new Set,this.ou=new ft(we.comparator),this._u=new Map,this.au=new G0,this.uu={},this.cu=new Map,this.lu=hu.ir(),this.onlineState="Unknown",this.hu=void 0}get isPrimaryClient(){return this.hu===!0}}async function a6(n,e,t=!0){const r=CR(n);let i;const o=r.ru.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.eu()):i=await wR(r,e,t,!0),i}async function s6(n,e){const t=CR(n);await wR(t,e,!0,!1)}async function wR(n,e,t,r){const i=await CU(n.localStore,ii(e)),o=i.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t);let s;return r&&(s=await u6(n,e,o,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&hR(n.remoteStore,i),s}async function u6(n,e,t,r,i){n.Pu=(h,d,p)=>async function(g,y,v,w){let _=y.view.Ga(v);_.ys&&(_=await Kb(g.localStore,y.query,!1).then(({documents:T})=>y.view.Ga(T,_)));const x=w&&w.targetChanges.get(y.targetId),C=w&&w.targetMismatches.get(y.targetId)!=null,A=y.view.applyChanges(_,g.isPrimaryClient,x,C);return iE(g,y.targetId,A.Ya),A.snapshot}(n,h,d,p);const o=await Kb(n.localStore,e,!0),a=new n6(e,o.Ns),s=a.Ga(o.documents),u=Mc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),l=a.applyChanges(s,n.isPrimaryClient,u);iE(n,t,l.Ya);const c=new r6(e,t,a);return n.ru.set(e,c),n.iu.has(t)?n.iu.get(t).push(e):n.iu.set(t,[e]),l.snapshot}async function l6(n,e,t){const r=Re(n),i=r.ru.get(e),o=r.iu.get(i.targetId);if(o.length>1)return r.iu.set(i.targetId,o.filter(a=>!_p(a,e))),void r.ru.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Kg(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Q0(r.remoteStore,i.targetId),Yg(r,i.targetId)}).catch(Tu)):(Yg(r,i.targetId),await Kg(r.localStore,i.targetId,!0))}async function c6(n,e){const t=Re(n),r=t.ru.get(e),i=t.iu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Q0(t.remoteStore,r.targetId))}async function h6(n,e,t){const r=y6(n);try{const i=await function(a,s){const u=Re(a),l=Pt.now(),c=s.reduce((p,m)=>p.add(m.key),Ve());let h,d;return u.persistence.runTransaction("Locally write mutations","readwrite",p=>{let m=Bi(),g=Ve();return u.Cs.getEntries(p,c).next(y=>{m=y,m.forEach((v,w)=>{w.isValidDocument()||(g=g.add(v))})}).next(()=>u.localDocuments.getOverlayedDocuments(p,m)).next(y=>{h=y;const v=[];for(const w of s){const _=CB(w,h.get(w.key).overlayedDocument);_!=null&&v.push(new Ka(w.key,_,RS(_.value.mapValue),oi.exists(!0)))}return u.mutationQueue.addMutationBatch(p,l,v,s)}).next(y=>{d=y;const v=y.applyToLocalDocumentSet(h,g);return u.documentOverlayCache.saveOverlays(p,y.batchId,v)})}).then(()=>({batchId:d.batchId,changes:US(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(a,s,u){let l=a.uu[a.currentUser.toKey()];l||(l=new ft(Pe)),l=l.insert(s,u),a.uu[a.currentUser.toKey()]=l}(r,i.batchId,t),await Lc(r,i.changes),await Sp(r.remoteStore)}catch(i){const o=t1(i,"Failed to persist write");t.reject(o)}}async function _R(n,e){const t=Re(n);try{const r=await xU(t.localStore,e);e.targetChanges.forEach((i,o)=>{const a=t._u.get(o);a&&(Ge(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.tu=!0:i.modifiedDocuments.size>0?Ge(a.tu,14607):i.removedDocuments.size>0&&(Ge(a.tu,42227),a.tu=!1))}),await Lc(t,r,e)}catch(r){await Tu(r)}}function rE(n,e,t){const r=Re(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const i=[];r.ru.forEach((o,a)=>{const s=a.view.ga(e);s.snapshot&&i.push(s.snapshot)}),function(a,s){const u=Re(a);u.onlineState=s;let l=!1;u.queries.forEach((c,h)=>{for(const d of h.Ra)d.ga(s)&&(l=!0)}),l&&n1(u)}(r.eventManager,e),i.length&&r.nu.Q_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function d6(n,e,t){const r=Re(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r._u.get(e),o=i&&i.key;if(o){let a=new ft(we.comparator);a=a.insert(o,hn.newNoDocument(o,Ce.min()));const s=Ve().add(o),u=new Cp(Ce.min(),new Map,new ft(Pe),a,s);await _R(r,u),r.ou=r.ou.remove(o),r._u.delete(e),i1(r)}else await Kg(r.localStore,e,!1).then(()=>Yg(r,e,t)).catch(Tu)}async function f6(n,e){const t=Re(n),r=e.batch.batchId;try{const i=await _U(t.localStore,e);bR(t,r,null),xR(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Lc(t,i)}catch(i){await Tu(i)}}async function p6(n,e,t){const r=Re(n);try{const i=await function(a,s){const u=Re(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let c;return u.mutationQueue.lookupMutationBatch(l,s).next(h=>(Ge(h!==null,37113),c=h.keys(),u.mutationQueue.removeMutationBatch(l,h))).next(()=>u.mutationQueue.performConsistencyCheck(l)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(l,c,s)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,c)).next(()=>u.localDocuments.getDocuments(l,c))})}(r.localStore,e);bR(r,e,t),xR(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Lc(r,i)}catch(i){await Tu(i)}}function xR(n,e){(n.cu.get(e)||[]).forEach(t=>{t.resolve()}),n.cu.delete(e)}function bR(n,e,t){const r=Re(n);let i=r.uu[r.currentUser.toKey()];if(i){const o=i.get(e);o&&(t?o.reject(t):o.resolve(),i=i.remove(e)),r.uu[r.currentUser.toKey()]=i}}function Yg(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.iu.get(e))n.ru.delete(r),t&&n.nu.Tu(r,t);n.iu.delete(e),n.isPrimaryClient&&n.au.Ur(e).forEach(r=>{n.au.containsKey(r)||ER(n,r)})}function ER(n,e){n.su.delete(e.path.canonicalString());const t=n.ou.get(e);t!==null&&(Q0(n.remoteStore,t),n.ou=n.ou.remove(e),n._u.delete(t),i1(n))}function iE(n,e,t){for(const r of t)r instanceof gR?(n.au.addReference(r.key,e),m6(n,r)):r instanceof yR?(se(r1,"Document no longer in limbo: "+r.key),n.au.removeReference(r.key,e),n.au.containsKey(r.key)||ER(n,r.key)):be(19791,{Iu:r})}function m6(n,e){const t=e.key,r=t.path.canonicalString();n.ou.get(t)||n.su.has(r)||(se(r1,"New document in limbo: "+t),n.su.add(r),i1(n))}function i1(n){for(;n.su.size>0&&n.ou.size<n.maxConcurrentLimboResolutions;){const e=n.su.values().next().value;n.su.delete(e);const t=new we(ot.fromString(e)),r=n.lu.next();n._u.set(r,new i6(t)),n.ou=n.ou.insert(t,r),hR(n.remoteStore,new mo(ii(MS(t.path)),r,"TargetPurposeLimboResolution",gp.le))}}async function Lc(n,e,t){const r=Re(n),i=[],o=[],a=[];r.ru.isEmpty()||(r.ru.forEach((s,u)=>{a.push(r.Pu(u,e,t).then(l=>{var c;if((l||t)&&r.isPrimaryClient){const h=l?!l.fromCache:(c=t==null?void 0:t.targetChanges.get(u.targetId))===null||c===void 0?void 0:c.current;r.sharedClientState.updateQueryState(u.targetId,h?"current":"not-current")}if(l){i.push(l);const h=K0.Ps(u.targetId,l);o.push(h)}}))}),await Promise.all(a),r.nu.Q_(i),await async function(u,l){const c=Re(u);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>J.forEach(l,d=>J.forEach(d.ls,p=>c.persistence.referenceDelegate.addReference(h,d.targetId,p)).next(()=>J.forEach(d.hs,p=>c.persistence.referenceDelegate.removeReference(h,d.targetId,p)))))}catch(h){if(!Su(h))throw h;se(X0,"Failed to update sequence numbers: "+h)}for(const h of l){const d=h.targetId;if(!h.fromCache){const p=c.Ss.get(d),m=p.snapshotVersion,g=p.withLastLimboFreeSnapshotVersion(m);c.Ss=c.Ss.insert(d,g)}}}(r.localStore,o))}async function v6(n,e){const t=Re(n);if(!t.currentUser.isEqual(e)){se(r1,"User change. New user:",e.toKey());const r=await sR(t.localStore,e);t.currentUser=e,function(o,a){o.cu.forEach(s=>{s.forEach(u=>{u.reject(new de(ee.CANCELLED,a))})}),o.cu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Lc(t,r.Ms)}}function g6(n,e){const t=Re(n),r=t._u.get(e);if(r&&r.tu)return Ve().add(r.key);{let i=Ve();const o=t.iu.get(e);if(!o)return i;for(const a of o){const s=t.ru.get(a);i=i.unionWith(s.view.Wa)}return i}}function CR(n){const e=Re(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=_R.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=g6.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=d6.bind(null,e),e.nu.Q_=ZU.bind(null,e.eventManager),e.nu.Tu=e6.bind(null,e.eventManager),e}function y6(n){const e=Re(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=f6.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=p6.bind(null,e),e}class vf{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Ip(e.databaseInfo.databaseId),this.sharedClientState=this.Au(e),this.persistence=this.Ru(e),await this.persistence.start(),this.localStore=this.Vu(e),this.gcScheduler=this.mu(e,this.localStore),this.indexBackfillerScheduler=this.fu(e,this.localStore)}mu(e,t){return null}fu(e,t){return null}Vu(e){return wU(this.persistence,new vU,e.initialUser,this.serializer)}Ru(e){return new aR(q0.Ei,this.serializer)}Au(e){return new TU}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}vf.provider={build:()=>new vf};class w6 extends vf{constructor(e){super(),this.cacheSizeBytes=e}mu(e,t){Ge(this.persistence.referenceDelegate instanceof pf,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new tU(r,e.asyncQueue,t)}Ru(e){const t=this.cacheSizeBytes!==void 0?Sn.withCacheSize(this.cacheSizeBytes):Sn.DEFAULT;return new aR(r=>pf.Ei(r,t),this.serializer)}}class Jg{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>rE(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=v6.bind(null,this.syncEngine),await KU(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new QU}()}createDatastore(e){const t=Ip(e.databaseInfo.databaseId),r=function(o){return new PU(o)}(e.databaseInfo);return function(o,a,s,u){return new MU(o,a,s,u)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,o,a,s){return new LU(r,i,o,a,s)}(this.localStore,this.datastore,e.asyncQueue,t=>rE(this.syncEngine,t,0),function(){return Yb.C()?new Yb:new SU}())}createSyncEngine(e,t){return function(i,o,a,s,u,l,c){const h=new o6(i,o,a,s,u,l);return c&&(h.hu=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(i){const o=Re(i);se(Ba,"RemoteStore shutting down."),o.aa.add(5),await Fc(o),o.ca.shutdown(),o.la.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Jg.provider={build:()=>new Jg};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _6{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.pu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.pu(this.observer.error,e):Vi("Uncaught Error in snapshot listener:",e.toString()))}yu(){this.muted=!0}pu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ho="FirestoreClient";class x6{constructor(e,t,r,i,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=un.UNAUTHENTICATED,this.clientId=gS.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,async a=>{se(Ho,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(se(Ho,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new No;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=t1(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Qm(n,e){n.asyncQueue.verifyOperationInProgress(),se(Ho,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async i=>{r.isEqual(i)||(await sR(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function oE(n,e){n.asyncQueue.verifyOperationInProgress();const t=await b6(n);se(Ho,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Zb(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Zb(e.remoteStore,i)),n._onlineComponents=e}async function b6(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){se(Ho,"Using user provided OfflineComponentProvider");try{await Qm(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(i){return i.name==="FirebaseError"?i.code===ee.FAILED_PRECONDITION||i.code===ee.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;su("Error using user provided cache. Falling back to memory cache: "+t),await Qm(n,new vf)}}else se(Ho,"Using default OfflineComponentProvider"),await Qm(n,new w6(void 0));return n._offlineComponents}async function IR(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(se(Ho,"Using user provided OnlineComponentProvider"),await oE(n,n._uninitializedComponentsProvider._online)):(se(Ho,"Using default OnlineComponentProvider"),await oE(n,new Jg))),n._onlineComponents}function E6(n){return IR(n).then(e=>e.syncEngine)}async function C6(n){const e=await IR(n),t=e.eventManager;return t.onListen=a6.bind(null,e.syncEngine),t.onUnlisten=l6.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=s6.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=c6.bind(null,e.syncEngine),t}function I6(n,e,t={}){const r=new No;return n.asyncQueue.enqueueAndForget(async()=>function(o,a,s,u,l){const c=new _6({next:d=>{c.yu(),a.enqueueAndForget(()=>JU(o,h)),d.fromCache&&u.source==="server"?l.reject(new de(ee.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(d)},error:d=>l.reject(d)}),h=new t6(s,c,{includeMetadataChanges:!0,Fa:!0});return YU(o,h)}(await C6(n),n.asyncQueue,e,t,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TR(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aE=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SR(n,e,t){if(!t)throw new de(ee.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function T6(n,e,t,r){if(e===!0&&r===!0)throw new de(ee.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function sE(n){if(!we.isDocumentKey(n))throw new de(ee.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function uE(n){if(we.isDocumentKey(n))throw new de(ee.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Rp(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":be(12329,{type:typeof n})}function lc(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new de(ee.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Rp(n);throw new de(ee.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RR="firestore.googleapis.com",lE=!0;class cE{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new de(ee.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=RR,this.ssl=lE}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:lE;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=oR;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<ZB)throw new de(ee.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}T6("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=TR((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new de(ee.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new de(ee.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new de(ee.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class kp{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new cE({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new de(ee.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new de(ee.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new cE(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new AV;switch(r.type){case"firstParty":return new OV(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new de(ee.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=aE.get(t);r&&(se("ComponentProvider","Removing Datastore"),aE.delete(t),r.terminate())}(this),Promise.resolve()}}function S6(n,e,t,r={}){var i;const o=(n=lc(n,kp))._getSettings(),a=Object.assign(Object.assign({},o),{emulatorOptions:n._getEmulatorOptions()}),s=`${e}:${t}`;o.host!==RR&&o.host!==s&&su("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u=Object.assign(Object.assign({},o),{host:s,ssl:!1,emulatorOptions:r});if(!Oa(u,a)&&(n._setSettings(u),r.mockUserToken)){let l,c;if(typeof r.mockUserToken=="string")l=r.mockUserToken,c=un.MOCK_USER;else{l=UO(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);const h=r.mockUserToken.sub||r.mockUserToken.user_id;if(!h)throw new de(ee.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new un(h)}n._authCredentials=new PV(new mS(l,c))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ku{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new ku(this.firestore,e,this._query)}}class gr{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Do(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new gr(this.firestore,e,this._key)}}class Do extends ku{constructor(e,t,r){super(e,t,MS(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new gr(this.firestore,null,new we(e))}withConverter(e){return new Do(this.firestore,e,this._path)}}function Ar(n,e,...t){if(n=Ln(n),SR("collection","path",e),n instanceof kp){const r=ot.fromString(e,...t);return uE(r),new Do(n,null,r)}{if(!(n instanceof gr||n instanceof Do))throw new de(ee.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ot.fromString(e,...t));return uE(r),new Do(n.firestore,null,r)}}function gf(n,e,...t){if(n=Ln(n),arguments.length===1&&(e=gS.newId()),SR("doc","path",e),n instanceof kp){const r=ot.fromString(e,...t);return sE(r),new gr(n,null,new we(r))}{if(!(n instanceof gr||n instanceof Do))throw new de(ee.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ot.fromString(e,...t));return sE(r),new gr(n.firestore,n instanceof Do?n.converter:null,new we(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hE="AsyncQueue";class dE{constructor(e=Promise.resolve()){this.Qu=[],this.$u=!1,this.Uu=[],this.Ku=null,this.Wu=!1,this.Gu=!1,this.zu=[],this.y_=new lR(this,"async_queue_retry"),this.ju=()=>{const r=Xm();r&&se(hE,"Visibility state changed to "+r.visibilityState),this.y_.A_()},this.Hu=e;const t=Xm();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.ju)}get isShuttingDown(){return this.$u}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Ju(),this.Yu(e)}enterRestrictedMode(e){if(!this.$u){this.$u=!0,this.Gu=e||!1;const t=Xm();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.ju)}}enqueue(e){if(this.Ju(),this.$u)return new Promise(()=>{});const t=new No;return this.Yu(()=>this.$u&&this.Gu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Qu.push(e),this.Zu()))}async Zu(){if(this.Qu.length!==0){try{await this.Qu[0](),this.Qu.shift(),this.y_.reset()}catch(e){if(!Su(e))throw e;se(hE,"Operation failed with retryable error: "+e)}this.Qu.length>0&&this.y_.E_(()=>this.Zu())}}Yu(e){const t=this.Hu.then(()=>(this.Wu=!0,e().catch(r=>{throw this.Ku=r,this.Wu=!1,Vi("INTERNAL UNHANDLED ERROR: ",fE(r)),r}).then(r=>(this.Wu=!1,r))));return this.Hu=t,t}enqueueAfterDelay(e,t,r){this.Ju(),this.zu.indexOf(e)>-1&&(t=0);const i=e1.createAndSchedule(this,e,t,r,o=>this.Xu(o));return this.Uu.push(i),i}Ju(){this.Ku&&be(47125,{ec:fE(this.Ku)})}verifyOperationInProgress(){}async tc(){let e;do e=this.Hu,await e;while(e!==this.Hu)}nc(e){for(const t of this.Uu)if(t.timerId===e)return!0;return!1}rc(e){return this.tc().then(()=>{this.Uu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Uu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.tc()})}sc(e){this.zu.push(e)}Xu(e){const t=this.Uu.indexOf(e);this.Uu.splice(t,1)}}function fE(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class Ap extends kp{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new dE,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new dE(e),this._firestoreClient=void 0,await e}}}function R6(n,e){const t=typeof n=="object"?n:CT(),r=typeof n=="string"?n:uf,i=I0(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const o=VO("firestore");o&&S6(i,...o)}return i}function kR(n){if(n._terminated)throw new de(ee.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||k6(n),n._firestoreClient}function k6(n){var e,t,r;const i=n._freezeSettings(),o=function(s,u,l,c){return new XV(s,u,l,c.host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,TR(c.experimentalLongPollingOptions),c.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new x6(n._authCredentials,n._appCheckCredentials,n._queue,o,n._componentsProvider&&function(s){const u=s==null?void 0:s._online.build();return{_offline:s==null?void 0:s._offline.build(u),_online:u}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fu{constructor(e){this._byteString=e}static fromBase64String(e){try{return new fu(en.fromBase64String(e))}catch(t){throw new de(ee.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new fu(en.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o1{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new de(ee.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Yt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a1{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s1{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new de(ee.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new de(ee.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Pe(this._lat,e._lat)||Pe(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u1{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A6=/^__.*__$/;class P6{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Ka(e,this.data,this.fieldMask,t,this.fieldTransforms):new Oc(e,this.data,t,this.fieldTransforms)}}function AR(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw be(40011,{oc:n})}}class l1{constructor(e,t,r,i,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this._c(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get oc(){return this.settings.oc}ac(e){return new l1(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}uc(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.ac({path:r,cc:!1});return i.lc(e),i}hc(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.ac({path:r,cc:!1});return i._c(),i}Pc(e){return this.ac({path:void 0,cc:!0})}Tc(e){return yf(e,this.settings.methodName,this.settings.Ic||!1,this.path,this.settings.Ec)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}_c(){if(this.path)for(let e=0;e<this.path.length;e++)this.lc(this.path.get(e))}lc(e){if(e.length===0)throw this.Tc("Document fields must not be empty");if(AR(this.oc)&&A6.test(e))throw this.Tc('Document fields cannot begin and end with "__"')}}class N6{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Ip(e)}dc(e,t,r,i=!1){return new l1({oc:e,methodName:t,Ec:r,path:Yt.emptyPath(),cc:!1,Ic:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function PR(n){const e=n._freezeSettings(),t=Ip(n._databaseId);return new N6(n._databaseId,!!e.ignoreUndefinedProperties,t)}function D6(n,e,t,r,i,o={}){const a=n.dc(o.merge||o.mergeFields?2:0,e,t,i);OR("Data must be an object, but it was:",a,r);const s=NR(r,a);let u,l;if(o.merge)u=new kr(a.fieldMask),l=a.fieldTransforms;else if(o.mergeFields){const c=[];for(const h of o.mergeFields){const d=M6(e,h,t);if(!a.contains(d))throw new de(ee.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);L6(c,d)||c.push(d)}u=new kr(c),l=a.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,l=a.fieldTransforms;return new P6(new hr(s),u,l)}class c1 extends a1{_toFieldTransform(e){return new _B(e.path,new ac)}isEqual(e){return e instanceof c1}}function O6(n,e,t,r=!1){return h1(t,n.dc(r?4:3,e))}function h1(n,e){if(DR(n=Ln(n)))return OR("Unsupported field value:",e,n),NR(n,e);if(n instanceof a1)return function(r,i){if(!AR(i.oc))throw i.Tc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Tc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.cc&&e.oc!==4)throw e.Tc("Nested arrays are not supported");return function(r,i){const o=[];let a=0;for(const s of r){let u=h1(s,i.Pc(a));u==null&&(u={nullValue:"NULL_VALUE"}),o.push(u),a++}return{arrayValue:{values:o}}}(n,e)}return function(r,i){if((r=Ln(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return gB(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Pt.fromDate(r);return{timestampValue:ff(i.serializer,o)}}if(r instanceof Pt){const o=new Pt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:ff(i.serializer,o)}}if(r instanceof s1)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof fu)return{bytesValue:JS(i.serializer,r._byteString)};if(r instanceof gr){const o=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw i.Tc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:H0(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof u1)return function(a,s){return{mapValue:{fields:{[IS]:{stringValue:SS},[lf]:{arrayValue:{values:a.toArray().map(l=>{if(typeof l!="number")throw s.Tc("VectorValues must only contain numeric values.");return j0(s.serializer,l)})}}}}}}(r,i);throw i.Tc(`Unsupported field value: ${Rp(r)}`)}(n,e)}function NR(n,e){const t={};return wS(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ga(n,(r,i)=>{const o=h1(i,e.uc(r));o!=null&&(t[r]=o)}),{mapValue:{fields:t}}}function DR(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Pt||n instanceof s1||n instanceof fu||n instanceof gr||n instanceof a1||n instanceof u1)}function OR(n,e,t){if(!DR(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){const r=Rp(t);throw r==="an object"?e.Tc(n+" a custom object"):e.Tc(n+" "+r)}}function M6(n,e,t){if((e=Ln(e))instanceof o1)return e._internalPath;if(typeof e=="string")return MR(n,e);throw yf("Field path arguments must be of type string or ",n,!1,void 0,t)}const F6=new RegExp("[~\\*/\\[\\]]");function MR(n,e,t){if(e.search(F6)>=0)throw yf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new o1(...e.split("."))._internalPath}catch{throw yf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function yf(n,e,t,r,i){const o=r&&!r.isEmpty(),a=i!==void 0;let s=`Function ${e}() called with invalid data`;t&&(s+=" (via `toFirestore()`)"),s+=". ";let u="";return(o||a)&&(u+=" (found",o&&(u+=` in field ${r}`),a&&(u+=` in document ${i}`),u+=")"),new de(ee.INVALID_ARGUMENT,s+n+u)}function L6(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FR{constructor(e,t,r,i,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new gr(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new V6(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(d1("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class V6 extends FR{data(){return super.data()}}function d1(n,e){return typeof e=="string"?MR(n,e):e instanceof o1?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B6(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new de(ee.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class f1{}class U6 extends f1{}function Ca(n,e,...t){let r=[];e instanceof f1&&r.push(e),r=r.concat(t),function(o){const a=o.filter(u=>u instanceof p1).length,s=o.filter(u=>u instanceof Pp).length;if(a>1||a>0&&s>0)throw new de(ee.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class Pp extends U6{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Pp(e,t,r)}_apply(e){const t=this._parse(e);return LR(e._query,t),new ku(e.firestore,e.converter,zg(e._query,t))}_parse(e){const t=PR(e.firestore);return function(o,a,s,u,l,c,h){let d;if(l.isKeyField()){if(c==="array-contains"||c==="array-contains-any")throw new de(ee.INVALID_ARGUMENT,`Invalid Query. You can't perform '${c}' queries on documentId().`);if(c==="in"||c==="not-in"){mE(h,c);const m=[];for(const g of h)m.push(pE(u,o,g));d={arrayValue:{values:m}}}else d=pE(u,o,h)}else c!=="in"&&c!=="not-in"&&c!=="array-contains-any"||mE(h,c),d=O6(s,a,h,c==="in"||c==="not-in");return It.create(l,c,d)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function vo(n,e,t){const r=e,i=d1("where",n);return Pp._create(i,r,t)}class p1 extends f1{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new p1(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Vr.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(i,o){let a=i;const s=o.getFlattenedFilters();for(const u of s)LR(a,u),a=zg(a,u)}(e._query,t),new ku(e.firestore,e.converter,zg(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function pE(n,e,t){if(typeof(t=Ln(t))=="string"){if(t==="")throw new de(ee.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!FS(e)&&t.indexOf("/")!==-1)throw new de(ee.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(ot.fromString(t));if(!we.isDocumentKey(r))throw new de(ee.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return kb(n,new we(r))}if(t instanceof gr)return kb(n,t._key);throw new de(ee.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Rp(t)}.`)}function mE(n,e){if(!Array.isArray(n)||n.length===0)throw new de(ee.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function LR(n,e){const t=function(i,o){for(const a of i)for(const s of a.getFlattenedFilters())if(o.indexOf(s.op)>=0)return s.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new de(ee.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new de(ee.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class j6{convertValue(e,t="none"){switch(Wo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return wt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(zo(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw be(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Ga(e,(i,o)=>{r[i]=this.convertValue(o,t)}),r}convertVectorValue(e){var t,r,i;const o=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[lf].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(a=>wt(a.doubleValue));return new u1(o)}convertGeoPoint(e){return new s1(wt(e.latitude),wt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=wp(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(rc(e));default:return null}}convertTimestamp(e){const t=jo(e);return new Pt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ot.fromString(e);Ge(iR(r),9688,{name:e});const i=new ic(r.get(1),r.get(3)),o=new we(r.popFirst(5));return i.isEqual(t)||Vi(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z6(n,e,t){let r;return r=n?n.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oh{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class W6 extends FR{constructor(e,t,r,i,o,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new vd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(d1("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class vd extends W6{data(e={}){return super.data(e)}}class $6{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Oh(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new vd(this._firestore,this._userDataWriter,r.key,r,new Oh(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new de(ee.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,o){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(s=>{const u=new vd(i._firestore,i._userDataWriter,s.doc.key,s.doc,new Oh(i._snapshot.mutatedKeys.has(s.doc.key),i._snapshot.fromCache),i.query.converter);return s.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(s=>o||s.type!==3).map(s=>{const u=new vd(i._firestore,i._userDataWriter,s.doc.key,s.doc,new Oh(i._snapshot.mutatedKeys.has(s.doc.key),i._snapshot.fromCache),i.query.converter);let l=-1,c=-1;return s.type!==0&&(l=a.indexOf(s.doc.key),a=a.delete(s.doc.key)),s.type!==1&&(a=a.add(s.doc),c=a.indexOf(s.doc.key)),{type:H6(s.type),doc:u,oldIndex:l,newIndex:c}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function H6(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return be(61501,{type:n})}}class G6 extends j6{constructor(e){super(),this.firestore=e}convertBytes(e){return new fu(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new gr(this.firestore,null,t)}}function Ia(n){n=lc(n,ku);const e=lc(n.firestore,Ap),t=kR(e),r=new G6(e);return B6(n._query),I6(t,n._query).then(i=>new $6(e,r,n,i))}function wf(n){return VR(lc(n.firestore,Ap),[new z0(n._key,oi.none())])}function _f(n,e){const t=lc(n.firestore,Ap),r=gf(n),i=z6(n.converter,e);return VR(t,[D6(PR(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,oi.exists(!1))]).then(()=>r)}function VR(n,e){return function(r,i){const o=new No;return r.asyncQueue.enqueueAndForget(async()=>h6(await E6(r),i,o)),o.promise}(kR(n),e)}function BR(){return new c1("serverTimestamp")}(function(e,t=!0){(function(i){Iu=i})(Eu),au(new Ma("firestore",(r,{instanceIdentifier:i,options:o})=>{const a=r.getProvider("app").getImmediate(),s=new Ap(new NV(r.getProvider("auth-internal")),new MV(a,r.getProvider("app-check-internal")),function(l,c){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new de(ee.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ic(l.options.projectId,c)}(a,i),a);return o=Object.assign({useFetchStreams:t},o),s._setSettings(o),s},"PUBLIC").setMultipleInstances(!0)),Ao(gb,yb,e),Ao(gb,yb,"esm2017")})();const q6={apiKey:"AIzaSyBxyvvdKgYgSJ5p9E5zIERpV0EMOwot7Pg",authDomain:"facedetect-f064e.firebaseapp.com",projectId:"facedetect-f064e",storageBucket:"facedetect-f064e.firebasestorage.app",messagingSenderId:"40586135061",appId:"1:40586135061:web:c24b7c8c5b39bc1033701c"},UR=ET(q6),xf=sS(UR),kn=R6(UR),K6=()=>{const[n,e]=Q.useState([]),[t,r]=Q.useState([]),[i,o]=Q.useState(0),[a,s]=Q.useState("purple"),[u,l]=Q.useState([]),[c,h]=Q.useState([]);Ec(k=>k.auth);const[d,p]=Q.useState(null),[m,g]=Q.useState(""),[y,v]=Q.useState(!0);Q.useEffect(()=>{const k=yL(xf,j=>{p(j),v(!1)});return()=>k()},[]),Q.useEffect(()=>{fetch("/Api.json").then(k=>k.json()).then(k=>e(k)).catch(k=>console.error("Error fetching anime data:",k)),fetch("/Api2.json").then(k=>k.json()).then(k=>r(k)).catch(k=>console.error("Error fetching Api2 data:",k)),d&&(w(),_())},[d]);const w=async()=>{if(d)try{v(!0);const k=Ca(Ar(kn,"favorite"),vo("email","==",d.email)),j=await Ia(k),B=[];j.forEach(W=>{B.push({id:W.id,...W.data()})}),l(B)}catch(k){console.error("Error fetching favorites:",k),g("Error loading favorites. Please try again later."),setTimeout(()=>g(""),3e3)}finally{v(!1)}},_=async()=>{if(d)try{v(!0);const k=Ca(Ar(kn,"favoriteBook"),vo("email","==",d.email)),j=await Ia(k),B=[];j.forEach(W=>{B.push({id:W.id,...W.data()})}),h(B)}catch(k){console.error("Error fetching favorite books:",k),g("Error loading favorite books. Please try again later."),setTimeout(()=>g(""),3e3)}finally{v(!1)}};Q.useEffect(()=>{const k=setInterval(()=>{x()},1e4);return()=>clearInterval(k)},[i,n]);const x=()=>{o(k=>k+1>=Math.ceil(n.length/3)?0:k+1)},C=()=>{o(k=>k-1<0?Math.ceil(n.length/3)-1:k-1)},A=k=>{const j=[];for(let B=0;B<k.length;B+=3)j.push(k.slice(B,B+3));return j},T=()=>{s(a==="purple"?"blue":a==="blue"?"grey":a==="grey"?"red":a==="red"?"green":"purple")},E=k=>u.some(j=>j.originalId===k),I=k=>c.some(j=>j.originalId===k),S=async k=>{if(!d){g("Please login to add favorites"),setTimeout(()=>g(""),3e3);return}if(E(k.id)){const B=u.find(W=>W.originalId===k.id);if(B)try{await wf(gf(kn,"favorite",B.id)),l(W=>W.filter(X=>X.id!==B.id)),g("Removed from favorites!"),setTimeout(()=>g(""),3e3)}catch(W){console.error("Error removing favorite:",W),g("Error removing favorite: "+W.message),setTimeout(()=>g(""),3e3)}}else{const B={name:k.name,rating:k.rating,description:k.description,image:k.image,link:k.link,email:d.email,originalId:k.id,timestamp:new Date};try{const W=await _f(Ar(kn,"favorite"),B);l(X=>[...X,{id:W.id,...B}]),g("Added to favorites!"),setTimeout(()=>g(""),3e3)}catch(W){console.error("Error adding favorite:",W),g("Error adding favorite: "+W.message),setTimeout(()=>g(""),3e3)}}},N=async k=>{if(!d){g("Please login to add favorite books"),setTimeout(()=>g(""),3e3);return}if(I(k.id)){const B=c.find(W=>W.originalId===k.id);if(B)try{await wf(gf(kn,"favoriteBook",B.id)),h(W=>W.filter(X=>X.id!==B.id)),g("Removed from favorite books!"),setTimeout(()=>g(""),3e3)}catch(W){console.error("Error removing favorite book:",W),g("Error removing favorite book: "+W.message),setTimeout(()=>g(""),3e3)}}else{const B={name:k.name,rating:k.rating,description:k.description,image:k.image,link:k.link,email:d.email,originalId:k.id,timestamp:new Date};try{const W=await _f(Ar(kn,"favoriteBook"),B);h(X=>[...X,{id:W.id,...B}]),g("Added to favorite books!"),setTimeout(()=>g(""),3e3)}catch(W){console.error("Error adding favorite book:",W),g("Error adding favorite book: "+W.message),setTimeout(()=>g(""),3e3)}}},P={purple:{bgColor:"bg-purple-950",textColor:"text-purple-200",buttonColor:"bg-purple-500",buttonHoverColor:"hover:bg-purple-600",sliderBgColor:"bg-purple-900"},blue:{bgColor:"bg-blue-900",textColor:"text-white",buttonColor:"bg-blue-500",buttonHoverColor:"hover:bg-blue-600",sliderBgColor:"bg-blue-800"},grey:{bgColor:"bg-gray-700",textColor:"text-gray-300",buttonColor:"bg-gray-500",buttonHoverColor:"hover:bg-gray-600",sliderBgColor:"bg-gray-700"},red:{bgColor:"bg-red-900",textColor:"text-red-200",buttonColor:"bg-red-500",buttonHoverColor:"hover:bg-red-600",sliderBgColor:"bg-red-800"},green:{bgColor:"bg-green-800",textColor:"text-green-200",buttonColor:"bg-green-500",buttonHoverColor:"hover:bg-green-600",sliderBgColor:"bg-green-700"},pink:{bgColor:"bg-pink-800",textColor:"text-pink-200",buttonColor:"bg-pink-500",buttonHoverColor:"hover:bg-pink-600",sliderBgColor:"bg-pink-700"}};return D.jsxs("div",{className:`${P[a].bgColor} ${P[a].textColor} min-h-screen flex flex-col transition-colors duration-500`,children:[D.jsx(bu,{}),m&&D.jsx("div",{className:"fixed top-0 left-1/2 transform -translate-x-1/2 mt-4 bg-green-500 text-white p-4 rounded-md shadow-md z-50",style:{width:"auto",maxWidth:"300px",textAlign:"center"},children:m}),D.jsxs("div",{className:"flex-grow container mx-auto px-6 py-12 grid grid-cols-1 md:grid-cols-2 gap-8",children:[D.jsxs("div",{className:"flex flex-col justify-center space-y-6",children:[D.jsx("h1",{className:"text-4xl md:text-6xl font-bold text-purple-200",children:"Capture Your Mood"}),D.jsx("p",{className:"text-lg md:text-xl text-gray-300",children:"Discover the beauty of self-expression and connect with your inner emotions. Let Mood Conexus guide you through your journey."}),D.jsx(mn,{to:"/capture",className:`${P[a].buttonColor} ${P[a].buttonHoverColor} text-white text-center px-6 py-3 rounded-lg text-lg font-bold transition duration-300`,"aria-label":"Capture Mood",children:"Capture Mood"})]}),D.jsx("div",{className:"flex items-center justify-center",children:D.jsx("img",{src:"gif.gif",alt:"Your GIF description",className:"w-full h-full rounded-l-full object-fill"})})]}),D.jsxs("div",{className:`relative w-full mt-8 overflow-hidden ${P[a].sliderBgColor}`,children:[n.length>0&&D.jsx("div",{className:"flex transition-transform duration-700",style:{transform:`translateX(-${i*100}%)`},children:A(n).map((k,j)=>D.jsx("div",{className:"flex-shrink-0 w-full flex items-center justify-center",children:D.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:k.map(B=>D.jsxs("div",{className:"text-center p-6",children:[D.jsx("img",{src:B.image,alt:B.name,className:"w-52 h-60 object-center rounded-lg mb-4 mx-auto"}),D.jsx("h2",{className:`text-2xl font-bold ${P[a].textColor} mb-2`,children:B.name}),D.jsxs("p",{className:`text-sm mb-2 ${P[a].textColor}`,children:["Rating: ",B.rating]}),D.jsx("p",{className:"text-gray-400 mb-4 h-20 overflow-hidden",children:B.description}),D.jsx(mn,{to:B.link,target:"_blank",rel:"noopener noreferrer",className:`${P[a].buttonColor} ${P[a].buttonHoverColor} text-white px-4 py-2 rounded-lg transition duration-300`,children:"Watch Now"}),D.jsx("button",{onClick:()=>S(B),className:"text-xl mt-2 ml-3",children:E(B.id)?D.jsx(Jl,{className:"text-red-500 opacity-100 fill-current"}):D.jsx(Sg,{className:"text-gray-400 opacity-100 fill-current"})})]},B.id))})},j))}),D.jsx("button",{className:`${P[a].buttonColor} ${P[a].buttonHoverColor} absolute top-40 left-8 transform -translate-y-1/2 p-3 rounded-full`,onClick:C,"aria-label":"Previous Slide",children:"<"}),D.jsx("button",{className:`${P[a].buttonColor} ${P[a].buttonHoverColor} absolute top-40 right-8 transform -translate-y-1/2 p-3 rounded-full`,onClick:x,"aria-label":"Next Slide",children:">"})]}),D.jsxs("div",{className:`relative w-full mt-8 overflow-hidden ${P[a].sliderBgColor}`,children:[t.length>0&&D.jsx("div",{className:"flex transition-transform duration-700",style:{transform:`translateX(-${i*100}%)`},children:A(t).map((k,j)=>D.jsx("div",{className:"flex-shrink-0 w-full flex items-center justify-center",children:D.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:k.map(B=>D.jsxs("div",{className:"text-center p-6",children:[D.jsx("img",{src:B.image,alt:B.name,className:"w-52 h-60 object-center rounded-lg mb-4 mx-auto"}),D.jsx("h2",{className:`text-2xl font-bold ${P[a].textColor} mb-2`,children:B.name}),D.jsxs("p",{className:`text-sm mb-2 ${P[a].textColor}`,children:["Author: ",B.rating]}),D.jsx("p",{className:"text-gray-400 mb-4 h-20 overflow-hidden",children:B.description}),D.jsx(mn,{to:B.link,target:"_blank",rel:"noopener noreferrer",className:`${P[a].buttonColor} ${P[a].buttonHoverColor} text-white px-4 py-2 rounded-lg transition duration-300`,children:"Read Now"}),D.jsx("button",{onClick:()=>N(B),className:"text-xl mt-2 ml-3",children:I(B.id)?D.jsx(Jl,{className:"text-red-500 opacity-100 fill-current"}):D.jsx(Sg,{className:"text-gray-400 opacity-100 fill-current"})})]},B.id))})},j))}),D.jsx("button",{className:`${P[a].buttonColor} ${P[a].buttonHoverColor} absolute top-40 left-8 transform -translate-y-1/2 p-3 rounded-full`,onClick:C,"aria-label":"Previous Slide",children:"<"}),D.jsx("button",{className:`${P[a].buttonColor} ${P[a].buttonHoverColor} absolute top-40 right-8 transform -translate-y-1/2 p-3 rounded-full`,onClick:x,"aria-label":"Next Slide",children:">"})]}),D.jsx("button",{onClick:T,className:"fixed bottom-8 right-8 bg-white text-purple-950 font-bold rounded-md hover:bg-black hover:text-white p-2",children:"Click me"}),D.jsx(Tc,{})]})},vE=()=>{const[n,e]=Q.useState(""),[t,r]=Q.useState(""),[i,o]=Q.useState(""),[a,s]=Q.useState(!1),[u,l]=Q.useState(!1),[c,h]=Q.useState(""),[d,p]=Q.useState(!1),m=up(),g=BI(),y=async _=>{_.preventDefault(),o(""),p(!0);try{const x=await mL(xf,n,t);console.log("User logged in:",x.user);const C=x.user,A=await C.getIdToken();localStorage.setItem("token",A),g(pO({user:C,email:n,token:A})),m("/home")}catch(x){console.error("Login error:",x),x.code==="auth/invalid-credential"?o("Invalid email or password. Please try again."):x.code==="auth/too-many-requests"?o("Too many failed login attempts. Please try again later or reset your password."):o(x.message)}finally{p(!1)}},v=async _=>{if(_.preventDefault(),o(""),p(!0),!(C=>{const A=C.trim().toLowerCase();if(!/^[a-zA-Z][\w.-]*@[a-zA-Z\d.-]+\.[a-zA-Z]{2,}$/.test(A))return!1;const E=A.split("@")[1];return["gmail.com","yahoo.com","outlook.com","hotmail.com","icloud.com","yopmail.com","gmx.com","mailinator.com","fastmail.com","tutanota.com","hushmail.com","protonmail.com","zoho.com","aol.com","live.com","mail.com"].includes(E)})(c)){o("Email must start with a letter and use a valid domain (e.g., example@gmail.com)."),p(!1);return}if(!c){o("Please enter your email address"),p(!1);return}try{await fL(xf,c,{url:window.location.origin+"/login"}),console.log("Password reset request processed for:",c),s(!0),o("")}catch(C){console.error("Password reset error:",C),C.code==="auth/invalid-email"?o("Invalid email format. Please enter a valid email address."):C.code==="auth/user-not-found"?o("No account found with this email address."):o(`Error: ${C.message}`)}finally{p(!1)}},w=()=>{l(!u),h(n),o(""),s(!1)};return D.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 min-h-screen bg-gradient-to-tr from-purple-950 to-black text-white",children:[D.jsxs("div",{className:"flex flex-col justify-center items-center p-8",children:[D.jsxs("div",{className:"flex flex-row items-center text-center space-x-4",children:[D.jsx("img",{src:"logo.jpeg",alt:"Logo",className:"w-20 h-20 rounded-full"}),D.jsx("div",{children:D.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Mood Conexus"})})]}),D.jsx("p",{className:"text-lg mt-4",children:"Log in to access your account and explore more features."})]}),D.jsx("div",{className:"flex justify-center items-center p-8",children:u?D.jsxs("form",{onSubmit:v,className:"bg-purple-950 rounded-lg shadow-lg p-8 max-w-md w-full",children:[D.jsx("h2",{className:"text-3xl font-bold mb-6 text-center text-white",children:"Reset Password"}),a?D.jsxs("div",{className:"text-center mb-6",children:[D.jsx("p",{className:"text-green-400 mb-4",children:"Password reset email sent!"}),D.jsx("p",{className:"text-gray-200 mb-4",children:"If an account exists with this email, you will receive password reset instructions shortly."}),D.jsx("p",{className:"text-gray-300 text-sm",children:"If you don't see the email in your inbox, please check your spam folder."})]}):D.jsxs(D.Fragment,{children:[D.jsx("p",{className:"font-medium mb-6 text-center text-white",children:"Enter your email address and we'll send you a link to reset your password"}),i&&D.jsx("p",{className:"text-red-400 text-center mb-4",children:i}),D.jsxs("div",{className:"mb-6",children:[D.jsx("label",{htmlFor:"resetEmail",className:"block text-lg font-medium text-gray-200 mb-2",children:"Email"}),D.jsx("input",{type:"email",id:"resetEmail",value:c,onChange:_=>h(_.target.value),required:!0,pattern:"[^\\s@]+@[^\\s@]+\\.[^\\s@]+",title:"Please enter a valid email address (e.g., example@domain.com)",className:"w-full px-4 py-2 border-2 border-purple-700 rounded-md bg-purple-800 text-white",placeholder:"Enter your registered email"})]}),D.jsxs("button",{type:"submit",className:"w-full bg-purple-700 text-white py-2 rounded-md text-lg font-semibold hover:bg-purple-600 flex justify-center items-center",disabled:d,children:[d?D.jsx("span",{className:"inline-block w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}):null,"Send Reset Link"]})]}),D.jsx("div",{className:"text-center mt-6",children:D.jsx("button",{type:"button",onClick:w,className:"text-purple-400 hover:text-purple-500",children:"Back to Login"})})]}):D.jsxs("form",{onSubmit:y,className:"bg-purple-950 rounded-lg shadow-lg p-8 max-w-md w-full",children:[D.jsx("h2",{className:"text-3xl font-bold mb-6 text-center text-white",children:"Mood Conexus"}),D.jsx("p",{className:"font-bold mb-6 text-center text-white",children:"Let's sign you in quickly"}),i&&D.jsx("p",{className:"text-red-400 text-center mb-4",children:i}),D.jsxs("div",{className:"mb-4",children:[D.jsx("label",{htmlFor:"email",className:"block text-lg font-medium text-gray-200 mb-2",children:"Email"}),D.jsx("input",{type:"email",id:"email",value:n,onChange:_=>e(_.target.value),required:!0,className:"w-full px-4 py-2 border-2 border-purple-700 rounded-md bg-purple-800 text-white"})]}),D.jsxs("div",{className:"mb-6",children:[D.jsx("label",{htmlFor:"password",className:"block text-lg font-medium text-gray-200 mb-2",children:"Password"}),D.jsx("input",{type:"password",id:"password",value:t,onChange:_=>r(_.target.value),required:!0,className:"w-full px-4 py-2 border-2 border-red-500 rounded-md bg-purple-800 text-white"})]}),D.jsxs("button",{type:"submit",className:"w-full bg-purple-700 text-white py-2 rounded-md text-lg font-semibold hover:bg-purple-600 flex justify-center items-center",disabled:d,children:[d?D.jsx("span",{className:"inline-block w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}):null,"Login"]}),D.jsx("div",{className:"text-center mt-4 mb-4",children:D.jsx("button",{type:"button",onClick:w,className:"text-purple-400 hover:text-purple-500",children:"Forgot Password?"})}),D.jsxs("div",{className:"text-center",children:[D.jsx("p",{className:"text-gray-200 mb-2",children:"Don't have an account?"}),D.jsx("button",{type:"button",onClick:()=>m("/register"),className:"text-purple-400 hover:text-purple-500",children:"Register"})]})]})})]})},X6=()=>{const[n,e]=Q.useState(""),[t,r]=Q.useState(""),[i,o]=Q.useState(""),[a,s]=Q.useState(""),[u,l]=Q.useState(""),[c,h]=Q.useState(""),[d,p]=Q.useState(""),[m,g]=Q.useState(""),[y,v]=Q.useState(!1),w=up(),_=["gmail.com","yahoo.com","outlook.com","hotmail.com","protonmail.com","icloud.com","aol.com","mail.com","zoho.com","gmx.com","yandex.com","qq.com","163.com","rediffmail.com","live.com","msn.com","yopmail.com","me.com","rocketmail.com","fastmail.com","tutanota.com","pm.me","proton.me"],x=N=>N?/^[A-Za-z\s]+$/.test(N)?N.trim().length<2?"Name should be at least 2 characters long":"":"Name should contain only alphabets and spaces":"Name is required",C=N=>{if(!N)return"Email is required";if(N.indexOf("@")===-1)return"Email must contain '@'";const P=N.split("@");if(P.length!==2)return"Invalid email format";const k=P[1].toLowerCase();return k.includes(".")?k.split(".").pop().length<2?"Domain extension must be at least 2 characters":k.includes("..")?"Domain cannot contain consecutive dots":k.endsWith(".")?"Domain cannot end with a dot":k.indexOf(".")>0&&!_.includes(k)?"Please use an email from a supported provider":_.includes(k)?"":`Please use a valid email provider (e.g., ${_.slice(0,3).join(", ")})`:"Please include a complete domain (e.g., gmail.com)"},A=N=>{const P=[];return N.length<8&&P.push("Password must be at least 8 characters long"),/[!@#$%^&*(),.?":{}|<>]/.test(N)||P.push("Password must contain at least one special character"),P},T=N=>{const P=N.target.value;e(P),g(P?x(P):""),l("")},E=N=>{const P=N.target.value.trim();if(r(P),P.includes("@")){const k=C(P);h(k),l(k||"")}else h(""),l("")},I=N=>{const P=N.target.value;o(P),p(""),l("")},S=async N=>{N.preventDefault(),v(!0),g(""),h(""),p(""),l(""),s("");const P=x(n);if(P){g(P),l(P),v(!1);return}const k=C(t);if(k){h(k),l(k),v(!1);return}const j=A(i);if(j.length>0){p(j.join(". ")),l(j.join(". ")),v(!1);return}try{const B=await pL(xf,t,i);console.log("User Registered:",B.user),s("Registration successful! Redirecting..."),setTimeout(()=>w("/login"),2e3)}catch(B){let W="Registration failed. Please try again.";B.code==="auth/email-already-in-use"?W="This email is already registered. Please login instead.":B.code==="auth/invalid-email"?W="Please enter a valid email address":B.code==="auth/weak-password"&&(W="Password should be at least 6 characters"),l(W)}finally{v(!1)}};return D.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 min-h-screen bg-gradient-to-tr from-purple-950 to-black text-white",children:[D.jsxs("div",{className:"flex flex-col justify-center items-center p-8",children:[D.jsxs("div",{className:"flex flex-row items-center text-center space-x-4",children:[D.jsx("img",{src:"logo.jpeg",alt:"Logo",className:"w-20 h-20 rounded-full"}),D.jsx("div",{children:D.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Mood Conexus"})})]}),D.jsx("p",{className:"text-lg",children:"Register to access your account and explore more features."})]}),D.jsx("div",{className:"flex justify-center items-center p-8",children:D.jsxs("form",{onSubmit:S,className:"bg-purple-950 rounded-lg shadow-lg p-8 max-w-md w-full",children:[D.jsx("h2",{className:"text-3xl font-bold mb-6 text-center text-white",children:"Mood Conexus"}),a&&D.jsx("div",{className:"bg-green-500 text-white p-3 rounded mb-4 text-center",children:a}),u&&D.jsx("div",{className:"bg-red-500 text-white p-3 rounded mb-4 text-center",children:u}),D.jsxs("div",{className:"mb-4",children:[D.jsx("label",{htmlFor:"name",className:"block text-lg font-medium text-gray-200 mb-2",children:"Name"}),D.jsx("input",{type:"text",id:"name",value:n,placeholder:"Enter your name (letters only)",onChange:T,onBlur:()=>g(x(n)),required:!0,className:`w-full px-4 py-2 border-2 rounded-md bg-purple-800 text-white ${m?"border-red-500":"border-purple-700"}`}),m?D.jsx("div",{className:"text-red-400 text-sm mt-1",children:m}):D.jsx("div",{className:"text-gray-400 text-sm mt-1",children:"Only alphabets and spaces allowed"})]}),D.jsxs("div",{className:"mb-4",children:[D.jsx("label",{htmlFor:"email",className:"block text-lg font-medium text-gray-200 mb-2",children:"Email"}),D.jsx("input",{type:"email",id:"email",value:t,placeholder:"yourname@gmail.com",onChange:E,onBlur:()=>h(C(t)),required:!0,className:`w-full px-4 py-2 border-2 rounded-md bg-purple-800 text-white ${c?"border-red-500":"border-purple-700"}`}),c?D.jsx("div",{className:"text-red-400 text-sm mt-1",children:c}):D.jsx("div",{className:"text-gray-400 text-sm mt-1"})]}),D.jsxs("div",{className:"mb-6",children:[D.jsx("label",{htmlFor:"password",className:"block text-lg font-medium text-gray-200 mb-2",children:"Password"}),D.jsx("input",{type:"password",id:"password",value:i,placeholder:"At least 8 characters with special character",onChange:I,onBlur:()=>{const N=A(i);p(N.join(". "))},required:!0,className:`w-full px-4 py-2 border-2 rounded-md bg-purple-700 text-white ${d?"border-red-500":"border-red-600"}`}),d?D.jsx("div",{className:"text-red-400 text-sm mt-1",children:d}):D.jsx("div",{className:"text-gray-400 text-sm mt-1",children:"Must be 8+ characters with a special character"})]}),D.jsx("button",{type:"submit",disabled:y,className:`w-full bg-purple-600 text-white py-2 rounded-md text-lg font-semibold hover:bg-purple-700 transition-colors ${y?"opacity-70 cursor-not-allowed":""}`,children:y?"Registering...":"Register"}),D.jsxs("div",{className:"text-center mt-4",children:[D.jsx("p",{className:"text-gray-200 mb-2",children:"Already have an account?"}),D.jsx("button",{type:"button",onClick:()=>w("/login"),className:"text-purple-400 font-medium hover:text-purple-300 transition-colors",children:"Login"})]})]})})]})},Q6=({theme:n,changeTheme:e})=>{const t={purple:"text-purple-300 bg-purple-900",blue:"text-blue-400 bg-blue-900",grey:"text-gray-300 bg-gray-700",red:"text-red-400 bg-red-900",pink:"text-pink-300 bg-pink-800",green:"text-green-300 bg-green-900"};return D.jsxs("div",{className:`min-h-screen flex flex-col ${t[n]}`,children:[D.jsx(bu,{}),D.jsx("button",{onClick:e,className:"fixed bottom-8 right-8  bg-white text-purple-950 font-bold rounded-md hover:bg-black hover:text-white p-2","aria-label":"Change Theme",children:"Click me"}),D.jsxs("div",{className:"flex-grow container mx-auto px-6 py-12",children:[D.jsxs("div",{className:"mb-12 text-center",children:[D.jsx("h1",{className:"text-4xl md:text-6xl font-bold",children:"About Mood Conexus"}),D.jsx("p",{className:"text-lg md:text-xl mt-4",children:"Learn more about the platform that helps you connect with your emotions and explore the world of moods."})]}),D.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[D.jsxs("div",{className:"space-y-6",children:[D.jsx("h2",{className:"text-3xl font-bold",children:"What We Offer"}),D.jsx("p",{children:"Mood Conexus is a platform designed to help individuals capture and explore their moods. Whether it's through journaling, self-expression, or connecting with like-minded individuals, our goal is to create a supportive environment for emotional growth."})]}),D.jsxs("div",{className:"space-y-6",children:[D.jsx("h2",{className:"text-3xl font-bold",children:"Our Mission"}),D.jsx("p",{children:"At Mood Conexus, we believe that understanding and expressing your emotions are key to personal development. We strive to provide tools and a community that inspire and empower you to connect with your inner self."})]})]})]}),D.jsx(Tc,{})]})},jR=eO({reducer:{auth:vO}}),Y6=({theme:n,changeTheme:e})=>{const t={purple:"text-purple-400 bg-purple-900",blue:"text-blue-400 bg-blue-900",grey:"text-gray-300 bg-gray-700",red:"text-red-400 bg-red-900",pink:"text-pink-400 bg-pink-900",green:"text-green-300 bg-green-900"},[r,i]=Q.useState({name:"",email:"",message:""}),[o,a]=Q.useState({name:"",email:"",message:""}),[s,u]=Q.useState(!1),[l,c]=Q.useState(!1),h=m=>{const g=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,y=["gmail.com","yahoo.com","outlook.com","hotmail.com","protonmail.com","yopmail.com","icloud.com","aol.com","mail.com","zoho.com","gmx.com"];if(!g.test(m))return!1;const v=m.split("@")[1].toLowerCase();return y.some(w=>v===w)},d=m=>{const{name:g,value:y}=m.target;i(v=>({...v,[g]:y})),o[g]&&a(v=>({...v,[g]:""}))},p=async m=>{m.preventDefault();let g=!0;const y={name:"",email:"",message:""};if(r.name.trim()||(y.name="Name is required",g=!1),r.email.trim()?h(r.email)||(y.email="Please enter a valid email address",g=!1):(y.email="Email is required",g=!1),r.message.trim()||(y.message="Message is required",g=!1),a(y),!!g){u(!0);try{const v=new FormData;v.append("name",r.name),v.append("email",r.email),v.append("message",r.message),v.append("_captcha","false"),v.append("_subject","New Contact Form Submission"),(await(await fetch("https://formsubmit.co/ajax/ch.mariyam06@gmail.com",{method:"POST",body:v})).json()).success&&(c(!0),i({name:"",email:"",message:""}),setTimeout(()=>c(!1),5e3))}catch(v){console.error("Submission error:",v)}finally{u(!1)}}};return D.jsxs("div",{className:`min-h-screen flex flex-col ${t[n]}`,children:[D.jsx(bu,{}),D.jsx("button",{onClick:e,className:"fixed bottom-8 right-8 bg-white text-purple-950 font-bold rounded-md hover:bg-black hover:text-white p-2 z-50","aria-label":"Change Theme",children:"Click me"}),l&&D.jsx("div",{className:"fixed top-4 right-4 p-4 bg-green-500 text-white rounded-md shadow-lg z-50 animate-fade-in",children:"Thank you! Your message has been sent successfully."}),D.jsxs("div",{className:"flex-grow container mx-auto px-6 py-12",children:[D.jsxs("div",{className:"mb-12 text-center",children:[D.jsx("h1",{className:"text-4xl md:text-6xl font-bold",children:"Contact Us"}),D.jsx("p",{className:"text-lg md:text-xl mt-4",children:"Have questions? We will respond to your email address."})]}),D.jsx("div",{className:"max-w-2xl mx-auto",children:D.jsxs("form",{onSubmit:p,className:"space-y-6",children:[D.jsxs("div",{children:[D.jsx("label",{className:"block text-lg font-medium mb-2",children:"Your Name"}),D.jsx("input",{type:"text",name:"name",value:r.name,onChange:d,className:`w-full px-4 py-2 rounded-md bg-gray-100 text-black ${o.name?"border-2 border-red-500":""}`,placeholder:"Enter your full name"}),o.name&&D.jsx("p",{className:"text-red-500 mt-1",children:o.name})]}),D.jsxs("div",{children:[D.jsx("label",{className:"block text-lg font-medium mb-2",children:"Your Email"}),D.jsx("input",{type:"email",name:"email",value:r.email,onChange:d,className:`w-full px-4 py-2 rounded-md bg-gray-100 text-black ${o.email?"border-2 border-red-500":""}`,placeholder:"Enter your email address"}),o.email&&D.jsx("p",{className:"text-red-500 mt-1",children:o.email})]}),D.jsxs("div",{children:[D.jsx("label",{className:"block text-lg font-medium mb-2",children:"Your Message"}),D.jsx("textarea",{name:"message",value:r.message,onChange:d,className:`w-full px-4 py-2 rounded-md bg-gray-100 text-black ${o.message?"border-2 border-red-500":""}`,rows:"4",placeholder:"Type your message here..."}),o.message&&D.jsx("p",{className:"text-red-500 mt-1",children:o.message})]}),D.jsx("button",{type:"submit",disabled:s,className:`px-6 py-3 bg-white text-purple-950 font-bold rounded-md hover:bg-purple-400 hover:text-white ${s?"opacity-50 cursor-not-allowed":""}`,children:s?"Sending...":"Send Message"})]})})]}),D.jsx(Tc,{})]})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var zR=function(n,e){return(zR=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])})(n,e)};function Br(n,e){function t(){this.constructor=n}zR(n,e),n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function ce(n,e,t,r){return new(t||(t=Promise))(function(i,o){function a(l){try{u(r.next(l))}catch(c){o(c)}}function s(l){try{u(r.throw(l))}catch(c){o(c)}}function u(l){l.done?i(l.value):new t(function(c){c(l.value)}).then(a,s)}u((r=r.apply(n,[])).next())})}function he(n,e){var t,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(l){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){a=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){a.label=c[1];break}if(c[0]===6&&a.label<i[1]){a.label=i[1],i=c;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(c);break}i[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(n,a)}catch(h){c=[6,h],r=0}finally{t=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([u,l])}}}var J6=function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var i=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+i+"."),this.set(e,i)}},n.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,r,i=(t=this.global.location.search,r={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(o){for(var a=[],s=1;s<arguments.length;s++)a[s-1]=arguments[s];return Z6(r,a[0],a[1]),a.join("=")}),r);"tfjsflags"in i&&i.tfjsflags.split(",").forEach(function(o){var a=o.split(":"),s=a[0],u=a[1];e.urlFlags[s]=function(l,c){if((c=c.toLowerCase())==="true"||c==="false")return c==="true";if(""+ +c===c)return+c;throw new Error("Could not parse value flag value "+c+" for flag "+l+".")}(s,u)})}},n}();function Z6(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Y(){return WR}var WR=null,bf=new Map,Zg=new Map;function $R(n,e){var t=GR(n,e);return bf.get(t)}function ej(n){return Zg.get(n)}function gE(n){for(var e=bf.entries(),t=[];;){var r=e.next(),i=r.done,o=r.value;if(i)break;var a=o[0],s=o[1];a.split("_")[0]===n&&t.push(s)}return t}function HR(n){var e=n.kernelName,t=n.backendName,r=GR(e,t);if(bf.has(r))throw new Error("The kernel '"+e+"' for backend '"+t+"' is already registered");bf.set(r,n)}function tj(n){var e=n.kernelName;Zg.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),Zg.set(e,n)}function GR(n,e){return e+"_"+n}function ey(n,e,t){return Math.max(n,Math.min(e,t))}function qR(n){return n%2==0?n:n+1}function nj(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];return e}function F(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function qe(n,e,t){t===void 0&&(t=""),F(zt(n,e),function(){return t+" Shapes "+n+" and "+e+" must match"})}function Au(n){F(n!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function pu(n,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(n)||si(n)&&!t)for(var r=0;r<n.length;++r)pu(n[r],e,t);else e.push(n);return e}function fe(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function zt(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function xt(n){return n%1==0}function rj(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var e=Math.exp(2*n);return(e-1)/(e+1)}function ty(n){var e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function $s(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function yE(n,e,t){return e===void 0&&(e=function(r){return 0}),new Promise(function(r,i){var o=0,a=function(){if(n())r();else{o++;var s=e(o);t!=null&&o>=t?i():setTimeout(a,s)}};a()})}function ij(n,e){for(var t=1,r=-1,i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(n[i]<0)throw Error("Shapes can not be < 0. Found "+n[i]+" at dim "+i);if(r===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+n);return n}if(t===0)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var o=n.slice();return o[r]=e/t,o}function Lt(n,e){var t=e.length;return F((n=n==null?e.map(function(r,i){return i}):[].concat(n)).every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+n}),F(n.every(function(r){return xt(r)}),function(){return"All values in axis param must be integers but got axis "+n}),n.map(function(r){return r<0?t+r:r})}function ma(n,e){for(var t=[],r=[],i=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||i?null:Lt(e,n).sort(),a=0,s=0;s<n.length;++s){if(o!=null){if(o[a]===s&&n[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+n[s]+"' is not 1");(o[a]==null||o[a]>s)&&n[s]===1&&(t.push(n[s]),r.push(s)),o[a]<=s&&a++}n[s]!==1&&(t.push(n[s]),r.push(s))}return{newShape:t,keptDims:r}}function cc(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else{if(n!=="bool")throw new Error("Unknown data type "+n);t=new Uint8Array(e)}return t}function Ef(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else{if(n!=="string")throw new Error("Unknown data type "+n);t=new Array(e)}return t}function oj(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function aj(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function sj(n,e){return e!=="complex64"&&(e!=="float32"||n==="complex64")&&(e!=="int32"||n==="float32"||n==="complex64")&&(e!=="bool"||n!=="bool")}function si(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function KR(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype "+n)}function uj(n){if(n==null)return 0;var e=0;return n.forEach(function(t){return e+=t.length}),e}function m1(n){return typeof n=="string"||n instanceof String}function lj(n){return typeof n=="boolean"}function cj(n){return typeof n=="number"}function Vc(n){return Array.isArray(n)?Vc(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":cj(n)?"float32":m1(n)?"string":lj(n)?"bool":"float32"}function ny(n){return!!(n&&n.constructor&&n.call&&n.apply)}function ry(n,e){for(var t=e;t<n;++t)if(n%t==0)return t;return n}function ui(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function XR(n,e,t){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=pu(n)),t&&oj(n,e),function(o,a){return o instanceof Float32Array&&a==="float32"||o instanceof Int32Array&&a==="int32"||o instanceof Uint8Array&&a==="bool"}(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var r=new Uint8Array(n.length),i=0;i<r.length;++i)Math.round(n[i])!==0&&(r[i]=1);return r}throw new Error("Unknown data type "+e)}function wE(n,e){if(n.length===0)return e[0];var t=n.reduce(function(r,i){return r*i});if(t===0)return[];if(t!==e.length)throw new Error("["+n+"] does not match the input size.");return function r(i,o,a){var s=new Array;if(o.length===1)for(var u=o[0],l=0;l<u;l++)s[l]=a[i+l];else{u=o[0];var c=o.slice(1),h=c.reduce(function(d,p){return d*p});for(l=0;l<u;l++)s[l]=r(i+l*h,c,a)}return s}(0,n,e)}function QR(n,e){for(var t=Bc(n,e),r=0;r<t.length;r++)t[r]=1;return t}function Bc(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type "+e)}function Xr(){return Y().platform.now()}function YR(n){n.forEach(function(e){F(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."})})}function hj(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Y().platform.encode(n,e)}function Cf(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Y().platform.decode(n,e)}function _E(n,e,t){if(e===0)return 0;if(e===1)return n[0];for(var r=n[n.length-1],i=0;i<n.length-1;++i)r+=t[i]*n[i];return r}function dj(n,e,t){if(e===0)return[];if(e===1)return[n];for(var r=new Array(e),i=0;i<r.length-1;++i)r[i]=Math.floor(n/t[i]),n-=r[i]*t[i];return r[r.length-1]=n,r}var fj=function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new pj)}return n.prototype.profileKernel=function(e,t,r){var i,o=this,a=this.backendTimer.time(function(){i=r()});return i.forEach(function(s){s.data().then(function(u){(function(l,c,h){if(c!=="float32")return!1;for(var d=0;d<l.length;d++){var p=l[d];if(isNaN(p)||!isFinite(p))return console.warn("Found "+p+" in the result of '"+h+"'"),!0}})(u,s.dtype,e),a.then(function(l){var c="";l.getExtraProfileInfo!=null&&(c=l.getExtraProfileInfo()),o.logger.logKernelProfile(e,s,u,l.kernelMs,t,c)})})}),i},n}(),pj=function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,i,o,a){var s=typeof i=="number"?$s(i+"ms",9):i.error,u=$s(e,25),l=t.rank,c=t.size,h=$s(t.shape.toString(),14),d="";for(var p in o){var m=o[p].shape||t.shape,g=m.length;d+=p+": "+g+"D "+(g>0?m:"")+" "}console.log("%c"+u+"	%c"+s+"	%c"+l+"D "+h+"	%c"+c+"	%c"+d+"	%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}(),xE=20,Ju=3,Ym=7;function mj(n,e,t,r){var i=ui(e),o=function(l,c,h,d){var p=fe(c),m=d[d.length-1],g=new Array(m).fill(0),y=c.length,v=h==="complex64"?el(l):l;if(y>1)for(var w=0;w<p/m;w++)for(var _=w*m,x=0;x<m;x++)g[x]=Math.max(g[x],Zu(v[_+x],0,h).length);return g}(n,e,t,i),a=e.length,s=function l(c,h,d,p,m,g){g===void 0&&(g=!0);var y=d==="complex64"?2:1,v=h[0],w=h.length;if(w===0)return d==="complex64"?[Zu(el(c)[0],0,d)]:d==="bool"?[JR(c[0])]:[c[0].toString()];if(w===1){if(v>xE){var _=Ju*y,x=Array.from(c.slice(0,_)),C=Array.from(c.slice((v-Ju)*y,v*y));return d==="complex64"&&(x=el(x),C=el(C)),["["+x.map(function(B,W){return Zu(B,m[W],d)}).join(", ")+", ..., "+C.map(function(B,W){return Zu(B,m[v-Ju+W],d)}).join(", ")+"]"]}return["["+(d==="complex64"?el(c):Array.from(c)).map(function(B,W){return Zu(B,m[W],d)}).join(", ")+"]"]}var A=h.slice(1),T=p.slice(1),E=p[0]*y,I=[];if(v>xE){for(var S=0;S<Ju;S++){var N=(P=S*E)+E;I.push.apply(I,l(c.slice(P,N),A,d,T,m,!1))}for(I.push("..."),S=v-Ju;S<v;S++)N=(P=S*E)+E,I.push.apply(I,l(c.slice(P,N),A,d,T,m,S===v-1))}else for(S=0;S<v;S++){var P;N=(P=S*E)+E,I.push.apply(I,l(c.slice(P,N),A,d,T,m,S===v-1))}var k=w===2?",":"";for(I[0]="["+I[0]+k,S=1;S<I.length-1;S++)I[S]=" "+I[S]+k;var j=`,
`;for(S=2;S<w;S++)j+=`
`;return I[I.length-1]=" "+I[I.length-1]+"]"+(g?"":j),I}(n,e,t,i,o),u=["Tensor"];return r&&(u.push("  dtype: "+t),u.push("  rank: "+a),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function Zu(n,e,t){return $s(Array.isArray(n)?parseFloat(n[0].toFixed(Ym))+" + "+parseFloat(n[1].toFixed(Ym))+"j":m1(n)?"'"+n+"'":t==="bool"?JR(n):parseFloat(n.toFixed(Ym)).toString(),e)}function JR(n){return n===0?"false":"true"}function el(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var hc=function(){function n(e,t,r){var i=this;if(this.dtype=t,this.shape=e.slice(),this.size=fe(e),r!=null){var o=r.length;F(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+i.size+"'."})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Ef(t,this.size),this.strides=ui(e)}return n.prototype.set=function(e){for(var t=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];r.length===0&&(r=[0]),F(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"});var o=this.locToIndex(r);this.values[o]=e},n.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length===0&&(e=[0]);for(var r=0,i=0,o=e;i<o.length;i++){var a=o[i];if(a<0||a>=this.shape[r]){var s="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(s)}r++}for(var u=e[e.length-1],l=0;l<e.length-1;++l)u+=this.strides[l]*e[l];return this.values[u]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return Yr().makeTensor(this.values,this.shape,this.dtype)},n}(),Yr=null,q=null,ZR=null,lt=function(){function n(e,t,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=fe(e),this.strides=ui(e),this.dataId=r,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}return n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),F(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},n.prototype.as3D=function(e,t,r){return this.throwIfDisposed(),this.reshape([e,t,r])},n.prototype.as4D=function(e,t,r,i){return this.throwIfDisposed(),this.reshape([e,t,r,i])},n.prototype.as5D=function(e,t,r,i,o){return this.throwIfDisposed(),this.reshape([e,t,r,i,o])},n.prototype.asType=function(e){return this.throwIfDisposed(),q.cast(this,e)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return ce(this,void 0,void 0,function(){var e;return he(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,q.buffer(this.shape,this.dtype,e)]}})})},n.prototype.bufferSync=function(){return q.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return ce(this,void 0,void 0,function(){var e;return he(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,wE(this.shape,e)]}})})},n.prototype.arraySync=function(){return wE(this.shape,this.dataSync())},n.prototype.data=function(){return ce(this,void 0,void 0,function(){var e,t;return he(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=Yr().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map(function(i){return Cf(i)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}})})},n.prototype.dataSync=function(){this.throwIfDisposed();var e=Yr().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return Cf(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return ce(this,void 0,void 0,function(){var e;return he(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,Yr().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(Yr().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(e){return e===void 0&&(e=!1),q.print(this,e)},n.prototype.reshape=function(e){return this.throwIfDisposed(),q.reshape(this,e)},n.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},n.prototype.expandDims=function(e){return e===void 0&&(e=0),q.expandDims(this,e)},n.prototype.cumsum=function(e,t,r){return e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1),q.cumsum(this,e,t,r)},n.prototype.squeeze=function(e){return this.throwIfDisposed(),q.squeeze(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),q.clone(this)},n.prototype.oneHot=function(e,t,r){return this.throwIfDisposed(),q.oneHot(this,e,t,r)},n.prototype.toString=function(e){return e===void 0&&(e=!1),mj(this.dataSync(),this.shape,this.dtype,e)},n.prototype.tile=function(e){return this.throwIfDisposed(),q.tile(this,e)},n.prototype.gather=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),q.gather(this,e,t)},n.prototype.matMul=function(e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!1),this.throwIfDisposed(),q.matMul(this,e,t,r)},n.prototype.dot=function(e){return this.throwIfDisposed(),q.dot(this,e)},n.prototype.norm=function(e,t,r){return e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),this.throwIfDisposed(),q.norm(this,e,t,r)},n.prototype.slice=function(e,t){return this.throwIfDisposed(),q.slice(this,e,t)},n.prototype.reverse=function(e){return this.throwIfDisposed(),q.reverse(this,e)},n.prototype.concat=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),e instanceof n&&(e=[e]),q.concat([this].concat(e),t)},n.prototype.split=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),q.split(this,e,t)},n.prototype.stack=function(e,t){return t===void 0&&(t=0),q.stack([this,e],t)},n.prototype.unstack=function(e){return e===void 0&&(e=0),q.unstack(this,e)},n.prototype.pad=function(e,t){return t===void 0&&(t=0),q.pad(this,e,t)},n.prototype.batchNormalization=function(e,t,r,i,o){return r===void 0&&(r=.001),ZR("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,i,r)},n.prototype.batchNorm=function(e,t,r,i,o){return o===void 0&&(o=.001),this.throwIfDisposed(),q.batchNorm(this,e,t,r,i,o)},n.prototype.all=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),q.all(this,e,t)},n.prototype.any=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),q.any(this,e,t)},n.prototype.logSumExp=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),q.logSumExp(this,e,t)},n.prototype.sum=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),q.sum(this,e,t)},n.prototype.prod=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),q.prod(this,e,t)},n.prototype.mean=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),q.mean(this,e,t)},n.prototype.min=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),q.min(this,e,t)},n.prototype.max=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),q.max(this,e,t)},n.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),q.argMin(this,e)},n.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),q.argMax(this,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),q.cast(this,e)},n.prototype.add=function(e){return this.throwIfDisposed(),q.add(this,e)},n.prototype.addStrict=function(e){return this.throwIfDisposed(),q.addStrict(this,e)},n.prototype.atan2=function(e){return this.throwIfDisposed(),q.atan2(this,e)},n.prototype.sub=function(e){return this.throwIfDisposed(),q.sub(this,e)},n.prototype.subStrict=function(e){return this.throwIfDisposed(),q.subStrict(this,e)},n.prototype.pow=function(e){return this.throwIfDisposed(),q.pow(this,e)},n.prototype.powStrict=function(e){return this.throwIfDisposed(),q.powStrict(this,e)},n.prototype.mul=function(e){return this.throwIfDisposed(),q.mul(this,e)},n.prototype.mulStrict=function(e){return this.throwIfDisposed(),q.mulStrict(this,e)},n.prototype.div=function(e){return this.throwIfDisposed(),q.div(this,e)},n.prototype.divNoNan=function(e){return this.throwIfDisposed(),q.divNoNan(this,e)},n.prototype.floorDiv=function(e){return this.throwIfDisposed(),q.floorDiv(this,e)},n.prototype.divStrict=function(e){return this.throwIfDisposed(),q.divStrict(this,e)},n.prototype.minimum=function(e){return this.throwIfDisposed(),q.minimum(this,e)},n.prototype.minimumStrict=function(e){return this.throwIfDisposed(),q.minimumStrict(this,e)},n.prototype.maximum=function(e){return this.throwIfDisposed(),q.maximum(this,e)},n.prototype.maximumStrict=function(e){return this.throwIfDisposed(),q.maximumStrict(this,e)},n.prototype.mod=function(e){return this.throwIfDisposed(),q.mod(this,e)},n.prototype.modStrict=function(e){return this.throwIfDisposed(),q.modStrict(this,e)},n.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),q.squaredDifferenceStrict(this,e)},n.prototype.transpose=function(e){return this.throwIfDisposed(),q.transpose(this,e)},n.prototype.notEqual=function(e){return this.throwIfDisposed(),q.notEqual(this,e)},n.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),q.notEqualStrict(this,e)},n.prototype.less=function(e){return this.throwIfDisposed(),q.less(this,e)},n.prototype.lessStrict=function(e){return this.throwIfDisposed(),q.lessStrict(this,e)},n.prototype.equal=function(e){return this.throwIfDisposed(),q.equal(this,e)},n.prototype.equalStrict=function(e){return this.throwIfDisposed(),q.equalStrict(this,e)},n.prototype.lessEqual=function(e){return this.throwIfDisposed(),q.lessEqual(this,e)},n.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),q.lessEqualStrict(this,e)},n.prototype.greater=function(e){return this.throwIfDisposed(),q.greater(this,e)},n.prototype.greaterStrict=function(e){return this.throwIfDisposed(),q.greaterStrict(this,e)},n.prototype.greaterEqual=function(e){return this.throwIfDisposed(),q.greaterEqual(this,e)},n.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),q.greaterEqualStrict(this,e)},n.prototype.logicalAnd=function(e){return this.throwIfDisposed(),q.logicalAnd(this,e)},n.prototype.logicalOr=function(e){return this.throwIfDisposed(),q.logicalOr(this,e)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),q.logicalNot(this)},n.prototype.logicalXor=function(e){return this.throwIfDisposed(),q.logicalXor(this,e)},n.prototype.where=function(e,t){return this.throwIfDisposed(),q.where(e,this,t)},n.prototype.neg=function(){return this.throwIfDisposed(),q.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),q.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),q.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),q.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),q.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),q.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),q.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),q.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),q.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),q.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),q.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),q.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),q.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),q.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),q.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),q.abs(this)},n.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),q.clipByValue(this,e,t)},n.prototype.relu=function(){return this.throwIfDisposed(),q.relu(this)},n.prototype.relu6=function(){return this.throwIfDisposed(),q.relu6(this)},n.prototype.elu=function(){return this.throwIfDisposed(),q.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),q.selu(this)},n.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),q.leakyRelu(this,e)},n.prototype.prelu=function(e){return this.throwIfDisposed(),q.prelu(this,e)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),q.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),q.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),q.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),q.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),q.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),q.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),q.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),q.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),q.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),q.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),q.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),q.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),q.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),q.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),q.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),q.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),q.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),q.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),q.round(this)},n.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),q.step(this,e)},n.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),q.softmax(this,e)},n.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),q.logSoftmax(this,e)},n.prototype.resizeBilinear=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),q.image.resizeBilinear(this,e,t)},n.prototype.resizeNearestNeighbor=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),q.image.resizeNearestNeighbor(this,e,t)},n.prototype.conv1d=function(e,t,r,i,o,a){return i===void 0&&(i="NWC"),o===void 0&&(o=1),this.throwIfDisposed(),q.conv1d(this,e,t,r,i,o,a)},n.prototype.conv2d=function(e,t,r,i,o,a){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),q.conv2d(this,e,t,r,i,o,a)},n.prototype.conv2dTranspose=function(e,t,r,i,o){return this.throwIfDisposed(),q.conv2dTranspose(this,e,t,r,i,o)},n.prototype.depthwiseConv2D=function(e,t,r,i,o,a){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),q.depthwiseConv2d(this,e,t,r,i,o,a)},n.prototype.separableConv2d=function(e,t,r,i,o,a){return o===void 0&&(o=[1,1]),a===void 0&&(a="NHWC"),this.throwIfDisposed(),q.separableConv2d(this,e,t,r,i,o,a)},n.prototype.avgPool=function(e,t,r,i){return this.throwIfDisposed(),q.avgPool(this,e,t,r,i)},n.prototype.maxPool=function(e,t,r,i){return this.throwIfDisposed(),q.maxPool(this,e,t,r,i)},n.prototype.localResponseNormalization=function(e,t,r,i){return e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5),q.localResponseNormalization(this,e,t,r,i)},n.prototype.pool=function(e,t,r,i,o){return this.throwIfDisposed(),q.pool(this,e,t,r,i,o)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),Yr().makeVariable(this,e,t,r)},n.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),q.unsortedSegmentSum(this,e,t)},n.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),q.batchToSpaceND(this,e,t)},n.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),q.spaceToBatchND(this,e,t)},n.prototype.topk=function(e,t){return e===void 0&&(e=1),t===void 0&&(t=!0),this.throwIfDisposed(),q.topk(this,e,t)},n.prototype.stridedSlice=function(e,t,r,i,o,a,s,u){return i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),this.throwIfDisposed(),q.stridedSlice(this,e,t,r,i,o,a,s,u)},n.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),q.depthToSpace(this,e,t)},n.prototype.fft=function(){return this.throwIfDisposed(),q.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),q.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),q.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),q.spectral.irfft(this)},n}();Object.defineProperty(lt,Symbol.hasInstance,{value:function(n){return!!n&&n.dataId!=null&&n.shape!=null&&n.dtype!=null}});var bE,iy,oy,ay,sy,mu=function(n){function e(t,r,i,o){var a=n.call(this,t.shape,t.dtype,t.dataId,o)||this;return a.trainable=r,a.name=i,a}return Br(e,n),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!zt(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");Yr().disposeTensor(this),this.dataId=t.dataId,Yr().incRef(this,null)},e.prototype.dispose=function(){Yr().disposeVariable(this),this.isDisposedInternal=!0},e}(lt);Object.defineProperty(mu,Symbol.hasInstance,{value:function(n){return n instanceof lt&&n.assign!=null&&n.assign instanceof Function}}),function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"}(bE||(bE={})),function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"}(iy||(iy={})),function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"}(oy||(oy={})),function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"}(ay||(ay={})),function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"}(sy||(sy={}));var vj={float32:ay,int32:iy,bool:oy,complex64:sy};function Xt(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast "+n+" with "+e)}return vj[n][e]}function Jm(n){return Xt(n,"int32")}function pt(n,e){if(n.dtype===e.dtype)return[n,e];var t=Xt(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function gj(n,e){F(n.dtype===e.dtype,function(){return"The dtypes of the first("+n.dtype+") and second("+e.dtype+") input must match"})}function ek(n){var e=[];return function t(r,i,o){if(r!=null){if(r instanceof lt)return void i.push(r);if(a=r,!(!Array.isArray(a)&&typeof a!="object")){var a,s=r;for(var u in s){var l=s[u];o.has(l)||(o.add(l),t(l,i,o))}}}}(n,e,new Set),e}var Zm,EE=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n}(),yj=function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new EE}return n.prototype.ready=function(){return ce(this,void 0,void 0,function(){var e,t,r;return he(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return i.sent()?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return ce(this,void 0,void 0,function(){var t,r,i;return he(this,function(o){switch(o.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,t.asyncInit?[4,r]:[3,2]);case 1:return i=o.sent(),[3,3];case 2:i=r,o.label=3;case 3:if(!i)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new fj(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var e=this;gE(this.backendName).forEach(function(t){t.setupFunc!=null&&t.setupFunc(e.backendInstance)})},n.prototype.disposeRegisteredKernels=function(e){var t=this;gE(e).forEach(function(r){r.disposeFunc!=null&&r.disposeFunc(t.registry[e])})},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var i=r.factory();if(Promise.resolve(i)===i){var o=++this.pendingBackendInitId,a=i.then(function(s){return!(o<t.pendingBackendInitId)&&(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return!(o<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),!1)});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],i=this.initializeBackend(r),o=i.success,a=i.asyncInit;if(a||o)return{name:r,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),i=r.backend,o=this.readSync(t);i.disposeData(t),r.backend=e,e.move(t,o,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r,i=this,o=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return i.startScope(o)},function(){return i.endScope(r)},function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},n.prototype.scopedRun=function(e,t,r){e();try{var i=r();return t(),i}catch(o){throw t(),o}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),r={x:e};return this.addTapeNode(this.state.activeScope.name,r,[t],function(i){return{x:function(){return i.toFloat()}}},[]),t},n.prototype.runKernel=function(e,t,r,i,o){return this.runKernelFunc(null,t,null,e,r,i,o)},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var i=this.backend.numDataIds(),o=0;r.forEach(function(u){o+=u.dtype==="complex64"?3:1});var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=i-t-o-a;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+e+"'")},n.prototype.runKernelFunc=function(e,t,r,i,o,a,s){var u,l=this;a===void 0&&(a=[]),s===void 0&&(s=[]);var c=[],h=this.isTapeOn();i==null&&(i=this.state.activeScope!=null?this.state.activeScope.name:"");var d,p=function(w){h&&(c=w.map(function(_){return l.keep(l.clone(_))}))},m=this.state.numBytes,g=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var y,v=$R(i,this.backendName);return d=v!=null?function(){var w=l.backend.numDataIds();y=v.kernelFunc({inputs:t,attrs:o,backend:l.backend});var _=Array.isArray(y)?y:[y];l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(i,w,_);var x=_.map(function(A){var T=A.dataId,E=A.shape,I=A.dtype;return l.makeTensorFromDataId(T,E,I)}),C=x.filter(function(A,T){return s[T]});return p((a||[]).slice().concat(C)),x}:function(){var w=l.backend.numDataIds();y=l.tidy(function(){return e(l.backend,p)});var _=Array.isArray(y)?y:[y];return l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(i,w,_),_},this.scopedRun(function(){return l.state.kernelDepth++},function(){return l.state.kernelDepth--},function(){u=l.ENV.getBool("DEBUG")?l.profiler.profileKernel(i,t,function(){return d()}):d()}),h&&this.addTapeNode(i,t,u,r,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:i,bytesAdded:this.state.numBytes-m,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-g,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(w){return t[w].shape}),outputShapes:u.map(function(w){return w.shape})}),Array.isArray(y)?u:u[0]},n.prototype.makeTensor=function(e,t,r,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",i=i||this.backend;var o=e;r==="string"&&m1(e[0])&&(o=e.map(function(c){return hj(c)}));var a=i.write(o,t,r),s=new lt(t,r,a,this.nextTensorId());if(this.incRef(s,i),r==="string"){var u=this.state.tensorInfo.get(a),l=uj(o);this.state.numBytes+=l-u.bytes,u.bytes=l}return s},n.prototype.makeTensorFromDataId=function(e,t,r,i){var o=new lt(t,r=r||"float32",e,this.nextTensorId());return this.incRef(o,i),o},n.prototype.makeVariable=function(e,t,r,i){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.asType(i));var o=new mu(e,t,r,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},n.prototype.incRef=function(e,t){var r=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*KR(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:i,refCount:0}),this.state.numBytes+=i}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof mu||this.track(e)},n.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return ce(this,void 0,void 0,function(){var t,r;return he(this,function(i){return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(o){return o.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r,i,o){var a=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:o},u=ej(e);u!=null&&(i=u.gradFunc),i!=null&&(s.gradient=function(l){return l=l.map(function(c,h){if(c==null){var d=r[h],p=Bc(d.size,d.dtype);return a.makeTensor(p,d.shape,d.dtype)}return c}),i(l.length>1?l:l[0],o)}),this.state.activeTape.push(s)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=ek(e),i=new Set(r.map(function(u){return u.id})),o=0;o<this.state.activeScope.track.length;o++){var a=this.state.activeScope.track[o];a.kept||i.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==s.id||t.track(u)})},n.prototype.gradients=function(e,t,r,i){var o=this;if(i===void 0&&(i=!1),F(t.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var a=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",e)});F(a instanceof lt,function(){return"The result y returned by f() must be a tensor."});var s=function(u,l,c){for(var h={},d={},p=0;p<l.length;p++)h[l[p].id]=!0;for(p=0;p<u.length;p++){var m=(A=u[p]).inputs;for(var g in m){for(var y=m[g],v=!1,w=0;w<l.length;w++)if(h[y.id]){A.outputs.forEach(function(S){return h[S.id]=!0}),v=!0,d[A.id]=!0;break}if(v)break}}var _={};_[c.id]=!0;var x={};for(p=u.length-1;p>=0;p--)for(m=(A=u[p]).inputs,w=0;w<A.outputs.length;w++)if(_[A.outputs[w].id]){for(var g in m)_[m[g].id]=!0,x[A.id]=!0;break}var C=[];for(p=0;p<u.length;p++){var A;if(d[(A=u[p]).id]&&x[A.id]){var T={};for(var g in A.inputs){var E=A.inputs[g];h[E.id]&&(T[g]=E)}var I=Object.assign({},A);I.inputs=T,I.outputs=A.outputs,C.push(I)}}return C}(this.state.activeTape,t,a);if(!i&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,l,c={};c[a.id]=r??(u=a.shape,l=QR(fe(u),"float32"),U.makeTensor(l,u,"float32")),function(d,p,m){for(var g=function(v){var w=p[v],_=[];if(w.outputs.forEach(function(T){var E=d[T.id];E!=null?_.push(E):_.push(null)}),w.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+w.kernelName+".");var x=w.gradient(_),C=function(T){if(!(T in x))throw new Error("Cannot backprop through input "+T+". Available gradients found: "+Object.keys(x)+".");var E=m(function(){return x[T]()});if(E.dtype!=="float32")throw new Error("Error in gradient for op "+w.kernelName+". The gradient of input "+T+" must have 'float32' dtype, but has '"+E.dtype+"'");var I=w.inputs[T];if(!zt(E.shape,I.shape))throw new Error("Error in gradient for op "+w.kernelName+". The gradient of input '"+T+"' has shape '"+E.shape+"', which does not match the shape of the input '"+I.shape+"'");if(d[I.id]==null)d[I.id]=E;else{var S=d[I.id];d[I.id]=S.add(E),S.dispose()}};for(var A in w.inputs)C(A)},y=p.length-1;y>=0;y--)g(y)}(c,s,function(d){return o.tidy(d)});var h=t.map(function(d){return c[d.id]});return o.state.gradientDepth===0&&(o.state.activeTape.forEach(function(d){for(var p=0,m=d.saved;p<m.length;p++)m[p].dispose()}),o.state.activeTape=null),{value:a,grads:h}})},n.prototype.customGrad=function(e){var t=this;return F(ny(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];F(i.every(function(s){return s instanceof lt}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return i.forEach(function(s,u){a[u]=s}),t.runKernelFunc(function(s,u){return F((r=e.apply(void 0,i.concat([u]))).value instanceof lt,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),F(ny(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},a,function(s,u){var l=r.gradFunc(s,u),c=Array.isArray(l)?l:[l];F(c.length===i.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),F(c.every(function(d){return d instanceof lt}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var h={};return c.forEach(function(d,p){h[p]=function(){return d}}),h})}},n.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},n.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},n.prototype.time=function(e){return ce(this,void 0,void 0,function(){var t,r;return he(this,function(i){switch(i.label){case 0:return t=Xr(),[4,this.backend.time(e)];case 1:return(r=i.sent()).wallMs=Xr()-t,[2,r]}})})},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new EE,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n}(),U=function(){var n=function(){if(Zm==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}Zm=t}return Zm}();if(n._tfengine==null){var e=new J6(n);n._tfengine=new yj(e)}return function(t){WR=t}(n._tfengine.ENV),Yr=function(){return n._tfengine},n._tfengine}();function tk(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var yi=Y();yi.registerFlag("DEBUG",function(){return!1},function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),yi.registerFlag("IS_BROWSER",function(){return tk()}),yi.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),yi.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),yi.registerFlag("PROD",function(){return!1}),yi.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return yi.getBool("DEBUG")}),yi.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),yi.registerFlag("IS_TEST",function(){return!1});var dc,qn,$n,fa={},ev={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function wj(n,e){fa[n]=e}function di(n){n in fa||(fa[n]=function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(i){if(typeof OffscreenCanvas<"u"&&i===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return r.addEventListener("webglcontextlost",function(i){i.preventDefault(),delete fa[t]},!1),t===1?r.getContext("webgl",ev)||r.getContext("experimental-webgl",ev):r.getContext("webgl2",ev)}(n));var e=fa[n];return e.isContextLost()?(delete fa[n],di(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),fa[n])}function Np(n,e){return[e,n]}function Rl(n){var e=fe(n);return ty(Math.ceil(e/4))}function Uc(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function v1(n,e){var t,r,i,o,a,s,u,l,c,h=n;return Y().getNumber("WEBGL_VERSION")===2?(t=h.R32F,r=h.R16F,i=h.RGBA16F,o=h.RGBA32F,a=h.RED,s=4,u=1,l=h.HALF_FLOAT,c=h.FLOAT):(t=n.RGBA,r=n.RGBA,i=n.RGBA,o=h.RGBA,a=n.RGBA,s=4,u=4,l=e!=null?e.HALF_FLOAT_OES:null,c=n.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function me(n,e,t){var r=t();return e&&function(i){var o=i.getError();if(o!==i.NO_ERROR)throw new Error("WebGL Error: "+Ej(i,o))}(n),r}(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(dc||(dc={})),function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"}(qn||(qn={})),function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}($n||($n={}));var _j=596e-10,xj=65504;function bj(n){return!!(Y().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||_j<Math.abs(n)&&Math.abs(n)<xj)}function Ej(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function Mh(n,e,t){return $i(n,e,function(){return n.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function Cj(n,e,t){var r=$i(n,e,function(){return n.createShader(n.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(me(n,e,function(){return n.shaderSource(r,t)}),me(n,e,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function Ij(n,e,t){var r=$i(n,e,function(){return n.createShader(n.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(me(n,e,function(){return n.shaderSource(r,t)}),me(n,e,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw function(i,o){var a=Tj.exec(o);if(a==null)return console.log("Couldn't parse line number in error: "+o),void console.log(i);for(var s=+a[1],u=i.split(`
`),l=u.length.toString().length+2,c=u.map(function(y,v){return $s((v+1).toString(),l)+y}),h=0,d=0;d<c.length;d++)h=Math.max(c[d].length,h);var p=c.slice(0,s-1),m=c.slice(s-1,s),g=c.slice(s);console.log(p.join(`
`)),console.log(o.split(`
`)[0]),console.log("%c "+$s(m[0],h),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(g.join(`
`))}(t,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var tv,nv,Tj=/ERROR: [0-9]+:([0-9]+):/g;function Sj(n,e){return $i(n,e,function(){return n.createProgram()},"Unable to create WebGLProgram.")}function Rj(n,e,t){if(me(n,e,function(){return n.linkProgram(t)}),n.getProgramParameter(t,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function rv(n,e,t){if(me(n,e,function(){return n.validateProgram(t)}),n.getProgramParameter(t,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function kj(n,e,t){var r=$i(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return me(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),me(n,e,function(){return n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function Aj(n,e,t){var r=$i(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return me(n,e,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)}),me(n,e,function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function Pj(n,e){return $i(n,e,function(){return n.createTexture()},"Unable to create WebGLTexture.")}function Nj(n,e){var t=Y().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){var r="["+n+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t)throw r="["+n+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function Dj(n,e){return $i(n,e,function(){return n.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function CE(n,e,t,r,i,o,a,s){var u=n.getAttribLocation(t,r);return u!==-1&&(me(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,i)}),me(n,e,function(){return n.vertexAttribPointer(u,o,n.FLOAT,!1,a,s)}),me(n,e,function(){return n.enableVertexAttribArray(u)}),!0)}function Oj(n,e,t,r){Bj(n,r),me(n,e,function(){return n.activeTexture(n.TEXTURE0+r)}),me(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)})}function Mj(n,e,t,r){return $i(n,e,function(){return n.getUniformLocation(t,r)},'uniform "'+r+'" not present in program.')}function Fj(n,e,t){return n.getUniformLocation(e,t)}function Lj(n,e,t,r,i,o){me(n,e,function(){return Oj(n,e,r,o)}),me(n,e,function(){return n.uniform1i(i,o)})}function iv(n,e,t,r){me(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)}),me(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0)})}function IE(n,e,t){me(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,t)}),me(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)})}function Fh(n){var e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Vj(n,e))}function Vj(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function $i(n,e,t,r){var i=me(n,e,function(){return t()});if(i==null)throw new Error(r);return i}function Bj(n,e){var t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function If(n,e){return e===void 0&&(e=2),fe(n.slice(0,n.length-e))}function Tf(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function ov(n){var e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[If(n)].concat(Tf(n))),e}function Uj(n,e){var t;e===void 0&&(e=!1);var r=Y().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,(n=n.map(function(l,c){return c>=n.length-2?qR(n[c]):n[c]})).length===1&&(n=[2,n[0]])),n.length!==2){var i=ma(n);n=i.newShape}var o=fe(n);if(n.length<=1&&o<=r)return[1,o];if(n.length===2&&n[0]<=r&&n[1]<=r)return n;if(n.length===3&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(n.length===3&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(n.length===4&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(n.length===4&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(e){var a=If(n),s=2,u=2;return n.length&&(s=(t=Tf(n))[0],u=t[1]),ty(o=a*(s/2)*(u/2)).map(function(l){return 2*l})}return ty(o)}function Lh(n){return n%2==0}function Vh(n,e){if(zt(n=n.slice(-2),e=e.slice(-2))||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){var t=n.slice(-1)[0],r=e.slice(-1)[0];if(t===r||Lh(t)&&Lh(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&Lh(n[0])&&Lh(e[0])}function jj(n){if(tv==null){var e=di(n);tv=e.getParameter(e.MAX_TEXTURE_SIZE)}return tv}function zj(n){if(nv==null){var e=di(n);nv=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,nv)}function Wj(n){if(n===0)return 0;var e=di(n);return mr(e,"EXT_disjoint_timer_query_webgl2")&&n===2?2:mr(e,"EXT_disjoint_timer_query")?1:0}function mr(n,e){return n.getExtension(e)!=null}function TE(n){try{if(di(n)!=null)return!0}catch{return!1}return!1}function $j(n){if(n===0)return!1;var e=di(n);if(n===1){if(!mr(e,"OES_texture_float"))return!1}else if(!mr(e,"EXT_color_buffer_float"))return!1;return uy(e)}function Hj(n){if(n===0)return!1;var e=di(n);if(n!==1){if(mr(e,"EXT_color_buffer_float"))return uy(e);if(mr(e,"EXT_color_buffer_half_float")){var t=e.getExtension("EXT_color_buffer_half_float");return function(r,i){var o=v1(r,i),a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,o.internalFormatHalfFloat,1,1,0,o.textureFormatFloat,o.textureTypeHalfFloat,null);var s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(a),r.deleteFramebuffer(s),u}(e,t)}return!1}return!!mr(e,"OES_texture_float")&&!!mr(e,"WEBGL_color_buffer_float")&&uy(e)}function uy(n){var e=v1(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);var i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(r),i}function Gj(n){return n===2&&di(n).fenceSync!=null}var Ee=Y();function nk(n){Y().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function ue(n,e){return U.tidy(n,e)}function Fn(n){ek(n).forEach(function(e){return e.dispose()})}function qj(n){return U.keep(n)}function Sf(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];Y().getBool("IS_TEST")||console.warn.apply(console,n)}function Zo(n,e){var t=n;if(si(n))return e==="string"?[]:[n.length];if(!Array.isArray(n))return[];for(var r=[];Array.isArray(t)||si(t)&&e!=="string";)r.push(t.length),t=t[0];return Array.isArray(n)&&Y().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function i(o,a,s){if(s=s||[],!Array.isArray(o)&&!si(o))return void F(a.length===0,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+a[0]+" elements"});F(a.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+o.length+" elements"}),F(o.length===a[0],function(){return"Element arr["+s.join("][")+"] should have "+a[0]+" elements, but has "+o.length+" elements"});for(var u=a.slice(1),l=0;l<o.length;++l)i(o[l],u,s.concat(l))}(n,r,[]),r}function SE(n,e,t,r){if(n!=null&&(n!=="numeric"&&n!==e||n==="numeric"&&e==="string"))throw new Error("Argument '"+t+"' passed to '"+r+"' must be "+n+" tensor, but got "+e+" tensor")}function M(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof lt)return SE(r,n.dtype,e,t),n;var i=Vc(n);if(i!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),SE(r,i,e,t),n==null||!si(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var o=n==null?"null":n.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+o+"'")}var a=Zo(n,i);si(n)||Array.isArray(n)||(n=[n]);var s=i!=="string"?XR(n,i,Y().getBool("DEBUG")):pu(n,[],!0);return U.makeTensor(s,a,i)}function Rf(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return n.map(function(i,o){return M(i,e+"["+o+"]",t)},r)}function rk(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function Kj(n,e,t){for(var r=n.length+e.length,i=[],o=0,a=0,s=0;s<r;s++)t.indexOf(s)===-1?i.push(n[o++]):i.push(e[a++]);return i}function ln(n,e){for(var t=[],r=n.length,i=0;i<r;i++)e.indexOf(i)===-1&&t.push(n[i]);return[t,e.map(function(o){return n[o]})]}function Vn(n,e){return Kj(n,e.map(function(t){return 1}),e)}function Wn(n,e,t){F(rk(e,t),function(){return n+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."})}function fi(n,e){if(rk(n,e))return null;for(var t=[],r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(function(i){return t.push(i)}),t}function g1(n){return n.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function pi(n,e){for(var t=[],r=e-n;r<e;++r)t.push(r);return t}function Xj(n,e){var t=n[0].length;n.forEach(function(i,o){F(i.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+t+")"})}),F(e>=0&&e<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var r=n[0];n.forEach(function(i,o){for(var a=0;a<t;a++)F(a===e||i[a]===r[a],function(){return"Error in concat"+t+"D: Shape of tensors["+o+"] ("+i+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function vu(n,e){for(var t=n[0].slice(),r=1;r<n.length;r++)t[e]+=n[r][e];return t}function L(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var i=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];U.startScope(t);try{var s=r.apply(void 0,o);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),U.endScope(s),s}catch(u){throw U.endScope(null),u}};return Object.defineProperty(i,"name",{value:t,configurable:!0}),i}Ee.registerFlag("HAS_WEBGL",function(){return Ee.getNumber("WEBGL_VERSION")>0}),Ee.registerFlag("WEBGL_VERSION",function(){return TE(2)?2:TE(1)?1:0}),Ee.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return Ee.get("WEBGL_VERSION")===2}),Ee.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),Ee.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),Ee.registerFlag("WEBGL_PACK",function(){return Ee.getBool("HAS_WEBGL")}),Ee.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_PACK_CLIP",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),Ee.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_PACK_REDUCE",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_CONV_IM2COL",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return jj(Ee.getNumber("WEBGL_VERSION"))}),Ee.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return zj(Ee.getNumber("WEBGL_VERSION"))}),Ee.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var n=Ee.getNumber("WEBGL_VERSION");return n===0?0:Wj(n)}),Ee.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Ee.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n}),Ee.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return $j(Ee.getNumber("WEBGL_VERSION"))}),Ee.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!Ee.getBool("WEBGL_FORCE_F16_TEXTURES")&&Ee.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),Ee.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return Hj(Ee.getNumber("WEBGL_VERSION"))}),Ee.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return Gj(Ee.getNumber("WEBGL_VERSION"))}),Ee.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return Ee.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),ZR=nk;var qt=L({complex_:function(n,e){var t=M(n,"real","complex"),r=M(e,"imag","complex");return qe(t.shape,r.shape,"real and imag shapes, "+t.shape+" and "+r.shape+", must match in call to tf.complex()."),U.runKernelFunc(function(i){return i.complex(t,r)},{$real:t,$imag:r})}}),dr=L({real_:function(n){var e=M(n,"input","real");return U.runKernelFunc(function(t){return t.real(e)},{$input:e})}}),Jr=L({imag_:function(n){var e=M(n,"input","imag");return U.runKernelFunc(function(t){return t.imag(e)},{$input:e})}});function Qt(n,e,t){return ea(n,e,Zo(n,t),t)}function ea(n,e,t,r){if(r==null&&(r=Vc(n)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!si(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){YR(e);var i=fe(e),o=fe(t);F(i===o,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+o});for(var a=0;a<t.length;++a){var s=t[a],u=a!==t.length-1||s!==fe(e.slice(a));F(t[a]===e[a]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "})}}return si(n)||Array.isArray(n)||(n=[n]),e=e||t,n=r!=="string"?XR(n,r,Y().getBool("DEBUG")):pu(n,[],!0),U.makeTensor(n,e,r)}function ae(n,e){if((si(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&si(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return ea(n,[],[],e)}function Tt(n,e){Au(n);var t=Zo(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return ea(n,null,t,e)}function Oo(n,e,t){if(Au(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=Zo(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return ea(n,e,r,t)}function y1(n,e,t){if(Au(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=Zo(n,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return ea(n,e,r,t)}function An(n,e,t){if(Au(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=Zo(n,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return ea(n,e,r,t)}function Qj(n,e,t){if(Au(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=Zo(n,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return ea(n,e,r,t)}function Yj(n,e,t){if(Au(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=Zo(n,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return ea(n,e=e||r,r,t)}function Jj(n,e,t,r){return e===void 0&&(e=!0),U.makeVariable(n,e,t,r)}function Pu(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Pu(n,"float32"),r=it(n,"float32");return qt(t,r)}var i=QR(fe(n),e);return U.makeTensor(i,n,e)}function it(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=it(n,"float32"),r=it(n,"float32");return qt(t,r)}var i=Bc(fe(n),e);return U.makeTensor(i,n,e)}function li(n,e,t){return U.runKernelFunc(function(r){return r.fill(n,e,t)},{})}function Zj(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");return U.runKernelFunc(function(r){return r.linspace(n,e,t)},{})}function kf(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");if(n===e||n<e&&t<0||e<n&&t>1)return it([0],r);var i=Bc(Math.abs(Math.ceil((e-n)/t)),r);e<n&&t===1&&(t=-1),i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+t;return Tt(i,r)}var ik=L({onesLike_:function(n){var e=M(n,"x","onesLike");if(e.dtype==="complex64"){var t=ik(dr(e)),r=je(Jr(e));return qt(t,r)}return U.runKernelFunc(function(i){return i.onesLike(e)},{$x:e},function(i,o){return{$x:function(){return je(i)}}})}}),je=L({zerosLike_:function(n){var e=M(n,"x","zerosLike");return U.runKernelFunc(function(t){return t.zerosLike(e)},{$x:e},function(t,r){return{$x:function(){return je(t)}}})}}),Dt=L({concat_:function(n,e){e===void 0&&(e=0),F(n.length>=1,function(){return"Pass at least one tensor to concat"});var t=Rf(n,"tensors","concat");t[0].dtype==="complex64"&&t.forEach(function(s){if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+s.dtype+". ")}),e=Lt(e,t[0].shape)[0];var r=vu(t.map(function(s){return s.shape}),e);if(fe(r)===0)return Qt([],r);if((t=t.filter(function(s){return s.size>0})).length===1)return t[0];var i=t.map(function(s){return s.shape});Xj(i,e);var o=t,a={axis:e};return U.runKernelFunc(function(s){return s.concat(t,e)},o,function(s){var u=i.map(function(l){return l[e]});return w1(s,u,e).map(function(l){return function(){return l}})},"Concat",a)}}),e5=L({concat1d_:function(n){return Dt(n,0)}}),t5=L({concat2d_:function(n,e){return Dt(n,e)}}),n5=L({concat3d_:function(n,e){return Dt(n,e)}}),r5=L({concat4d_:function(n,e){return Dt(n,e)}}),w1=L({split_:function(n,e,t){t===void 0&&(t=0);var r,i=M(n,"x","split");return t=Lt(t,i.shape)[0],typeof e=="number"?(F(i.shape[t]%e==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(i.shape[t]/e)):(F(i.shape[t]===e.reduce(function(o,a){return o+a}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e),U.runKernelFunc(function(o){return o.split(i,r,t)},{$x:i},function(o){return{$x:function(){return Dt(o,t)}}})}});function Qa(n,e){return n(e={exports:{}},e.exports),e.exports}var i5=Qa(function(n){(function(e,t,r){function i(s){var u,l=this,c=(u=4022871197,function(h){h=h.toString();for(var d=0;d<h.length;d++){var p=.02519603282416938*(u+=h.charCodeAt(d));p-=u=p>>>0,u=(p*=u)>>>0,u+=4294967296*(p-=u)}return 23283064365386963e-26*(u>>>0)});l.next=function(){var h=2091639*l.s0+23283064365386963e-26*l.c;return l.s0=l.s1,l.s1=l.s2,l.s2=h-(l.c=0|h)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(s),l.s0<0&&(l.s0+=1),l.s1-=c(s),l.s1<0&&(l.s1+=1),l.s2-=c(s),l.s2<0&&(l.s2+=1),c=null}function o(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function a(s,u){var l=new i(s),c=u&&u.state,h=l.next;return h.int32=function(){return 4294967296*l.next()|0},h.double=function(){return h()+11102230246251565e-32*(2097152*h()|0)},h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.alea=a})(0,n)}),o5=Qa(function(n){(function(e,t,r){function i(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var h=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^h^h>>>8},s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),u.next()}function o(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function a(s,u){var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xor128=a})(0,n)}),a5=Qa(function(n){(function(e,t,r){function i(s){var u=this,l="";u.next=function(){var h=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^h^h<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function o(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function a(s,u){var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xorwow=a})(0,n)}),s5=Qa(function(n){(function(e,t,r){function i(s){var u=this;u.next=function(){var l,c,h=u.x,d=u.i;return l=h[d],c=(l^=l>>>7)^l<<24,c^=(l=h[d+1&7])^l>>>10,c^=(l=h[d+3&7])^l>>>3,c^=(l=h[d+4&7])^l<<7,l=h[d+7&7],c^=(l^=l<<13)^l<<9,h[d]=c,u.i=d+1&7,c},function(l,c){var h,d=[];if(c===(0|c))d[0]=c;else for(c=""+c,h=0;h<c.length;++h)d[7&h]=d[7&h]<<15^c.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8?d[7]=-1:d[h],l.x=d,l.i=0,h=256;h>0;--h)l.next()}(u,s)}function o(s,u){return u.x=s.x.slice(),u.i=s.i,u}function a(s,u){s==null&&(s=+new Date);var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=l.next,h.quick=h,c&&(c.x&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xorshift7=a})(0,n)}),u5=Qa(function(n){(function(e,t,r){function i(s){var u=this;u.next=function(){var l,c,h=u.w,d=u.X,p=u.i;return u.w=h=h+1640531527|0,c=d[p+34&127],l=d[p=p+1&127],c^=c<<13,l^=l<<17,c^=c>>>15,l^=l>>>12,c=d[p]=c^l,u.i=p,c+(h^h>>>16)|0},function(l,c){var h,d,p,m,g,y=[],v=128;for(c===(0|c)?(d=c,c=null):(c+="\0",d=0,v=Math.max(v,c.length)),p=0,m=-32;m<v;++m)c&&(d^=c.charCodeAt((m+32)%c.length)),m===0&&(g=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,m>=0&&(g=g+1640531527|0,p=(h=y[127&m]^=d+g)==0?p+1:0);for(p>=128&&(y[127&(c&&c.length||0)]=-1),p=127,m=512;m>0;--m)d=y[p+34&127],h=y[p=p+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,y[p]=d^h;l.w=g,l.X=y,l.i=p}(u,s)}function o(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function a(s,u){s==null&&(s=+new Date);var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=l.next,h.quick=h,c&&(c.X&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xor4096=a})(0,n)}),l5=Qa(function(n){(function(e,t,r){function i(s){var u=this,l="";u.next=function(){var h=u.b,d=u.c,p=u.d,m=u.a;return h=h<<25^h>>>7^d,d=d-p|0,p=p<<24^p>>>8^m,m=m-h|0,u.b=h=h<<20^h>>>12^d,u.c=d=d-p|0,u.d=p<<16^d>>>16^m,u.a=m-h|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):l+=s;for(var c=0;c<l.length+20;c++)u.b^=0|l.charCodeAt(c),u.next()}function o(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function a(s,u){var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.tychei=a})(0,n)}),pa=Qa(function(n){(function(e,t){var r,i=this,o=256,a=6,s="random",u=t.pow(o,a),l=t.pow(2,52),c=2*l,h=o-1;function d(v,w,_){var x=[],C=g(function E(I,S){var N,P=[],k=typeof I;if(S&&k=="object")for(N in I)try{P.push(E(I[N],S-1))}catch{}return P.length?P:k=="string"?I:I+"\0"}((w=w==1?{entropy:!0}:w||{}).entropy?[v,y(e)]:v??function(){try{var E;return r&&(E=r.randomBytes)?E=E(o):(E=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(E)),y(E)}catch{var I=i.navigator,S=I&&I.plugins;return[+new Date,i,S,i.screen,y(e)]}}(),3),x),A=new p(x),T=function(){for(var E=A.g(a),I=u,S=0;E<l;)E=(E+S)*o,I*=o,S=A.g(1);for(;E>=c;)E/=2,I/=2,S>>>=1;return(E+S)/I};return T.int32=function(){return 0|A.g(4)},T.quick=function(){return A.g(4)/4294967296},T.double=T,g(y(A.S),e),(w.pass||_||function(E,I,S,N){return N&&(N.S&&m(N,A),E.state=function(){return m(A,{})}),S?(t[s]=E,I):E})(T,C,"global"in w?w.global:this==t,w.state)}function p(v){var w,_=v.length,x=this,C=0,A=x.i=x.j=0,T=x.S=[];for(_||(v=[_++]);C<o;)T[C]=C++;for(C=0;C<o;C++)T[C]=T[A=h&A+v[C%_]+(w=T[C])],T[A]=w;(x.g=function(E){for(var I,S=0,N=x.i,P=x.j,k=x.S;E--;)I=k[N=h&N+1],S=S*o+k[h&(k[N]=k[P=h&P+I])+(k[P]=I)];return x.i=N,x.j=P,S})(o)}function m(v,w){return w.i=v.i,w.j=v.j,w.S=v.S.slice(),w}function g(v,w){for(var _,x=v+"",C=0;C<x.length;)w[h&C]=h&(_^=19*w[h&C])+x.charCodeAt(C++);return y(w)}function y(v){return String.fromCharCode.apply(0,v)}if(t["seed"+s]=d,g(t.random(),e),n.exports){n.exports=d;try{r=require("crypto")}catch{}}})([],Math)});pa.alea=i5,pa.xor128=o5,pa.xorwow=a5,pa.xorshift7=s5,pa.xor4096=u5,pa.tychei=l5;var Dp=pa.alea,_1=function(){function n(e,t,r,i,o){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=Dp(a.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,i=!1;!i;){var o=void 0,a=void 0,s=void 0;do s=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*o*u,r=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(t)||(i=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n}(),c5=function(){function n(e,t,r,i){this.alpha=e,this.beta=1/t,this.dtype=r;var o=i||Math.random();this.randu=Dp(o.toString()),this.randn=new _1(0,1,r,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var e,t,r,i,o,a;;){do i=this.randn.nextValue(),a=1+this.c*i;while(a<=0);if(a*=a*a,t=1-.331*(e=i*i)*e,r=.5*e+this.d*(1-a+Math.log(a)),(o=this.randu())<t||Math.log(o)<r)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},n.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},n}(),h5=function(){function n(e,t,r,i){var o=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return o.dtype==null||o.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=r,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=Dp(i)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n}();function Se(n,e,t){return e===void 0&&(e="float32"),e=e||"float32",YR(n),new hc(n,e,t)}function d5(n,e){e===void 0&&(e=!1),console.log(n.toString(e))}var ok=L({batchToSpaceND_:function(n,e,t){var r=M(n,"x","batchToSpaceND"),i=e.reduce(function(o,a){return o*a});return F(r.rank>=1+e.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length}),F(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),F(r.shape[0]%i==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i}),U.runKernelFunc(function(o){return o.batchToSpaceND(r,e,t)},{$x:r},function(o){return{$x:function(){return o.spaceToBatchND(e,t)}}})}}),f5=L({broadcastTo_:function(n,e){var t=M(n,"broadcastTo","x"),r=t.shape;if(e.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var i=t.shape.slice();i.length<e.length;)i.unshift(1);t=t.reshape(i)}for(var o=Array.from(e),a=e.length-1;a>=0;a--)if(t.shape[a]===e[a])o[a]=1;else if(t.shape[a]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var s=o.map(function(u,l){return u>1?l:-1}).filter(function(u){return u>=0});return s.length===0?t.clone():U.runKernelFunc(function(u){return u.tile(t,o)},{input:t},function(u){return{input:function(){return u.sum(s,!0)}}})}}),p5=L({cast_:function(n,e){var t=M(n,"x","cast");if(!aj(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:e};return U.runKernelFunc(function(i){return i.cast(t,e)},{x:t},function(i){return{x:function(){return i.clone()}}},"Cast",r)}}),m5=L({clone_:function(n){var e=M(n,"x","clone",null);return U.runKernelFunc(function(){return U.makeTensorFromDataId(e.dataId,e.shape,e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),v5=L({cumsum_:function(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var i=M(n,"x","cumsum"),o=fi([e|=0],i.rank),a=i;o!=null&&(a=i.transpose(o));var s=pi(1,i.rank)[0],u=U.runKernelFunc(function(l){return l.cumsum(a,s,t,r)},{permutedX:a},function(l){return{permutedX:function(){return l.cumsum(e,t,!r)}}});return o!=null&&(u=u.transpose(o)),u}}),g5=L({depthToSpace_:function(n,e,t){t===void 0&&(t="NHWC");var r=M(n,"x","depthToSpace"),i=t==="NHWC"?r.shape[1]:r.shape[2],o=t==="NHWC"?r.shape[2]:r.shape[3],a=t==="NHWC"?r.shape[3]:r.shape[1];return F(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+e+`  for depthToSpace with input shape
      `+r.shape}),F(o*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+e+` for depthToSpace with input shape
          `+r.shape}),F(a%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+a+" for depthToSpace with input shape "+r.shape}),U.runKernelFunc(function(s){return s.depthToSpace(r,e,t)},{$x:r})}}),lr=L({expandDims_:function(n,e){e===void 0&&(e=0);var t=M(n,"x","expandDims",null);F(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r=t.shape.slice();return e<0&&(F(-(t.rank+1)<=e,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),e=t.rank+e+1),r.splice(e,0,1),Pr(t,r)}}),ak=L({eye_:function(n,e,t,r){r===void 0&&(r="float32"),e==null&&(e=n);for(var i=Se([n,e],r),o=n<=e?n:e,a=0;a<o;++a)i.set(1,a,a);var s=i.toTensor().as2D(n,e);if(t==null)return s;if(t.length===1)return Hs(lr(s,0),[t[0],1,1]);if(t.length===2)return Hs(lr(lr(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return Hs(lr(lr(lr(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),y5=L({multinomial_:function(n,e,t,r){r===void 0&&(r=!1);var i=M(n,"logits","multinomial"),o=i.size,a=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);t=t||Math.random();var s=a===1?i.as2D(1,-1):i,u=U.runKernelFunc(function(l){return l.multinomial(s,r,e,t)},{logits2D:s});return a===1?u.as1D():u}}),ly=L({oneHot_:function(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=M(n,"indices","oneHot","int32"),o=i.shape.concat([e]);return i=i.flatten(),U.runKernelFunc(function(a){return a.oneHot(i,e,t,r)},{$indices:i},function(a){return{$indices:function(){return it(i.shape,"float32")}}}).reshape(o)}}),Ya=L({pad_:function(n,e,t){t===void 0&&(t=0);var r=M(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:e,constantValue:t};return U.runKernelFunc(function(o){return o.pad(r,e,t)},{x:r},function(o){var a=e.map(function(s){return s[0]});return{x:function(){return o.slice(a,r.shape)}}},"PadV2",i)}}),w5=L({pad1d_:function(n,e,t){return t===void 0&&(t=0),F(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Ya(n,[e],t)}}),_5=L({pad2d_:function(n,e,t){return t===void 0&&(t=0),F(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ya(n,e,t)}}),x5=L({pad3d_:function(n,e,t){return t===void 0&&(t=0),F(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ya(n,e,t)}}),b5=L({pad4d_:function(n,e,t){return t===void 0&&(t=0),F(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ya(n,e,t)}}),E5=L({rand_:function(n,e,t){var r=fe(n),i=null;if(t==null||t==="float32")i=new Float32Array(r);else if(t==="int32")i=new Int32Array(r);else{if(t!=="bool")throw new Error("Unknown data type "+t);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=e();return U.makeTensor(i,n,t)}}),C5=L({randomNormal_:function(n,e,t,r,i){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new _1(e,t,r,!1,i),a=Se(n,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),I5=L({randomGamma_:function(n,e,t,r,i){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var o=new c5(e,t,r,i),a=Se(n,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),sk=L({randomUniform_:function(n,e,t,r,i){e===void 0&&(e=0),t===void 0&&(t=1),r===void 0&&(r="float32");for(var o=Se(n,r),a=new h5(e,t,null,i),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),Pr=L({reshape_:function(n,e){var t=M(n,"x","reshape",null);e=ij(e,t.size),F(t.size===fe(e),function(){return"new shape and old shape must have the same number of elements."});var r={shape:e};return U.runKernelFunc(function(i){return i.reshape(t,e)},{x:t},function(i){return{x:function(){return i.reshape(t.shape)}}},"Reshape",r)}}),uk=L({spaceToBatchND_:function(n,e,t){var r=M(n,"x","spaceToBatchND");return F(r.rank>=1+e.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length}),F(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),F(r.shape.reduce(function(i,o,a){return a>0&&a<=e.length?i&&(o+t[a-1][0]+t[a-1][1])%e[a-1]==0:i},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()}),U.runKernelFunc(function(i){return i.spaceToBatchND(r,e,t)},{$x:r},function(i){return{$x:function(){return i.batchToSpaceND(e,t)}}})}}),lk=L({squeeze_:function(n,e){var t=M(n,"x","squeeze");return Pr(t,ma(t.shape,e).newShape)}}),Yn=L({stack_:function(n,e){e===void 0&&(e=0);var t=Rf(n,"tensors","stack");if(F(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length===1)return t[0].expandDims(e);var r=t[0].rank,i=t[0].shape,o=t[0].dtype;F(e<=r,function(){return"Axis must be <= rank of the tensor"}),t.forEach(function(s){qe(i,s.shape,"All tensors passed to stack must have matching shapes")}),t.forEach(function(s){F(o===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=t.map(function(s){return s.expandDims(e)});return Dt(a,e)}}),Hs=L({tile_:function(n,e){var t=M(n,"x","tile",null);F(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."});var r=[t],i={reps:e};return U.runKernelFunc(function(o,a){var s=o.tile(t,e);return a([t]),s},{x:t},function(o,a){var s=a[0];return{x:function(){var u=je(s);if(s.rank===1)for(var l=0;l<e[0];++l)u=u.add(o.slice([l*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(l=0;l<e[0];++l)for(var c=0;c<e[1];++c)u=u.add(o.slice([l*s.shape[0],c*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(l=0;l<e[0];++l)for(c=0;c<e[1];++c)for(var h=0;h<e[2];++h)u=u.add(o.slice([l*s.shape[0],c*s.shape[1],h*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(s.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(l=0;l<e[0];++l)for(c=0;c<e[1];++c)for(h=0;h<e[2];++h)for(var d=0;d<e[3];++d)u=u.add(o.slice([l*s.shape[0],c*s.shape[1],h*s.shape[2],d*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return u}}},"Tile",i,r)}}),T5=L({truncatedNormal_:function(n,e,t,r,i){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new _1(e,t,r,!0,i),a=Se(n,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),Ot=L({unstack_:function(n,e){e===void 0&&(e=0),e=e||0;var t=M(n,"x","unstack");F(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),e<0&&(e+=t.shape.length);var r={axis:e};return U.runKernelFunc(function(i){return i.unstack(t,e)},{x:t},function(i){return{x:function(){return Yn(i,e)}}},"Unpack",r)}}),S5=function(n,e){return ce(this,void 0,void 0,function(){var t,r,i,o,a,s,u,l,c,h;return he(this,function(d){switch(d.label){case 0:return t=M(n,"x","setdiff1d"),r=M(e,"y","setdiff1d"),F(t.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."}),F(t.rank===1,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),F(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,t.data()];case 1:return i=d.sent(),[4,r.data()];case 2:for(o=d.sent(),a=new Set(o),s=0,c=0;c<i.length;c++)a.has(i[c])||s++;for(u=new hc([s],t.dtype),l=new hc([s],"int32"),c=0,h=0;c<i.length;c++)a.has(i[c])||(u.values[h]=i[c],l.values[h]=c,h++);return[2,[u.toTensor(),l.toTensor()]]}})})};function Af(n,e,t,r){r===void 0&&(r=!0);var i=[];if(r)(i=i.concat(e.slice(0))).push(n[0]/t),i=i.concat(n.slice(1));else{i=i.concat(n[0]);for(var o=e.length,a=0;a<o;++a)i=i.concat([n[a+1]/e[a],e[a]]);i=i.concat(n.slice(o+1))}return i}function Pf(n,e,t){t===void 0&&(t=!0);var r=[];if(t){r.push(e);for(var i=e+1;i<n;++i)i<=2*e?(r.push(i),r.push(i-(e+1))):r.push(i)}else{var o=[],a=[];for(i=1;i<n;++i)i>=2*e+1||i%2==1?a.push(i):o.push(i);r.push.apply(r,o),r.push(0),r.push.apply(r,a)}return r}function Nf(n,e,t,r){r===void 0&&(r=!0);var i=[];r?i.push(n[0]/t):i.push(n[0]*t);for(var o=1;o<n.length;++o)o<=e.length?r?i.push(e[o-1]*n[o]):i.push(n[o]/e[o-1]):i.push(n[o]);return i}function ck(n,e){for(var t=[0],r=0;r<e;++r)t.push(n[r][0]);return t}function hk(n,e,t){for(var r=n.slice(0,1),i=0;i<t;++i)r.push(n[i+1]-e[i][0]-e[i][1]);return r}function dk(n,e){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+n.rank);if(n.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var t=e.shape,r=t[t.length-1],i=1,o=0;o<t.length-1;++o)i*=t[o];var a=n.shape,s=t.slice();s.pop();var u=1;for(o=r;o<n.rank;++o)u*=a[o],s.push(a[o]);var l=ui(n.shape).map(function(c){return c/u}).concat([1]).slice(0,r);return[s,i,u,l]}var fk=30;function av(n){return n<=fk?n:ry(n,Math.floor(Math.sqrt(n)))}function R5(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+i+".";if(t.rank<i)throw new Error(o+" update.rank < "+i+". ");if(n.length<r+(t.rank-i))throw new Error(o+" Output shape length < "+(r+(t.rank-i)));if(t.rank!==i+n.length-r)throw new Error(o+" update.rank != "+(i+n.length-r));for(var a=0;a<i;++a)if(t.shape[a]!==e.shape[a])throw new Error(o+" updates.shape["+a+"] ("+t.shape[a]+") != indices.shape["+a+"] ("+e.shape[a]+").");for(a=0;a<t.rank-i;++a)if(t.shape[a+i]!==n[a+r])throw new Error(o+" updates.shape["+(a+i)+"] ("+t.shape[a+i]+") != shape["+(a+i)+"] ("+n[a+i]+")")}function k5(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(n.size===0)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}R5(t,e,n)}function Df(n,e,t){for(var r=e.shape.length,i=r>1?e.shape[r-1]:1,o=t.length,a=1,s=i;s<o;++s)a*=t[s];var u=i<1?1:i;return{sliceRank:i,numUpdates:fe(e.shape)/u,sliceSize:a,strides:ui(t.slice(0,i)).concat([1]),outputSize:fe(t)}}function A5(n,e,t){F(n.rank===e.length,function(){return"Error in slice"+n.rank+"D: Length of begin "+e+" must match the rank of the array ("+n.rank+")."}),F(n.rank===t.length,function(){return"Error in slice"+n.rank+"D: Length of size "+t+" must match the rank of the array ("+n.rank+")."});for(var r=function(o){F(e[o]+t[o]<=n.shape[o],function(){return"Error in slice"+n.rank+"D: begin["+o+"] + size["+o+"] ("+(e[o]+t[o])+") would overflow input.shape["+o+"] ("+n.shape[o]+")"})},i=0;i<n.rank;++i)r(i)}function RE(n){for(var e=[],t=0;n>0;)1&n&&e.push(t),n/=2,t++;return e}function x1(n,e,t){for(var r=[],i=0;i<n.length;i++)r[i]=Math.ceil((e[i]-n[i])/t[i]);return r}function P5(n,e,t,r,i){var o=e[i],a=t[i]||1;(n&1<<i||o==null)&&(o=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[i];return o<0&&(o+=s),o=ey(0,o,s-1)}function N5(n,e,t,r,i){var o=e[i],a=t[i]||1;(n&1<<i||o==null)&&(o=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[i];return o<0&&(o+=s),o=a>0?ey(0,o,s):ey(-1,o,s-1)}function pk(n,e,t){for(var r=t.length,i=0;i<t.length;i++)if(t[i]>1){r=i;break}for(i=r+1;i<t.length;i++)if(e[i]>0||t[i]!==n[i])return!1;return!0}function mk(n,e){for(var t=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function D5(n,e){F(ny(n),function(){return"The f passed in variableGrads(f) must be a function"}),F(e==null||Array.isArray(e)&&e.every(function(c){return c instanceof mu}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t)for(var r in e=[],U.registeredVariables)e.push(U.registeredVariables[r]);var i=t?e.filter(function(c){return!c.trainable}):null,o=e.length;F((e=e.filter(function(c){return c.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."});var a=U.gradients(n,e,null,!0),s=a.value,u=a.grads;F(u.some(function(c){return c!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),F(s.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var l={};return e.forEach(function(c,h){u[h]!=null&&(l[c.name]=u[h])}),i!=null&&i.forEach(function(c){return l[c.name]=null}),{value:s,grads:l}}function Op(n){return U.customGrad(n)}var Hi=L({softmax_:function(n,e){e===void 0&&(e=-1);var t=M(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return U.runKernelFunc(function(r,i){var o=r.softmax(t,e);return i([o]),o},{logits:t},function(r,i){var o=i[0],a=r.mul(o);return{logits:function(){return a.sub(a.sum([e],!0).mul(o))}}},"Softmax",{dim:e},[],[!0])}}),O5=L({logSoftmax_:function(n,e){e===void 0&&(e=-1);var t=M(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return Op(function(r,i){var o=r.max(e,!0),a=r.sub(o),s=a.toFloat().sub(a.exp().sum(e,!0).log());return i([s]),{value:s,gradFunc:function(u,l){var c=l[0].exp();return u.sub(u.sum(e,!0).mul(c))}}})(t)}}),vk=function(){function n(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},n.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},n.prototype.has=function(e){return this.data.has(e)},n.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},n.prototype.numDataIds=function(){return this.dataIdsCount},n}(),gk=function(){function n(){}return n.prototype.time=function(e){return H("time")},n.prototype.read=function(e){return H("read")},n.prototype.readSync=function(e){return H("readSync")},n.prototype.numDataIds=function(){return H("numDataIds")},n.prototype.disposeData=function(e){return H("disposeData")},n.prototype.write=function(e,t,r){return H("write")},n.prototype.move=function(e,t,r,i){return H("move")},n.prototype.memory=function(){return H("memory")},n.prototype.floatPrecision=function(){return H("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.batchMatMul=function(e,t,r,i){return H("batchMatMul")},n.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,H("fusedBatchMatMul")},n.prototype.slice=function(e,t,r){return H("slice")},n.prototype.stridedSlice=function(e,t,r,i){return H("stridedSlice")},n.prototype.unstack=function(e,t){return H("unstack")},n.prototype.reverse=function(e,t){return H("reverse")},n.prototype.concat=function(e,t){return H("concat")},n.prototype.neg=function(e){return H("neg")},n.prototype.add=function(e,t){return H("add")},n.prototype.addN=function(e){return H("addN")},n.prototype.subtract=function(e,t){return H("subtract")},n.prototype.multiply=function(e,t){return H("multiply")},n.prototype.realDivide=function(e,t){return H("realDivide")},n.prototype.floorDiv=function(e,t){return H("floorDiv")},n.prototype.sum=function(e,t){return H("sum")},n.prototype.prod=function(e,t){return H("prod")},n.prototype.unsortedSegmentSum=function(e,t,r){return H("unsortedSegmentSum")},n.prototype.argMin=function(e,t){return H("argMin")},n.prototype.argMax=function(e,t){return H("argMax")},n.prototype.equal=function(e,t){return H("equal")},n.prototype.notEqual=function(e,t){return H("notEqual")},n.prototype.less=function(e,t){return H("less")},n.prototype.lessEqual=function(e,t){return H("lessEqual")},n.prototype.greater=function(e,t){return H("greater")},n.prototype.greaterEqual=function(e,t){return H("greaterEqual")},n.prototype.logicalNot=function(e){return H("logicalNot")},n.prototype.logicalAnd=function(e,t){return H("logicalAnd")},n.prototype.logicalOr=function(e,t){return H("logicalOr")},n.prototype.where=function(e){return H("where")},n.prototype.select=function(e,t,r){return H("select")},n.prototype.topk=function(e,t,r){return H("topk")},n.prototype.min=function(e,t){return H("min")},n.prototype.minimum=function(e,t){return H("minimum")},n.prototype.mod=function(e,t){return H("mod")},n.prototype.max=function(e,t){return H("max")},n.prototype.maximum=function(e,t){return H("maximum")},n.prototype.all=function(e,t){return H("all")},n.prototype.any=function(e,t){return H("any")},n.prototype.squaredDifference=function(e,t){return H("squaredDifference")},n.prototype.ceil=function(e){return H("ceil")},n.prototype.floor=function(e){return H("floor")},n.prototype.round=function(e){return H("round")},n.prototype.sign=function(e){return H("sign")},n.prototype.isNaN=function(e){return H("isNaN")},n.prototype.isInf=function(e){return H("isInf")},n.prototype.isFinite=function(e){return H("isFinite")},n.prototype.pow=function(e,t){return H("pow")},n.prototype.exp=function(e){return H("exp")},n.prototype.expm1=function(e){return H("expm1")},n.prototype.softmax=function(e,t){return H("softmax")},n.prototype.log=function(e){return H("log")},n.prototype.log1p=function(e){return H("log1p")},n.prototype.sqrt=function(e){return H("sqrt")},n.prototype.rsqrt=function(e){return H("rsqrt")},n.prototype.square=function(e){return H("square")},n.prototype.reciprocal=function(e){return H("reciprocal")},n.prototype.relu=function(e){return H("relu")},n.prototype.relu6=function(e){return H("relu6")},n.prototype.prelu=function(e,t){return H("prelu")},n.prototype.elu=function(e){return H("elu")},n.prototype.eluDer=function(e,t){return H("eluDer")},n.prototype.selu=function(e){return H("selu")},n.prototype.int=function(e){return H("int")},n.prototype.clip=function(e,t,r){return H("clip")},n.prototype.abs=function(e){return H("abs")},n.prototype.complexAbs=function(e){return H("complexAbs")},n.prototype.sigmoid=function(e){return H("sigmoid")},n.prototype.softplus=function(e){return H("softplus")},n.prototype.sin=function(e){return H("sin")},n.prototype.cos=function(e){return H("cos")},n.prototype.tan=function(e){return H("tan")},n.prototype.asin=function(e){return H("asin")},n.prototype.acos=function(e){return H("acos")},n.prototype.atan=function(e){return H("atan")},n.prototype.atan2=function(e,t){return H("atan2")},n.prototype.sinh=function(e){return H("sinh")},n.prototype.cosh=function(e){return H("cosh")},n.prototype.tanh=function(e){return H("tanh")},n.prototype.asinh=function(e){return H("asinh")},n.prototype.acosh=function(e){return H("acosh")},n.prototype.atanh=function(e){return H("atanh")},n.prototype.erf=function(e){return H("erf")},n.prototype.step=function(e,t){return H("step")},n.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,H("fusedConv2d")},n.prototype.conv2d=function(e,t,r){return H("conv2d")},n.prototype.conv2dDerInput=function(e,t,r){return H("conv2dDerInput")},n.prototype.conv2dDerFilter=function(e,t,r){return H("conv2dDerFilter")},n.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,H("fusedDepthwiseConv2D")},n.prototype.depthwiseConv2D=function(e,t,r){return H("depthwiseConv2D")},n.prototype.depthwiseConv2DDerInput=function(e,t,r){return H("depthwiseConv2DDerInput")},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){return H("depthwiseConv2DDerFilter")},n.prototype.conv3d=function(e,t,r){return H("conv3d")},n.prototype.conv3dDerInput=function(e,t,r){return H("conv3dDerInput")},n.prototype.conv3dDerFilter=function(e,t,r){return H("conv3dDerFilter")},n.prototype.maxPool=function(e,t){return H("maxPool")},n.prototype.maxPoolBackprop=function(e,t,r,i){return H("maxPoolBackprop")},n.prototype.avgPool=function(e,t){return H("avgPool")},n.prototype.avgPoolBackprop=function(e,t,r){return H("avgPoolBackprop")},n.prototype.avgPool3d=function(e,t){return H("avgPool3d")},n.prototype.avgPool3dBackprop=function(e,t,r){return H("avgPool3dBackprop")},n.prototype.maxPool3d=function(e,t){return H("maxPool3d")},n.prototype.maxPool3dBackprop=function(e,t,r,i){return H("maxPool3dBackprop")},n.prototype.reshape=function(e,t){return H("reshape")},n.prototype.cast=function(e,t){return H("cast")},n.prototype.tile=function(e,t){return H("tile")},n.prototype.pad=function(e,t,r){return H("pad")},n.prototype.transpose=function(e,t){return H("transpose")},n.prototype.gather=function(e,t,r){return H("gather")},n.prototype.gatherND=function(e,t){return H("gatherND")},n.prototype.scatterND=function(e,t,r){return H("scatterND")},n.prototype.batchToSpaceND=function(e,t,r){return H("batchToSpaceND")},n.prototype.spaceToBatchND=function(e,t,r){return H("spaceToBatchND")},n.prototype.resizeBilinear=function(e,t,r,i){return H("resizeBilinear")},n.prototype.resizeBilinearBackprop=function(e,t,r){return H("resizeBilinearBackprop")},n.prototype.resizeNearestNeighbor=function(e,t,r,i){return H("resizeNearestNeighbor")},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){return H("resizeNearestNeighborBackprop")},n.prototype.batchNormalization=function(e,t,r,i,o,a){return H("batchNormalization")},n.prototype.localResponseNormalization4D=function(e,t,r,i,o){return H("localResponseNormalization4D")},n.prototype.LRNGrad=function(e,t,r,i,o,a,s){return H("LRNGrad")},n.prototype.multinomial=function(e,t,r,i){return H("multinomial")},n.prototype.oneHot=function(e,t,r,i){return H("oneHot")},n.prototype.cumsum=function(e,t,r,i){return H("cumsum")},n.prototype.nonMaxSuppression=function(e,t,r,i,o){return H("nonMaxSuppression")},n.prototype.fft=function(e){return H("fft")},n.prototype.ifft=function(e){return H("ifft")},n.prototype.complex=function(e,t){return H("complex")},n.prototype.real=function(e){return H("real")},n.prototype.imag=function(e){return H("imag")},n.prototype.cropAndResize=function(e,t,r,i,o,a){return H("cropAndResize")},n.prototype.depthToSpace=function(e,t,r){return H("depthToSpace")},n.prototype.split=function(e,t,r){return H("split")},n.prototype.sparseToDense=function(e,t,r,i){return H("sparseToDense")},n.prototype.diag=function(e){return H("diag")},n.prototype.fill=function(e,t,r){return H("fill")},n.prototype.onesLike=function(e){return H("onesLike")},n.prototype.zerosLike=function(e){return H("zerosLike")},n.prototype.linspace=function(e,t,r){return H("linspace")},n.prototype.dispose=function(){return H("dispose")},n}();function H(n){throw new Error("'"+n+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function go(n,e){for(var t=n.length,r=[],i=0;i<t;i++){var o=t-1-i,a=n[o]||1;(e[e.length-1-i]||1)>1&&a===1&&r.unshift(o)}return r}function Mt(n,e){for(var t=[],r=0;r<e.length;r++){var i=n[n.length-r-1],o=e.length-r-1,a=e[o];(i==null||i===1&&a>1)&&t.unshift(o)}return t}function Oe(n,e){for(var t=[],r=Math.max(n.length,e.length),i=0;i<r;i++){var o=n[n.length-i-1];o==null&&(o=1);var a=e[e.length-i-1];if(a==null&&(a=1),o===1)t.unshift(a);else if(a===1)t.unshift(o);else{if(o!==a)throw Error("Operands could not be broadcast together with shapes "+n+" and "+e+".");t.unshift(o)}}return t}function fc(n,e,t,r,i,o,a){a===void 0&&(a="channelsLast");var s,u=Ff(e),l=u[0],c=u[1];if(a==="channelsLast")s=[l,c,n[3],n[3]];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);s=[l,c,n[1],n[1]]}return Ja(n,s,t,r,i,o,!1,a)}function Of(n,e,t,r,i,o,a){a===void 0&&(a="NDHWC");var s,u,l=cy(e),c=l[0],h=l[1],d=l[2];if(a==="NDHWC")u="channelsLast",s=[c,h,d,n[4],n[4]];else{if(a!=="NCDHW")throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[c,h,d,n[1],n[1]]}return Mf(n,s,t,r,i,!1,u,o)}function Ja(n,e,t,r,i,o,a,s){a===void 0&&(a=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],d=u[3];if(s==="channelsLast")l=n[0],c=n[1],h=n[2],d=n[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);l=n[0],d=n[1],c=n[2],h=n[3]}var p,m=e[0],g=e[1],y=e[3],v=Ff(t),w=v[0],_=v[1],x=Ff(r),C=x[0],A=x[1],T=Gs(m,C),E=Gs(g,A),I=function(j,B,W,X,V,$,G,te){var re,oe,_e;if(typeof j=="number"){re={top:j,bottom:j,left:j,right:j,type:j===0?"VALID":"NUMBER"};var pe=function(Ae,We,Be,Je,Xe){Je==null&&(Je=yk(Ae,We,Be));var Ze=Ae[0],rr=Ae[1],ir=kl((Ze-We+2*Je)/Be+1,Xe);F(xt(ir),function(){return"The output # of rows ("+ir+") must be an integer. Change the stride and/or zero pad parameters"});var tn=kl((rr-We+2*Je)/Be+1,Xe);return F(xt(tn),function(){return"The output # of columns ("+tn+") must be an integer. Change the stride and/or zero pad parameters"}),[ir,tn]}([B,W],$,X,j,te);oe=pe[0],_e=pe[1]}else if(j==="same"){oe=Math.ceil(B/X),_e=Math.ceil(W/V);var xe=Math.max(0,(oe-1)*X+$-B),Te=Math.max(0,(_e-1)*V+G-W),De=Math.floor(xe/2),Fe=xe-De,Ye=Math.floor(Te/2);re={top:De,bottom:Fe,left:Ye,right:Te-Ye,type:"SAME"}}else{if(j!=="valid")throw Error("Unknown padding parameter: "+j);re={top:0,bottom:0,left:0,right:0,type:"VALID"},oe=Math.ceil((B-$+1)/X),_e=Math.ceil((W-G+1)/V)}return{padInfo:re,outHeight:oe,outWidth:_e}}(i,c,h,w,_,T,E,o),S=I.padInfo,N=I.outHeight,P=I.outWidth,k=a?y*d:y;return s==="channelsFirst"?p=[l,k,N,P]:s==="channelsLast"&&(p=[l,N,P,k]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:h,inChannels:d,outHeight:N,outWidth:P,outChannels:k,padInfo:S,strideHeight:w,strideWidth:_,filterHeight:m,filterWidth:g,effectiveFilterHeight:T,effectiveFilterWidth:E,dilationHeight:C,dilationWidth:A,inShape:n,outShape:p,filterShape:e}}function Mf(n,e,t,r,i,o,a,s){o===void 0&&(o=!1),a===void 0&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],d=u[3],p=u[4];if(a==="channelsLast")l=n[0],c=n[1],h=n[2],d=n[3],p=n[4];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);l=n[0],p=n[1],c=n[2],h=n[3],d=n[4]}var m,g=e[0],y=e[1],v=e[2],w=e[4],_=cy(t),x=_[0],C=_[1],A=_[2],T=cy(r),E=T[0],I=T[1],S=T[2],N=Gs(g,E),P=Gs(y,I),k=Gs(v,S),j=function(G,te,re,oe,_e,pe,xe,Te,De,Fe,Ye){var Ae,We,Be,Je;if(typeof G=="number"){Ae={top:G,bottom:G,left:G,right:G,front:G,back:G,type:G===0?"VALID":"NUMBER"};var Xe=function(Wr,ar,bt,mt,xn,ts){xn==null&&(xn=yk(Wr,ar,mt));var Kc=Wr[0],Kp=Wr[1],na=Wr[2],ns=kl((Kc-ar+2*xn)/mt+1,ts);F(xt(ns),function(){return"The output # of depths ("+ns+") must be an integer. Change the stride and/or zero pad parameters"});var rs=kl((Kp-ar+2*xn)/mt+1,ts);F(xt(rs),function(){return"The output # of rows ("+rs+") must be an integer. Change the stride and/or zero pad parameters"});var ra=kl((na-ar+2*xn)/mt+1,ts);return F(xt(ra),function(){return"The output # of columns ("+ra+") must be an integer. Change the stride and/or zero pad parameters"}),[ns,rs,ra,bt]}([te,re,oe,1],Te,1,_e,G,Ye);We=Xe[0],Be=Xe[1],Je=Xe[2]}else if(G==="same"){We=Math.ceil(te/_e),Be=Math.ceil(re/pe),Je=Math.ceil(oe/xe);var Ze=(We-1)*_e+Te-te,rr=(Be-1)*pe+De-re,ir=(Je-1)*xe+Fe-oe,tn=Math.floor(Ze/2),jr=Ze-tn,or=Math.floor(rr/2),zr=rr-or,Un=Math.floor(ir/2);Ae={top:or,bottom:zr,left:Un,right:ir-Un,front:tn,back:jr,type:"SAME"}}else{if(G!=="valid")throw Error("Unknown padding parameter: "+G);Ae={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},We=Math.ceil((te-Te+1)/_e),Be=Math.ceil((re-De+1)/pe),Je=Math.ceil((oe-Fe+1)/xe)}return{padInfo:Ae,outDepth:We,outHeight:Be,outWidth:Je}}(i,c,h,d,x,C,A,N,P,k,s),B=j.padInfo,W=j.outDepth,X=j.outHeight,V=j.outWidth,$=o?w*p:w;return a==="channelsFirst"?m=[l,$,W,X,V]:a==="channelsLast"&&(m=[l,W,X,V,$]),{batchSize:l,dataFormat:a,inDepth:c,inHeight:h,inWidth:d,inChannels:p,outDepth:W,outHeight:X,outWidth:V,outChannels:$,padInfo:B,strideDepth:x,strideHeight:C,strideWidth:A,filterDepth:g,filterHeight:y,filterWidth:v,effectiveFilterDepth:N,effectiveFilterHeight:P,effectiveFilterWidth:k,dilationDepth:E,dilationHeight:I,dilationWidth:S,inShape:n,outShape:m,filterShape:e}}function yk(n,e,t,r){r===void 0&&(r=1);var i=Gs(e,r);return Math.floor((n[0]*(t-1)-t+i)/2)}function Ff(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function cy(n){return typeof n=="number"?[n,n,n]:n}function Gs(n,e){return e<=1?n:n+(n-1)*(e-1)}function kl(n,e){if(!e)return n;switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+e)}}function gu(n){var e=Ff(n),t=e[0],r=e[1],i=e[2];return t===1&&r===1&&i===1}function Bn(n,e){return gu(n)||gu(e)}function b1(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+n)}function wk(n,e,t){if(e==="complex64"){if(n.dtype==="complex64")return n.clone();var r=it(n.shape),i=n.toFloat(),o=t.complex(i,r);return r.dispose(),i.dispose(),o}if(!sj(n.dtype,e))return U.makeTensorFromDataId(n.dataId,n.shape,e);if(n.dtype==="complex64"){var a=t.real(n);return o=a.cast(e),a.dispose(),o}if(e==="int32")return t.int(n);if(e==="bool"){var s=ae(0,n.dtype);return o=t.notEqual(n,s),s.dispose(),o}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+e)}function hy(n,e){return U.makeTensorFromDataId(n.dataId,e,n.dtype)}function _k(n,e,t){var r=(e-n)/(t-1),i=Bc(t,"float32");i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return Tt(i,"float32")}function dy(n,e){if(n.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+e.length+".");for(var t=new Float32Array(2*n.length),r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function kE(n,e){return{real:n[2*e],imag:n[2*e+1]}}function M5(n,e,t,r){n[2*r]=e,n[2*r+1]=t}function F5(n,e,t){var r=(t?2:-2)*Math.PI*(n/e);return{real:Math.cos(r),imag:Math.sin(r)}}function L5(n,e,t){var r=function(o,a,s){return function(u,l,c){for(var h=0,d=u.length,p=0,m=!1;h<d;){var g=c(l,u[p=h+(d-h>>>1)]);g>0?h=p+1:(d=p,m=!g)}return m?h:-h-1}(o,a,s||V5)}(n,e,t),i=r<0?-(r+1):r;n.splice(i,0,e)}function V5(n,e){return n>e?1:n<e?-1:0}function E1(n,e,t,r,i){return xk(n,e,t,r,i,0).selectedIndices}function C1(n,e,t,r,i,o){var a=xk(n,e,t,r,i,o);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function xk(n,e,t,r,i,o,a,s){s===void 0&&(s=!1);for(var u=Array.from(e).map(function(x,C){return{score:x,boxIndex:C,suppressBeginIndex:0}}).filter(function(x){return x.score>i}).sort(AE),l=o>0?-.5/o:0,c=[],h=[];c.length<t&&u.length>0;){var d=u.pop(),p=d.score,m=d.boxIndex,g=d.suppressBeginIndex;if(p<i)break;for(var y=!1,v=c.length-1;v>=g;--v){var w=B5(n,m,c[v]);if(w>=r){y=!0;break}if(d.score=d.score*U5(r,l,w),d.score<=i)break}d.suppressBeginIndex=c.length,y||(d.score===p?(c.push(m),h.push(d.score)):d.score>i&&L5(u,d,AE))}var _=c.length;return s&&(c.fill(0,_),h.fill(0,_)),{selectedIndices:Tt(c,"int32"),selectedScores:Tt(h,"float32"),numValidOutputs:ae(_,"int32")}}function B5(n,e,t){var r=n.subarray(4*e,4*e+4),i=n.subarray(4*t,4*t+4),o=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),d=Math.max(i[1],i[3]),p=(s-o)*(u-a),m=(h-l)*(d-c);if(p<=0||m<=0)return 0;var g=Math.max(o,l),y=Math.max(a,c),v=Math.min(s,h),w=Math.min(u,d),_=Math.max(v-g,0)*Math.max(w-y,0);return _/(p+m-_)}function U5(n,e,t){var r=Math.exp(e*t*t);return t<=n?r:0}function AE(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}function bk(n,e,t){var r=new Array(n.rank).fill(0),i=n.shape.slice();return e.map(function(o){i[t]=o;var a=n.slice(r,i);return r[t]+=o,a})}function Ek(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];var i=Se(t,n.dtype);for(r=0;r<i.values.length;++r){for(var o=i.indexToLoc(r),a=new Array(n.rank),s=0;s<a.length;s++)a[s]=o[s]%n.shape[s];var u=n.locToIndex(a);i.values[r]=n.values[u]}return i.toTensor()}function Ck(n,e,t,r,i){for(var o=e[e.length-1],a=[n.length/o,o],s=a[0],u=a[1],l=cc(t,s*r),c=cc("int32",s*r),h=0;h<s;h++){for(var d=h*u,p=n.subarray(d,d+u),m=[],g=0;g<p.length;g++)m.push({value:p[g],index:g});m.sort(function(x,C){return C.value-x.value});var y=h*r,v=l.subarray(y,y+r),w=c.subarray(y,y+r);for(g=0;g<r;g++)v[g]=m[g].value,w[g]=m[g].index}var _=e.slice();return _[_.length-1]=r,[Qt(l,_,t),Qt(c,_,"int32")]}function I1(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);var i=Se(n,"int32"),o=Se([t.length,n.length],"int32");for(r=0;r<t.length;r++){var a=i.indexToLoc(t[r]),s=r*n.length;o.values.set(a,s)}return o.toTensor()}var j5=function(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map(function(i,o){return"T"+o});var t=[];this.variableNames.forEach(function(i){t.push("float v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},z5=function(n,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=e.map(function(i,o){return"T"+o});var t=[];this.variableNames.forEach(function(i){t.push("vec4 v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},W5=function(n,e,t){this.variableNames=["A"];var r=n.windowSize,i=n.batchSize,o=n.inSize,a=Math.ceil(o/r);t||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a];var s=e==="max"?">":"<",u=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function Ik(n,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return n+"."+t})}function Pn(n,e){return e===1?[n]:Ik(n,e)}function fn(){var n,e,t,r,i,o,a,s,u,l;return Y().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",i="texture",o="outputColor",a="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",i="texture2D",o="gl_FragColor",a="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:i,output:o,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function _a(n,e,t){t===void 0&&(t="index");var r=ui(e);return r.map(function(i,o){return"int "+n[o]+" = "+t+" / "+i+"; "+(o===r.length-1?"int "+n[o+1]+" = "+t+" - "+n[o]+" * "+i:"index -= "+n[o]+" * "+i)+";"}).join("")}function T1(n){var e=ui(n).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var Tk=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function $5(n,e,t,r){var i=[];n.forEach(function(p){var m=fe(p.shapeInfo.logicalShape);p.shapeInfo.isUniform?i.push("uniform float "+p.name+(m>1?"["+m+"]":"")+";"):(i.push("uniform sampler2D "+p.name+";"),i.push("uniform int offset"+p.name+";"))});var o,a,s=i.join(`
`),u=n.map(function(p){return function(m,g,y){y===void 0&&(y=!1);var v="";v+=y?Sk(m):gs(m);var w=m.shapeInfo.logicalShape,_=g.logicalShape;return w.length<=_.length&&(v+=y?function(x,C){var A,T=x.name,E=T.charAt(0).toUpperCase()+T.slice(1),I="get"+E+"AtOutCoords",S=x.shapeInfo.logicalShape.length,N=C.logicalShape.length,P=go(x.shapeInfo.logicalShape,C.logicalShape),k=tt(N),j=N-S,B=["x","y","z","w","u","v"];A=S===0?"":N<2&&P.length>=1?"coords = 0;":P.map(function(re){return"coords."+B[re+j]+" = 0;"}).join(`
`);var W="";W=N<2&&S>0?"coords":x.shapeInfo.logicalShape.map(function(re,oe){return"coords."+B[oe+j]}).join(", ");var X="return outputValue;",V=fe(x.shapeInfo.logicalShape)===1,$=fe(C.logicalShape)===1;if(S!==1||V||$){if(V&&!$)X=N===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(P.length){var G=S-2,te=S-1;P.indexOf(G)>-1&&P.indexOf(te)>-1?X="return vec4(outputValue.x);":P.indexOf(G)>-1?X="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":P.indexOf(te)>-1&&(X="return vec4(outputValue.xx, outputValue.zz);")}}else X=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+I+`() {
      `+k+` coords = getOutputCoords();
      `+A+`
      vec4 outputValue = get`+E+"("+W+`);
      `+X+`
    }
  `}(m,g):function(x,C){var A=x.name,T=A.charAt(0).toUpperCase()+A.slice(1),E="get"+T+"AtOutCoords",I=C.texShape,S=x.shapeInfo.texShape,N=x.shapeInfo.logicalShape.length,P=C.logicalShape.length;if(!x.shapeInfo.isUniform&&N===P&&x.shapeInfo.flatOffset==null&&zt(S,I))return`
      float `+E+`() {
        return sampleTexture(`+A+`, resultUV);
      }
    `;var k,j=tt(P),B=go(x.shapeInfo.logicalShape,C.logicalShape),W=P-N,X=["x","y","z","w","u","v"];k=N===0?"":P<2&&B.length>=1?"coords = 0;":B.map(function($){return"coords."+X[$+W]+" = 0;"}).join(`
`);var V="";return V=P<2&&N>0?"coords":x.shapeInfo.logicalShape.map(function($,G){return"coords."+X[G+W]}).join(", "),`
    float `+E+`() {
      `+j+` coords = getOutputCoords();
      `+k+`
      return get`+T+"("+V+`);
    }
  `}(m,g)),v}(p,e,r)}).join(`
`),l=e.texShape,c=fn(),h=function(p){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+p.texture2D+`(textureSampler, uv).r;
    }
  `}(c),d=function(p){return p.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+p.varyingFs+` vec2 resultUV;
    `+p.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+p.defineSpecialNaN+`
    `+p.defineSpecialInf+`
    `+p.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+H5+`
    `+G5+`
    `+q5+`
  `}(c);return e.isPacked?(o=function(p,m){switch(p.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(x,C){var A=[Math.ceil(C[0]/2),Math.ceil(C[1]/2)];return A[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+A[1]+`.0);
      }
    `:A[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+A[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+A[0]+", "+A[1]+`));
      return 2 * (resTexRC.x * `+A[1]+` + resTexRC.y);
    }
  `}(0,m);case 2:return function(x,C){var A=[Math.ceil(C[0]/2),Math.ceil(C[1]/2)];if(zt(x,C))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+A[0]+", "+A[1]+`));
      }
    `;var T=Math.ceil(x[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+A[0]+", "+A[1]+`));

      int index = resTexRC.x * `+A[1]+` + resTexRC.y;
      int r = 2 * (index / `+T+`);
      int c = imod(index, `+T+`) * 2;

      return ivec2(r, c);
    }
  `}(p,m);case 3:return g=p,y=m,v=[Math.ceil(y[0]/2),Math.ceil(y[1]/2)],w=Math.ceil(g[2]/2),_=w*Math.ceil(g[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;

      int b = index / `+_+`;
      index -= b * `+_+`;

      int r = 2 * (index / `+w+`);
      int c = imod(index, `+w+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(x,C){for(var A=[Math.ceil(C[0]/2),Math.ceil(C[1]/2)],T=Math.ceil(x[x.length-1]/2),E=T*Math.ceil(x[x.length-2]/2),I=E,S="",N="b, r, c",P=2;P<x.length-1;P++)I*=x[x.length-P-1],S=`
      int b`+P+" = index / "+I+`;
      index -= b`+P+" * "+I+`;
    `+S,N="b"+P+", "+N;return`
    ivec`+x.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+A[0]+", "+A[1]+`));
      int index = resTexRC.x * `+A[1]+` + resTexRC.y;

      `+S+`

      int b = index / `+E+`;
      index -= b * `+E+`;

      int r = 2 * (index / `+T+`);
      int c = imod(index, `+T+`) * 2;

      return ivec`+x.length+"("+N+`);
    }
  `}(p,m)}var g,y,v,w,_}(e.logicalShape,l),a=function(p){return`
    void setOutput(vec4 val) {
      `+p.output+` = val;
    }
  `}(c)):(o=function(p,m){switch(p.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(v,w){return w[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+w[1]+`.0);
      }
    `:w[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+w[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));
      return resTexRC.x * `+w[1]+` + resTexRC.y;
    }
  `}(0,m);case 2:return function(v,w){return zt(v,w)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+w[0]+", "+w[1]+`));
      }
    `:v[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+w[0]+", "+w[1]+`));
        int index = resTexRC.x * `+w[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:v[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+w[0]+", "+w[1]+`));
        int index = resTexRC.x * `+w[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));
      int index = resTexRC.x * `+w[1]+` + resTexRC.y;
      int r = index / `+v[1]+`;
      int c = index - r * `+v[1]+`;
      return ivec2(r, c);
    }
  `}(p,m);case 3:return g=m,y=_a(["r","c","d"],p),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+g[0]+", "+g[1]+`));
      int index = resTexRC.x * `+g[1]+` + resTexRC.y;
      `+y+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(v,w){var _=_a(["r","c","d","d2"],v);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+w[0]+", "+w[1]+`));
      int index = resTexRC.x * `+w[1]+` + resTexRC.y;
      `+_+`
      return ivec4(r, c, d, d2);
    }
  `}(p,m);case 5:return function(v,w){var _=_a(["r","c","d","d2","d3"],v);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+w[0]+`,
                             `+w[1]+`));

      int index = resTexRC.x * `+w[1]+` + resTexRC.y;

      `+_+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(p,m);case 6:return function(v,w){var _=_a(["r","c","d","d2","d3","d4"],v);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+w[0]+", "+w[1]+`));
      int index = resTexRC.x * `+w[1]+` + resTexRC.y;

      `+_+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(p,m);default:throw new Error(p.length+"-D output sampling is not yet supported")}var g,y}(e.logicalShape,l),a=function(p){return`
    void setOutput(float val) {
      `+p.output+` = vec4(val, 0, 0, 0);
    }
  `}(c)),r&&(d+=K5),[d,h,a,s,o,u,t].join(`
`)}function gs(n){var e=n.shapeInfo.logicalShape;switch(e.length){case 0:return function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"float "+i+"() {return "+r+";}";var o=t.shapeInfo.texShape,a=o[0],s=o[1];if(a===1&&s===1)return`
      float `+i+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=t.shapeInfo.texShape,l=u[0],c=u[1],h=ua(r);return`
    float `+i+`() {
      vec2 uv = uvFromFlat(`+l+", "+c+", "+h+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(n);case 1:return function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return`
      float `+i+`(int index) {
        `+ls(t)+`
      }
    `;var o=t.shapeInfo.texShape,a=o[0],s=o[1];if(s===1&&a===1)return`
      float `+i+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=ua(r);return s===1?`
      float `+i+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+a+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:a===1?`
      float `+i+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+i+`(int index) {
      vec2 uv = uvFromFlat(`+a+", "+s+", index + "+u+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(n);case 2:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=t.shapeInfo.texShape;if(a!=null&&zt(r,a)){var s=a[0],u=a[1];return`
    float `+o+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+s+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `}var l=ma(r),c=l.newShape,h=l.keptDims,d=c;if(d.length<r.length){var p=ys(t,d);return`
      `+gs(p)+`
      float `+o+`(int row, int col) {
        return `+o+"("+ws(["row","col"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+ls(t)+`
      }
    `;var m=a[0],g=a[1],y=ua(i);return g===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+y+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+m+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `:m===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+y+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+g+`.0, 0.5);
      return sampleTexture(`+i+`, uv);
    }
  `:`
  float `+o+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+y+`;
    vec2 uv = uvFromFlat(`+m+", "+g+`, index);
    return sampleTexture(`+i+`, uv);
  }
`}(n);case 3:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=r[1]*r[2],s=r[2],u=ma(r),l=u.newShape,c=u.keptDims,h=l;if(h.length<r.length){var d=ys(t,h);return`
        `+gs(d)+`
        float `+o+`(int row, int col, int depth) {
          return `+o+"("+ws(["row","col","depth"],c)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+a+", "+s+`, 1)));
        `+ls(t)+`
      }
    `;var p=t.shapeInfo.texShape,m=p[0],g=p[1],y=t.shapeInfo.flatOffset;if(g===a&&y==null)return`
        float `+o+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+g+".0, "+m+`.0);
          return sampleTexture(`+i+`, uv);
        }
      `;if(g===s&&y==null)return`
    float `+o+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+g+".0, "+m+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `;var v=ua(i);return`
      float `+o+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+a+" + col * "+s+" + depth + "+v+`;
        vec2 uv = uvFromFlat(`+m+", "+g+`, index);
        return sampleTexture(`+i+`, uv);
      }
  `}(n);case 4:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=r[3],s=r[2]*a,u=r[1]*s,l=ma(r),c=l.newShape,h=l.keptDims;if(c.length<r.length){var d=ys(t,c);return`
      `+gs(d)+`
      float `+o+`(int row, int col, int depth, int depth2) {
        return `+o+"("+ws(["row","col","depth","depth2"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+s+", "+a+`, 1)));
        `+ls(t)+`
      }
    `;var p=t.shapeInfo.flatOffset,m=t.shapeInfo.texShape,g=m[0],y=m[1];if(y===u&&p==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+y+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(y===a&&p==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+y+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var v=ua(i);return`
    float `+o+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+s+` +
          depth * `+a+` + depth2;
      vec2 uv = uvFromFlat(`+g+", "+y+", index + "+v+`);
      return sampleTexture(`+i+`, uv);
    }
  `}(n);case 5:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=r[4],s=r[3]*a,u=r[2]*s,l=r[1]*u,c=ma(r),h=c.newShape,d=c.keptDims;if(h.length<r.length){var p=ys(t,h);return`
      `+gs(p)+`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        return `+o+"("+ws(["row","col","depth","depth2","depth3"],d)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+l+", "+u+", "+s+", "+a+`)) +
          depth3;
        `+ls(t)+`
      }
    `;var m=t.shapeInfo.flatOffset,g=t.shapeInfo.texShape,y=g[0],v=g[1];if(v===l&&m==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+v+".0, "+y+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(v===a&&m==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+v+".0, "+y+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var w=ua(i);return`
    float `+o+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+u+" + depth * "+s+` +
          depth2 * `+a+" + depth3 + "+w+`;
      vec2 uv = uvFromFlat(`+y+", "+v+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(n);case 6:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=ma(r),s=a.newShape,u=a.keptDims;if(s.length<r.length){var l=ys(t,s);return`
      `+gs(l)+`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+o+"("+ws(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var c=r[5],h=r[4]*c,d=r[3]*h,p=r[2]*d,m=r[1]*p;if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+m+", "+p+", "+d+", "+h+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+c+`, 1)));
        `+ls(t)+`
      }
    `;var g=t.shapeInfo.flatOffset,y=t.shapeInfo.texShape,v=y[0],w=y[1];if(w===m&&g==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+p+", "+d+", "+h+", "+c+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+w+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(w===c&&g==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+w+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var _=ua(i);return`
    float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+m+" + col * "+p+" + depth * "+d+` +
          depth2 * `+h+" + depth3 * "+c+" + depth4 + "+_+`;
      vec2 uv = uvFromFlat(`+v+", "+w+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(n);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function Sk(n){var e,t,r;switch(n.shapeInfo.logicalShape.length){case 0:return e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=fn(),`
    vec4 `+t+`() {
      return `+r.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return function(i){var o=i.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),s=i.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],l=fn();return`
    vec4 `+a+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+l.texture2D+"("+o+`, uv);
    }
  `}(n);case 2:return function(i){var o=i.shapeInfo.logicalShape,a=i.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,l=u[0],c=u[1],h=fn();if(u!=null&&zt(o,u))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+l+`.0);

        return `+h.texture2D+"("+a+`, uv);
      }
    `;var d=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],p=Math.ceil(o[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+p+", "+d[0]+", "+d[1]+`, row, col);
      return `+h.texture2D+"("+a+`, uv);
    }
  `}(n);case 3:return function(i){var o=i.shapeInfo.logicalShape,a=i.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(o[0]===1){var c=o.slice(1),h=ys(i,c);return`
        `+Sk(h)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+ws(["b","row","col"],[1,2])+`);
        }
      `}var d=l[0],p=l[1],m=Math.ceil(o[2]/2),g=m*Math.ceil(o[1]/2),y=fn();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+d+", "+p+", "+g+", "+m+`, b, row, col);
      return `+y.texture2D+"("+a+`, uv);
    }
  `}(n);default:return function(i){for(var o=i.shapeInfo.logicalShape,a=o.length,s=i.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),l=i.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],h=c[0],d=c[1],p=Math.ceil(o[a-1]/2),m=p*Math.ceil(o[a-2]/2),g="int b, int row, int col",y="b * "+m+" + (row / 2) * "+p+" + (col / 2)",v=2;v<a-1;v++)g="int b"+v+", "+g,m*=o[a-v-1],y="b"+v+" * "+m+" + "+y;var w=fn();return`
    vec4 `+u+"("+g+`) {
      int index = `+y+`;
      int texR = index / `+d+`;
      int texC = index - texR * `+d+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+d+", "+h+`);
      return `+w.texture2D+"("+s+`, uv);
    }
  `}(n)}}var H5=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,G5=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,q5=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,K5=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function ua(n){return"offset"+n}function ls(n){var e=n.name,t=fe(n.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function tt(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function ys(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function ws(n,e){return e.map(function(t){return n[t]}).join(", ")}var X5=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,F(n.length>2,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var i=n[n.length-1],o=Math.ceil(i/e);this.outputShape=n.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,l=u.length,c=tt(l),h=Pn("coords",l);if(o===1){var d=tt(s=l+1);a=`
        `+d+" sourceLocR = "+d+"("+h.join()+`, 0);
        ++`+h[l-1]+`;
        `+d+" sourceLocG = "+d+"("+h.join()+`, 0);
        ++`+h[l-2]+`;
        `+d+" sourceLocA = "+d+"("+h.join()+`, 0);
        --`+h[l-1]+`;
        `+d+" sourceLocB = "+d+"("+h.join()+`, 0);
        --`+h[l-2]+";"}else s=l,a=`
        `+c+` sourceLocR = coords;
        ++`+h[l-1]+`;
        `+c+` sourceLocG = coords;
        ++`+h[l-2]+`;
        `+c+` sourceLocA = coords;
        --`+h[l-1]+`;
        `+c+` sourceLocB = coords;
        --`+h[l-2]+";";var p=["x","y","z","w","u","v"].slice(0,s),m="."+p[s-1],g=p.map(function(E){return"int "+E}),y=Pn("sourceLocR",s-1).concat("inIdx.r"),v=Pn("sourceLocG",s-1).concat("inIdx.g"),w=Pn("sourceLocB",s-1).concat("inIdx.b"),_=Pn("sourceLocA",s-1).concat("inIdx.a"),x=t==="max"?"greaterThan":"lessThan",C=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+v.join()+`),
                             getBestIndicesAChannel(`+w.join()+`),
                             getBestIndicesAChannel(`+_.join()+")));",A=`vec4(
            getAChannel(`+y.join()+`),
            hasNextCol ? getAChannel(`+v.join()+`) : 0.,
            hasNextRow ? getAChannel(`+w.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+_.join()+") : 0.)",T=r?"":`
      float getBestIndicesAChannel(`+g.join()+`) {
        return getChannel(getBestIndicesA(`+p.join()+`),
                                          vec2(`+p.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+g.join()+`) {
        return getChannel(getA(`+p.join()+`),
                               vec2(`+p.slice(-2).join()+`));
      }
      `+T+`
      void main() {
        `+c+` coords = getOutputCoords();
        bool hasNextCol = `+h[l-1]+" < "+(u[l-1]-1)+`;
        bool hasNextRow = `+h[l-2]+" < "+(u[l-2]-1)+`;
        `+a+`
        ivec4 srcIdx = ivec4(sourceLocR`+m+", sourceLocG"+m+`,
          sourceLocB`+m+", sourceLocA"+m+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+A+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+C+`
          vec4 candidate = `+A+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+x+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},Q5=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=n.dilationHeight,a=n.dilationWidth,s=n.effectiveFilterHeight,u=n.effectiveFilterWidth,l=s-1-n.padInfo.top,c=u-1-n.padInfo.left,h=1/(e*t);this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+c+`);
      const float avgMultiplier = float(`+h+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+o+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+a+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},Y5=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,i=n.strideDepth,o=n.strideHeight,a=n.strideWidth,s=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterDepth,h=n.effectiveFilterHeight,d=n.effectiveFilterWidth,p=c-1-n.padInfo.front,m=h-1-n.padInfo.top,g=d-1-n.padInfo.left,y=1/(e*t*r);this.userCode=`
      const ivec3 pads = ivec3(`+p+", "+m+", "+g+`);
      const float avgMultiplier = float(`+y+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+i+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+h+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+d+`;
                wC += `+l+`) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},J5=function(n,e,t,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],Oe(n,e),Oe(n,t);var a="0.0";r!=null&&(Oe(n,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";i!=null&&(Oe(n,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+a+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+o+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},Z5=function(n,e,t,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Oe(n,e),Oe(n,t);var a="vec4(0.0)";r!=null&&(Oe(n,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";i!=null&&(Oe(n,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = `+a+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+o+`));

        setOutput((x - mean) * inv + offset);
      }
    `},ez="return areal * breal - aimag * bimag;",tz="return areal * bimag + aimag * breal;",PE=function(n,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Oe(e,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+n+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},sv="return a + b;",uv="return a - b;",NE="return a * b;",Rk="return (a < 0.) ? b * a : a;",gt=function(n,e,t){this.variableNames=["A","B"],this.outputShape=Oe(e,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+n+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},kk=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,_i=function(n,e,t,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Oe(e,t);var i=this.outputShape.length,o="";if(r)if(i===0||fe(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          `+tt(i)+` coords = getOutputCoords();
        `,i===1)o+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var a=Pn("coords",i);o+=`
            bool nextRowOutOfBounds =
              (`+a[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+a[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+n+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+o+`

        setOutput(result);
      }
    `},nz=function(){function n(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n}(),rz=function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n}(),iz=function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},oz=function(n){this.outputShape=[],this.outputShape=vu(n,1),this.variableNames=n.map(function(s,u){return"T"+u});var e=new Array(n.length-1);e[0]=n[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+n[t][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var i=e[t-1];r.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+i+"));")}var o=e.length,a=e[e.length-1];r.push("else setOutput(getT"+o+"(yR, yC-"+a+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},az=function(n,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=vu(n,e);var t=this.outputShape,r=t.length,i=tt(r),o=Pn("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map(function(y,v){return"T"+v});var s=new Array(n.length-1);s[0]=n[0][e];for(var u=1;u<s.length;u++)s[u]=s[u-1]+n[u][e];var l=a[e],c=a.slice(-2),h=a.join(),d="if ("+l+" < "+s[0]+`) {
        return getChannel(
            getT0(`+h+"), vec2("+c.join()+`));
        }`;for(u=1;u<s.length;u++){var p=s[u-1];d+=`
        if (`+l+" < "+s[u]+"  && "+l+" >= "+s[u-1]+`) {
          return getChannel(
            getT`+u+"("+Bh(a,l,p)+`),
            vec2(`+Bh(c,l,p)+`));
        }`}var m=s.length,g=s[s.length-1];d+=`
        return getChannel(
          getT`+m+"("+Bh(a,l,g)+`),
          vec2(`+Bh(c,l,g)+"));",this.userCode=`
      float getValue(`+a.map(function(y){return"int "+y})+`) {
        `+d+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+o+`), 0., 0., 0.);

        `+o[r-1]+" = "+o[r-1]+` + 1;
        if (`+o[r-1]+" < "+t[r-1]+`) {
          result.g = getValue(`+o+`);
        }

        `+o[r-2]+" = "+o[r-2]+` + 1;
        if (`+o[r-2]+" < "+t[r-2]+`) {
          result.a = getValue(`+o+`);
        }

        `+o[r-1]+" = "+o[r-1]+` - 1;
        if (`+o[r-2]+" < "+t[r-2]+` &&
            `+o[r-1]+" < "+t[r-1]+`) {
          result.b = getValue(`+o+`);
        }
        setOutput(result);
      }
    `};function Bh(n,e,t){var r=n.indexOf(e);return n.map(function(i,o){return o===r?i+" - "+t:i}).join()}var sz=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,i=n.padInfo.left,o=n.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              if (`+o+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},uz=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=n.dataFormat==="channelsLast",a=e-1-n.padInfo.top,s=t-1-n.padInfo.left,u=o?1:2,l=o?2:3,c=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+c+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+l+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {

              if (`+o+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},lz=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,i=n.padInfo.front,o=n.padInfo.top,a=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yF = 0; yF < `+n.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+i+`;

            if (xF < 0 || xF >= `+n.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+n.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+o+`;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+n.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+a+`;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},cz=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,i=n.strideDepth,o=n.strideHeight,a=n.strideWidth,s=e-1-n.padInfo.front,u=t-1-n.padInfo.top,l=r-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+u+", "+l+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+n.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},hz=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,i=n.padInfo.left,o=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+o+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},dz=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=e-1-n.padInfo.top,a=t-1-n.padInfo.left,s=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},DE=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.padInfo.top,o=n.padInfo.left,a=n.strideHeight,s=n.strideWidth,u=n.dilationHeight,l=n.dilationWidth,c=n.filterHeight,h=n.filterWidth,d=4*Math.floor(n.inChannels/4),p=n.inChannels%4,m=n.dataFormat==="channelsLast",g=m?1:2,y=m?2:3,v=m?3:1,w="",_="";t&&(w=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,_="result = activation(result);");var x=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+w+`

      const ivec2 strides = ivec2(`+a+", "+s+`);
      const ivec2 pads = ivec2(`+i+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+v+`];

        ivec2 xRCCorner =
            ivec2(coords[`+g+"], coords["+y+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+c+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+h+`; wC++) {
            int xC = xCCorner + wC * `+l+`;

            if (xC < 0 || xC >= `+n.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+d+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+m+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(p===1)+`) {

              if (`+m+`) {
                dotProd +=
                    getX(batch, xR, xC, `+d+`) *
                    getW(wR, wC, `+d+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+d+`, xR, xC) *
                    getW(wR, wC, `+d+`, d2);
              }

            } else if (`+(p===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+d+`, d2),
                getW(wR, wC, `+d+` + 1, d2)
              );

              if (`+m+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+d+`),
                  getX(batch, xR, xC, `+d+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+d+`, xR, xC),
                  getX(batch, `+d+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(p===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+d+`, d2),
                getW(wR, wC, `+d+` + 1, d2),
                getW(wR, wC, `+d+` + 2, d2)
              );

              if (`+m+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+d+`),
                  getX(batch, xR, xC, `+d+` + 1),
                  getX(batch, xR, xC, `+d+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+d+`, xR, xC),
                  getX(batch, `+d+` + 1, xR, xC),
                  getX(batch, `+d+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+x+`
        `+_+`
        setOutput(result);
      }
    `},fz=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.front,t=n.padInfo.top,r=n.padInfo.left,i=n.strideDepth,o=n.strideHeight,a=n.strideWidth,s=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.filterDepth,h=n.filterHeight,d=n.filterWidth,p=4*Math.floor(n.inChannels/4),m=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+o+", "+a+`);
      const ivec3 pads = ivec3(`+e+", "+t+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+c+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+d+`; wC++) {
              int xC = xCCorner + wC * `+l+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+p+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(m===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+p+`) *
                  getW(wF, wR, wC, `+p+`, d2);
              } else if (`+(m===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+p+`),
                  getX(batch, xF, xR, xC, `+p+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+p+`, d2),
                  getW(wF, wR, wC, `+p+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(m===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+p+`),
                  getX(batch, xF, xR, xC, `+p+` + 1),
                  getX(batch, xF, xR, xC, `+p+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+p+`, d2),
                  getW(wF, wR, wC, `+p+` + 1, d2),
                  getW(wF, wR, wC, `+p+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},OE=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.inHeight,o=n.inWidth,a=n.padInfo.top,s=n.padInfo.left,u=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,h=n.dilationWidth,d=n.filterHeight,p=n.filterWidth,m=n.outChannels/n.inChannels,g="",y="";t&&(g=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,y="result = activation(result);");var v=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+g+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+m+`;
        int q = d2 - d1 * `+m+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+d+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+i+`) {
            continue;
          }

          for (int wC = 0; wC < `+p+`; wC++) {
            int xC = xCCorner + wC * `+h+`;

            if (xC < 0 || xC >= `+o+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+v+`
        `+y+`
        setOutput(result);
      }
    `},ME=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;for(var i=n.inHeight,o=n.inWidth,a=n.padInfo.top,s=n.padInfo.left,u=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,h=n.dilationWidth,d=n.filterHeight,p=n.filterWidth,m=p,g="int xR; int xC; int xCOffset;",y=0;y<d;y++)for(var v=0;v<p;v++)g+=`
          vec4 xTexelR`+y+"C"+2*v+` = vec4(0.);
          vec4 wR`+y+"C"+v+` = vec4(0.);
          vec4 xR`+y+"C"+v+" = vec4(0.);";for(y=0;y<d;y++)for(var w=0;w<m;w++){if(g+=`
          xR = xRCorner + `+y*c+`;
          xC = xCCorner + `+(v=2*w)*h+`;
        `,l===1){if(v<p&&(g+=s%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  xTexelR`+y+"C"+v+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    xTexelR`+y+"C"+v+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+y+"C"+v+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+y+"C"+v+" = vec4(previous.zw, xTexelR"+y+"C"+v+`.xy);
                } else {
                  xR`+y+"C"+v+" = vec4(0, 0, xTexelR"+y+"C"+v+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+i+" && xC >= 0 && xC < "+o+`) {
                  xTexelR`+y+"C"+v+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+y+"C"+v+` = vec4(0.);
                }

                xR`+y+"C"+v+" = xTexelR"+y+"C"+v+`;
              `,v+1<p)){var _=s%2==0?qR(h):h;h%2==0&&s%2==1||h%2!=0&&s%2!=1?(g+=`
                  xCOffset = xC + `+s%2+" + "+_+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+y+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,h>1&&(g+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+i+` &&
                      xCOffset >= 0 && xCOffset < `+o+`) {
                      xTexelR`+y+"C"+v+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+y+"C"+v+` = vec4(0.);
                    }
                  `),g+=`
                  xR`+y+"C"+(v+1)+` = vec4(
                    xTexelR`+y+"C"+v+".zw, xTexelR"+y+"C"+(v+2)+`.xy);
                `):g+=`
                  xCOffset = xC + `+_+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+y+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+y+"C"+(v+1)+" = xTexelR"+y+"C"+(v+2)+`;
                `}}else v<p&&(g+=`
              if(xR >= 0 && xR < `+i+`) {
            `,s%2==1?(g+=`
                xCOffset = xC + 1 - `+l+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+y+"C"+v+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+y+"C"+v+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+o+`) {
                  xTexelR`+y+"C"+(v+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+y+"C"+(v+2)+` = vec4(0.);
                }

                xR`+y+"C"+v+` = vec4(
                  xTexelR`+y+"C"+v+".zw, xTexelR"+y+"C"+(v+2)+`.zw);
              `,v+1<p&&(g+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+l+`;
                  if(xCOffset >= 0 && xCOffset < `+o+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+y+"C"+(v+1)+" = vec4(xTexelR"+y+"C"+(v+2)+`.xy, final.xy);
                `)):(g+=`
                if(xC >= 0 && xC < `+o+`) {
                  xTexelR`+y+"C"+v+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+y+"C"+v+` = vec4(0.);
                }

                xCOffset = xC + `+l+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+y+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+y+"C"+(v+2)+` = vec4(0.);
                }

                xR`+y+"C"+v+` = vec4(
                  xTexelR`+y+"C"+v+".xy, xTexelR"+y+"C"+(v+2)+`.xy);
              `,v+1<p&&(g+=`
                  xR`+y+"C"+(v+1)+` = vec4(
                    xTexelR`+y+"C"+v+".zw, xTexelR"+y+"C"+(v+2)+`.zw);
                `)),g+="}");v<p&&(g+=`
            vec4 wTexelR`+y+"C"+v+" = getW("+y+", "+v+`, d1, q);
            wR`+y+"C"+v+" = vec4(wTexelR"+y+"C"+v+".xz, wTexelR"+y+"C"+v+`.xz);
          `,v+1<p&&(g+=`
              vec4 wTexelR`+y+"C"+(v+1)+" = getW("+y+", "+(v+1)+`, d1, q);
              wR`+y+"C"+(v+1)+` =
                vec4(wTexelR`+y+"C"+(v+1)+".xz, wTexelR"+y+"C"+(v+1)+".xz);"))}for(y=0;y<d;y++)for(v=0;v<p;v++)g+="dotProd += xR"+y+"C"+v+" * wR"+y+"C"+v+";";var x="",C="";t&&(x=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,C="result = activation(result);");var A=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+x+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+g+`

        vec4 result = dotProd;
        `+A+`
        `+C+`
        setOutput(result);
      }
    `},pz=function(n,e,t,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=n[0],a=n[1],s=n[2],u=n[3],l=e[0],c=t[0],h=t[1];this.outputShape=[l,c,h,u];var d=r==="bilinear"?1:0,p=[a-1+".0",s-1+".0"],m=p[0],g=p[1],y=c>1?[""+(a-1)/(c-1),"(y2-y1) * height_ratio","y1*"+m+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+m],v=y[0],w=y[1],_=y[2],x=h>1?[""+(s-1)/(h-1),"(x2-x1) * width_ratio","x1*"+g+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+g],C=x[0],A=x[1],T=x[2];this.userCode=`
      const float height_ratio = float(`+v+`);
      const float width_ratio = float(`+C+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+o+`) {
          return;
        }

        float height_scale = `+w+`;
        float width_scale = `+A+`;

        float in_y = `+_+`;
        if( in_y < 0.0 || in_y > `+m+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+T+`;
        if( in_x < 0.0 || in_x > `+g+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+d+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},mz=function(n,e,t){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=n[n.length-1],o=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+i+" -i - 1;":"return i;")+`
      }

      void main() {
        `+tt(r)+` coords = getOutputCoords();
        int end = `+FE(r,"coords")+`;
        float val = 0.0;
        for (int i = `+i+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+o+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+FE(r,"coords")+` = idx;
          val += getX(`+function(a,s){if(a===1)return""+s;if(a===2)return s+".x, "+s+".y";if(a===3)return s+".x, "+s+".y, "+s+".z";if(a===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")}(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function FE(n,e){if(n===1)return""+e;if(n===2)return e+".y";if(n===3)return e+".z";if(n===4)return e+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var vz=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=dc.DENSE;var e=Rl(n),t=fn();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+_a(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `},gz=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=dc.DENSE;var e=Rl(n),t=fn();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+_a(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `},yz=function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return n.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n}(),wz=function(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},_z=function(n){this.variableNames=["A"],this.outTexUsage=qn.DOWNLOAD;var e=fn();this.outputShape=n,this.userCode=`
      `+Tk+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `},xz=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=qn.DOWNLOAD;var e=fn();this.outputShape=n,this.userCode=`
      `+Tk+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `},bz=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var r=fn(),i=e[0],o=e[1];this.outputShape=n;var a="result";t&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      `+T1(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+o+`;
        int c = imod(flatIndex, `+o+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+a+`, 0., 0., 0.);
      }
    `},Ez=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=fn(),i=e[0],o=e[1];this.outputShape=n;var a="",s="result";t&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;a+=`
          localCoords = coords;
          if(localCoords[2] + `+l+" < "+n[2]+`) {
            localCoords[2] += `+l+`;
            if(localCoords[1] + `+u+" < "+n[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+o+`;
              c = imod(flatIndex, `+o+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+c+`] = values[0];
              } else if(offset == 1) {
                result[`+c+`] = values[1];
              } else if(offset == 2) {
                result[`+c+`] = values[2];
              } else {
                result[`+c+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+T1(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+a+`

        `+r.output+" = "+s+`;
      }
    `},Cz="return real * expR - imag * expI;",Iz="return real * expI + imag * expR;",LE=function(n,e,t){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var i=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=t?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+n+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+o+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},Tz=function(){function n(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){t.valueLoc==null&&(t.valueLoc=r.getUniformLocationNoThrow(i,"value")),r.gl.uniform1f(t.valueLoc,e)}},n}(),Sz=function(n,e,t){this.variableNames=["A","indices"];var r=n.slice();r[t]=e,this.outputShape=r,this.rank=r.length;var i=tt(this.rank),o=function(a,s){var u=a.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],h=0;h<a.length;h++)h===s?c.push("int(getIndices("+l[h]+"))"):c.push(""+l[h]);return c.join()}(n,t);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},Rz=function(n,e,t){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var r=tt(e.length),i=tt(t.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+o+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function kz(n,e){var t=fn();return Cj(n,e,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function Az(n,e){return kj(n,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Pz(n,e){return Aj(n,e,new Uint16Array([0,1,2,2,1,3]))}function jc(n,e,t,r,i,o,a){Nj(t,r);var s=Pj(n,e),u=n.TEXTURE_2D;return me(n,e,function(){return n.bindTexture(u,s)}),me(n,e,function(){return n.texParameteri(u,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)}),me(n,e,function(){return n.texParameteri(u,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),me(n,e,function(){return n.texParameteri(u,n.TEXTURE_MIN_FILTER,n.NEAREST)}),me(n,e,function(){return n.texParameteri(u,n.TEXTURE_MAG_FILTER,n.NEAREST)}),me(n,e,function(){return n.texImage2D(u,0,i,t,r,0,o,a,null)}),me(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)}),s}function Nz(n,e,t,r,i){var o=Np(t,r);return jc(n,e,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,n.FLOAT)}function Dz(n,e,t,r,i){var o=Np(t,r);return jc(n,e,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function Oz(n,e,t,r,i){var o=Np(t,r);return jc(n,e,o[0],o[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function Mz(n,e,t,r,i){var o=Uc(t,r);return jc(n,e,o[0],o[1],i.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function Fz(n,e,t,r,i){var o=Uc(t,r);return jc(n,e,o[0],o[1],i.internalFormatPackedHalfFloat,n.RGBA,i.textureTypeHalfFloat)}function Lz(n,e,t,r){return me(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),CE(n,e,t,"clipSpacePos",r,3,20,0)&&CE(n,e,t,"uv",r,2,20,12)}function Vz(n,e,t,r,i,o,a){var s,u,l;me(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),o instanceof Uint8Array?(s=new Uint8Array(r*i*4),u=n.UNSIGNED_BYTE,l=n.RGBA):(s=new Float32Array(r*i*4),u=n.FLOAT,l=a.internalFormatPackedFloat),s.set(o),me(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,l,r,i,0,n.RGBA,u,s)}),me(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function Bz(n,e,t,r){me(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),r.data instanceof Uint8Array?me(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r.width,r.height,0,n.RGBA,n.UNSIGNED_BYTE,r.data)}):me(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)}),me(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function Uz(n,e,t,r,i){var o=n.createBuffer();me(n,e,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,o)});var a=16*t*r;return me(n,e,function(){return n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)}),me(n,e,function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,0)}),me(n,e,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}),o}function jz(n,e,t){var r=n,i=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function zz(n,e,t,r,i){var o=Np(t,r),a=o[0],s=o[1],u=new Uint8Array(t*r*4);return me(n,e,function(){return n.readPixels(0,0,a,s,i.downloadTextureFormat,n.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function Wz(n,e,t,r,i,o,a,s){var u=n,l=new Float32Array(function(c,h){var d=Uc(c,h);return d[0]*d[1]*4}(o,a));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function $z(n,e,t,r){var i=new Float32Array(t*r*4);return me(n,e,function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,i)}),i}var Hz=function(){function n(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=Y().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,wj(t,e)):this.gl=di(t);var r="WEBGL_color_buffer_float";if(Y().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=Mh(this.gl,this.debug,"OES_texture_float"),mr(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Mh(this.gl,this.debug,"OES_texture_half_float");else if(Y().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),mr(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Mh(this.gl,this.debug,"EXT_color_buffer_half_float");else if(Y().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",mr(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!mr(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Az(this.gl,this.debug),this.indexBuffer=Pz(this.gl,this.debug),this.framebuffer=Dj(this.gl,this.debug),this.textureConfig=v1(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return Y().getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;me(t,this.debug,function(){return t.finish()}),me(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),me(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),me(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),me(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),me(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),Nz(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),Dz(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),Oz(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),Bz(this.gl,this.debug,e,t)},n.prototype.uploadDenseMatrixToTexture=function(e,t,r,i){this.throwIfDisposed(),Vz(this.gl,this.debug,e,t,r,i,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Fz(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Mz(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(IE(this.gl,this.debug,this.framebuffer),this.outputTexture=null),me(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,function(){return zz(i.gl,i.debug,t,r,i.textureConfig)})},n.prototype.downloadPackedMatrixFromBuffer=function(e,t,r,i,o,a){return Wz(this.gl,e,0,0,0,o,a,this.textureConfig)},n.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return jz(this.gl,e,t)},n.prototype.createBufferFromTexture=function(e,t,r){this.bindTextureToFrameBuffer(e);var i=Uz(this.gl,this.debug,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},n.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},n.prototype.createFence=function(e){var t,r,i=this;if(Y().getBool("WEBGL_FENCE_API_ENABLED")){var o=e,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=function(){var s=o.clientWaitSync(a,0,0);return s===o.ALREADY_SIGNALED||s===o.CONDITION_SATISFIED},t=a}else Y().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return i.isQueryAvailable(t,Y().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,function(){return $z(i.gl,i.debug,t,r)})},n.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,r=Ij(t,this.debug,e),i=kz(t,this.debug),o=Sj(t,this.debug);return me(t,this.debug,function(){return t.attachShader(o,i)}),me(t,this.debug,function(){return t.attachShader(o,r)}),Rj(t,this.debug,o),this.debug&&rv(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=Lz(t,this.debug,this.program,this.vertexBuffer)),o},n.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&me(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},n.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&rv(this.gl,this.debug,this.program),me(this.gl,this.debug,function(){return t.gl.useProgram(e)})},n.prototype.getUniformLocation=function(e,t,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?Mj(this.gl,this.debug,e,t):Fj(this.gl,e,t)},n.prototype.getAttributeLocation=function(e,t){var r=this;return this.throwIfDisposed(),me(this.gl,this.debug,function(){return r.gl.getAttribLocation(e,t)})},n.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},n.prototype.setInputMatrixTexture=function(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),Lj(this.gl,this.debug,this.program,e,t,r)},n.prototype.setOutputMatrixTexture=function(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)},n.prototype.setOutputPackedMatrixTexture=function(e,t,r){this.throwIfDisposed();var i=Uc(t,r),o=i[0],a=i[1];this.setOutputMatrixTextureDriver(e,o,a)},n.prototype.setOutputMatrixWriteRegion=function(e,t,r,i){this.setOutputMatrixWriteRegionDriver(r,e,i,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(e,t,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){this.program!=null&&rv(this.gl,this.debug,this.program),Fh(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),me(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},n.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),me(this.gl,this.debug,function(){return e.gl.finish()})},n.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Mh(this.gl,this.debug,Y().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(Y().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}var i=this.getQueryTimerExtensionWebGL1(),o=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,o),o},n.prototype.endQuery=function(){if(Y().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(e){return ce(this,void 0,void 0,function(){var t=this;return he(this,function(r){switch(r.label){case 0:return[4,yE(function(){return t.disposed||t.isQueryAvailable(e,Y().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(e,Y().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},n.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var r=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint},n.prototype.pollFence=function(e){var t=this;return new Promise(function(r){t.addItemToPoll(function(){return e.isFencePassed()},function(){return r()})})},n.prototype.pollItems=function(){for(var e=function(r){for(var i=0;i<r.length&&r[i]();++i);return i-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},n.prototype.addItemToPoll=function(e,t){var r=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||yE(function(){return r.pollItems(),r.itemsToPoll.length===0})},n.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),iv(this.gl,this.debug,e,this.framebuffer),this.debug&&Fh(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(iv(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Fh(this.gl)):IE(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(e,t,r){this.throwIfDisposed();var i=this.gl;iv(i,this.debug,e,this.framebuffer),this.debug&&Fh(i),this.outputTexture=e,me(i,this.debug,function(){return i.viewport(0,0,t,r)}),me(i,this.debug,function(){return i.scissor(0,0,t,r)})},n.prototype.setOutputMatrixWriteRegionDriver=function(e,t,r,i){var o=this;this.throwIfDisposed(),me(this.gl,this.debug,function(){return o.gl.scissor(e,t,r,i)})},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},n}();function VE(n,e){if(n.length!==e.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+e.length+" inputs");n.forEach(function(t,r){var i=t.logicalShape,o=e[r],a=o.shape;if(!zt(i,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+a+" must match");if(!t.isUniform||!o.isUniform){var s=t.texShape,u=o.isUniform?null:o.texData.texShape;if(!zt(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var Gz=function(n,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var r=t.filterWidth,i=t.inChannels,o=t.strideWidth,a=t.strideHeight,s=t.padInfo,u=t.outWidth,l=t.dilationWidth,c=t.dilationHeight,h=t.dataFormat,d=s.left,p=s.top,m=i*r,g=fn(),y=h==="channelsLast",v=y?0:1,w=y?1:2,_="",x=0;x<=1;x++)for(var C=0;C<=1;C++)_+=`
          blockIndex = rc.y + `+C+`;
          pos = rc.x + `+x+`;

          if(blockIndex < `+n[1]+" && pos < "+n[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+a+" - "+p+`;
            d0 = offsetY + `+c+" * (pos / "+m+`);

            if(d0 < `+e[v]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+o+". - "+d+`.);
              d1 = offsetX + `+l+" * (int(mod(float(pos), "+m+".) / "+i+`.));

              if(d1 < `+e[w]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+i+`.));

                if (`+y+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*x+C)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*x+C)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+_+`

        `+g.output+` = result;
      }
    `},qz=function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[];var o,a=e,s=n[3]-1;this.outputShape=n;var u="float("+t+") + float("+r+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+a+"; j <= "+a+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+o+`;
        setOutput(val);
      }
    `},Kz=function(n,e,t,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=t,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},Xz=function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,a=e,s=n[3]-1;this.outputShape=n;var u="float("+t+") + float("+r+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+a+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+a+"; j <= "+a+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+o+`;
        setOutput(result);
      }
    `},Qz=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideHeight,t=n.strideWidth,r=n.dilationHeight,i=n.effectiveFilterHeight,o=n.effectiveFilterWidth,a=i-1-n.padInfo.top,s=o-1-n.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+o+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+o+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},Yz=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,i=n.dilationDepth,o=n.dilationHeight,a=n.dilationWidth,s=n.effectiveFilterDepth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,c=s-1-n.padInfo.front,h=u-1-n.padInfo.top,d=l-1-n.padInfo.left,p=s*u*l-1;this.userCode=`
      const ivec3 pads = ivec3(`+c+", "+h+", "+d+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+s+`;
           wD += `+i+`) {
          float dyD = float(dyDCorner + wD) / `+e+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+o+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+l+`;
                wC += `+a+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+p+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+l+` +
                  wR * `+l+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},lv=function(n,e,t,r,i,o,a){t===void 0&&(t=!1),r===void 0&&(r=!1),i===void 0&&(i=!1),o===void 0&&(o=null),a===void 0&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var s=t?n[1]:n[2],u=Math.ceil(s/2),l=t?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",h=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],p="",m="";o&&(p=a?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+o+`
        }`:`vec4 activation(vec4 x) {
          `+o+`
        }`,m="result = activation(result);");var g=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+p+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+l+`);
          vec4 b = getMatrixB(rc.x, `+c+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+h[0]+" * "+d[0]+`);
          result += (`+h[1]+" * "+d[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+g+`

        `+m+`

        setOutput(result);
      }
    `},Jz=function(){function n(e,t,r){this.variableNames=["probs"],this.outputShape=[e,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){t.seedLoc==null&&(t.seedLoc=r.getUniformLocation(i,"seed")),r.gl.uniform1f(t.seedLoc,e)}},n}(),Zz=function(n,e,t,r){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+t+`),
                      float(index == coords.y)));
      }
    `},eW=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;var e=n.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=Pn("rc",e),r=tt(e),i=function(s,u,l){if(s===1)return"rc > "+u[0];for(var c="",h=s-2;h<s;h++)c+=l[h]+" >= "+u[h],h<s-1&&(c+="||");return c}(e,n,t),o=function(s,u,l,c){if(s===1)return"";var h=c.slice(-2);return`
    int r = `+h[0]+`;
    int c = `+h[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+l+`;
  `}(e,n[n.length-1],n[n.length-2],t),a=function(s,u){var l=s.length,c=function(h,d){for(var p=[],m=0;m<=1;m++)for(var g=0;g<=1;g++){for(var y=(m===0?"r":"rp1")+", "+(g===0?"c":"cp1"),v=2;v<h;v++)y=d[d.length-1-v]+","+y;p.push(y)}return p}(l,u);return l===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+c[0]+`),
          cEdge ? 0. : getA(`+c[1]+`),
          rEdge ? 0. : getA(`+c[2]+`),
          rEdge || cEdge ? 0. : getA(`+c[3]+")"}(n,t);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+i+`) {
            setOutput(vec4(0));
          } else {
            `+o+`

            setOutput(vec4(`+a+`));
          }
        }
      `}},tW=function(n,e,t){this.variableNames=["x"],this.outputShape=e.map(function(u,l){return u[0]+n[l]+u[1]});var r=n.length,i=tt(r),o=e.map(function(u){return u[0]}).join(","),a=e.map(function(u,l){return u[0]+n[l]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+i+" start = "+i+"("+o+`);
      `+i+" end = "+i+"("+a+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+o+`;
        int end = `+a+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},nW=function(n,e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(function(y,v){return y[0]+n[v]+y[1]});for(var r=n.length,i=tt(r),o=e.map(function(y){return y[0]}).join(","),a=e.map(function(y,v){return y[0]+n[v]}).join(","),s=Pn("rc",r),u=Pn("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=r===1?"source":"vec2("+u.slice(-2).join()+")",h=[i+" rc = outputLoc;",s[r-1]+` += 1;
       if(`+l+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+s[r-2]+` += 1;
       if(`+s[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+s[r-1]+` += 1;
         if(`+l+") {"],d=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="",m=0,g=r===1?2:4;m<g;m++)p+=`
        `+h[m]+`
        if (`+d+`) {
          result[`+m+"] = float("+t+`);
        } else {
          `+i+` source = rc - start;
          result[`+m+"] = getChannel(getX("+u.join()+"), "+c+`);
        }
      `;p+=r===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+o+`);
      const `+i+" end = "+i+"("+a+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+p+`
        setOutput(result);
      }
    `},cv=function(n,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,i=n.strideHeight,o=n.strideWidth,a=n.dilationHeight,s=n.dilationWidth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,c=n.padInfo.top,h=n.padInfo.left;this.outputShape=n.outShape;var d=e==="avg",p="0.0";if(d||(p="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+i+", "+o+`);
        const ivec2 pads = ivec2(`+c+", "+h+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+a+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+l+`;
                wC += `+s+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+l+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var m=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(m="avgValue / count");var g=4*Math.floor(r/4),y=r%4,v=`
      if (`+d+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+o+`);
      const ivec2 pads = ivec2(`+c+", "+h+`);
      const float initializationValue = `+p+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+p+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+a+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+g+`; wC += 4) {
            int xC = xCCorner + wC * `+s+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              getValue(batch, xR, xC + 3 * `+s+`, d)
            );

            `+v+`
          }

          int xC = xCCorner + `+g+`;
          if (`+(y===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+v+`
          } else if (`+(y===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              initializationValue,
              initializationValue
            );

            `+v+`
          } else if (`+(y===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              initializationValue
            );

            `+v+`
          }
        }
        setOutput(`+m+`);
      }
    `}},hv=function(n,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,i=n.strideDepth,o=n.strideHeight,a=n.strideWidth,s=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterDepth,h=n.effectiveFilterHeight,d=n.effectiveFilterWidth,p=n.padInfo.front,m=n.padInfo.top,g=n.padInfo.left;this.outputShape=n.outShape;var y=e==="avg",v="0.0";if(y||(v="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+i+", "+o+", "+a+`);
        const ivec3 pads = ivec3(`+p+", "+m+", "+g+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+c+`;
              wD += `+s+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+n.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+h+`;
                wR += `+u+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+d+`;
                  wC += `+l+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+h+" * "+d+` +
                      wR * `+d+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var w=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(w="avgValue / count");var _=4*Math.floor(r/4),x=r%4,C=`
      if (`+y+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+i+", "+o+", "+a+`);
      const ivec3 pads = ivec3(`+p+", "+m+", "+g+`);
      const float initializationValue = `+v+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+v+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+s+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`;
            wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+_+`; wC += 4) {
              int xC = xCCorner + wC * `+l+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+l+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+l+`, ch)
              );

              `+C+`
            }

            int xC = xCCorner + `+_+`;
            if (`+(x===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+C+`
            } else if (`+(x===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                initializationValue,
                initializationValue
              );

              `+C+`
            } else if (`+(x===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+l+`, ch),
                initializationValue
              );

              `+C+`
            }
          }
          setOutput(`+w+`);
        }
      }
    `}},rW=function(n,e){this.variableNames=["x"];var t=n.windowSize,r=n.batchSize,i=n.inSize,o=Math.ceil(i/t);this.outputShape=[r,o];var a="0.0",s="";e==="prod"?a="1.0":e==="min"?(a="1.0 / 1e-20",s="min"):e==="max"&&(a="-1.0 / 1e-20",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?u="sumValue":e==="prod"?u="prodValue":e==="all"?u="allValue":e==="any"&&(u="anyValue");var l=4*Math.floor(t/4),c=t%4,h=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,d="vec4";e==="all"?(a="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):e==="any"&&(a="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");var p="";i%t>0&&(p=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+a+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+p+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+a+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+h+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(c===1)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===2)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===3)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+h+`
        }
        setOutput(`+u+`);
      }
    `},iW=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var t="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),t+=`
        `+i+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+_a(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+T1(n)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+n[1]+`;
        int cols = `+n[2]+`;

        `+t+`

        setOutput(result);
      }
    `},oW=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],a=n.shape,s=a[1],u=a[2],l=[t&&s>1?i-1:i,t&&u>1?o-1:o],c=[t&&s>1?s-1:s,t&&u>1?u-1:u],h=l[0]/c[0],d=l[1]/c[1],p=1/h,m=1/d,g=2*Math.ceil(p)+2,y=2*Math.ceil(m)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+d+`);

        const float invHeightScale = float(`+p+`);
        const float invWidthScale = float(`+m+`);

        const int winHeight = int(`+g+`);
        const int winWidth = int(`+y+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(o-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},aW=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[0],o=n[1],a=n[2],s=n[3];this.outputShape=[i,e,t,s];var u=[r&&e>1?o-1:o,r&&t>1?a-1:a],l=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},sW=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=n[0],o=n[1],a=n[2],s=n[3];this.outputShape=[i,e,t,s];var u=[r&&e>1?o-1:o,r&&t>1?a-1:a],l=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`,
          `+u[1]/l[1]+`);
      const vec3 inputShapeRC = vec3(`+o+".0, "+a+`.0,
                                     `+a+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},uW=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],a=n.shape,s=a[1],u=a[2],l=[t&&s>1?i-1:i,t&&u>1?o-1:o],c=[t&&s>1?s-1:s,t&&u>1?u-1:u],h=l[0]/c[0],d=l[1]/c[1],p=1/h,m=1/d,g=2*Math.ceil(p)+2,y=2*Math.ceil(m)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+d+`);

        const float invHeightScale = float(`+p+`);
        const float invWidthScale = float(`+m+`);

        const int winHeight = int(`+g+`);
        const int winWidth = int(`+y+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+l[0]+`) *
                (float(dyR) / float(`+c[0]+`));

            float sourceFracCol =
                float(`+l[1]+`) *
                  (float(dyC) / float(`+c[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+o+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},lW=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[0],o=n[1],a=n[2],s=n[3];this.outputShape=[i,e,t,s];var u=[r&&e>1?o-1:o,r&&t>1?a-1:a],l=[r&&e>1?e-1:e,r&&t>1?t-1:t],c=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+c+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},cW=function(n,e){this.variableNames=["x"];var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=n,t!==1){var r=n.map(function(o,a){return function(s){return e.indexOf(s)!==-1&&n[s]!==1?n[s]+" - coords["+s+"] - 1":"coords["+s+"]"}(a)}).join(","),i=tt(t);this.userCode=`
      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+n[0]+` - coord - 1));
        }
      `},hW=function(n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=n;var r=Pn("rc",t),i=r[t-1]+" + 1 < "+this.outputShape[t-1],o=r[t-2]+" + 1 < "+this.outputShape[t-2],a=tt(t);function s(u){var l=n.map(function(c,h){return function(d,p){return e.indexOf(d)!==-1&&n[d]!==1?n[d]+" - "+p[d]+" - 1":""+p[d]}(h,u)});return"getChannel(getX("+l.join(",")+"), vec2("+l.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+n[0]+` - rc - 1),
            `+n[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+n[0]+` - (rc  + 1) - 1),
                `+n[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+a+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(u){return s(u)}(r.slice())+`;
          if(`+i+`){
            result.g = `+function(u){return u[t-1]="("+u[t-1]+" + 1)",s(u)}(r.slice())+`;
          }
          if(`+o+`) {
            result.b = `+function(u){return u[t-2]="("+u[t-2]+" + 1)",s(u)}(r.slice())+`;
            if(`+i+`) {
              result.a = `+function(u){return u[t-1]="("+u[t-1]+" + 1)",u[t-2]="("+u[t-2]+" + 1)",s(u)}(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},BE=function(n,e,t,r,i,o,a){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=tt(i.length),u=tt(o.length),l="";t===1?l="i":t===2&&(l="i, j");var c="getIndices("+l+")",h="";r===1?h="i":r===2&&(h="i, coords[1]");var d="getUpdates("+h+")",p=e>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+i+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+n+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+c+`);
              flattenedIndex += index * `+p+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+d+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},dW=function(n,e){this.variableNames=["x","segmentIds"];var t=n.windowSize,r=n.batchSize,i=n.inSize,o=n.numSegments,a=o*Math.ceil(i/t);this.outputShape=[r,a];var s=4*Math.floor(t/4),u=t%4,l=`
        sumValue += dot(values, segFilter);
    `,c="";i%t>0&&(c=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var h="";i%t>0&&(h=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+c+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+h+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+o+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+o+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+l+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+l+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+l+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+l+`
        }
        setOutput(sumValue);
      }
    `},fW=function(n,e,t){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)i="resRC",r="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<e.length;u++)s.push(""+o[u]),u<n&&a.push(""+o[u]);r=a.join(),i=s.join()}var l=tt(t);this.userCode=`
      void main() {
        `+l+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `},pW=function(){function n(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,r=tt(this.rank),i="uniform int start["+this.rank+"];",o=function(a){if(a===1)return"sourceLoc";if(a<=6)return dv.slice(0,a).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+a+" is not yet supported")}(this.rank);t=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+e.map(function(a,s){return"sourceLoc."+dv[s]+" = start["+s+"] + coords."+dv[s]+";"}).join(`
`)+`
      `,this.userCode=`
      `+i+`
      void main() {
        `+t+`
        setOutput(getSource(`+o+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n}(),dv=["x","y","z","w","u","v"],mW=function(){function n(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=tt(this.rank),r=Pn("coords",this.rank),i=Pn("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":"vec2("+i.slice(-2).join()+")",a="getChannel(getSource("+i.join()+"), "+o+")",s=`
      result.x = `+a+`;
      if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+i[this.rank-1]+`;
        result.y = `+a+`;
        --`+i[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+i[this.rank-2]+`;
        result.z = `+a+`;
        if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+i[this.rank-1]+`;
          result.w = `+a+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map(function(c,h){return"start["+h+"]"}).join()+");":e.map(function(c,h){return i[h]+" = "+r[h]+" + start["+h+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+l+`
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n}(),vW=function(n,e,t){this.variableNames=["x"],this.outputShape=t;var r=t.length,i=tt(t.length),o=tt(t.length),a="";if(r===1)a="coords * strides + begin";else{var s=0;a=t.map(function(u,l){return s++,t.length===1?"coords * strides["+l+"] + begin["+l+"]":"coords["+(s-1)+"] * strides["+l+"] + begin["+l+"]"}).join(",")}this.userCode=`
      `+i+" begin = "+i+"("+n+`);
      `+i+" strides = "+i+"("+e+`);

      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+a+`));
      }
    `},gW=function(){function n(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(e,t,r){var i,o=UE(t,r),a=jE(e,o,r);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),o===$n.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===$n.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===$n.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===$n.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===$n.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),i},n.prototype.releaseTexture=function(e,t,r,i){if(this.freeTextures!=null){var o=jE(t,UE(r,i),i);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[o],s=a.indexOf(e);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},n.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(r){e.gpgpu.deleteMatrixTexture(r)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(i){e.gpgpu.deleteMatrixTexture(i)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n}();function UE(n,e){if(n===qn.UPLOAD)return $n.PACKED_2X2_FLOAT32;if(n===qn.RENDER||n==null)return function(t){return Y().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?$n.PACKED_2X2_FLOAT32:$n.UNPACKED_FLOAT32:t?$n.PACKED_2X2_FLOAT16:$n.UNPACKED_FLOAT16}(e);if(n===qn.DOWNLOAD||n===qn.PIXELS)return $n.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function jE(n,e,t){return n[0]+"_"+n[1]+"_"+e+"_"+t}var yW=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[r]*e[r];this.outputShape=t,this.rank=t.length;var i=tt(this.rank),o=function(a){var s=a.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+a[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],l=[],c=0;c<a.length;c++)l.push("imod("+u[c]+", "+a[c]+")");return l.join()}(n);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},wW=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];this.outputShape=t,this.rank=t.length;var i=tt(this.rank),o=function(a){var s=a.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],l=new Array(s),c=0;c<a.length;c++)l[a[c]]=u[c];return l.join()}(e);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+o+`));
    }
    `},_W=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=tt(this.rank),o=Ik("rc",this.rank),a=new Array(this.rank);for(r=0;r<e.length;r++)a[e[r]]=o[r];var s="vec2("+a.slice(-2).join()+")",u="++"+o[this.rank-1]+" < "+t[this.rank-1],l="getChannel(getA("+a.join()+"), "+s+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+l+`;
      if(`+u+`) {
        result[1] = `+l+`;
      }
      --`+o[this.rank-1]+`;
      if(++`+o[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+l+`;
        if(`+u+`) {
          result[3] = `+l+`;
        }
      }
      setOutput(result);
    }
    `},S1=1.7580993408473768,R1=1.0507009873554805,ke=function(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},Ur="if (isnan(x)) return x;",xW="return x;",zE="return abs(x);",Ak=Ur+`
  return (x < 0.0) ? 0.0 : x;
`,Pk=Ur+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Nk="return (x >= 0.0) ? x : (exp(x) - 1.0);",bW=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+S1+`;
  float scale = `+R1+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,WE="return -x;",$E="return ceil(x);",HE="return floor(x);",GE="return exp(x);",qE="return exp(x) - 1.0;",EW=Ur+`
  return sin(x);
`,CW=Ur+`
  return cos(x);
`,IW=Ur+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,TW=Ur+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,SW=Ur+`
  return atan(x);
`,RW=Ur+"return log(x + sqrt(x * x + 1.0));",kW=Ur+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,AW=Ur+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Uh="return x;",PW="return x;",Dk=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Ok=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Mk=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,tl=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},NW=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;var e=n.length,t=Pn("rc",e),r=tt(e),i=function(s,u){if(s===1)return"rc";for(var l="",c=0;c<s;c++)l+=u[c],c<s-1&&(l+=",");return l}(e,t),o=t.slice(-2),a=e<=1?"rc":"vec2("+o.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+a+`));
      }
    `},jh={};function zh(n,e){if(e===void 0&&(e=!1),n==="linear")return e?PW:xW;if(n==="relu")return e?Dk:Ak;if(n==="elu")return e?Mk:Nk;if(n==="relu6")return e?Ok:Pk;if(n==="prelu")return e?kk:Rk;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var DW=600,OW=function(n){function e(t){var r,i=n.call(this)||this;if(i.pendingRead=new WeakMap,i.pendingDisposal=new WeakSet,i.dataRefCount=new WeakMap,i.numBytesInGPU=0,i.uploadWaitMs=0,i.downloadWaitMs=0,i.warnedAboutMemory=!1,i.pendingDeletes=0,i.disposed=!1,!Y().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var o=di(Y().getNumber("WEBGL_VERSION"));i.binaryCache=((r=Y().getNumber("WEBGL_VERSION"))in jh||(jh[r]={}),jh[r]),i.gpgpu=new Hz(o),i.canvas=o.canvas,i.gpgpuCreatedLocally=!0}else i.gpgpu=t,i.binaryCache={},i.gpgpuCreatedLocally=!1,i.canvas=t.gl.canvas;return i.textureManager=new gW(i.gpgpu),i.numMBBeforeWarning=Y().global.screen==null?1024:Y().global.screen.height*Y().global.screen.width*window.devicePixelRatio*DW/1024/1024,i.texData=new vk(i,U),i}return Br(e,n),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,r,i){if(Y().getBool("DEBUG")&&this.checkNumericalProblems(t),i==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var o={};return this.texData.set(o,{shape:r,dtype:i,values:t,usage:qn.UPLOAD}),o},e.prototype.move=function(t,r,i,o){if(Y().getBool("DEBUG")&&this.checkNumericalProblems(r),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:i,dtype:o,values:r,usage:qn.UPLOAD})},e.prototype.readSync=function(t){var r=this.texData.get(t),i=r.values,o=r.dtype,a=r.complexTensors,s=r.slice,u=r.shape,l=r.isPacked;if(s!=null){var c=void 0;c=l?new tl(u,Uh):new ke(u,Uh);var h=this.runWebGLProgram(c,[{dataId:t,shape:u,dtype:o}],o),d=this.readSync(h.dataId);return this.disposeData(h.dataId),d}if(i!=null)return this.convertAndCacheOnCPU(t);if(o==="string")return i;var p,m,g=this.activeTimers!=null;return g&&(p=Xr()),o==="complex64"?m=dy(a.real.dataSync(),a.imag.dataSync()):m=this.getValuesFromTexture(t),g&&(this.downloadWaitMs+=Xr()-p),this.convertAndCacheOnCPU(t,m)},e.prototype.read=function(t){return ce(this,void 0,void 0,function(){var r,i,o,a,s,u,l,c,h,d,p,m,g,y,v,w,_,x,C,A,T,E;return he(this,function(I){switch(I.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise(function(S){return r.push(S)})];if(i=this.texData.get(t),o=i.values,a=i.shape,s=i.slice,u=i.dtype,l=i.complexTensors,c=i.isPacked,s!=null)return h=void 0,h=c?new tl(a,Uh):new ke(a,Uh),d=this.runWebGLProgram(h,[{dataId:t,shape:a,dtype:u}],u),p=this.read(d.dataId),this.disposeData(d.dataId),[2,p];if(o!=null)return[2,this.convertAndCacheOnCPU(t)];if(!Y().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Y().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return m=null,u!=="complex64"&&Y().get("WEBGL_BUFFER_SUPPORTED")&&(g=this.decode(t),y=this.texData.get(g.dataId),m=(E=this.gpgpu).createBufferFromTexture.apply(E,[y.texture].concat(Rl(a)))),this.pendingRead.set(t,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:I.sent(),I.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([l.real.data(),l.imag.data()])];case 3:return w=I.sent(),_=w[0],x=w[1],v=dy(_,x),[3,5];case 4:m==null?v=this.getValuesFromTexture(t):(C=fe(a),v=this.gpgpu.downloadFloat32MatrixFromBuffer(m,C)),I.label=5;case 5:return g!=null&&this.disposeData(g.dataId),A=this.convertAndCacheOnCPU(t,v),T=this.pendingRead.get(t),this.pendingRead.delete(t),T.forEach(function(S){return S(A)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,A]}})})},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var r=0;r<t.length;r++){var i=t[r];if(!bj(i))throw Y().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+i+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+i+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var r,i=this.texData.get(t),o=i.shape,a=i.dtype,s=i.isPacked,u=fe(o);if(Y().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(t),c=this.texData.get(l.dataId),h=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[c.texture].concat(Rl(o))).subarray(0,u);return this.disposeData(l.dataId),h}var d=Y().getBool("WEBGL_PACK")&&s===!0,p=d?ov(o):o,m=d?new xz(p):new _z(p),g=this.runWebGLProgram(m,[{shape:p,dtype:a,dataId:t}],"float32"),y=this.texData.get(g.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(y.texture,y.texShape[0],y.texShape[1]).subarray(0,u);return this.disposeData(g.dataId),v},e.prototype.time=function(t){return ce(this,void 0,void 0,function(){var r,i,o,a,s,u,l;return he(this,function(c){switch(c.label){case 0:return r=this.activeTimers,i=[],o=!1,this.programTimersStack==null?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,t(),a=pu(this.activeTimers.map(function(h){return h.query})).filter(function(h){return h!=null}),s=pu(this.activeTimers.map(function(h){return h.name})).filter(function(h){return h!=null}),this.activeTimers=r,o&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},Y().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return l=c.sent(),u.kernelMs=nj(l),u.getExtraProfileInfo=function(){return l.map(function(h,d){return{name:s[d],ms:h}}).map(function(h){return h.name+": "+h.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return Y().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Xr(),endMs:null}},e.prototype.endTimer=function(t){return Y().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Xr(),t)},e.prototype.getQueryTime=function(t){return ce(this,void 0,void 0,function(){var r;return he(this,function(i){return Y().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(r=t).endMs-r.startMs]})})},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var r=this.texData.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var r=this.texData.get(t),i=r.texture,o=r.dtype,a=r.texShape,s=r.usage,u=r.isPacked,l=r.slice,c=l&&l.origDataId||t,h=this.dataRefCount.get(c);h>1?this.dataRefCount.set(c,h-1):(this.dataRefCount.delete(c),i!=null&&(this.numBytesInGPU-=this.computeBytes(a,o),this.textureManager.releaseTexture(i,a,s,u)));var d=this.texData.get(t);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return Y().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=U.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,r){var i=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&t.every(function(o){return i.texData.get(o.dataId).texture==null&&o.size<r})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,r){var i=this.makeOutput(t.shape,"complex64");return this.texData.get(i.dataId).complexTensors={real:U.keep(t.clone()),imag:U.keep(r.clone())},i},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,i){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,r,i);if(fe(i)===0)return Qt([],i,t.dtype);var o=this.texData.get(t.dataId).isPacked,a=pk(t.shape,r,i);if(o||!a){var s=Y().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new mW(i):new pW(i),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[t],null,u)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,r,i)},e.prototype.shallowSlice=function(t,r,i){var o=this.texData.get(t.dataId),a=this.makeOutput(i,t.dtype),s=this.texData.get(a.dataId);Object.assign(s,o),s.shape=i,s.dtype=t.dtype;var u=mk(r,t.strides);o.slice&&(u+=o.slice.flatOffset),s.slice={flatOffset:u,origDataId:o.slice&&o.slice.origDataId||t.dataId};var l=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,l+1),a},e.prototype.stridedSlice=function(t,r,i,o){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,r,i,o);var a=x1(r,i,o);if(a.some(function(u){return u===0}))return Qt([],a);var s=new vW(r,o,a);return this.compileAndRun(s,[t])},e.prototype.reverse=function(t,r){var i=Y().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new hW(t.shape,r):new cW(t.shape,r);return this.compileAndRun(i,[t])},e.prototype.concat=function(t,r){if(t[0].dtype==="complex64"){var i=t.map(function(p){return dr(p)}),o=t.map(function(p){return Jr(p)});return qt(this.concat(i,r),this.concat(o,r))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,r);if(t.length===1)return t[0];if(t.length>Y().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(t.length/2),s=this.concat(t.slice(0,a),r),u=this.concat(t.slice(a),r);return this.concat([s,u],r)}if(Y().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var l=new az(t.map(function(p){return p.shape}),r);return this.compileAndRun(l,t)}var c=vu(t.map(function(p){return p.shape}),r),h=t.map(function(p){return p.as2D(-1,fe(p.shape.slice(r)))}),d=new oz(h.map(function(p){return p.shape}));return this.compileAndRun(d,h).reshape(c)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(Y().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,WE,t.dtype);var r=new ke(t.shape,WE);return this.compileAndRun(r,[t])},e.prototype.batchMatMul=function(t,r,i,o){var a=i?t.shape[2]:t.shape[1],s=o?r.shape[1]:r.shape[2],u=i?t.shape[1]:t.shape[2],l=t.shape[0];if((a===1||s===1)&&u>1e3){i&&(t=t.transpose([0,2,1])),o&&(r=r.transpose([0,2,1]));var c=s===1?t:t.as3D(l,u,1),h=s===1?2:1,d=s===1?r.as3D(l,1,u):r;return this.multiply(c,d).sum(h,!0)}var p=Xt(t.dtype,r.dtype),m=new lv(t.shape,[l,a,s],i,o);return this.compileAndRun(m,[t,r],p)},e.prototype.fusedBatchMatMul=function(t){var r=t.a,i=t.b,o=t.transposeA,a=t.transposeB,s=t.bias,u=t.activation,l=t.preluActivationWeights,c=o?r.shape[2]:r.shape[1],h=a?i.shape[1]:i.shape[2],d=r.shape[0],p=Xt(r.dtype,i.dtype),m=s!=null,g=l!=null,y=u?zh(u,!0):null,v=new lv(r.shape,[d,c,h],o,a,m,y,g),w=[r,i];return s&&w.push(s),l&&w.push(l),this.compileAndRun(v,w,p)},e.prototype.multiply=function(t,r){if(t.dtype==="complex64"){var i=this.texData.get(t.dataId),o=this.texData.get(r.dataId),a=new PE(ez,t.shape,r.shape),s=new PE(tz,t.shape,r.shape),u=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag),this.makeComplexComponentTensorInfo(r,o.complexTensors.real),this.makeComplexComponentTensorInfo(r,o.complexTensors.imag)],l=this.compileAndRun(a,u),c=this.compileAndRun(s,u),h=this.complex(l,c);return l.dispose(),c.dispose(),h}if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.multiply(t,r);if(Y().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,NE,t.dtype);var d=new gt(NE,t.shape,r.shape);return this.compileAndRun(d,[t,r],t.dtype)},e.prototype.batchNormalization=function(t,r,i,o,a,s){var u=[t,r,i],l=null;s!=null&&(l=s.shape,u.push(s));var c=null;if(a!=null&&(c=a.shape,u.push(a)),Y().getBool("WEBGL_PACK_NORMALIZATION")){var h=new Z5(t.shape,r.shape,i.shape,l,c,o);return this.compileAndRun(h,u)}var d=new J5(t.shape,r.shape,i.shape,l,c,o);return this.compileAndRun(d,u)},e.prototype.localResponseNormalization4D=function(t,r,i,o,a){var s=Y().getBool("WEBGL_PACK_NORMALIZATION")?new Xz(t.shape,r,i,o,a):new qz(t.shape,r,i,o,a);return this.compileAndRun(s,[t])},e.prototype.LRNGrad=function(t,r,i,o,a,s,u){var l=new Kz(r.shape,o,a,s,u);return this.compileAndRun(l,[r,i,t])},e.prototype.tile=function(t,r){if(t.dtype==="string"){var i=this.readSync(t.dataId).map(function(a){return Cf(a)});return Ek(Se(t.shape,t.dtype,i),r)}var o=new yW(t.shape,r);return this.compileAndRun(o,[t])},e.prototype.pad=function(t,r,i){var o=Y().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new nW(t.shape,r,i):new tW(t.shape,r,i);return this.compileAndRun(o,[t])},e.prototype.transpose=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,r);var i=Y().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new _W(t.shape,r):new wW(t.shape,r);return this.compileAndRun(i,[t])},e.prototype.gather=function(t,r,i){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.gather(t,r,i);var o=new Sz(t.shape,r.size,i);return this.compileAndRun(o,[t,r])},e.prototype.batchToSpaceND=function(t,r,i){F(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(h,d){return h*d}),a=Af(t.shape,r,o),s=Pf(a.length,r.length),u=Nf(t.shape,r,o),l=ck(i,r.length),c=hk(u,i,r.length);return t.reshape(a).transpose(s).reshape(u).slice(l,c)},e.prototype.spaceToBatchND=function(t,r,i){F(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(d,p){return d*p}),a=[[0,0]];a.push.apply(a,i);for(var s=1+r.length;s<t.shape.length;++s)a.push([0,0]);var u=t.pad(a),l=Af(u.shape,r,o,!1),c=Pf(l.length,r.length,!1),h=Nf(u.shape,r,o,!1);return u.reshape(l).transpose(c).reshape(h)},e.prototype.reduce=function(t,r,i){var o=t.shape[0],a=t.shape[1],s=av(a),u=new rW({windowSize:s,inSize:a,batchSize:o},r),l=this.compileAndRun(u,[t],i);return l.shape[1]===1?l:this.reduce(l,r,i)},e.prototype.argReduce=function(t,r,i){i===void 0&&(i=null);var o=t.shape[0],a=t.shape[1];i!=null&&(o=i.shape[0],a=i.shape[1]);var s=av(a),u=new W5({windowSize:s,inSize:a,batchSize:o},r,i==null),l=[t];i!=null&&l.push(i);var c=this.compileAndRun(u,l,"int32");return c.shape[1]===1?c:this.argReduce(t,r,c)},e.prototype.argReducePacked=function(t,r,i){i===void 0&&(i=null);var o=i!=null?i.shape:t.shape,a=av(o[o.length-1]),s=new X5(o,a,r,i==null),u=i==null?[t]:[t,i],l=this.compileAndRun(s,u,"int32");return l.rank===t.rank?this.argReducePacked(t,r,l):l},e.prototype.sum=function(t,r){Wn("sum",r,t.rank);var i=ln(t.shape,r),o=i[0],a=fe(i[1]),s=t.as2D(-1,a),u=Jm(t.dtype);return this.reduce(s,"sum",u).reshape(o)},e.prototype.prod=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,r);var i=ln(t.shape,r),o=i[0],a=fe(i[1]),s=t.as2D(-1,a),u=Jm(t.dtype);return this.reduce(s,"prod",u).reshape(o)},e.prototype.unsortedSegmentSum=function(t,r,i){var o=0,a=fi([o],t.rank),s=t;a!=null&&(s=t.transpose(a),o=pi(1,t.rank)[0]);var u=function(p,m,g){for(var y=[],v=p.length,w=0;w<v;w++)w!==m?y.push(p[w]):y.push(g);return y}(s.shape,o,i),l=fe([s.shape[o]]),c=s.as2D(-1,l),h=Jm(t.dtype),d=this.segOpCompute(c,"unsortedSegmentSum",r,h,i).reshape(u);return a!=null&&(d=d.transpose(g1(a))),d},e.prototype.segOpCompute=function(t,r,i,o,a){var s=t.shape[0],u=t.shape[1],l=function(d,p){var m,g=!1;for(d<=fk?(m=d,g=!0):m=ry(d,Math.floor(Math.sqrt(d)));!g;)m>p||m===d?g=!0:m=ry(d,m+1);return m}(u,a),c=new dW({windowSize:l,inSize:u,batchSize:s,numSegments:a}),h=this.compileAndRun(c,[t,i],o);return h.shape[1]===a?h:(i=kf(0,a).tile([u/l]),this.segOpCompute(h,r,i,o,a))},e.prototype.argMinMaxReduce=function(t,r,i){var o=[r];if(Wn("arg"+i.charAt(0).toUpperCase()+i.slice(1),o,t.rank),!Y().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var a=ln(t.shape,o),s=a[0],u=fe(a[1]),l=t.as2D(-1,u);return this.argReduce(l,i).reshape(s)}return this.argReducePacked(t,i)},e.prototype.argMin=function(t,r){return this.argMinMaxReduce(t,r,"min")},e.prototype.argMax=function(t,r){return this.argMinMaxReduce(t,r,"max")},e.prototype.cumsum=function(t,r,i,o){if(r!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+r);var a=new mz(t.shape,i,o);return this.compileAndRun(a,[t])},e.prototype.equal=function(t,r){if(Y().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(equal(a, b));
`,"bool");var i=new gt("return float(a == b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.notEqual=function(t,r){if(Y().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(notEqual(a, b));
`,"bool");var i=new gt("return float(a != b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.less=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.less(t,r);if(Y().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThan(a, b));
`,"bool");var i=new gt("return float(a < b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.lessEqual=function(t,r){if(Y().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var i=new gt("return float(a <= b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.greater=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.greater(t,r);if(Y().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThan(a, b));
`,"bool");var i=new gt("return float(a > b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.greaterEqual=function(t,r){if(Y().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var i=new gt("return float(a >= b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.logicalNot=function(t){var r=new ke(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[t])},e.prototype.logicalAnd=function(t,r){if(Y().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var i=new gt("return float(a >= 1.0 && b >= 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.logicalOr=function(t,r){if(Y().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var i=new gt("return float(a >= 1.0 || b >= 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.select=function(t,r,i){var o=new fW(t.rank,r.shape,r.rank);return this.compileAndRun(o,[t,r,i],Xt(r.dtype,i.dtype))},e.prototype.where=function(t){Sf("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=t.dataSync();return I1(t.shape,r)},e.prototype.topk=function(t,r,i){return Ck(t.dataSync(),t.shape,t.dtype,r)},e.prototype.min=function(t,r){Wn("min",r,t.rank);var i=ln(t.shape,r),o=i[0],a=fe(i[1]),s=t.as2D(-1,a);return this.reduce(s,"min",s.dtype).reshape(o)},e.prototype.minimum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.minimum(t,r);var i=Y().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _i(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new gt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.mod=function(t,r){var i=Y().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _i(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new gt(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.max=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,r);Wn("max",r,t.rank);var i=ln(t.shape,r),o=i[0],a=fe(i[1]),s=t.as2D(-1,a);return this.reduce(s,"max",s.dtype).reshape(o)},e.prototype.maximum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.maximum(t,r);var i=Y().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _i(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new gt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.all=function(t,r){Wn("all",r,t.rank);var i=ln(t.shape,r),o=i[0],a=fe(i[1]),s=t.as2D(-1,a);return this.reduce(s,"all",s.dtype).reshape(o)},e.prototype.any=function(t,r){Wn("any",r,t.rank);var i=ln(t.shape,r),o=i[0],a=fe(i[1]),s=t.as2D(-1,a);return this.reduce(s,"any",s.dtype).reshape(o)},e.prototype.realDivide=function(t,r){if(Y().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var i=new gt(`
if (a == b) {
  return 1.0;
};
return a / b;`,t.shape,r.shape);return this.compileAndRun(i,[t,r],"float32")},e.prototype.floorDiv=function(t,r){if(Y().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var i=new gt(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,r.shape);return this.compileAndRun(i,[t,r],"int32")},e.prototype.add=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,sv);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.add(t,r);var i=Xt(t.dtype,r.dtype);if(Y().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,sv,i);var o=new gt(sv,t.shape,r.shape);return this.compileAndRun(o,[t,r],i)},e.prototype.packedUnaryOp=function(t,r,i){var o=new tl(t.shape,r);return this.compileAndRun(o,[t],i)},e.prototype.packedBinaryOp=function(t,r,i,o,a){a===void 0&&(a=!1);var s=new _i(i,t.shape,r.shape,a);return this.compileAndRun(s,[t,r],o)},e.prototype.complexSeparableBinaryOp=function(t,r,i){var o=this,a=this.texData.get(t.dataId),s=this.texData.get(r.dataId),u=[[a.complexTensors.real,s.complexTensors.real],[a.complexTensors.imag,s.complexTensors.imag]].map(function(d){var p=d[0],m=d[1],g=o.makeComplexComponentTensorInfo(t,p),y=o.makeComplexComponentTensorInfo(r,m),v=new gt(i,t.shape,r.shape);return o.compileAndRun(v,[g,y],Xt(p.dtype,m.dtype))}),l=u[0],c=u[1],h=this.complex(l,c);return l.dispose(),c.dispose(),h},e.prototype.makeComplexComponentTensorInfo=function(t,r){return{dataId:r.dataId,dtype:r.dtype,shape:t.shape}},e.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>Y().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(t.length/2),i=this.addN(t.slice(0,r)),o=this.addN(t.slice(r));return this.addN([i,o])}var a=t.map(function(l){return l.dtype}).reduce(function(l,c){return Xt(l,c)}),s=t.map(function(l){return l.shape}),u=Y().getBool("WEBGL_PACK")?new z5(t[0].shape,s):new j5(t[0].shape,s);return this.compileAndRun(u,t,a)},e.prototype.subtract=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,uv);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.subtract(t,r);var i=Xt(t.dtype,r.dtype);if(Y().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,uv,t.dtype);var o=new gt(uv,t.shape,r.shape);return this.compileAndRun(o,[t,r],i)},e.prototype.pow=function(t,r){var i=Y().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _i(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new gt(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,r.shape),o=Xt(t.dtype,r.dtype);return this.compileAndRun(i,[t,r],o)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(Y().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,$E,t.dtype);var r=new ke(t.shape,$E);return this.compileAndRun(r,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(Y().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,HE,t.dtype);var r=new ke(t.shape,HE);return this.compileAndRun(r,[t])},e.prototype.sign=function(t){var r=new ke(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[t])},e.prototype.isNaN=function(t){var r=new ke(t.shape,"return float(isnan(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isInf=function(t){var r=new ke(t.shape,"return float(isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isFinite=function(t){var r=new ke(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.round=function(t){var r=new ke(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(Y().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,GE,t.dtype);var r=new ke(t.shape,GE);return this.compileAndRun(r,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(Y().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,qE,t.dtype);var r=new ke(t.shape,qE);return this.compileAndRun(r,[t])},e.prototype.softmax=function(t,r){var i=Lt([r],t.shape),o=this.max(t,i),a=Vn(o.shape,i),s=this.subtract(t,o.reshape(a)),u=this.exp(s),l=this.sum(u,i).reshape(a);return this.realDivide(u,l)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(Y().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var r=new ke(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[t])},e.prototype.log1p=function(t){var r=new ke(t.shape,"return log(1.0 + x);");return this.compileAndRun(r,[t])},e.prototype.sqrt=function(t){var r=new ke(t.shape,"return sqrt(x);");return this.compileAndRun(r,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var r=new ke(t.shape,"return inversesqrt(x);");return this.compileAndRun(r,[t])},e.prototype.reciprocal=function(t){var r=new ke(t.shape,"return 1.0 / x;");return this.compileAndRun(r,[t])},e.prototype.relu=function(t){var r;return r=Y().getBool("WEBGL_PACK")?new tl(t.shape,Dk):new ke(t.shape,Ak),this.compileAndRun(r,[t])},e.prototype.relu6=function(t){var r;return r=Y().getBool("WEBGL_PACK")?new tl(t.shape,Ok):new ke(t.shape,Pk),this.compileAndRun(r,[t])},e.prototype.prelu=function(t,r){var i=Y().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _i(kk,t.shape,r.shape):new gt(Rk,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.elu=function(t){if(Y().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Mk,t.dtype);var r=new ke(t.shape,Nk);return this.compileAndRun(r,[t])},e.prototype.eluDer=function(t,r){var i=Y().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _i(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,r.shape):new gt("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.selu=function(t){var r=new ke(t.shape,bW);return this.compileAndRun(r,[t])},e.prototype.int=function(t){var r=new ke(t.shape,"return float(int(x));");return this.compileAndRun(r,[t],"int32")},e.prototype.clip=function(t,r,i){var o,a=(o=Y().getBool("WEBGL_PACK_CLIP")?new rz(t.shape):new nz(t.shape)).getCustomSetupFunc(r,i);return this.compileAndRun(o,[t],null,a)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(Y().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,zE,t.dtype);var r=new ke(t.shape,zE);return this.compileAndRun(r,[t])},e.prototype.complexAbs=function(t){var r=this.texData.get(t.dataId),i=new iz(t.shape),o=[this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)];return this.compileAndRun(i,o)},e.prototype.sigmoid=function(t){var r=new ke(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[t])},e.prototype.softplus=function(t){var r=new ke(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[t])},e.prototype.sin=function(t){var r=new ke(t.shape,EW);return this.compileAndRun(r,[t])},e.prototype.cos=function(t){var r=new ke(t.shape,CW);return this.compileAndRun(r,[t])},e.prototype.tan=function(t){var r=new ke(t.shape,"return tan(x);");return this.compileAndRun(r,[t])},e.prototype.asin=function(t){var r=new ke(t.shape,IW);return this.compileAndRun(r,[t])},e.prototype.acos=function(t){var r=new ke(t.shape,TW);return this.compileAndRun(r,[t])},e.prototype.atan=function(t){var r=new ke(t.shape,SW);return this.compileAndRun(r,[t])},e.prototype.atan2=function(t,r){var i=Y().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _i(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new gt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.sinh=function(t){var r=new ke(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.cosh=function(t){var r=new ke(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.tanh=function(t){var r=new ke(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[t])},e.prototype.asinh=function(t){var r=new ke(t.shape,RW);return this.compileAndRun(r,[t])},e.prototype.acosh=function(t){var r=new ke(t.shape,kW);return this.compileAndRun(r,[t])},e.prototype.atanh=function(t){var r=new ke(t.shape,AW);return this.compileAndRun(r,[t])},e.prototype.erf=function(t){var r=new ke(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[t])},e.prototype.step=function(t,r){var i=new ke(t.shape,function(o){return o===void 0&&(o=0),Ur+`
    return x > 0.0 ? 1.0 : float(`+o+`);
  `}(r));return this.compileAndRun(i,[t])},e.prototype.conv2dByMatMul=function(t,r,i,o,a,s){var u=t.shape,l=this.texData.get(t.dataId),c=i.inChannels,h=u[0]*u[1]*u[2],d=i.outChannels,p=i.dataFormat==="channelsLast",m=(h===1||d===1)&&c>1e3,g=u[2]%2!=0&&!!l.isPacked;if(m||!Y().getBool("WEBGL_LAZILY_UNPACK")||!Y().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!g){var y=p?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],v=this.reshape(t,[1,y,i.inChannels]),w=this.reshape(r,[1,i.inChannels,i.outChannels]);return this.reshape(this.fusedBatchMatMul({a:v,b:w,transposeA:!1,transposeB:!1,bias:o,activation:a,preluActivationWeights:s}),i.outShape)}var _=p?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),x={dataId:t.dataId,shape:[1,_,i.inChannels],dtype:t.dtype},C=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,F(Vh(l.shape,x.shape),function(){return"packed reshape "+l.shape+" to "+x.shape+" isn't free"});var A=this.reshape(r,[1,i.inChannels,i.outChannels]),T=this.fusedBatchMatMul({a:x,b:A,transposeA:!1,transposeB:!1,bias:o,activation:a,preluActivationWeights:s}),E=this.texData.get(T.dataId);return F(E.isPacked,function(){return"batchMatMul result is expected to be packed"}),l.shape=C,E.shape=i.outShape,U.makeTensorFromDataId(T.dataId,i.outShape,T.dtype)},e.prototype.conv2dWithIm2Row=function(t,r,i,o,a,s){var u=i.filterWidth,l=i.filterHeight,c=i.inChannels,h=i.outWidth,d=i.outHeight,p=i.dataFormat==="channelsLast",m=u*l*c,g=d*h,y=[m,g],v=t.squeeze([0]),w=r.reshape([1,m,-1]),_=new Gz(y,v.shape,i),x=this.compileAndRun(_,[v]).reshape([1,y[0],y[1]]),C=o!=null,A=s!=null,T=a?zh(a,!0):null,E=new lv(x.shape,[1,g,i.outChannels],!0,!1,C,T,A),I=[x,w];o&&I.push(o),A&&I.push(s);var S=this.compileAndRun(E,I);return p?S.reshape([1,d,h,i.outChannels]):S.reshape([1,i.outChannels,d,h])},e.prototype.fusedConv2d=function(t){var r=t.input,i=t.filter,o=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights;if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(r,i,o,a,s,u);if(Y().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,i,o,a,s,u);var l=a!=null,c=u!=null,h=s?zh(s,!1):null,d=new DE(o,l,h,c),p=[r,i];return a&&p.push(a),u&&p.push(u),this.compileAndRun(d,p)},e.prototype.conv2d=function(t,r,i){if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(t,r,i);if(Y().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,r,i);var o=new DE(i);return this.compileAndRun(o,[t,r])},e.prototype.conv2dDerInput=function(t,r,i){var o=new uz(i);return this.compileAndRun(o,[t,r])},e.prototype.conv2dDerFilter=function(t,r,i){var o=new sz(i);return this.compileAndRun(o,[t,r])},e.prototype.fusedDepthwiseConv2D=function(t){var r,i=t.input,o=t.filter,a=t.convInfo,s=t.bias,u=t.activation,l=t.preluActivationWeights,c=Y().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,h=u?zh(u,c):null,d=[i,o],p=s!=null,m=l!=null;return p&&d.push(s),m&&d.push(l),c?(r=new ME(a,p,h,m),this.compileAndRun(r,d)):(r=new OE(a,p,h,m),this.compileAndRun(r,d))},e.prototype.depthwiseConv2D=function(t,r,i){var o;return Y().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1?(o=new ME(i),this.compileAndRun(o,[t,r])):(o=new OE(i),this.compileAndRun(o,[t,r]))},e.prototype.depthwiseConv2DDerInput=function(t,r,i){var o=new dz(i);return this.compileAndRun(o,[t,r])},e.prototype.depthwiseConv2DDerFilter=function(t,r,i){var o=new hz(i);return this.compileAndRun(o,[t,r])},e.prototype.conv3d=function(t,r,i){var o=new fz(i);return this.compileAndRun(o,[t,r])},e.prototype.conv3dDerInput=function(t,r,i){var o=new cz(i);return this.compileAndRun(o,[t,r])},e.prototype.conv3dDerFilter=function(t,r,i){var o=new lz(i);return this.compileAndRun(o,[t,r])},e.prototype.maxPool=function(t,r){var i=new cv(r,"max",!1);return this.compileAndRun(i,[t])},e.prototype.avgPool=function(t,r){var i=new cv(r,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPoolBackprop=function(t,r,i,o){var a=new cv(o,"max",!0),s=this.compileAndRun(a,[r]),u=new Qz(o),l=this.compileAndRun(u,[t,s],r.dtype);return s.dispose(),l},e.prototype.avgPoolBackprop=function(t,r,i){var o=new Q5(i);return this.compileAndRun(o,[t],r.dtype)},e.prototype.cast=function(t,r){return wk(t,r,this)},e.prototype.unstack=function(t,r){for(var i=t.shape[r],o=new Array(t.rank-1),a=0,s=0;s<t.rank;s++)s!==r&&(o[a++]=t.shape[s]);var u=new Array(t.rank).fill(0),l=t.shape.slice();l[r]=1;var c=new Array(i);for(s=0;s<c.length;s++)u[r]=s,c[s]=this.slice(t,u,l).reshape(o);return c},e.prototype.avgPool3d=function(t,r){var i=new hv(r,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,r,i){var o=new Y5(i);return this.compileAndRun(o,[t],r.dtype)},e.prototype.maxPool3d=function(t,r){var i=new hv(r,"max",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,r,i,o){var a=new hv(o,"max",!0),s=this.compileAndRun(a,[r]),u=new Yz(o),l=this.compileAndRun(u,[t,s],r.dtype);return s.dispose(),l},e.prototype.reshape=function(t,r){var i=this.texData.get(t.dataId);if(i.isPacked&&!Vh(t.shape,r)&&(i.texture===null||!Vh(i.shape,r))){var o=this.packedReshape(t,r);return U.makeTensorFromDataId(o.dataId,o.shape,o.dtype)}return hy(t,r)},e.prototype.resizeBilinear=function(t,r,i,o){var a=Y().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new sW(t.shape,r,i,o):new aW(t.shape,r,i,o);return this.compileAndRun(a,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,r,i){var o=new oW(t,r,i);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighbor=function(t,r,i,o){var a=new lW(t.shape,r,i,o);return this.compileAndRun(a,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,r,i){var o=new uW(t,r,i);return this.compileAndRun(o,[t])},e.prototype.multinomial=function(t,r,i,o){var a=r?t:Hi(t),s=a.shape[0],u=a.shape[1],l=new Jz(s,u,i),c=l.getCustomSetupFunc(o);return this.compileAndRun(l,[a],"int32",c)},e.prototype.oneHot=function(t,r,i,o){var a=new Zz(t.size,r,i,o);return this.compileAndRun(a,[t])},e.prototype.diag=function(t){var r=new wz(t.size);return this.compileAndRun(r,[t])},e.prototype.nonMaxSuppression=function(t,r,i,o,a){return Sf("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),E1(t.dataSync(),r.dataSync(),i,o,a)},e.prototype.cropAndResize=function(t,r,i,o,a,s){var u=new pz(t.shape,r.shape,o,a,s);return this.compileAndRun(u,[t,r,i],"float32")},e.prototype.depthToSpace=function(t,r,i){F(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var o=t.shape[0],a=i==="NHWC"?t.shape[1]:t.shape[2],s=i==="NHWC"?t.shape[2]:t.shape[3],u=i==="NHWC"?t.shape[3]:t.shape[1],l=a*r,c=s*r,h=u/(r*r),d=new yz(i==="NHWC"?[o,l,c,h]:[o,h,l,c],r,i);return this.compileAndRun(d,[t])},e.prototype.split=function(t,r,i){return bk(t,r,i)},e.prototype.scatterND=function(t,r,i){var o=Df(0,t,i),a=o.sliceRank,s=o.numUpdates,u=o.sliceSize,l=o.strides,c=o.outputSize,h=[c/u,u],d=t.reshape([s,a]),p=r.reshape([s,u]);if(c===0)return hy(Qt([]),i);var m=ae(0),g=new BE(s,a,d.rank,p.rank,l,h);return this.compileAndRun(g,[p,d,m]).reshape(i)},e.prototype.sparseToDense=function(t,r,i,o){var a=Df(0,t,i),s=a.sliceRank,u=a.numUpdates,l=a.strides,c=a.outputSize,h=new BE(u,s,t.rank,r.rank,l,[c,1]);return this.compileAndRun(h,[r,t,o]).reshape(i)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,r){var i=this.texData.get(t.dataId),o=new LE(Cz,t.shape,r),a=new LE(Iz,t.shape,r),s=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag)],u=this.compileAndRun(o,s),l=this.compileAndRun(a,s),c=this.complex(u,l).as2D(t.shape[0],t.shape[1]);return u.dispose(),l.dispose(),c},e.prototype.gatherND=function(t,r){var i=r.shape,o=i[i.length-1],a=dk(t,r),s=a[0],u=a[1],l=a[2],c=a[3],h=r.reshape([u,o]),d=t.reshape([t.size/l,l]),p=new Rz(o,c,[u,l]);return this.compileAndRun(p,[d,h]).reshape(s)},e.prototype.fill=function(t,r,i){if((i=i||Vc(r))==="string"){var o=Ef(i,fe(t));return o.fill(r),U.makeTensor(o,t,i,this)}var a=new Tz(t,r),s=a.getCustomSetupFunc(r);return this.compileAndRun(a,[],i,s)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},e.prototype.linspace=function(t,r,i){return _k(t,r,i)},e.prototype.makeTensorInfo=function(t,r){var i=this.write(null,t,r);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:r}},e.prototype.makeOutput=function(t,r){var i=this.makeTensorInfo(t,r).dataId;return U.makeTensorFromDataId(i,t,r,this)},e.prototype.unpackTensor=function(t){var r=new NW(t.shape);return this.runWebGLProgram(r,[t],t.dtype)},e.prototype.packTensor=function(t){var r=new eW(t.shape);return this.runWebGLProgram(r,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,r){var i=[If(t.shape)].concat(Tf(t.shape)),o={dtype:t.dtype,shape:i,dataId:t.dataId},a=[If(r)].concat(Tf(r)),s=new iW(a,i),u=this.runWebGLProgram(s,[o],t.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},e.prototype.decode=function(t){var r,i=this.texData.get(t),o=i.isPacked,a=i.shape,s=i.dtype,u=ov(a);return r=o?new gz(u):new vz(u),{dtype:s,shape:a,dataId:this.runWebGLProgram(r,[{shape:u,dtype:s,dataId:t}],s,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,r,i,o,a){var s=this;a===void 0&&(a=!1);var u=this.makeTensorInfo(t.outputShape,i),l=this.texData.get(u.dataId);if(t.packedOutput&&(l.isPacked=!0),t.outPackingScheme===dc.DENSE){var c=Rl(t.outputShape);l.texShape=c.map(function(_){return 2*_})}if(t.outTexUsage!=null&&(l.usage=t.outTexUsage),fe(u.shape)===0)return l.values=cc(u.dtype,0),u;var h=[],d=r.map(function(_){if(_.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var x=s.texData.get(_.dataId);if(x.texture==null){if(!t.packedInputs&&fe(_.shape)<=Y().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:_.shape,texData:null,isUniform:!0,uniformValues:x.values};t.packedInputs&&(x.isPacked=!0,x.shape=_.shape)}else if(!!x.isPacked!=!!t.packedInputs)_=x.isPacked?s.unpackTensor(_):s.packTensor(_),h.push(_),x=s.texData.get(_.dataId);else if(x.isPacked&&!Vh(x.shape,_.shape)){var C=_,A=_.shape;_.shape=x.shape,_=s.packedReshape(_,A),h.push(_),x=s.texData.get(_.dataId),C.shape=A}return s.uploadToGPU(_.dataId),{shape:_.shape,texData:x,isUniform:!1}});this.uploadToGPU(u.dataId);var p,m={shape:u.shape,texData:l,isUniform:!1},g=function(_,x,C){var A="";x.concat(C).forEach(function(I){var S=I.texData!=null&&I.texData.slice!=null&&I.texData.slice.flatOffset>0,N=I.isUniform?"uniform":I.texData.texShape;A+=I.shape+"_"+N+"_"+S});var T=_.userCode,E=_.constructor.name;return E+="_"+A+"_"+T}(t,d,m),y=this.getAndSaveBinary(g,function(){return function(_,x,C,A){var T=x.userCode,E=C.map(function(V,$){var G={logicalShape:V.shape,texShape:V.isUniform?null:V.texData.texShape,isUniform:V.isUniform,isPacked:!V.isUniform&&V.texData.isPacked,flatOffset:null};return V.texData!=null&&V.texData.slice!=null&&V.texData.slice.flatOffset>0&&(G.flatOffset=V.texData.slice.flatOffset),{name:x.variableNames[$],shapeInfo:G}}),I=E.map(function(V){return V.shapeInfo}),S={logicalShape:A.shape,texShape:A.texData.texShape,isUniform:!1,isPacked:A.texData.isPacked,flatOffset:null},N=$5(E,S,T,x.packedInputs),P=_.createProgram(N),k=null,j=_.getUniformLocation(P,"NAN",!1);Y().getNumber("WEBGL_VERSION")===1&&(k=_.getUniformLocation(P,"INFINITY",!1));for(var B={},W=0;W<x.variableNames.length;W++){var X=x.variableNames[W];B[X]=_.getUniformLocation(P,X,!1),B["offset"+X]=_.getUniformLocation(P,"offset"+X,!1)}return{program:x,source:N,webGLProgram:P,uniformLocations:B,inShapeInfos:I,outShapeInfo:S,infLoc:k,nanLoc:j}}(s.gpgpu,t,d,m)}),v=this.activeTimers!=null;if(v&&(p=this.startTimer()),function(_,x,C,A,T){VE(x.inShapeInfos,C),VE([x.outShapeInfo],[A]);var E=A.texData.texture,I=A.texData.texShape;A.texData.isPacked?_.setOutputPackedMatrixTexture(E,I[0],I[1]):_.setOutputMatrixTexture(E,I[0],I[1]),_.setProgram(x.webGLProgram),Y().getNumber("WEBGL_VERSION")===1&&x.infLoc!==null&&_.gl.uniform1f(x.infLoc,1/0),x.nanLoc!==null&&_.gl.uniform1f(x.nanLoc,NaN),C.forEach(function(S,N){var P=x.program.variableNames[N],k=x.uniformLocations[P],j=x.uniformLocations["offset"+P];if(k!=null)if(S.isUniform)if(fe(S.shape)<2)_.gl.uniform1f(k,S.uniformValues[0]);else{var B=S.uniformValues;B instanceof Float32Array||(B=new Float32Array(B)),_.gl.uniform1fv(k,B)}else S.texData.slice!=null&&j!=null&&_.gl.uniform1i(j,S.texData.slice.flatOffset),_.setInputMatrixTexture(S.texData.texture,k,N)}),T!=null&&T(_,x.webGLProgram),_.executeProgram()}(this.gpgpu,y,d,m,o),h.forEach(function(_){return s.disposeData(_.dataId)}),v&&(p=this.endTimer(p),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(p)})),!Y().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&a===!1){var w=this.unpackTensor(u);return this.disposeData(u.dataId),w}return u},e.prototype.compileAndRun=function(t,r,i,o,a){a===void 0&&(a=!1),i=i||r[0].dtype;var s=this.runWebGLProgram(t,r,i,o,a);return U.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},e.prototype.getAndSaveBinary=function(t,r){return t in this.binaryCache||(this.binaryCache[t]=r()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(Y().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){t.gpgpu.deleteProgram(t.binaryCache[r].webGLProgram),delete t.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ue(function(){if(!Y().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=Y().getBool("DEBUG");Y().set("DEBUG",!1);var i=t.abs(ae(1e-8)).dataSync()[0];if(Y().set("DEBUG",r),i>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var r,i=this.texData.get(t),o=i.shape,a=i.dtype,s=i.values,u=i.texture,l=i.usage,c=i.isPacked;if(u==null){var h,d=this.activeTimers!=null;d&&(h=Xr());var p=i.texShape;if(p==null&&(p=Uj(o,c),i.texShape=p),s!=null){var m=ov(o),g=void 0,y=p[1],v=p[0],w=s instanceof Uint8Array;c?(y=(r=Uc(p[0],p[1]))[0],v=r[1],g=new Ez(m,[v,y],w)):g=new bz(m,[v,y],w);var _=this.makeTensorInfo([v,y],a);this.texData.get(_.dataId).usage=w?qn.PIXELS:qn.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(_.dataId),y,v,s);var x=this.runWebGLProgram(g,[_],a,null,!0),C=this.texData.get(x.dataId);i.texture=C.texture,i.texShape=C.texShape,i.isPacked=C.isPacked,i.usage=C.usage,this.disposeData(_.dataId),this.texData.delete(x.dataId),i.values=null,d&&(this.uploadWaitMs+=Xr()-h)}else{var A=this.acquireTexture(p,l,a,c);i.texture=A}}},e.prototype.convertAndCacheOnCPU=function(t,r){var i=this.texData.get(t),o=i.dtype;return this.releaseGPUData(t),r!=null&&(i.values=function(a,s){if(s==="float32"||s==="complex64")return a;if(s==="int32"||s==="bool"){for(var u=s==="int32"?new Int32Array(a.length):new Uint8Array(a.length),l=0;l<u.length;++l)u[l]=Math.round(a[l]);return u}throw new Error("Unknown dtype "+s)}(r,o)),i.values},e.prototype.acquireTexture=function(t,r,i,o){if(this.numBytesInGPU+=this.computeBytes(t,i),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,r,o)},e.prototype.computeBytes=function(t,r){return t[0]*t[1]*KR(r)},e}(gk);tk()&&U.registerBackend("webgl",function(){return new OW},2);var MW=L({square_:function(n){var e=M(n,"x","square"),t=[e];return U.runKernelFunc(function(r,i){return i([e]),r.square(e)},{x:e},null,"Square",{},t,[])}}),pc="SquaredDifference",Fk=L({squaredDifference_:function(n,e){var t,r=M(n,"a","squaredDifference"),i=M(e,"b","squaredDifference");t=pt(r,i),r=t[0],i=t[1],Oe(r.shape,i.shape);var o={a:r,b:i},a=[r,i];return U.runKernelFunc(function(s,u){var l=s.squaredDifference(r,i);return u([r,i]),l},o,function(s,u){var l=u[0],c=u[1],h=ae(2);return{a:function(){return s.mul(l.sub(c).mul(h))},b:function(){return s.mul(c.sub(l).mul(h))}}},pc,{},a,[])}}),FW=L({abs_:function(n){var e=M(n,"x","abs");return e.dtype==="complex64"?U.runKernelFunc(function(t){return t.complexAbs(e)},{$x:e}):U.runKernelFunc(function(t,r){var i=t.abs(e);return r([e]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return t.mul(i.toFloat().step(-1))}}},"Abs")}}),LW=L({acos_:function(n){var e=M(n,"x","acos");return U.runKernelFunc(function(t,r){var i=t.acos(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(ae(1).sub(i.toFloat().square()).sqrt()).neg()}}})}}),VW=L({acosh_:function(n){var e=M(n,"x","acosh");return U.runKernelFunc(function(t,r){var i=t.acosh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(i.toFloat().square().sub(1).sqrt())}}})}}),BW=L({asin_:function(n){var e=M(n,"x","asin");return U.runKernelFunc(function(t,r){var i=t.asin(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(ae(1).sub(i.toFloat().square()).sqrt())}}})}}),UW=L({asinh_:function(n){var e=M(n,"x","asinh");return U.runKernelFunc(function(t,r){var i=t.asinh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(ae(1).add(i.toFloat().square()).sqrt())}}})}}),jW=L({atan_:function(n){var e=M(n,"x","atan");return U.runKernelFunc(function(t,r){var i=t.atan(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().square().add(1))}}})}}),zW=L({atanh_:function(n){var e=M(n,"x","atanh");return U.runKernelFunc(function(t,r){var i=t.atanh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(ae(1).sub(i.toFloat().square()))}}})}}),WW=L({ceil_:function(n){var e=M(n,"x","ceil");return U.runKernelFunc(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return je(t)}}})}}),k1=L({clipByValue_:function(n,e,t){var r=M(n,"x","clipByValue");F(e<=t,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."});var i=[r],o={min:e,max:t};return U.runKernelFunc(function(a,s){var u=a.clip(r,e,t);return s([r]),u},{x:r},function(a,s){var u=s[0];return{x:function(){return a.where(u.greaterEqual(e).logicalAnd(u.lessEqual(t)),je(a))}}},"ClipByValue",o,i)}}),$W=L({cos_:function(n){var e=M(n,"x","cos"),t=[e];return U.runKernelFunc(function(r,i){var o=r.cos(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return o.toFloat().sin().neg().mul(r)}}},"Cos",{},t)}}),HW=L({cosh_:function(n){var e=M(n,"x","cosh");return U.runKernelFunc(function(t,r){var i=t.cosh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().sinh().mulStrict(t)}}})}}),GW=L({erf_:function(n){var e=M(n,"x","erf");return F(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=e.toFloat()),U.runKernelFunc(function(t,r){var i=t.erf(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),fy=L({exp_:function(n){var e=M(n,"x","exp");return U.runKernelFunc(function(t,r){var i=t.exp(e);return r([i]),i},{x:e},function(t,r){return{x:function(){return t.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),qW=L({expm1_:function(n){var e=M(n,"x","expm1");return U.runKernelFunc(function(t,r){var i=t.expm1(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.exp())}}})}}),KW=L({floor_:function(n){var e=M(n,"x","floor");return U.runKernelFunc(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return je(t)}}})}}),XW=L({log_:function(n){var e=M(n,"x","log"),t=[e];return U.runKernelFunc(function(r,i){var o=r.log(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return r.div(o.toFloat())}}},"Log",{},t)}}),QW=L({log1p_:function(n){var e=M(n,"x","log1p");return U.runKernelFunc(function(t,r){var i=t.log1p(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.add(1))}}})}}),YW=L({logSigmoid_:function(n){var e=M(n,"x","logSigmoid");return U.runKernelFunc(function(t,r){var i=t.softplus(e.neg()).neg();return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.neg().sigmoid())}}})}}),Lf=L({neg_:function(n){var e=M(n,"x","neg"),t=[e];return U.runKernelFunc(function(r){return r.neg(e)},{x:e},function(r){return{x:function(){return r.neg()}}},"Neg",{},t)}}),JW=L({reciprocal_:function(n){var e=M(n,"x","reciprocal");return U.runKernelFunc(function(t,r){var i=t.reciprocal(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.square().neg())}}})}}),ZW=L({round_:function(n){var e=M(n,"x","round");return U.runKernelFunc(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return je(t)}}})}}),Lk=L({rsqrt_:function(n){var e=M(n,"x","rsqrt"),t=[e];return U.runKernelFunc(function(r,i){var o=r.rsqrt(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return r.div(o.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},t)}}),Vk=L({sigmoid_:function(n){var e=M(n,"x","sigmoid");return U.runKernelFunc(function(t,r){var i=t.sigmoid(e);return r([i]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return t.mul(i.mul(ae(1).sub(i)))}}},"Sigmoid")}}),e$=L({sign_:function(n){var e=M(n,"x","sign");return U.runKernelFunc(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return je(t)}}})}}),t$=L({isNaN_:function(n){var e=M(n,"x","isNaN");return U.runKernelFunc(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return je(t)}}})}}),n$=L({isInf_:function(n){var e=M(n,"x","isInf");return U.runKernelFunc(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return je(t)}}})}}),r$=L({isFinite_:function(n){var e=M(n,"x","isFinite");return U.runKernelFunc(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return je(t)}}})}}),i$=L({sin_:function(n){var e=M(n,"x","sin"),t=[e];return U.runKernelFunc(function(r,i){var o=r.sin(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return o.toFloat().cos().mul(r)}}},"Sin",{},t)}}),o$=L({sinh_:function(n){var e=M(n,"x","sinh");return U.runKernelFunc(function(t,r){var i=t.sinh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().cosh().mulStrict(t)}}})}}),a$=L({softplus_:function(n){var e=M(n,"x","softplus");return U.runKernelFunc(function(t,r){var i=t.softplus(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.sigmoid())}}})}}),s$=L({sqrt_:function(n){var e=M(n,"x","sqrt");return U.runKernelFunc(function(t,r){var i=t.sqrt(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().sqrt().mul(2))}}})}}),u$=L({step_:function(n,e){e===void 0&&(e=0);var t=M(n,"x","step");return U.runKernelFunc(function(r){return r.step(t,e)},{$x:t},function(r){return{$x:function(){return je(r)}}})}}),l$=L({tan_:function(n){var e=M(n,"x","tan");return U.runKernelFunc(function(t,r){var i=t.tan(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.cos().square())}}})}}),c$=L({tanh_:function(n){var e=M(n,"x","tanh");return U.runKernelFunc(function(t,r){var i=t.tanh(e);return r([i]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return ae(1).sub(i.square()).mulStrict(t)}}},"Tanh",{},null,[!0])}});function Bk(n,e,t,r,i,o){var a,s,u=M(n,"x","batchNorm"),l=M(e,"mean","batchNorm"),c=M(t,"variance","batchNorm");return i!=null&&(a=M(i,"scale","batchNorm")),r!=null&&(s=M(r,"offset","batchNorm")),F(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),F(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),F(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),a!=null&&F(a.rank===2||a.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),s!=null&&F(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),zc(u,l,c,s,a,o)}function Uk(n,e,t,r,i,o){var a,s,u=M(n,"x","batchNorm"),l=M(e,"mean","batchNorm"),c=M(t,"variance","batchNorm");return i!=null&&(a=M(i,"scale","batchNorm")),r!=null&&(s=M(r,"offset","batchNorm")),F(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),F(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),F(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),a!=null&&F(a.rank===3||a.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),s!=null&&F(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),zc(u,l,c,s,a,o)}function jk(n,e,t,r,i,o){var a,s,u=M(n,"x","batchNorm"),l=M(e,"mean","batchNorm"),c=M(t,"variance","batchNorm");return i!=null&&(a=M(i,"scale","batchNorm")),r!=null&&(s=M(r,"offset","batchNorm")),F(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),F(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),F(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),a!=null&&F(a.rank===4||a.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),s!=null&&F(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),zc(u,l,c,s,a,o)}function zc(n,e,t,r,i,o){o==null&&(o=.001);var a,s,u,l=M(n,"x","batchNorm"),c=M(e,"mean","batchNorm"),h=M(t,"variance","batchNorm");i!=null&&(a=M(i,"scale","batchNorm")),r!=null&&(s=M(r,"offset","batchNorm")),F(c.rank===h.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),F(s==null||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),F(a==null||c.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=l.rank===0||l.rank===1?l.as4D(1,1,1,l.size):l.rank===2?l.as4D(1,1,l.shape[0],l.shape[1]):l.rank===3?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l;var d=[l,c,h,a];return U.runKernelFunc(function(p,m){var g=p.batchNormalization(u,Wh(c),Wh(h),o,Wh(a),Wh(s));return m([l,c,h,a]),g},{x:l,mean:c,variance:h,scale:a,offset:s},function(p,m){var g=m,y=g[0],v=g[1],w=g[2],_=g[3],x=_??ae(1),C=Mt(v.shape,u.shape),A=[];if(v.rank===1){for(var T=0;T<u.shape.length-1;++T)A.push(u.shape[T]);A.push(1)}var E=y.sub(v),I=p.mul(x),S=Lk(w.add(ae(o))),N=S.mul(S).mul(S).mul(ae(-.5));return{x:function(){return v.rank===1?p.mul(Hs(S.as4D(1,1,1,v.shape[0]),A)).mul(x).reshape(y.shape):p.mul(S).mul(x).reshape(y.shape)},mean:function(){var P=S.mul(ae(-1)).mul(I);return v.rank===1&&(P=P.sum(C)),P.reshape(v.shape)},variance:function(){var P=N.mul(E).mul(I);return v.rank===1&&(P=P.sum(C)),P.reshape(v.shape)},scale:function(){var P=E.mul(S),k=p.mul(P);return v.rank===1&&(k=k.sum(C)),k.reshape(v.shape)},offset:function(){var P=p;return v.rank===1&&(P=P.sum(C)),P.reshape(v.shape)}}},"BatchNormalization",{varianceEpsilon:o},d).reshape(l.shape)}function Wh(n){return n==null?null:n.rank===0?n.as1D():n.rank===1?n:n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function Mp(){nk("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var h$=L({batchNormalization2d_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),Mp(),Bk(n,e,t,o,i,r)}}),d$=L({batchNormalization3d_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),Mp(),Uk(n,e,t,o,i,r)}}),f$=L({batchNormalization4d_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),Mp(),jk(n,e,t,o,i,r)}}),p$=L({batchNormalization_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),Mp(),zc(n,e,t,o,i,r)}}),zk=L({batchNorm_:zc}),m$=L({batchNorm2d_:Bk}),v$=L({batchNorm3d_:Uk}),g$=L({batchNorm4d_:jk}),Fp=L({logicalAnd_:function(n,e){var t=M(n,"a","logicalAnd","bool"),r=M(e,"b","logicalAnd","bool");return Oe(t.shape,r.shape),U.runKernelFunc(function(i){return i.logicalAnd(t,r)},{a:t,b:r},null,"LogicalAnd")}}),y$=L({logicalNot_:function(n){var e=M(n,"x","logicalNot","bool");return U.runKernelFunc(function(t){return t.logicalNot(e)},{$x:e})}}),Wk=L({logicalOr_:function(n,e){var t=M(n,"a","logicalOr","bool"),r=M(e,"b","logicalOr","bool");return Oe(t.shape,r.shape),U.runKernelFunc(function(i){return i.logicalOr(t,r)},{$a:t,$b:r})}}),w$=L({logicalXor_:function(n,e){var t=M(n,"a","logicalXor","bool"),r=M(e,"b","logicalXor","bool");return Oe(t.shape,r.shape),Wk(n,e).logicalAnd(Fp(n,e).logicalNot())}}),Ua=L({where_:function(n,e,t){var r=M(e,"a","where"),i=M(t,"b","where"),o=M(n,"condition","where","bool");return qe(r.shape,i.shape,"Error in where: "),o.rank===1?F(o.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):qe(o.shape,i.shape,"Error in where: "),U.runKernelFunc(function(a,s){var u=a.select(o,r,i);return s([o]),u},{$condition:o,$a:r,$b:i},function(a,s){var u=s[0];return{$condition:function(){return je(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}})}}),$k=function(n){return ce(this,void 0,void 0,function(){var e,t,r;return he(this,function(i){switch(i.label){case 0:return[4,(e=M(n,"condition","whereAsync","bool")).data()];case 1:return t=i.sent(),r=I1(e.shape,t),n!==e&&e.dispose(),[2,r]}})})},Ne=L({add_:function(n,e){var t,r=M(n,"a","add"),i=M(e,"b","add");t=pt(r,i),r=t[0],i=t[1];var o=Oe(r.shape,i.shape);return U.runKernelFunc(function(a){return a.add(r,i)},{a:r,b:i},function(a){return{a:function(){var s=a,u=Mt(r.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=Mt(i.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(i.shape)}}},"Add")}}),_$=L({addN_:function(n){F(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),F(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length});var e=n.map(function(i,o){return M(i,"tensors"+o,"addN")}),t=e[0];e.forEach(function(i){if(i.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(i){if(!zt(i.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=e;return U.runKernelFunc(function(i){return i.addN(e)},r,function(i){var o={};return e.forEach(function(a,s){o[s]=function(){return i.clone()}}),o},"AddN")}}),x$=L({addStrict_:function(n,e){var t=M(n,"a","addStrict"),r=M(e,"b","addStrict");return qe(t.shape,r.shape,"Error in addStrict: "),t.add(r)}}),b$=L({atan2_:function(n,e){var t,r=M(n,"a","atan2"),i=M(e,"b","atan2");t=pt(r,i),r=t[0],i=t[1];var o=Oe(r.shape,i.shape);return U.runKernelFunc(function(a,s){var u=a.atan2(r,i);return s([r,i]),u},{$a:r,$b:i},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=Ne(u.square(),l.square()),h=a.mul(l.div(c)),d=Mt(u.shape,o);return d.length>0&&(h=h.sum(d)),h.reshape(u.shape)},$b:function(){var c=Ne(u.square(),l.square()),h=Lf(a.mul(u.div(c))),d=Mt(l.shape,o);return d.length>0&&(h=h.sum(d)),h.reshape(l.shape)}}})}}),Tr=L({div_:function(n,e){var t,r=M(n,"a","div"),i=M(e,"b","div");if(t=pt(r,i),r=t[0],i=t[1],r.dtype==="int32"&&i.dtype==="int32")return Hk(r,i);var o=Oe(r.shape,i.shape);return U.runKernelFunc(function(a,s){var u=a.realDivide(r,i);return s([r,i]),u},{a:r,b:i},function(a,s){var u=s[0],l=s[1];return{a:function(){var c=a.div(l.toFloat()),h=Mt(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},b:function(){var c=a.mul(u.toFloat()),h=Mt(l.shape,o);h.length>0&&(c=c.sum(h).reshape(l.shape));var d=l.square();return c.div(d.toFloat()).neg()}}},"Div")}}),E$=L({divNoNan_:function(n,e){var t,r=M(n,"a","div"),i=M(e,"b","div");r=(t=pt(r,i))[0],i=t[1];var o=Tr(r,i),a=je(o),s=i.equal(a);return Ua(s,a,o)}}),C$=L({divStrict_:function(n,e){var t=M(n,"a","div"),r=M(e,"b","div");return qe(t.shape,r.shape,"Error in divideStrict: "),t.div(r)}}),Hk=L({floorDiv_:function(n,e){var t,r=M(n,"a","floorDiv"),i=M(e,"b","floorDiv");t=pt(r,i),r=t[0],i=t[1];var o=Oe(r.shape,i.shape);return U.runKernelFunc(function(a,s){var u=a.floorDiv(r,i);return s([r,i]),u},{a:r,b:i},function(a,s){var u=s[0],l=s[1];return{a:function(){var c=a.div(l.toFloat()),h=Mt(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},b:function(){var c=a.mul(u.toFloat()),h=Mt(l.shape,o);h.length>0&&(c=c.sum(h).reshape(l.shape));var d=l.square();return c.div(d.toFloat()).neg()}}},"FloorDiv")}}),A1=L({maximum_:function(n,e){var t,r=M(n,"a","maximum"),i=M(e,"b","maximum");return t=pt(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),Oe(r.shape,i.shape),U.runKernelFunc(function(o,a){var s=o.maximum(r,i);return a([r,i]),s},{a:r,b:i},function(o,a){var s=a[0],u=a[1];return{a:function(){return o.mul(s.greaterEqual(u).toFloat())},b:function(){return o.mul(s.less(u).toFloat())}}},"Maximum")}}),I$=L({maximumStrict_:function(n,e){var t=M(n,"a","maximumStrict"),r=M(e,"b","maximumStrict");return qe(t.shape,r.shape,"Error in maximumStrict: "),t.maximum(r)}}),Gk=L({minimum_:function(n,e){var t,r=M(n,"a","minimum"),i=M(e,"b","minimum");return t=pt(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),Oe(r.shape,i.shape),U.runKernelFunc(function(o,a){var s=o.minimum(r,i);return a([r,i]),s},{a:r,b:i},function(o,a){var s=a[0],u=a[1];return{a:function(){return o.mul(s.lessEqual(u).toFloat())},b:function(){return o.mul(s.greater(u).toFloat())}}},"Minimum")}}),T$=L({minimumStrict_:function(n,e){var t=M(n,"a","minimumStrict"),r=M(e,"b","minimumStrict");return qe(t.shape,r.shape,"Error in minimumStrict: "),t.minimum(r)}}),S$=L({mod_:function(n,e){var t,r=M(n,"a","mod"),i=M(e,"b","mod");t=pt(r,i),r=t[0],i=t[1];var o=Oe(r.shape,i.shape);return U.runKernelFunc(function(a,s){var u=a.mod(r,i);return s([r,i]),u},{$a:r,$b:i},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=Mt(u.shape,o);return c.length>0?a.sum(c).reshape(u.shape):a},$b:function(){var c=a.mul(u.div(l).floor().neg()),h=Mt(l.shape,o);return h.length>0?c.sum(h).reshape(l.shape):c}}})}}),R$=L({modStrict_:function(n,e){var t=M(n,"a","modStrict"),r=M(e,"b","modStrict");return qe(t.shape,r.shape,"Error in modStrict: "),t.mod(r)}}),vn=L({mul_:function(n,e){var t,r=M(n,"a","mul"),i=M(e,"b","mul");t=pt(r,i),r=t[0],i=t[1];var o=Oe(r.shape,i.shape);return U.runKernelFunc(function(a,s){var u=a.multiply(r,i);return s([r,i]),u},{a:r,b:i},function(a,s){var u=s[0],l=s[1];return{a:function(){var c=a.mul(l.toFloat()),h=Mt(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},b:function(){var c=a.mul(u.toFloat()),h=Mt(l.shape,o);return h.length>0?c.sum(h).reshape(l.shape):c}}},"Mul")}}),k$=L({mulStrict_:function(n,e){var t=M(n,"a","mul"),r=M(e,"b","mul");return qe(t.shape,r.shape,"Error in multiplyStrict: "),t.mul(r)}}),Vf=L({pow_:function(n,e){var t,r=M(n,"base","pow"),i=M(e,"exp","pow");t=pt(r,i),r=t[0],i=t[1];var o=Oe(r.shape,i.shape),a=[r,i];return U.runKernelFunc(function(s,u){var l=s.pow(r,i);return u([r,i,l]),l},{a:r,b:i},function(s,u){var l=u[0],c=u[1],h=u[2];return{a:function(){var d=c.toFloat(),p=s.mul(d.mul(l.pow(d.sub(ae(1))))),m=Mt(l.shape,o);return m.length>0&&(p=p.sum(m)),p.reshape(l.shape)},b:function(){var d=l.greater(0),p=l.log().where(d,je(l)),m=s.mul(h.mul(p)),g=Mt(c.shape,o);return g.length>0&&(m=m.sum(g)),m.reshape(c.shape)}}},"Pow",{},a,[!0])}}),A$=L({powStrict_:function(n,e){return qe(n.shape,e.shape,"Error in powStrict: "),n.pow(e)}}),P$=L({squaredDifferenceStrict_:function(n,e){var t=M(n,"a","squaredDifferenceStrict"),r=M(e,"b","squaredDifferenceStrict");return qe(t.shape,r.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(r)}}),Ft=L({sub_:function(n,e){var t,r=M(n,"a","sub"),i=M(e,"b","sub");t=pt(r,i),r=t[0],i=t[1];var o=Oe(r.shape,i.shape);return U.runKernelFunc(function(a){return a.subtract(r,i)},{a:r,b:i},function(a){return{a:function(){var s=a,u=Mt(r.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=Mt(i.shape,o);return u.length>0&&(s=s.sum(u)),s.neg().reshape(i.shape)}}},"Sub")}}),N$=L({subStrict_:function(n,e){var t=M(n,"a","subStrict"),r=M(e,"b","subStrict");return qe(t.shape,r.shape,"Error in subStrict: "),t.sub(r)}}),qk=L({equal_:function(n,e){var t,r=M(n,"a","equal"),i=M(e,"b","equal");return t=pt(r,i),r=t[0],i=t[1],Oe(r.shape,i.shape),U.runKernelFunc(function(o){return o.equal(r,i)},{$a:r,$b:i})}}),D$=L({equalStrict_:function(n,e){var t=M(n,"a","equalStrict"),r=M(e,"b","equalStrict");return qe(t.shape,r.shape,"Error in equalStrict: "),t.equal(r)}}),O$=L({greater_:function(n,e){var t,r=M(n,"a","greater"),i=M(e,"b","greater");return t=pt(r,i),r=t[0],i=t[1],Oe(r.shape,i.shape),U.runKernelFunc(function(o){return o.greater(r,i)},{a:r,b:i},null,"Greater")}}),Kk=L({greaterEqual_:function(n,e){var t,r=M(n,"a","greaterEqual"),i=M(e,"b","greaterEqual");return t=pt(r,i),r=t[0],i=t[1],Oe(r.shape,i.shape),U.runKernelFunc(function(o,a){var s=o.greaterEqual(r,i);return a([r,i]),s},{a:r,b:i},function(o,a){var s=a[0],u=a[1];return{a:function(){return je(s)},b:function(){return je(u)}}},"GreaterEqual")}}),M$=L({greaterEqualStrict_:function(n,e){var t=M(n,"a","greaterEqualStrict"),r=M(e,"b","greaterEqualStrict");return qe(t.shape,r.shape,"Error in greaterEqualStrict: "),t.greaterEqual(r)}}),F$=L({greaterStrict_:function(n,e){var t=M(n,"a","greaterStrict"),r=M(e,"b","greaterStrict");return qe(t.shape,r.shape,"Error in greaterStrict: "),t.greater(r)}}),L$=L({less_:function(n,e){var t,r=M(n,"a","less"),i=M(e,"b","less");return t=pt(r,i),r=t[0],i=t[1],Oe(r.shape,i.shape),U.runKernelFunc(function(o){return o.less(r,i)},{a:r,b:i},null,"Less")}}),V$=L({lessEqual_:function(n,e){var t,r=M(n,"a","lessEqual"),i=M(e,"b","lessEqual");return t=pt(r,i),r=t[0],i=t[1],Oe(r.shape,i.shape),U.runKernelFunc(function(o,a){var s=o.lessEqual(r,i);return a([r,i]),s},{a:r,b:i},null,"LessEqual")}}),B$=L({lessEqualStrict_:function(n,e){var t=M(n,"a","lessEqualStrict"),r=M(e,"b","lessEqualStrict");return qe(t.shape,r.shape,"Error in lessEqualStrict: "),t.lessEqual(r)}}),U$=L({lessStrict_:function(n,e){var t=M(n,"a","lessStrict"),r=M(e,"b","lessStrict");return qe(t.shape,r.shape,"Error in lessStrict: "),t.less(r)}}),j$=L({notEqual_:function(n,e){var t,r=M(n,"a","notEqual"),i=M(e,"b","notEqual");return t=pt(r,i),r=t[0],i=t[1],Oe(r.shape,i.shape),U.runKernelFunc(function(o){return o.notEqual(r,i)},{a:r,b:i},null,"NotEqual")}}),z$=L({notEqualStrict_:function(n,e){var t=M(n,"a","notEqualStrict"),r=M(e,"b","notEqualStrict");return qe(t.shape,r.shape,"Error in notEqualStrict: "),t.notEqual(r)}});function KE(n,e){for(var t=[],r=n;r<e;++r)t.push(r);return t}function XE(n){for(var e=[],t=0;t<n.length;++t)for(var r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var P1=L({gather_:function(n,e,t){t===void 0&&(t=0);var r=M(n,"x","gather"),i=M(e,"indices","gather","int32");t=Lt(t,r.shape)[0];var o=function(a,s,u){for(var l=a.shape[u],c=[],h=1,d=1,p=0;p<u;p++)c.push(a.shape[p]),h*=a.shape[p];for(p=0;p<s.rank;p++)c.push(s.shape[p]);for(p=u+1;p<a.rank;p++)c.push(a.shape[p]),d*=a.shape[p];return{batchSize:h,sliceSize:d,dimSize:l,outputShape:c}}(r,i,t);return U.runKernelFunc(function(a,s){var u=a.gather(r,i.flatten(),t);return s([i]),u},{x:r,indices:i},function(a,s){var u=s[0];return{x:function(){var l=r.shape,c=u.size,h=l.slice(0,t),d=h.length,p=l.slice(t,l.length).slice(1),m=p.length,g=KE(0,d),y=KE(d+1,d+1+m),v=XE([h,[c],p]),w=a.reshape(v),_=u.reshape([c]),x=XE([[d],g,y]),C=w.transpose(x),A=Xk(C,_,r.shape[t]),T=g1(x);return A=A.transpose(T)},indices:function(){return u}}},"Gather",{axis:t}).reshape(o.outputShape)}}),Xk=L({unsortedSegmentSum_:function(n,e,t){var r=M(n,"x","unsortedSegmentSum"),i=M(e,"segmentIds","unsortedSegmentSum","int32");return F(xt(t),function(){return"numSegments must be of dtype int"}),U.runKernelFunc(function(o,a){var s=o.unsortedSegmentSum(r,i,t);return a([i]),s},{$x:r},function(o,a){var s=a[0];return{$x:function(){return function(u,l){for(var c=A1(l,je(l)),h=P1(u,c),d=Kk(l,ae(0,"int32")),p=h.rank-d.rank,m=0;m<p;++m)d=lr(d,m+1);d=Fp(d,Pu(h.shape,"bool"));var g=je(h);return Ua(d,h,g)}(o,s)}}})}}),W$=function(n,e,t){return ce(this,void 0,void 0,function(){var r,i,o,a,s,u,l,c,h,d,p,m,g;return he(this,function(y){switch(y.label){case 0:for(r=M(n,"tensor","boolMask"),i=M(e,"mask","boolMask","bool"),o=t??0,a=i.rank,s=r.shape,F(a>0,function(){return"mask cannot be scalar"}),qe(s.slice(o,o+a),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=o;l<o+a;l++)u*=s[l];return c=s.slice(0,o).concat([u],s.slice(o+a)),h=r.reshape(c),d=i.reshape([-1]),[4,$k(d)];case 1:return p=y.sent(),m=p.squeeze([1]),g=P1(h,m,o),n!==r&&r.dispose(),e!==i&&i.dispose(),m.dispose(),h.dispose(),d.dispose(),p.dispose(),[2,g]}})})};function Qk(n,e,t,r,i,o,a){o===void 0&&(o="NHWC"),F(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var s=n,u=e,l=!1;e.rank===3&&(l=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),s=[1,n[0],n[1],n[2]]),F(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),F(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),F(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank});var c=o==="NHWC"?s[3]:s[1],h=o==="NHWC"?u.shape[3]:u.shape[1];F(c===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+t.shape[2]+"."}),F(h===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+t.shape[3]+"."}),a!=null&&F(xt(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var d=b1(o),p=Ja(s,t.shape,r,1,i,a,!1,d),m=U.runKernelFunc(function(g,y){var v=g.conv2dDerInput(u,t,p);return y([t,u]),v},{dy4D:u,filter:t},function(g,y){var v=y[0],w=y[1];return{dy4D:function(){return _r(g,v,r,i,o,1,a)},filter:function(){return N1(g,w,v.shape,r,i,o,a)}}});return l?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}function fv(n){var e=function(o){return typeof o=="number"?[o,o,o]:o.length===2?[o[0],o[1],1]:o}(n),t=e[0],r=e[1],i=e[2];return t===1&&r===1&&i===1}function Yk(n,e,t,r,i){F(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var o=n,a=e,s=!1;e.rank===4&&(s=!0,a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),o=[1,n[0],n[1],n[2],n[3]]);var u=o[4],l=a.shape[4];F(o.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."}),F(a.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),F(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank}),F(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+t.shape[3]+"."}),F(l===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+t.shape[4]+"."});var c=Mf(o,t.shape,r,1,i),h=U.runKernelFunc(function(d){return d.conv3dDerInput(a,t,c)},{dy5D:a});return s?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var $$=L({conv1d_:function(n,e,t,r,i,o,a){i===void 0&&(i="NWC"),o===void 0&&(o=1);var s=M(n,"x","conv1d"),u=M(e,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),F(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),F(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),a!=null&&F(xt(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),F(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),F(Bn(t,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+o+"'"}),F(i==="NWC",function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),d=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),p=_r(d,h,[1,t],r,"NHWC",[1,o],a);return c?p.as2D(p.shape[2],p.shape[3]):p.as3D(p.shape[0],p.shape[2],p.shape[3])}}),_r=L({conv2d_:function(n,e,t,r,i,o,a){i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]);var s=M(n,"x","conv2d"),u=M(e,"filter","conv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),F(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),F(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),a!=null&&F(xt(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var h=i==="NHWC"?l.shape[3]:l.shape[1];F(h===u.shape[2],function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+u.shape[2]+"."}),F(Bn(t,o),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"});var d=b1(i),p=Ja(l.shape,u.shape,t,o,r,a,!1,d),m=[u,l],g=U.runKernelFunc(function(y,v){var w=y.conv2d(l,u,p);return v([u,l]),w},{x:l,filter:u},function(y,v){var w=v,_=w[0],x=w[1];return F(gu(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}),{x:function(){return Jk(x.shape,y,_,t,r,i)},filter:function(){return N1(x,y,_.shape,t,r,i)}}},"Conv2D",p,m);return c?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),H$=L({conv3d_:function(n,e,t,r,i,o){i===void 0&&(i="NDHWC"),o===void 0&&(o=[1,1,1]);var a=M(n,"x","conv3d"),s=M(e,"filter","conv3d"),u=a,l=!1;a.rank===4&&(l=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),F(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),F(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),F(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),F(function(d,p){return fv(d)||fv(p)}(t,o),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),F(i==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."});var c=Mf(u.shape,s.shape,t,o,r),h=U.runKernelFunc(function(d,p){var m=d.conv3d(u,s,c);return p([u,s]),m},{x:u,$filter:s},function(d,p){F(fv(o),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var m=p[0],g=p[1];return{x:function(){return Yk(m.shape,d,g,t,r)},$filter:function(){return function(y,v,w,_,x){var C=y;y.rank===4&&(C=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3]));var A=v;A.rank===4&&(A=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3])),F(C.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+C.shape+"."}),F(A.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+A.shape+"."}),F(w.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+w+"."}),F(C.shape[4]===w[3],function(){return"Error in conv3dDerFilter: depth of input "+C.shape[4]+") must match input depth in filter ("+w[3]+"."}),F(A.shape[4]===w[4],function(){return"Error in conv3dDerFilter: depth of dy ("+A.shape[4]+") must match output depth for filter ("+w[4]+")."});var T=Mf(C.shape,w,_,1,x);return U.runKernelFunc(function(E){return E.conv3dDerFilter(C,A,T)},{x5D:C,dy5D:A})}(m,d,g.shape,t,r)}}});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),N1=L({conv2dDerFilter_:function(n,e,t,r,i,o,a){o===void 0&&(o="NHWC");var s=n;n.rank===3&&(s=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var u=e;u.rank===3&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),F(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),F(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),F(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."});var l=o==="NHWC"?s.shape[3]:s.shape[1],c=o==="NHWC"?u.shape[3]:u.shape[1];F(l===t[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+t[2]+"."}),F(c===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+t[3]+")."}),a!=null&&F(xt(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var h=b1(o),d=Ja(s.shape,t,r,1,i,a,!1,h);return U.runKernelFunc(function(p){return p.conv2dDerFilter(s,u,d)},{x4D:s,dy4D:u})}}),Jk=L({conv2dDerInput_:Qk}),Lp=L({depthwiseConv2d_:function(n,e,t,r,i,o,a){o===void 0&&(o=[1,1]);var s=M(n,"x","depthwiseConv2d"),u=M(e,"filter","depthwiseConv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),F(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),F(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),F(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),o==null&&(o=[1,1]),F(Bn(t,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),a!=null&&F(xt(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var h=Ja(l.shape,u.shape,t,o,r,a,!0),d=[l,u],p=U.runKernelFunc(function(m,g){var y=m.depthwiseConv2D(l,u,h);return g([l,u]),y},{x:l,filter:u},function(m,g){F(gu(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var y=g[0],v=g[1];return{x:function(){return Zk(y.shape,m,v,h)},filter:function(){return eA(y,m,v.shape,h)}}},"DepthwiseConv2dNative",h,d);return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),Zk=L({depthwiseConv2dDerInput_:function(n,e,t,r){var i=e,o=!1;e.rank===3&&(o=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=U.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(i,t,r)},{dy4D:i});return o?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),eA=L({depthwiseConv2dDerFilter_:function(n,e,t,r){var i=n;n.rank===3&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var o=e;return o.rank===3&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),U.runKernelFunc(function(a){return a.depthwiseConv2DDerFilter(i,o,r)},{x4D:i,dy4D:o})}}),D1=L({separableConv2d_:function(n,e,t,r,i,o,a){o===void 0&&(o=[1,1]),a===void 0&&(a="NHWC");var s=M(n,"x","separableConv2d"),u=M(e,"depthwiseFilter","separableConv2d"),l=M(t,"pointwiseFilter","separableConv2d"),c=s,h=!1;if(s.rank===3&&(h=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),a==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");F(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),F(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),F(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),F(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),F(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var d=u.shape[2],p=u.shape[3];F(l.shape[2]===d*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*p+", but got "+l.shape[2]+"."});var m=Lp(c,u,r,i,a,o),g=_r(m,l,1,"valid",a);return h?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),G$=L({conv2dTranspose_:function(n,e,t,r,i,o){return Qk(t,M(n,"x","conv2dTranspose"),M(e,"filter","conv2dTranspose"),r,i,"NHWC",o)}}),q$=L({conv3dTranspose_:function(n,e,t,r,i){return Yk(t,M(n,"x","conv3dTranspose"),M(e,"filter","conv3dTranspose"),r,i)}}),Vp=L({matMul_:function(n,e,t,r){var i;t===void 0&&(t=!1),r===void 0&&(r=!1);var o=M(n,"a","matMul"),a=M(e,"b","matMul");i=pt(o,a),o=i[0],a=i[1];var s=t?o.shape[o.rank-2]:o.shape[o.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],l=t?o.shape[o.rank-1]:o.shape[o.rank-2],c=r?a.shape[a.rank-2]:a.shape[a.rank-1],h=o.shape.slice(0,-2),d=a.shape.slice(0,-2),p=fe(h),m=fe(d);F(o.rank>=2&&a.rank>=2&&o.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+a.rank+"."}),F(zt(h,d),function(){return"Error in matMul: outer dimensions ("+h+") and ("+d+") of Tensors with shapes "+o.shape+" and "+a.shape+" must match."}),F(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+o.shape+" and "+a.shape+" and transposeA="+t+" and transposeB="+r+" must match."});var g=o.shape.slice(0,-2).concat([l,c]),y=t?o.as3D(p,s,l):o.as3D(p,l,s),v=r?a.as3D(m,c,u):a.as3D(m,u,c),w={transposeA:t,transposeB:r};return U.runKernelFunc(function(_,x){var C=_.batchMatMul(y,v,t,r);return x([y,v]),C},{a:y,b:v},function(_,x){var C=x,A=C[0],T=C[1];return t||r?!t&&r?{a:function(){return _.matMul(T,!1,!1)},b:function(){return _.matMul(A,!0,!1)}}:t&&!r?{a:function(){return T.matMul(_,!1,!0)},b:function(){return A.matMul(_,!1,!1)}}:{a:function(){return T.matMul(_,!0,!0)},b:function(){return _.matMul(A,!0,!0)}}:{a:function(){return _.matMul(T,!1,!0)},b:function(){return A.matMul(_,!0,!1)}}},"BatchMatMul",w).reshape(g)}}),K$=L({dot_:function(n,e){var t=M(n,"t1","dot"),r=M(e,"t2","dot");F(!(t.rank!==1&&t.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+r.rank+"."});var i=t.rank===1?t.size:t.shape[1],o=r.rank===1?r.size:r.shape[0];return F(i===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."}),t.rank===1&&r.rank===1?t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():t.rank===1&&r.rank===2?t.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():t.rank===2&&r.rank===1?t.matMul(r.as2D(-1,1)).as1D():t.matMul(r.as2D(r.shape[0],r.shape[1]))}}),X$=L({outerProduct_:function(n,e){var t=M(n,"v1","outerProduct"),r=M(e,"v2","outerProduct");return F(t.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."}),t.as2D(-1,1).matMul(r.as2D(1,-1))}}),Wc=L({reverse_:function(n,e){var t=M(n,"x","reverse");if(t.rank===0)return t.clone();var r=Lt(e,t.shape);return U.runKernelFunc(function(i){return i.reverse(t,r)},{$x:t},function(i){return{$x:function(){return i.reverse(r)}}}).reshapeAs(t)}}),Q$=L({reverse1d_:function(n){var e=M(n,"x","reverse");return F(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),Wc(e,0)}}),Y$=L({reverse2d_:function(n,e){var t=M(n,"x","reverse");return F(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),Wc(t,e)}}),J$=L({reverse3d_:function(n,e){var t=M(n,"x","reverse");return F(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),Wc(t,e)}}),Z$=L({reverse4d_:function(n,e){var t=M(n,"x","reverse");return F(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),Wc(t,e)}});function tA(n,e,t,r,i,o){var a=M(n,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),F(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),F(Bn(t,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"}),o!=null&&F(xt(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var l=fc(s.shape,e,t,r,i,o);if(l.filterWidth===1&&l.filterHeight===1&&zt(l.inShape,l.outShape))return a.clone();var c=[s],h=U.runKernelFunc(function(d,p){var m=d.maxPool(s,l);return p([s,m]),m},{x:s},function(d,p){var m=p[0],g=p[1];return{x:function(){return function(y,v,w,_,x,C,A,T){var E=M(y,"dy","maxPoolBackprop"),I=M(v,"input","maxPoolBackprop"),S=M(w,"output","maxPoolBackprop");F(I.rank===E.rank,function(){return"Rank of input ("+I.rank+") does not match rank of dy ("+E.rank+")"}),F(Bn(x,C),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+x+" and dilations '"+C+"'"}),F(E.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+E.rank+"."}),F(I.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+I.rank+"."});var N=fc(I.shape,_,x,C,A,T);return U.runKernelFunc(function(P){return P.maxPoolBackprop(E,I,S,N)},{$dy:E,$input:I})}(d,m,g,e,t,r,i)}}},"MaxPool",l,c);return u?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function nA(n,e,t,r,i,o){var a=M(n,"x","avgPool","float32");F(Bn(t,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"});var s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),F(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),o!=null&&F(xt(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var l=fc(s.shape,e,t,r,i,o);if(l.filterWidth===1&&l.filterHeight===1&&zt(l.inShape,l.outShape))return a.clone();var c=U.runKernelFunc(function(h){return h.avgPool(s,l)},{x:s},function(h){return{x:function(){return function(d,p,m,g,y,v){var w=M(d,"dy","avgPoolBackprop"),_=M(p,"input","avgPoolBackprop");F(_.rank===w.rank,function(){return"Rank of input ("+_.rank+") does not match rank of dy ("+w.rank+")"}),F(Bn(g,y),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+g+" and dilations '"+y+"'"});var x=_,C=w,A=!1;_.rank===3&&(A=!0,x=_.as4D(1,_.shape[0],_.shape[1],_.shape[2]),C=w.as4D(1,w.shape[0],w.shape[1],w.shape[2])),F(C.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+C.rank+"."}),F(x.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+x.rank+"."});var T=fc(x.shape,m,g,y,v),E=U.runKernelFunc(function(I){return I.avgPoolBackprop(C,x,T)},{dy4D:C,input4D:x});return A?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}(h,s,e,t,r,i)}}},"AvgPool",l);return c=c.cast(a.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var Vt=L({maxPool_:function(n,e,t,r,i){return tA(n,e,t,1,r,i)}}),$c=L({avgPool_:function(n,e,t,r,i){return nA(n,e,t,1,r,i)}}),e9=L({pool_:function(n,e,t,r,i,o){i==null&&(i=[1,1]),o==null&&(o=1),r===0&&(r="valid");var a=M(n,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),F(Bn(o,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"});var l,c=fc(s.shape,e,o,i,r),h=[c.dilationHeight,c.dilationWidth];l=r==="same"?function(x,C){var A=x.map(function(I,S){return I+(I-1)*(C[S]-1)}).map(function(I){return I-1}),T=A.map(function(I){return Math.floor(I/2)}),E=A.map(function(I,S){return I-T[S]});return A.map(function(I,S){return[T[S],E[S]]})}([c.filterHeight,c.filterWidth],h):[[0,0],[0,0]];var d=h[0]===1&&h[1]===1,p=function(x,C,A){var T=A.map(function(j){return j[0]}),E=A.map(function(j){return j[1]}),I=x.concat(T,E),S=C.map(function(j,B){return(j-I[B]%j)%j}),N=E.map(function(j,B){return j+S[B]}),P=C.map(function(j,B){return[T[B],N[B]]}),k=C.map(function(j,B){return[0,S[B]]});return[P,k]}([c.inHeight,c.inWidth],h,l),m=p[0],g=p[1],y=d?r:"valid",v=d?s:uk(s,h,m),w=(t==="avg"?function(){return nA(v,e,o,1,y)}:function(){return tA(v,e,o,1,y)})(),_=d?w:ok(w,h,g);return u?_.as3D(_.shape[1],_.shape[2],_.shape[3]):_}}),t9=L({maxPool3d_:function(n,e,t,r,i,o,a){o===void 0&&(o="NDHWC");var s=M(n,"x","maxPool3d"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),F(u.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),F(o==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),F(Bn(t,a),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"}),i!=null&&F(xt(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var c=Of(u.shape,e,t,a,r,i,o),h=U.runKernelFunc(function(d,p){var m=d.maxPool3d(u,c);return p([u,m]),m},{x:u},function(d,p){var m=p[0],g=p[1];return{x:function(){return function(y,v,w,_,x,C,A,T){var E=M(y,"dy","maxPool3dBackprop"),I=M(v,"input","maxPool3dBackprop"),S=M(w,"output","maxPool3dBackprop"),N=E,P=I,k=S,j=!1;I.rank===4&&(j=!0,N=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3]),P=I.as5D(1,I.shape[0],I.shape[1],I.shape[2],I.shape[3]),k=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3])),F(N.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+N.rank+"."}),F(P.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+P.rank+"."}),F(k.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+k.rank+"."}),C==null&&(C=[1,1,1]),F(Bn(x,C),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+x+" and dilations '"+C+"'"}),T!=null&&F(xt(A),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+T+" but got pad "+A+"."});var B=Of(P.shape,_,x,C,A,T),W=U.runKernelFunc(function(X){return X.maxPool3dBackprop(N,P,k,B)},{dy5D:N,input5D:P});return j?W.as4D(W.shape[1],W.shape[2],W.shape[3],W.shape[4]):W}(d,m,g,e,t,a,r,i)}}});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),n9=L({avgPool3d_:function(n,e,t,r,i,o,a){o===void 0&&(o="NDHWC");var s=M(n,"x","avgPool3d","float32"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),F(u.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),F(o==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),F(Bn(t,a),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"}),i!=null&&F(xt(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var c=Of(u.shape,e,t,a,r,i,o),h=U.runKernelFunc(function(d){return d.avgPool3d(u,c)},{x:u},function(d){return{x:function(){return function(p,m,g,y,v,w,_){var x=M(p,"dy","avgPool3dBackprop"),C=M(m,"input","avgPool3dBackprop"),A=x,T=C,E=!1;C.rank===4&&(E=!0,A=x.as5D(1,x.shape[0],x.shape[1],x.shape[2],x.shape[3]),T=C.as5D(1,C.shape[0],C.shape[1],C.shape[2],C.shape[3])),F(A.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+A.rank+"."}),F(T.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+T.rank+"."}),v==null&&(v=[1,1,1]),F(Bn(y,v),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+v+"'"}),_!=null&&F(xt(w),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+_+" but got pad "+w+"."});var I=Of(T.shape,g,y,v,w,_),S=U.runKernelFunc(function(N){return N.avgPool3dBackprop(A,T,I)},{dy5D:A,input5D:T});return E?S.as4D(S.shape[1],S.shape[2],S.shape[3],S.shape[4]):S}(d,u,e,t,a,r,i)}}});return h=h.cast(u.dtype),l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),hi=L({slice_:function(n,e,t){var r,i,o=M(n,"x","slice");if(o.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof e=="number"?[e].concat(new Array(o.rank-1).fill(0)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(0)):e.slice()).forEach(function(u){F(u!==-1,function(){return"slice() does not support negative begin indexing."})}),i=(i=t==null?new Array(o.rank).fill(-1):typeof t=="number"?[t].concat(new Array(o.rank-1).fill(-1)):t.length<o.rank?t.concat(new Array(o.rank-t.length).fill(-1)):t).map(function(u,l){return u>=0?u:(F(u===-1,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+l+"."}),o.shape[l]-r[l])}),A5(o,r,i);var a=o.shape,s={begin:r,size:i};return U.runKernelFunc(function(u){return u.slice(o,r,i)},{x:o},function(u){for(var l=[],c=0;c<u.rank;c++)l.push([r[c],a[c]-r[c]-i[c]]);return{x:function(){return u.pad(l)}}},"Slice",s)}}),r9=L({slice1d_:function(n,e,t){var r=M(n,"x","slice1d");return F(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),hi(r,[e],[t])}}),i9=L({slice2d_:function(n,e,t){var r=M(n,"x","slice2d");return F(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),hi(r,e,t)}}),rA=L({slice3d_:function(n,e,t){var r=M(n,"x","slice3d");return F(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),hi(r,e,t)}}),o9=L({slice4d_:function(n,e,t){var r=M(n,"x","slice4d");return F(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),hi(r,e,t)}});function iA(n,e,t,r,i){return e.rank<t.rank&&(e=e.reshape(Vn(e.shape,r))),n.rank<t.rank&&(n=n.reshape(Vn(n.shape,r))),{x:function(){var o=n.mul(t.equal(e).cast(n.dtype));return i==null?o:o.transpose(i)}}}var a9=L({all_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","all","bool"),i=Lt(e,r.shape),o=i,a=fi(o,r.rank);a!=null&&(r=r.transpose(a),o=pi(o.length,r.rank));var s=U.runKernelFunc(function(l){return l.all(r,o)},{$x:r});if(t){var u=Vn(s.shape,i);return s.reshape(u)}return s}}),s9=L({any_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","any","bool"),i=Lt(e,r.shape),o=i,a=fi(o,r.rank);a!=null&&(r=r.transpose(a),o=pi(o.length,r.rank));var s=U.runKernelFunc(function(l){return l.any(r,o)},{$x:r});if(t){var u=Vn(s.shape,i);return s.reshape(u)}return s}}),u9=L({argMax_:function(n,e){e===void 0&&(e=0);var t=M(n,"x","argMax");e==null&&(e=0);var r=Lt(e,t.shape),i=fi(r,t.rank);i!=null&&(t=t.transpose(i),r=pi(r.length,t.rank));var o={axis:r[0]},a=[t];return U.runKernelFunc(function(s,u){var l=s.argMax(t,r[0]);return u([t]),l},{x:t},function(s,u){var l=u[0];return{x:function(){return je(l)}}},"ArgMax",o,a)}}),l9=L({argMin_:function(n,e){e===void 0&&(e=0);var t=M(n,"x","argMin");e==null&&(e=0);var r=Lt(e,t.shape),i=fi(r,t.rank);return i!=null&&(t=t.transpose(i),r=pi(r.length,t.rank)),U.runKernelFunc(function(o,a){var s=o.argMin(t,r[0]);return a([t]),s},{$x:t},function(o,a){var s=a[0];return{$x:function(){return je(s)}}})}}),c9=L({logSumExp_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","logSumExp"),i=Lt(e,r.shape),o=r.max(i,!0),a=r.sub(o).exp().sum(i).log(),s=o.reshape(a.shape).add(a);if(t){var u=Vn(s.shape,i);return s.reshape(u)}return s}}),Bp=L({max_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","max"),i=r,o=Lt(e,r.shape),a=o,s=fi(a,r.rank);s!=null&&(r=r.transpose(s),a=pi(a.length,r.rank));var u=[r],l=U.runKernelFunc(function(h,d){var p=h.max(r,a);return d([i,p]),p},{x:r},function(h,d){return iA(h,d[1],d[0],o,s)},"Max",{axes:a},u,[!0]);if(t){var c=Vn(l.shape,o);l=l.reshape(c)}return l}}),h9=L({mean_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","mean"),i=Lt(e,r.shape),o=fe(ln(r.shape,i)[1]);return Op(function(a){var s=ae(o);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(e,t),gradFunc:function(u){var l=a.shape.slice();return i.forEach(function(c){l[c]=1}),u.reshape(l).mul(Pu(a.shape,"float32")).div(o)}}})(r)}}),d9=L({min_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","min"),i=r,o=Lt(e,r.shape),a=o,s=fi(a,r.rank);s!=null&&(r=r.transpose(s),a=pi(a.length,r.rank));var u=[r],l=U.runKernelFunc(function(h,d){var p=h.min(r,a);return d([i,p]),p},{x:r},function(h,d){return iA(h,d[1],d[0],o,s)},"Min",{axes:a},u,[!0]);if(t){var c=Vn(l.shape,o);l=l.reshape(c)}return l}}),f9=L({moments_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Lt(e,(n=M(n,"x","moments")).shape),i=n.mean(r,t),o=i.shape;t||(o=Vn(i.shape,r));var a=n.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:a.mean(r,t)}}}),oA=L({sum_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","sum");r.dtype==="bool"&&(r=r.toInt());var i=Lt(e,r.shape);return Op(function(o){var a=fi(i,o.rank),s=i,u=o;a!=null&&(u=o.transpose(a),s=pi(s.length,o.rank));var l=function(p){var m=o.shape.slice();return i.forEach(function(g){m[g]=1}),p.reshape(m).mul(Pu(o.shape,"float32"))},c={axes:s},h=U.runKernelFunc(function(p){return p.sum(u,s)},{x:u},function(p){return{x:function(){return l(p)}}},"Sum",c);if(t){var d=Vn(h.shape,i);h=h.reshape(d)}return{value:h,gradFunc:l}})(r)}}),p9=L({prod_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","prod");r.dtype==="bool"&&(r=r.toInt());var i=Lt(e,r.shape),o=fi(i,r.rank),a=i,s=r;o!=null&&(s=r.transpose(o),a=pi(a.length,r.rank));var u=U.runKernelFunc(function(c){return c.prod(s,a)},{permutedX:s});if(t){var l=Vn(u.shape,i);u=u.reshape(l)}return u}}),aA=L({elu_:function(n){var e=M(n,"x","elu");return U.runKernelFunc(function(t,r){var i=t.elu(e);return r([i]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return U.runKernelFunc(function(o){return o.eluDer(t,i)},{dy:t,y:i})}}})}}),m9=L({leakyRelu_:function(n,e){e===void 0&&(e=.2);var t=M(n,"x","leakyRelu");return A1(ae(e).mul(t),t)}}),sA=L({prelu_:function(n,e){var t=M(n,"x","prelu"),r=M(e,"alpha","prelu");return U.runKernelFunc(function(i,o){var a=i.prelu(t,r);return o([t,r]),a},{x:t,alpha:r},function(i,o){var a=o[0],s=o[1],u=a.greater(0);return{x:function(){return Ua(u,i,i.mul(s))},alpha:function(){var l=Ua(u,je(i),i.mul(a)),c=Mt(s.shape,i.shape);return c.length>0&&(l=l.sum(c)),l.reshape(s.shape)}}},"Prelu")}}),ct=L({relu_:function(n){var e=M(n,"x","relu");return e.dtype==="bool"?e.toInt():U.runKernelFunc(function(t,r){var i=t.relu(e);return r([e]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return t.mulStrict(i.step().toFloat())}}},"Relu")}}),uA=L({relu6_:function(n){var e=M(n,"x","relu6");return e.dtype==="bool"?e.toInt():U.runKernelFunc(function(t,r){var i=t.relu6(e);return r([e]),i},{x:e},function(t,r){var i=r[0],o=i.lessEqual(6).mul(i.step());return{x:function(){return t.mulStrict(o.toFloat())}}},"Relu6")}}),v9=L({selu_:function(n){var e=M(n,"x","selu");return U.runKernelFunc(function(t,r){var i=t.selu(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){var o=i.greater(ae(0)),a=ae(S1),s=ae(R1),u=t.mul(s),l=t.mul(a).mul(i.toFloat().exp());return Ua(o,u,l)}}})}}),Go=L({transpose_:function(n,e){var t=M(n,"x","transpose");if(e==null&&(e=t.shape.map(function(i,o){return o}).reverse()),F(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."}),e.forEach(function(i){F(i>=0&&i<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e})}),t.rank<=1)return t.clone();var r={perm:e};return U.runKernelFunc(function(i){return i.transpose(t,e)},{x:t},function(i){var o=g1(e);return{x:function(){return i.transpose(o)}}},"Transpose",r)}}),g9=L({localResponseNormalization_:function(n,e,t,r,i){e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5);var o=M(n,"x","localResponseNormalization");F(o.rank===4||o.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+o.rank+"."}),F(xt(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var a=o,s=!1;o.rank===3&&(s=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var u=U.runKernelFunc(function(l,c){var h=l.localResponseNormalization4D(a,e,t,r,i);return c([a,h]),h},{x4D:a},function(l,c){var h=c[0],d=c[1];return{x4D:function(){return U.runKernelFunc(function(p){return p.LRNGrad(l,h,d,e,t,r,i)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),lA=L({norm_:function(n,e,t,r){e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1);var i=function s(u,l,c){if(c===void 0&&(c=null),u.rank===0)return u.abs();if(u.rank!==1&&c===null)return s(u.reshape([-1]),l,c);if(u.rank===1||typeof c=="number"||Array.isArray(c)&&c.length===1){if(l===1)return u.abs().sum(c);if(l===1/0)return u.abs().max(c);if(l===-1/0)return u.abs().min(c);if(l==="euclidean"||l===2)return u.abs().pow(ae(2,"int32")).sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}if(Array.isArray(c)&&c.length===2){if(l===1)return u.abs().sum(c[0]).max(c[1]-1);if(l===1/0)return u.abs().sum(c[1]).max(c[0]);if(l===-1/0)return u.abs().sum(c[1]).min(c[0]);if(l==="fro"||l==="euclidean")return u.square().sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}throw new Error("Error in norm: invalid axis: "+c)}(n=M(n,"x","norm"),e,t),o=i.shape;if(r){var a=Lt(t,n.shape);o=Vn(i.shape,a)}return i.reshape(o)}}),y9=L({basicLSTMCell_:function(n,e,t,r,i,o){var a=M(n,"forgetBias","basicLSTMCell"),s=M(e,"lstmKernel","basicLSTMCell"),u=M(t,"lstmBias","basicLSTMCell"),l=M(r,"data","basicLSTMCell"),c=M(i,"c","basicLSTMCell"),h=M(o,"h","basicLSTMCell"),d=l.concat(h,1).matMul(s).add(u),p=d.shape[0],m=d.shape[1]/4,g=[p,m],y=d.slice([0,0],g),v=d.slice([0,m],g),w=d.slice([0,2*m],g),_=d.slice([0,3*m],g),x=y.sigmoid().mulStrict(v.tanh()).addStrict(c.mulStrict(a.add(w).sigmoid())),C=x.tanh().mulStrict(_.sigmoid());return[x,C]}}),w9=L({multiRNNCell_:function(n,e,t,r){for(var i=M(e,"data","multiRNNCell"),o=Rf(t,"c","multiRNNCell"),a=Rf(r,"h","multiRNNCell"),s=i,u=[],l=0;l<n.length;l++){var c=n[l](s,o[l],a[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var h=[],d=[];for(l=0;l<u.length;l+=2)h.push(u[l]),d.push(u[l+1]);return[h,d]}}),_9=L({movingAverage_:function(n,e,t,r,i){i===void 0&&(i=!0);var o=M(n,"v","movingAverage"),a=M(e,"x","movingAverage"),s=M(t,"decay","movingAverage");gj(o,a),F(zt(o.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=ae(1),l=u.sub(s),c=a.sub(o).mul(l);if(i){F(r!=null,function(){return"When using zeroDebias: true, step is required."});var h=M(r,"step","movingAverage");c=c.div(u.sub(Vf(s,h)))}return o.add(c)}}),x9=L({stridedSlice_:function(n,e,t,r,i,o,a,s,u){if(i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),r==null&&(r=new Array(e.length)),a!==0)throw new Error("ellipsis mask is not yet supported");var l=M(n,"x","stridedSlice"),c=RE(s),h=l.shape.slice();c.forEach(function(y){e[y]=0,t[y]=1,h.splice(y,0,1)}),l=l.reshape(h);for(var d=0;d<l.rank;d++)e[d]=P5(i,e,r,l.shape,d),t[d]=N5(o,t,r,l.shape,d),r[d]=r[d]||1;var p=RE(u);p.forEach(function(y){t[y]=e[y]+1,r[y]=1});var m=x1(e,t,r),g=m.filter(function(y,v){return p.indexOf(v)===-1});return r.every(function(y){return y===1})?hi(l,e,m).reshape(g):U.runKernelFunc(function(y){return y.stridedSlice(l,e,t,r)},{$x:l}).reshape(g)}}),b9=L({topk_:function(n,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var r=M(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var o=U.runKernelFunc(function(a){return a.topk(r,e,t)},{$x:r});return{values:o[0],indices:o[1]}}}),E9=L({scatterND_:function(n,e,t){var r=M(n,"indices","scatterND","int32"),i=M(e,"updates","scatterND");return k5(i,r,t),U.runKernelFunc(function(o){return o.scatterND(r,i,t)},{indices:r,updates:i},null,"ScatterNd",{shape:t})}}),O1=L({fft_:function(n){F(n.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return U.runKernelFunc(function(i){return i.fft(r)},{input:n}).reshape(n.shape)}}),Bf=L({ifft_:function(n){F(n.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return U.runKernelFunc(function(i){return i.ifft(r)},{input:n}).reshape(n.shape)}}),M1=L({rfft_:function(n,e){F(n.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+n.dtype});var t,r=n.shape[n.shape.length-1],i=n.size/r;if(e!=null&&e<r){var o=n.shape.map(function(v){return 0}),a=n.shape.map(function(v){return v});a[n.shape.length-1]=e,t=n.slice(o,a),r=e}else if(e!=null&&e>r){var s=n.shape.map(function(v){return v});s[n.shape.length-1]=e-r,t=n.concat(it(s),n.shape.length-1),r=e}else t=n;var u=t.zerosLike(),l=qt(t,u).as2D(i,r),c=O1(l),h=Math.floor(r/2)+1,d=dr(c),p=Jr(c),m=d.split([h,r-h],d.shape.length-1),g=p.split([h,r-h],p.shape.length-1),y=t.shape.slice();return y[t.shape.length-1]=h,qt(m[0],g[0]).reshape(y)}}),cA=L({irfft_:function(n){var e=n.shape[n.shape.length-1],t=n.size/e;if(e<=2){var r=n.as2D(t,e),i=Bf(r);return dr(i)}var o=[t,2*(e-1)],a=dr(n).as2D(t,e),s=Jr(n).as2D(t,e),u=a.slice([0,1],[t,e-2]).reverse(1),l=s.slice([0,1],[t,e-2]).reverse(1).mul(ae(-1)),c=a.concat(u,1),h=s.concat(l,1);return r=qt(c,h).as2D(o[0],o[1]),i=Bf(r),dr(i)}}),C9=Object.freeze({fft:O1,ifft:Bf,rfft:M1,irfft:cA}),I9=L({sparseToDense_:function(n,e,t,r){r===void 0&&(r=0);var i=M(n,"sparseIndices","sparseToDense","int32"),o=M(e,"sparseValues","sparseToDense"),a=M(r,"defaultValue","sparseToDense",o.dtype);return function(s,u,l,c){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var h=s.rank>0?s.shape[0]:1,d=s.rank>1?s.shape[1]:1;if(l.length!==d)throw new Error("outputShape has incorrect number of elements:, "+l.length+", should be: "+d+".");var p=u.size;if(u.rank!==0&&(u.rank!==1||p!==h))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+h+"]");if(u.dtype!==c.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,o,t,a),U.runKernelFunc(function(s){return s.sparseToDense(i,o,t,a)},{$sparseIndices:i,$sparseValues:o,$defaultValue:a})}}),T9=L({gatherND_:function(n,e){var t=M(e,"indices","gatherND","int32"),r=M(n,"x","gatherND");return U.runKernelFunc(function(i){return i.gatherND(r,t)},{x:r,indices:t},null,"GatherNd")}}),S9=L({diag_:function(n){var e=M(n,"x","diag").flatten(),t=n.shape.concat(n.shape);return U.runKernelFunc(function(r){return r.diag(e)},{$x:e}).reshape(t)}}),R9=L({dropout_:function(n,e,t,r){var i=M(n,"x","dropout");if(F(i.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."}),F(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),e===0)return n instanceof lt?i.clone():i;var o=function(u,l){if(l==null)return u.shape.slice();if(zt(u.shape,l))return l;if(u.shape.length===l.length){for(var c=[],h=0;h<u.shape.length;h++)l[h]==null&&u.shape[h]!=null?c.push(u.shape[h]):c.push(l[h]);return c}return l}(i,t),a=1-e,s=sk(o,0,1,"float32",r).add(a).floor().div(a);return i.mul(s)}});function hA(n,e,t){for(var r=1-n%2,i=new Float32Array(n),o=0;o<n;++o){var a=2*Math.PI*o/(n+r-1);i[o]=e-t*Math.cos(a)}return Tt(i,"float32")}var F1=L({hannWindow_:function(n){return hA(n,.5,.5)}}),dA=L({hammingWindow_:function(n){return hA(n,.54,.46)}}),L1=L({frame_:function(n,e,t,r,i){r===void 0&&(r=!1),i===void 0&&(i=0);for(var o=0,a=[];o+e<=n.size;)a.push(hi(n,o,e)),o+=t;if(r)for(;o<n.size;){var s=o+e-n.size,u=Dt([hi(n,o,e-s),li([s],i)]);a.push(u),o+=t}return a.length===0?Oo([],[0,e]):Dt(a).as2D(a.length,e)}}),fA=L({stft_:function(n,e,t,r,i){var o;i===void 0&&(i=F1),r==null&&(o=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))));for(var a=L1(n,e,t),s=vn(a,i(e)),u=[],l=0;l<a.shape[0];l++)u.push(M1(s.slice([l,0],[1,e]),r));return Dt(u)}}),k9=Object.freeze({hannWindow:F1,hammingWindow:dA,frame:L1,stft:fA}),pn,A9=function(n,e,t){return t===void 0&&(t=1),ce(this,void 0,void 0,function(){var r,i,o,a,s,u,l,c,h,d,p,m,g,y;return he(this,function(v){switch(v.label){case 0:return r=M(n,"predictions","inTopK"),i=M(e,"targets","inTopK"),F(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),F(r.rank-1===i.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank}),qe(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=r.shape[r.shape.length-1],F(t>0&&t<=o,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+t}),[4,r.data()];case 1:return a=v.sent(),[4,i.data()];case 2:for(s=v.sent(),u=[a.length/o,o],c=u[1],h=cc("bool",l=u[0]),d=0;d<l;d++){for(p=d*c,m=a.subarray(p,p+c),g=[],y=0;y<m.length;y++)g.push({value:m[y],index:y});for(g.sort(function(w,_){return _.value-w.value}),h[d]=0,y=0;y<t;y++)if(g[y].index===s[d]){h[d]=1;break}}return n!==r&&r.dispose(),e!==i&&i.dispose(),[2,Qt(h,i.shape,"bool")]}})})};(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(pn||(pn={}));var P9=L({absoluteDifference_:function(n,e,t,r){r===void 0&&(r=pn.SUM_BY_NONZERO_WEIGHTS);var i=M(n,"labels","absoluteDifference"),o=M(e,"predictions","absoluteDifference"),a=null;t!=null&&(a=M(t,"weights","absoluteDifference")),qe(i.shape,o.shape,"Error in absoluteDifference: ");var s=i.sub(o).abs();return Gi(s,a,r)}}),Gi=L({computeWeightedLoss_:function(n,e,t){t===void 0&&(t=pn.SUM_BY_NONZERO_WEIGHTS);var r=M(n,"losses","computeWeightedLoss"),i=null;e!=null&&(i=M(e,"weights","computeWeightedLoss"));var o=i==null?r:r.mul(i);if(t===pn.NONE)return o;if(t===pn.SUM)return o.sum();if(t===pn.MEAN){if(i==null)return o.mean();var a=r.size/i.size,s=o.sum().div(i.sum());return a>1?s.div(ae(a)):s}if(t===pn.SUM_BY_NONZERO_WEIGHTS){if(i==null)return o.sum().div(ae(r.size));var u=i.mul(Pu(r.shape)).notEqual(ae(0)).sum().toFloat();return o.sum().div(u)}throw Error("Unknown reduction: "+t)}}),N9=L({cosineDistance_:function(n,e,t,r,i){i===void 0&&(i=pn.SUM_BY_NONZERO_WEIGHTS);var o=M(n,"labels","cosineDistance"),a=M(e,"predictions","cosineDistance"),s=null;r!=null&&(s=M(r,"weights","cosineDistance")),qe(o.shape,a.shape,"Error in cosineDistance: ");var u=ae(1).sub(o.mul(a).sum(t,!0));return Gi(u,s,i)}}),D9=L({hingeLoss_:function(n,e,t,r){r===void 0&&(r=pn.SUM_BY_NONZERO_WEIGHTS);var i=M(n,"labels","hingeLoss"),o=M(e,"predictions","hingeLoss"),a=null;t!=null&&(a=M(t,"weights","hingeLoss")),qe(i.shape,o.shape,"Error in hingeLoss: ");var s=ae(1);i=ae(2).mul(i).sub(s);var u=s.sub(i.mul(o)).relu();return Gi(u,a,r)}}),O9=L({huberLoss_:function(n,e,t,r,i){r===void 0&&(r=1),i===void 0&&(i=pn.SUM_BY_NONZERO_WEIGHTS);var o=M(n,"labels","huberLoss"),a=M(e,"predictions","huberLoss"),s=null;t!=null&&(s=M(t,"weights","huberLoss")),qe(o.shape,a.shape,"Error in huberLoss: ");var u=ae(r),l=a.sub(o).abs(),c=Gk(l,u),h=l.sub(c),d=ae(.5).mul(c.square()).add(u.mul(h));return Gi(d,s,i)}}),M9=L({logLoss_:function(n,e,t,r,i){r===void 0&&(r=1e-7),i===void 0&&(i=pn.SUM_BY_NONZERO_WEIGHTS);var o=M(n,"labels","logLoss"),a=M(e,"predictions","logLoss"),s=null;t!=null&&(s=M(t,"weights","logLoss")),qe(o.shape,a.shape,"Error in logLoss: ");var u=ae(1),l=ae(r),c=o.mul(a.add(l).log()).neg().sub(u.sub(o).mul(u.sub(a).add(l).log()));return Gi(c,s,i)}}),F9=L({meanSquaredError_:function(n,e,t,r){r===void 0&&(r=pn.SUM_BY_NONZERO_WEIGHTS);var i=M(n,"labels","meanSquaredError"),o=M(e,"predictions","meanSquaredError"),a=null;t!=null&&(a=M(t,"weights","meanSquaredError")),qe(i.shape,o.shape,"Error in meanSquaredError: ");var s=i.squaredDifference(o);return Gi(s,a,r)}}),L9=L({sigmoidCrossEntropy_:function(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=pn.SUM_BY_NONZERO_WEIGHTS);var o=M(n,"multiClassLabels","sigmoidCrossEntropy"),a=M(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=M(t,"weights","sigmoidCrossEntropy")),qe(o.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=ae(r),l=ae(1),c=ae(.5);o=o.mul(l.sub(u)).add(c.mul(u))}var h=function(d,p){var m=M(d,"labels","sigmoidCrossEntropyWithLogits"),g=M(p,"logits","sigmoidCrossEntropyWithLogits");qe(m.shape,g.shape,"Error in sigmoidCrossEntropyWithLogits: ");var y=g.relu(),v=g.mul(m),w=g.abs().neg().exp().log1p();return y.sub(v).add(w)}(o,a);return Gi(h,s,i)}}),V9=L({softmaxCrossEntropy_:function(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=pn.SUM_BY_NONZERO_WEIGHTS);var o=M(n,"onehotLabels","softmaxCrossEntropy"),a=M(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=M(t,"weights","softmaxCrossEntropy")),qe(o.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=ae(r),l=ae(1),c=ae(o.shape[1]);o=o.mul(l.sub(u)).add(u.div(c))}var h=function(d,p,m){if(m===void 0&&(m=-1),m===-1&&(m=p.rank-1),m!==p.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+p.rank+" and dim was "+m);return Op(function(g,y,v){var w=y.logSumExp([m],!0),_=y.toFloat().sub(w);return v([g,_]),{value:_.mul(g).neg().sum([m]),gradFunc:function(x,C){var A=C[0],T=C[1],E=Vn(x.shape,[m]);return[x.reshape(E).mul(A.toFloat().sub(T.exp())),x.reshape(E).mul(T.exp().sub(A.toFloat()))]}}})(d,p)}(o,a);return Gi(h,s,i)}}),B9=Object.freeze({get Reduction(){return pn},absoluteDifference:P9,computeWeightedLoss:Gi,cosineDistance:N9,hingeLoss:D9,huberLoss:O9,logLoss:M9,meanSquaredError:F9,sigmoidCrossEntropy:L9,softmaxCrossEntropy:V9});function QE(n,e){return e===void 0&&(e=!1),U.tidy(function(){if(n.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var t=n.shape[0],r=n.shape[1],i=ak(t),o=n.clone(),a=Oo([[1]],[1,1]),s=a.clone(),u=t>=r?r:t,l=function(h){var d,p=o,m=s,g=i;d=U.tidy(function(){var y=o.slice([h,h],[t-h,1]),v=y.norm(),w=o.slice([h,h],[1,1]),_=Oo([[-1]]).where(w.greater(0),Oo([[1]])),x=w.sub(_.mul(v)),C=y.div(x);s=C.shape[0]===1?a.clone():a.concat(C.slice([1,0],[C.shape[0]-1,C.shape[1]]),0);var A=_.matMul(x).div(v).neg(),T=o.slice([h,0],[t-h,r]),E=A.mul(s);if(h===0)o=T.sub(E.matMul(s.transpose().matMul(T)));else{var I=T.sub(E.matMul(s.transpose().matMul(T)));o=o.slice([0,0],[h,r]).concat(I,0)}var S=i.slice([0,h],[t,i.shape[1]-h]);if(h===0)i=S.sub(S.matMul(s).matMul(E.transpose()));else{var N=S.sub(S.matMul(s).matMul(E.transpose()));i=i.slice([0,0],[t,h]).concat(N,1)}return[s,o,i]}),s=d[0],o=d[1],i=d[2],Fn([p,m,g])},c=0;c<u;++c)l(c);return!e&&t>r&&(i=i.slice([0,0],[t,r]),o=o.slice([0,0],[r,r])),[i,o]})}var U9=L({bandPart_:function(n,e,t){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var r=M(n,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,o=r.shape.slice(-2),a=o[0],s=o[1];if(!(e<=a))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+a+").");if(!(t<=s))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+s+").");e<0&&(e=a),t<0&&(t=s);var u=kf(0,a,1,"int32").reshape([-1,1]),l=kf(0,s,1,"int32"),c=Ft(u,l),h=Fp(c.lessEqual(ae(+e,"int32")),c.greaterEqual(ae(-t,"int32"))),d=it([a,s],r.dtype);return Yn(Ot(r.reshape([-1,a,s])).map(function(p){return Ua(h,p,d)})).reshape(i)}}),j9=L({gramSchmidt_:function(n){var e;if(Array.isArray(n)){e=!1,F(n!=null&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=n[0].shape[0],r=function(u){F(n[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[u].shape[0]+" vs. "+t+")"})},i=1;i<n.length;++i)r(i)}else e=!0,n=w1(n,n.shape[0],0).map(function(u){return lk(u,[0])});F(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."});var o=[],a=n,s=function(u){o.push(U.tidy(function(){var l=a[u];if(u>0)for(var c=0;c<u;++c){var h=oA(o[c].mulStrict(l)).mul(o[c]);l=l.sub(h)}return l.div(lA(l,"euclidean"))}))};for(i=0;i<n.length;++i)s(i);return e?Yn(o,0):o}}),z9=L({qr_:function(n,e){if(e===void 0&&(e=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(n.rank===2)return QE(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce(function(a,s){return a*s}),r=Ot(n.reshape([t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),i=[],o=[];return r.forEach(function(a){var s=QE(a,e),u=s[0],l=s[1];i.push(u),o.push(l)}),[Yn(i,0).reshape(n.shape),Yn(o,0).reshape(n.shape)]}}),W9=Object.freeze({bandPart:U9,gramSchmidt:j9,qr:z9});function Up(n,e,t,r,i,o){r==null&&(r=.5),i==null&&(i=Number.NEGATIVE_INFINITY),o==null&&(o=0);var a=n.shape[0];return t=Math.min(t,a),F(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),F(n.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"}),F(n.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]}),F(e.rank===1,function(){return"scores must be a 1D tensor"}),F(e.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+e.shape[0]}),F(0<=o&&o<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+o+"'"}),{maxOutputSize:t,iouThreshold:r,scoreThreshold:i,softNmsSigma:o}}var $9=L({resizeBilinear_:function(n,e,t){t===void 0&&(t=!1);var r=M(n,"images","resizeBilinear");F(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),F(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=U.runKernelFunc(function(l,c){return c([i]),l.resizeBilinear(i,a,s,t)},{x:i},function(l,c){return{x:function(){return U.runKernelFunc(function(h){return h.resizeBilinearBackprop(l,c[0],t)},{})}}},"ResizeBilinear",{alignCorners:t,newHeight:a,newWidth:s});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),H9=L({resizeNearestNeighbor_:function(n,e,t){t===void 0&&(t=!1);var r=M(n,"images","resizeNearestNeighbor");F(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),F(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),F(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=U.runKernelFunc(function(l,c){return c([i]),l.resizeNearestNeighbor(i,a,s,t)},{batchImages:i},function(l,c){return{batchImages:function(){return U.runKernelFunc(function(h){return h.resizeNearestNeighborBackprop(l,c[0],t)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),G9=L({nonMaxSuppression_:function(n,e,t,r,i){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY);var o=M(n,"boxes","nonMaxSuppression"),a=M(e,"scores","nonMaxSuppression"),s=Up(o,a,t,r,i);t=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:r,scoreThreshold:i};return U.runKernelFunc(function(l){return l.nonMaxSuppression(o,a,t,r,i)},{boxes:o,scores:a},null,"NonMaxSuppressionV3",u)}}),q9=function(n,e,t,r,i){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),ce(this,void 0,void 0,function(){var o,a,s,u,l,c,h;return he(this,function(d){switch(d.label){case 0:return o=M(n,"boxes","nonMaxSuppressionAsync"),a=M(e,"scores","nonMaxSuppressionAsync"),s=Up(o,a,t,r,i),t=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold,[4,Promise.all([o.data(),a.data()])];case 1:return u=d.sent(),l=u[0],c=u[1],h=E1(l,c,t,r,i),o!==n&&o.dispose(),a!==e&&a.dispose(),[2,h]}})})},K9=L({nonMaxSuppressionWithScore_:function(n,e,t,r,i,o){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),o===void 0&&(o=0);var a=M(n,"boxes","nonMaxSuppression"),s=M(e,"scores","nonMaxSuppression"),u=Up(a,s,t,r,i,o),l={maxOutputSize:t=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},c=U.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},l);return{selectedIndices:c[0],selectedScores:c[1]}}}),X9=function(n,e,t,r,i,o){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),o===void 0&&(o=0),ce(this,void 0,void 0,function(){var a,s,u,l,c,h,d;return he(this,function(p){switch(p.label){case 0:return a=M(n,"boxes","nonMaxSuppressionAsync"),s=M(e,"scores","nonMaxSuppressionAsync"),u=Up(a,s,t,r,i,o),t=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,o=u.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return l=p.sent(),c=l[0],h=l[1],d=C1(c,h,t,r,i,o),a!==n&&a.dispose(),s!==e&&s.dispose(),[2,d]}})})},Q9=L({cropAndResize_:function(n,e,t,r,i,o){var a=M(n,"image","cropAndResize"),s=M(e,"boxes","cropAndResize","float32"),u=M(t,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var l=s.shape[0];return F(a.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),F(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),F(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),F(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),F(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),F(i==="bilinear"||i==="nearest",function(){return"method must be bilinear or nearest, but was "+i}),U.runKernelFunc(function(c,h){return c.cropAndResize(a,s,u,r,i,o)},{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:i,extrapolationValue:o,cropSize:r})}}),V1=Object.freeze({resizeBilinear:$9,resizeNearestNeighbor:H9,nonMaxSuppression:G9,nonMaxSuppressionAsync:q9,nonMaxSuppressionWithScore:K9,nonMaxSuppressionWithScoreAsync:X9,cropAndResize:Q9}),B1=function(n,e){return!(n>0)||e==="linear"},U1=function(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return n.mul(e.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},j1=function(n,e){var t=e,r=Mt(n.shape,e.shape);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},z1=function(n,e,t){if(e==="linear")return n;if(e==="relu")return ct(n);if(e==="elu")return aA(n);if(e==="relu6")return uA(n);if(e==="prelu")return sA(n,t);throw new Error("Unknown fused activation "+e+".")},Y9=L({fusedMatMul_:function(n){var e,t=n.a,r=n.b,i=n.transposeA,o=i!==void 0&&i,a=n.transposeB,s=a!==void 0&&a,u=n.bias,l=n.activation,c=l===void 0?"linear":l,h=n.preluActivationWeights;if(B1(U.state.gradientDepth,c)===!1){var d=Vp(t,r,o,s);return u!=null&&(d=Ne(d,u)),z1(d,c,h)}var p=M(t,"a","fused matMul"),m=M(r,"b","fused matMul");e=pt(p,m),p=e[0],m=e[1];var g=o?p.shape[p.rank-2]:p.shape[p.rank-1],y=s?m.shape[m.rank-1]:m.shape[m.rank-2],v=o?p.shape[p.rank-1]:p.shape[p.rank-2],w=s?m.shape[m.rank-2]:m.shape[m.rank-1],_=p.shape.slice(0,-2),x=m.shape.slice(0,-2),C=fe(_),A=fe(x);F(p.rank>=2&&m.rank>=2&&p.rank===m.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+p.rank+" and "+m.rank+"."}),F(zt(_,x),function(){return"Error in fused matMul: outer dimensions ("+_+") and ("+x+") of Tensors with shapes "+p.shape+" and "+m.shape+" must match."}),F(g===y,function(){return"Error in fused matMul: inner shapes ("+g+") and ("+y+") of Tensors with shapes "+p.shape+" and "+m.shape+" and transposeA="+o+" and transposeB="+s+" must match."});var T,E,I=p.shape.slice(0,-2).concat([v,w]),S=o?p.as3D(C,g,v):p.as3D(C,v,g),N=s?m.as3D(A,w,y):m.as3D(A,y,w);u!=null&&Oe(I,(T=pt(T=M(u,"bias","fused matMul"),p)[0]).shape),h!=null&&(E=M(h,"prelu weights","fused matMul"));var P={a:S,b:N};u!=null&&(P.bias=T),h!=null&&(P.preluActivationWeights=E);var k=[S,N];return U.runKernelFunc(function(j,B){var W=j.fusedBatchMatMul({a:S,b:N,transposeA:o,transposeB:s,bias:T,activation:c,preluActivationWeights:E});return B([S,N,W]),W},P,function(j,B){var W=B[0],X=B[1],V=B[2],$=U1(j,V,c),G={};return u!=null&&(G={bias:function(){return j1(T,$)}}),Object.assign(o||s?!o&&s?{a:function(){return $.matMul(X,!1,!1)},b:function(){return $.matMul(W,!0,!1)}}:o&&!s?{a:function(){return X.matMul($,!1,!0)},b:function(){return W.matMul($,!1,!1)}}:{a:function(){return X.matMul($,!0,!0)},b:function(){return $.matMul(W,!0,!0)}}:{a:function(){return $.matMul(X,!1,!0)},b:function(){return W.matMul($,!0,!1)}},G)},"_FusedMatMul",{transposeA:o,transposeB:s,activation:c},k,[!0]).reshape(I)}}),J9=L({fusedConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,i=n.pad,o=n.dataFormat,a=o===void 0?"NHWC":o,s=n.dilations,u=s===void 0?[1,1]:s,l=n.dimRoundingMode,c=n.bias,h=n.activation,d=h===void 0?"linear":h,p=n.preluActivationWeights;if(d=d||"linear",B1(U.state.gradientDepth,d)===!1){var m=_r(e,t,r,i,a,u,l);return c!=null&&(m=Ne(m,c)),z1(m,d,p)}var g=M(e,"x","conv2d"),y=M(t,"filter","conv2d"),v=g,w=!1;g.rank===3&&(w=!0,v=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),F(v.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+v.rank+"."}),F(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+y.rank+"."}),l!=null&&F(xt(i),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+i+"."}),F(v.shape[3]===y.shape[2],function(){return"Error in conv2d: depth of input ("+v.shape[3]+") must match input depth for filter "+y.shape[2]+"."}),F(Bn(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),F(a==="NHWC",function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."});var _,x,C=Ja(v.shape,y.shape,r,u,i,l);c!=null&&(_=pt(_=M(c,"bias","fused conv2d"),g)[0],Oe(C.outShape,_.shape)),p!=null&&(x=M(p,"prelu weights","fused conv2d"));var A={x:v,filter:y};c!=null&&(A.bias=_),p!=null&&(A.preluActivationWeights=x);var T=[y,v],E=U.runKernelFunc(function(I,S){var N=I.fusedConv2d({input:v,filter:y,convInfo:C,bias:_,activation:d,preluActivationWeights:x});return S([y,v,N]),N},A,function(I,S){var N=S,P=N[0],k=N[1],j=N[2],B=U1(I,j,d);F(gu(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var W={};return c!=null&&(W={bias:function(){return j1(_,B)}}),Object.assign({x:function(){return Jk(k.shape,B,P,r,i)},filter:function(){return N1(k,B,P.shape,r,i)}},W)},"FusedConv2D",{convInfo:C,activation:d},T,[!0]);return w?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),Z9=L({fusedDepthwiseConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,i=n.pad,o=n.dataFormat,a=o===void 0?"NHWC":o,s=n.dilations,u=s===void 0?[1,1]:s,l=n.dimRoundingMode,c=n.bias,h=n.activation,d=h===void 0?"linear":h,p=n.preluActivationWeights;if(B1(U.state.gradientDepth,d)===!1){var m=Lp(e,t,r,i,a,u,l);return c!=null&&(m=Ne(m,c)),z1(m,d,p)}var g=M(e,"x","depthwiseConv2d"),y=M(t,"filter","depthwiseConv2d"),v=g,w=!1;g.rank===3&&(w=!0,v=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),F(v.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+v.rank+"."}),F(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+y.rank+"."}),F(v.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+v.shape[3]+") must match the inChannels dimension in filter "+y.shape[2]+"."}),u==null&&(u=[1,1]),F(Bn(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),l!=null&&F(xt(i),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+i+"."});var _,x,C=Ja(v.shape,y.shape,r,u,i,l,!0);c!=null&&(_=pt(_=M(c,"bias","fused conv2d"),g)[0],Oe(C.outShape,_.shape)),p!=null&&(x=M(p,"prelu weights","fused depthwiseConv2d"));var A={x:v,filter:y};c!=null&&(A.bias=_),p!=null&&(A.preluActivationWeights=x);var T=[y,v],E=U.runKernelFunc(function(I,S){var N=I.fusedDepthwiseConv2D({input:v,filter:y,convInfo:C,bias:_,activation:d,preluActivationWeights:x});return S([y,v,N]),N},A,function(I,S){F(gu(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var N=S[0],P=S[1],k=S[2],j=U1(I,k,d),B={};return c!=null&&(B={bias:function(){return j1(_,j)}}),Object.assign({x:function(){return Zk(P.shape,j,N,C)},filter:function(){return eA(P,j,N.shape,C)}},B)},"FusedDepthwiseConv2D",{convInfo:C,activation:d},T,[!0]);return w?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),e8=Object.freeze({matMul:Y9,conv2d:J9,depthwiseConv2d:Z9}),t8=Object.freeze({image:V1,linalg:W9,losses:B9,spectral:C9,fused:e8,signal:k9,square:MW,squaredDifference:Fk,conv1d:$$,conv2d:_r,conv3d:H$,depthwiseConv2d:Lp,separableConv2d:D1,conv2dTranspose:G$,conv3dTranspose:q$,op:L,batchNormalization2d:h$,batchNormalization3d:d$,batchNormalization4d:f$,batchNormalization:p$,batchNorm:zk,batchNorm2d:m$,batchNorm3d:v$,batchNorm4d:g$,booleanMaskAsync:W$,complex:qt,real:dr,imag:Jr,concat:Dt,concat1d:e5,concat2d:t5,concat3d:n5,concat4d:r5,split:w1,matMul:Vp,dot:K$,outerProduct:X$,reverse:Wc,reverse1d:Q$,reverse2d:Y$,reverse3d:J$,reverse4d:Z$,maxPool:Vt,avgPool:$c,pool:e9,maxPool3d:t9,avgPool3d:n9,slice:hi,slice1d:r9,slice2d:i9,slice3d:rA,slice4d:o9,abs:FW,acos:LW,acosh:VW,asin:BW,asinh:UW,atan:jW,atanh:zW,ceil:WW,clipByValue:k1,cos:$W,cosh:HW,erf:GW,exp:fy,expm1:qW,floor:KW,log:XW,log1p:QW,logSigmoid:YW,neg:Lf,reciprocal:JW,round:ZW,rsqrt:Lk,sigmoid:Vk,sign:e$,isNaN:t$,isInf:n$,isFinite:r$,sin:i$,sinh:o$,softplus:a$,sqrt:s$,step:u$,tan:l$,tanh:c$,all:a9,any:s9,argMax:u9,argMin:l9,logSumExp:c9,max:Bp,mean:h9,min:d9,moments:f9,sum:oA,prod:p9,equal:qk,equalStrict:D$,greater:O$,greaterEqual:Kk,greaterEqualStrict:M$,greaterStrict:F$,less:L$,lessEqual:V$,lessEqualStrict:B$,lessStrict:U$,notEqual:j$,notEqualStrict:z$,add:Ne,addN:_$,addStrict:x$,atan2:b$,div:Tr,divNoNan:E$,divStrict:C$,floorDiv:Hk,maximum:A1,maximumStrict:I$,minimum:Gk,minimumStrict:T$,mod:S$,modStrict:R$,mul:vn,mulStrict:k$,pow:Vf,powStrict:A$,squaredDifferenceStrict:P$,sub:Ft,subStrict:N$,elu:aA,leakyRelu:m9,prelu:sA,relu:ct,relu6:uA,selu:v9,logicalAnd:Fp,logicalNot:y$,logicalOr:Wk,logicalXor:w$,where:Ua,whereAsync:$k,buffer:Se,print:d5,batchToSpaceND:ok,broadcastTo:f5,cast:p5,clone:m5,cumsum:v5,depthToSpace:g5,expandDims:lr,eye:ak,multinomial:y5,oneHot:ly,pad:Ya,pad1d:w5,pad2d:_5,pad3d:x5,pad4d:b5,rand:E5,randomNormal:C5,randomGamma:I5,randomUniform:sk,reshape:Pr,spaceToBatchND:uk,squeeze:lk,stack:Yn,tile:Hs,truncatedNormal:T5,unstack:Ot,setdiff1dAsync:S5,fill:li,linspace:Zj,ones:Pu,range:kf,scalar:ae,tensor:Qt,tensor1d:Tt,tensor2d:Oo,tensor3d:y1,tensor4d:An,tensor5d:Qj,tensor6d:Yj,variable:Jj,zeros:it,onesLike:ik,zerosLike:je,transpose:Go,softmax:Hi,logSoftmax:O5,localResponseNormalization:g9,norm:lA,gather:P1,unsortedSegmentSum:Xk,basicLSTMCell:y9,multiRNNCell:w9,movingAverage:_9,stridedSlice:x9,topk:b9,scatterND:E9,fft:O1,ifft:Bf,rfft:M1,irfft:cA,sparseToDense:I9,gatherND:T9,diag:S9,dropout:R9,hannWindow:F1,hammingWindow:dA,frame:L1,stft:fA,inTopKAsync:A9});function Z(n,e){Array.isArray(n)||(n=[n]),n.forEach(function(t){t!=null&&F(t.dtype!=="complex64",function(){return e+" does not support complex64 tensors."})})}function pv(n,e,t,r){if(t==="linear")return n.linear(e);if(t==="relu")return n.relu(e);if(t==="elu")return n.elu(e);if(t==="relu6")return n.relu6(e);if(t==="prelu")return n.prelu(e,r);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var n8=function(n){function e(){var t=n.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new vk(t,U),t}return Br(e,n),e.prototype.write=function(t,r,i){this.firstUse&&(this.firstUse=!1,Y().get("IS_NODE")&&Sf(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var o={};return this.data.set(o,{values:t,dtype:i}),o},e.prototype.move=function(t,r,i,o){this.data.set(t,{values:r,dtype:o})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return ce(this,void 0,void 0,function(){return he(this,function(r){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var r=this.data.get(t),i=r.dtype,o=r.complexTensors;return i==="complex64"?dy(this.readSync(o.real.dataId),this.readSync(o.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var r=this.readSync(t.dataId),i=r;if(t.dtype==="string")try{i=r.map(function(o){return Cf(o)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Se(t.shape,t.dtype,i)},e.prototype.makeOutput=function(t,r,i){var o=this.write(t,r,i);return U.makeTensorFromDataId(o,r,i,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var r=this.data.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return ce(this,void 0,void 0,function(){var r;return he(this,function(i){return r=Xr(),t(),[2,{kernelMs:Xr()-r}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,r){var i=this.makeOutput(null,t.shape,"complex64");return this.data.get(i.dataId).complexTensors={real:U.keep(t.clone()),imag:U.keep(r.clone())},i},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,i){if(Z(t,"slice"),pk(t.shape,r,i)){var o=mk(r,t.strides),a=fe(i);return Qt(this.readSync(t.dataId).subarray(o,o+a),i,t.dtype)}for(var s=Se(i,t.dtype),u=this.bufferSync(t),l=0;l<s.size;++l){var c=s.indexToLoc(l).map(function(h,d){return h+r[d]});s.values[l]=u.get.apply(u,c)}return s.toTensor()},e.prototype.stridedSlice=function(t,r,i,o){Z(t,"stridedSlice");var a=x1(r,i,o);if(a.some(function(p){return p===0}))return Qt([],a);for(var s=Se(a,t.dtype),u=this.bufferSync(t),l=0;l<s.size;l++){for(var c=s.indexToLoc(l),h=new Array(c.length),d=0;d<h.length;d++)h[d]=c[d]*o[d]+r[d];s.set.apply(s,[u.get.apply(u,h)].concat(c))}return s.toTensor()},e.prototype.diag=function(t){for(var r=this.readSync(t.dataId),i=Se([t.size,t.size],t.dtype),o=i.values,a=0;a<r.length;a++)o[a*t.size+a]=r[a];return i.toTensor()},e.prototype.unstack=function(t,r){for(var i=t.shape[r],o=new Array(t.rank-1),a=0,s=0;s<t.rank;s++)s!==r&&(o[a++]=t.shape[s]);var u=new Array(t.rank).fill(0),l=t.shape.slice();l[r]=1;var c=new Array(i);for(s=0;s<c.length;s++)u[r]=s,c[s]=this.slice(t,u,l).reshape(o);return c},e.prototype.reverse=function(t,r){Z(t,"reverse");for(var i=Se(t.shape,t.dtype),o=this.bufferSync(t),a=function(u){var l=i.indexToLoc(u),c=l.slice();r.forEach(function(h){return c[h]=t.shape[h]-1-c[h]}),i.set.apply(i,[o.get.apply(o,c)].concat(l))},s=0;s<i.size;s++)a(s);return i.toTensor()},e.prototype.concat=function(t,r){var i=this;if(t[0].dtype==="complex64"){var o=t.map(function(p){return dr(p)}),a=t.map(function(p){return Jr(p)});return qt(this.concat(o,r),this.concat(a,r))}var s=t.map(function(p){var m=fe(p.shape.slice(r));return p.as2D(-1,m)}),u=vu(s.map(function(p){return p.shape}),1),l=Se(u,t[0].dtype).values;if(s[0].shape[0]===1){var c=0;s.forEach(function(p){l.set(i.readSync(p.dataId),c),c+=p.size})}else{var h=0;s.forEach(function(p){for(var m=i.readSync(p.dataId),g=0,y=0;y<p.shape[0];++y)for(var v=y*u[1]+h,w=0;w<p.shape[1];++w)l[v+w]=m[g++];h+=p.shape[1]})}var d=vu(t.map(function(p){return p.shape}),r);return Qt(l,d,t[0].dtype)},e.prototype.neg=function(t){return Z(t,"neg"),this.multiply(ae(-1),t)},e.prototype.add=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(i,o,a,s){return{real:i+a,imag:o+s}}):this.broadcastedBinaryOp(t,r,Xt(t.dtype,r.dtype),function(i,o){return i+o})},e.prototype.addN=function(t){var r=this;Z(t,"addN");for(var i=t.map(function(c){return r.readSync(c.dataId)}),o=Se(t[0].shape,t[0].dtype),a=o.values,s=0;s<t.length;s++)for(var u=i[s],l=0;l<a.length;l++)a[l]+=u[l];return o.toTensor()},e.prototype.softmax=function(t,r){var i=Lt([r],t.shape),o=this.max(t,i),a=Vn(o.shape,i),s=this.subtract(t,o.reshape(a)),u=this.exp(s),l=this.sum(u,i).reshape(a);return this.realDivide(u,l)},e.prototype.subtract=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(i,o,a,s){return{real:i-a,imag:o-s}}):this.broadcastedBinaryOp(t,r,Xt(t.dtype,r.dtype),function(i,o){return i-o})},e.prototype.pow=function(t,r){return Z([t,r],"pow"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.pow(i,o)})},e.prototype.batchMatMul=function(t,r,i,o){Z([t,r],"matMul");for(var a=i?t.shape[1]:t.shape[2],s=i?t.shape[2]:t.shape[1],u=o?r.shape[1]:r.shape[2],l=t.shape[0],c=this.readSync(t.dataId),h=this.readSync(r.dataId),d=i?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],p=d[0],m=d[1],g=d[2],y=o?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],v=y[0],w=y[1],_=y[2],x=s*u,C=Se([l,s,u],t.dtype),A=C.values,T=this.blockSize,E=0;E<l;E++)for(var I=0;I<s;I+=T)for(var S=0;S<u;S+=T)for(var N=0;N<a;N+=T)for(var P=Math.min(I+T,s),k=Math.min(S+T,u),j=Math.min(N+T,a),B=I;B<P;B++)for(var W=S;W<k;W++){for(var X=0,V=N;V<j;V++)X+=c[E*p+B*m+V*g]*h[V*v+W*w+E*_];A[E*x+(B*u+W)]+=X}return C.toTensor()},e.prototype.fusedBatchMatMul=function(t){var r=t.a,i=t.b,o=t.transposeA,a=t.transposeB,s=t.bias,u=t.activation,l=t.preluActivationWeights,c=this.batchMatMul(r,i,o,a);return s&&(c=this.add(c,s)),u&&(c=pv(this,c,u,l)),c},e.prototype.multiply=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(i,o,a,s){return{real:i*a-o*s,imag:i*s+o*a}}):this.broadcastedBinaryOp(t,r,Xt(t.dtype,r.dtype),function(i,o){return i*o})},e.prototype.realDivide=function(t,r){return Z([t,r],"realDivide"),this.broadcastedBinaryOp(t,r,"float32",function(i,o){return i/o})},e.prototype.floorDiv=function(t,r){return Z([t,r],"floorDiv"),this.broadcastedBinaryOp(t,r,"int32",function(i,o){return Math.floor(i/o)})},e.prototype.sum=function(t,r){Z(t,"sum"),Wn("sum",r,t.rank);for(var i=ln(t.shape,r),o=i[0],a=i[1],s=it(o,Xt(t.dtype,"int32")),u=fe(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var d=h*u,p=0,m=0;m<u;++m)p+=c[d+m];l[h]=p}return s},e.prototype.prod=function(t,r){Z(t,"sum");for(var i=ln(t.shape,r),o=i[0],a=i[1],s=it(o,Xt(t.dtype,"int32")),u=fe(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var d=h*u,p=1,m=0;m<u;++m)p*=c[d+m];l[h]=p}return s},e.prototype.unsortedSegmentSum=function(t,r,i){Z(t,"unsortedSegmentSum");for(var o=[],a=t.rank-r.rank,s=0;s<a;++s)r=r.expandDims(s+1);for(s=0;s<i;++s){var u=ae(s,"int32"),l=qk(u,r).asType("float32").mul(t).sum(0);o.push(l)}return Yn(o)},e.prototype.argMin=function(t,r){Z(t,"argMin");var i=[r];Wn("argMin",i,t.rank);for(var o=ln(t.shape,i),a=o[0],s=o[1],u=it(a,"int32"),l=fe(s),c=this.readSync(u.dataId),h=this.readSync(t.dataId),d=0;d<c.length;++d){for(var p=d*l,m=h[p],g=0,y=0;y<l;++y){var v=h[p+y];v<m&&(m=v,g=y)}c[d]=g}return u},e.prototype.argMax=function(t,r){Z(t,"argMax");var i=[r];Wn("argMax",i,t.rank);for(var o=ln(t.shape,i),a=o[0],s=o[1],u=it(a,"int32"),l=fe(s),c=this.readSync(u.dataId),h=this.readSync(t.dataId),d=0;d<c.length;++d){for(var p=d*l,m=h[p],g=0,y=0;y<l;++y){var v=h[p+y];v>m&&(m=v,g=y)}c[d]=g}return u},e.prototype.cumsum=function(t,r,i,o){if(Z(t,"cumsum"),r!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+r);for(var a=Xt(t.dtype,"int32"),s=it(t.shape,a),u=this.readSync(s.dataId),l=this.readSync(t.dataId),c=t.shape[t.rank-1],h=o?function(y,v){return y+c-v-1}:function(y,v){return y+v},d=0;d<l.length;d+=c)for(var p=0;p<c;p++){var m=h(d,p);if(p===0)u[m]=i?0:l[m];else{var g=h(d,p-1);u[m]=i?l[g]+u[g]:l[m]+u[g]}}return s},e.prototype.equal=function(t,r){return Z([t,r],"equal"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i===o?1:0})},e.prototype.notEqual=function(t,r){return Z([t,r],"notEqual"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i!==o?1:0})},e.prototype.less=function(t,r){return Z([t,r],"less"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i<o?1:0})},e.prototype.lessEqual=function(t,r){return Z([t,r],"lessEqual"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i<=o?1:0})},e.prototype.greater=function(t,r){return Z([t,r],"greater"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i>o?1:0})},e.prototype.greaterEqual=function(t,r){return Z([t,r],"greaterEqual"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i>=o?1:0})},e.prototype.logicalNot=function(t){Z(t,"logicalNot");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)i[o]=r[o]?0:1;return this.makeOutput(i,t.shape,"bool")},e.prototype.logicalAnd=function(t,r){return Z([t,r],"logicalAnd"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i&&o})},e.prototype.logicalOr=function(t,r){return Z([t,r],"logicalOr"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i||o})},e.prototype.select=function(t,r,i){Z([t,r,i],"select");for(var o=this.readSync(t.dataId),a=this.readSync(r.dataId),s=this.readSync(i.dataId),u=it(r.shape,Xt(r.dtype,i.dtype)),l=this.readSync(u.dataId),c=0,h=t.rank===0||t.rank>1||r.rank===1?1:fe(r.shape.slice(1)),d=0;d<o.length;d++)for(var p=0;p<h;p++)o[d]===1?l[c++]=a[d]:l[c++]=s[d];return u},e.prototype.where=function(t){Z([t],"where");var r=this.readSync(t.dataId);return I1(t.shape,r)},e.prototype.topk=function(t,r,i){return Z(t,"topk"),Ck(this.readSync(t.dataId),t.shape,t.dtype,r)},e.prototype.min=function(t,r){Z(t,"min"),Wn("min",r,t.rank);for(var i=ln(t.shape,r),o=i[0],a=i[1],s=it(o,t.dtype),u=fe(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var d=h*u,p=c[d],m=0;m<u;++m){var g=c[d+m];g<p&&(p=g)}l[h]=p}return s},e.prototype.minimum=function(t,r){return Z([t,r],"minimum"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.min(i,o)})},e.prototype.mod=function(t,r){return Z([t,r],"mod"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){var a=i%o;return i<0&&o<0||i>=0&&o>=0?a:(a+o)%o})},e.prototype.max=function(t,r){Z(t,"max"),Wn("max",r,t.rank);for(var i=ln(t.shape,r),o=i[0],a=i[1],s=it(o,t.dtype),u=fe(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var d=h*u,p=c[d],m=0;m<u;++m){var g=c[d+m];g>p&&(p=g)}l[h]=p}return s},e.prototype.maximum=function(t,r){return Z([t,r],"maximum"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.max(i,o)})},e.prototype.all=function(t,r){Z(t,"all"),Wn("all",r,t.rank);for(var i=ln(t.shape,r),o=i[0],a=i[1],s=it(o,t.dtype),u=fe(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var d=h*u,p=c[d],m=0;m<u;++m){var g=c[d+m];p=p&&g}l[h]=p}return s},e.prototype.any=function(t,r){Z(t,"any"),Wn("any",r,t.rank);for(var i=ln(t.shape,r),o=i[0],a=i[1],s=it(o,t.dtype),u=fe(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var d=h*u,p=c[d],m=0;m<u;++m){var g=c[d+m];p=p||g}l[h]=p}return s},e.prototype.squaredDifference=function(t,r){return Z([t,r],"squaredDifference"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){var a=i-o;return a*a})},e.prototype.ceil=function(t){Z(t,"ceil");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.ceil(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.floor=function(t){Z(t,"floor");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.floor(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.sign=function(t){Z(t,"x");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)r[o]<0?i[o]=-1:r[o]>0?i[o]=1:i[o]=0;return this.makeOutput(i,t.shape,"float32")},e.prototype.isNaN=function(t){Z(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isNaN(r[o])&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isInf=function(t){Z(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Math.abs(r[o])===1/0&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isFinite=function(t){Z(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isFinite(r[o])&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.round=function(t){Z(t,"round");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=Math.floor(r[o]);r[o]-a<.5?i[o]=Math.floor(r[o]):r[o]-a>.5?i[o]=Math.ceil(r[o]):i[o]=a%2==0?a:a+1}return this.makeOutput(i,t.shape,"float32")},e.prototype.exp=function(t){Z(t,"exp");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.exp(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.expm1=function(t){Z(t,"expm1");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.expm1(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.log=function(t){Z(t,"log");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=r[o];i[o]=Math.log(a)}return this.makeOutput(i,t.shape,"float32")},e.prototype.log1p=function(t){Z(t,"log1p");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=r[o];i[o]=Math.log1p(a)}return this.makeOutput(i,t.shape,"float32")},e.prototype.sqrt=function(t){Z(t,"sqrt");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=r[o];i[o]=Math.sqrt(a)}return this.makeOutput(i,t.shape,"float32")},e.prototype.rsqrt=function(t){Z(t,"rsqrt");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=r[o];i[o]=1/Math.sqrt(a)}return this.makeOutput(i,t.shape,"float32")},e.prototype.reciprocal=function(t){Z(t,"reciprocal");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=1/r[o];return this.makeOutput(i,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){Z(t,"relu");for(var r=it(t.shape,t.dtype),i=this.readSync(r.dataId),o=this.readSync(t.dataId),a=0;a<o.length;++a)i[a]=Math.max(0,o[a]);return r},e.prototype.relu6=function(t){Z(t,"relu");for(var r=it(t.shape,t.dtype),i=this.readSync(r.dataId),o=this.readSync(t.dataId),a=0;a<o.length;++a)i[a]=Math.min(Math.max(0,o[a]),6);return r},e.prototype.prelu=function(t,r){return Z([t,r],"prelu"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return i<0?o*i:i})},e.prototype.elu=function(t){Z(t,"elu");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var a=i[o];r[o]=a>=0?a:Math.exp(a)-1}return this.makeOutput(r,t.shape,"float32")},e.prototype.eluDer=function(t,r){Z([t,r],"eluDer");for(var i=new Float32Array(r.size),o=this.readSync(r.dataId),a=this.readSync(t.dataId),s=0;s<o.length;++s){var u=o[s];i[s]=u>=1?a[s]:a[s]*(u+1)}return this.makeOutput(i,r.shape,"float32")},e.prototype.selu=function(t){Z(t,"selu");for(var r=S1,i=R1,o=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var u=a[s];o[s]=u>=0?i*u:r*(Math.exp(u)-1)}return this.makeOutput(o,t.shape,"float32")},e.prototype.clip=function(t,r,i){Z(t,"clip");for(var o=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var u=a[s];o[s]=u>i?i:u<r?r:u}return this.makeOutput(o,t.shape,"float32")},e.prototype.abs=function(t){for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.abs(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<t.size;++o){var a=i[2*o],s=i[2*o+1];r[o]=Math.hypot(a,s)}return this.makeOutput(r,t.shape,"float32")},e.prototype.int=function(t){Z(t,"int");for(var r=new Int32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=i[o];return this.makeOutput(r,t.shape,"int32")},e.prototype.sigmoid=function(t){Z(t,"sigmoid");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=1/(1+Math.exp(-i[o]));return this.makeOutput(r,t.shape,"float32")},e.prototype.softplus=function(t){Z(t,"softplus");for(var r=Math.log(11920928955078125e-23)+2,i=new Float32Array(t.size),o=this.readSync(t.dataId),a=0;a<o.length;++a){var s=o[a]>-r,u=o[a]<r,l=Math.exp(o[a]),c=void 0;c=u?l:s?o[a]:Math.log(1+l),i[a]=c}return this.makeOutput(i,t.shape,"float32")},e.prototype.sin=function(t){Z(t,"sin");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.sin(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cos=function(t){Z(t,"cos");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.cos(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tan=function(t){Z(t,"tan");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.tan(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asin=function(t){Z(t,"asin");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.asin(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acos=function(t){Z(t,"acos");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.acos(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan=function(t){Z(t,"atan");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.atan(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan2=function(t,r){return Z([t,r],"atan2"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.atan2(i,o)})},e.prototype.sinh=function(t){Z(t,"sinh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.sinh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cosh=function(t){Z(t,"cosh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.cosh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tanh=function(t){Z(t,"tanh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=rj(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asinh=function(t){Z(t,"asinh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.asinh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acosh=function(t){Z(t,"acosh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.acosh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atanh=function(t){Z(t,"atanh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.atanh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.erf=function(t){Z(t,"erf");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var a=Math.sign(i[o]),s=Math.abs(i[o]),u=1/(1+.3275911*s);r[o]=a*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(r,t.shape,"float32")},e.prototype.step=function(t,r){r===void 0&&(r=0),Z(t,"step");for(var i=new Float32Array(t.size),o=this.readSync(t.dataId),a=0;a<o.length;++a){var s=o[a];isNaN(s)?i[a]=NaN:i[a]=s>0?1:r}return this.makeOutput(i,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var r=t.input,i=t.filter,o=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights,l=this.conv2d(r,i,o);return a&&(l=this.add(l,a)),s&&(l=pv(this,l,s,u)),l},e.prototype.conv2d=function(t,r,i){Z([t,r],"conv2d");for(var o=i.filterHeight,a=i.filterWidth,s=i.dilationHeight,u=i.dilationWidth,l=i.padInfo.left,c=i.padInfo.top,h=i.dataFormat==="channelsLast",d=Se(i.outShape,t.dtype),p=t.strides[0],m=h?t.strides[1]:t.strides[2],g=h?t.strides[2]:1,y=h?1:t.strides[1],v=d.strides[0],w=h?d.strides[1]:d.strides[2],_=h?d.strides[2]:1,x=h?1:d.strides[1],C=this.readSync(t.dataId),A=this.readSync(r.dataId),T=d.values,E=0;E<i.batchSize;++E)for(var I=E*p,S=E*v,N=0;N<i.outHeight;++N)for(var P=S+N*w,k=N*i.strideHeight-c,j=0;j<o;j++){var B=k+j*s;if(!(B<0||B>=i.inHeight))for(var W=j*r.strides[0],X=I+B*m,V=0;V<i.outWidth;++V)for(var $=P+V*_,G=V*i.strideWidth-l,te=0;te<a;te++){var re=G+te*u;if(!(re<0||re>=i.inWidth))for(var oe=X+re*g,_e=W+te*r.strides[1],pe=0;pe<i.inChannels;++pe){for(var xe=C[oe+pe*y],Te=0;Te<i.outChannels;++Te)T[$+Te*x]+=xe*A[_e+Te];_e+=i.outChannels}}}return d.toTensor()},e.prototype.conv3d=function(t,r,i){for(var o=i.filterDepth,a=i.filterHeight,s=i.filterWidth,u=i.dilationDepth,l=i.dilationHeight,c=i.dilationWidth,h=i.padInfo.front,d=i.padInfo.left,p=i.padInfo.top,m=Se(i.outShape,t.dtype),g=this.readSync(t.dataId),y=this.readSync(r.dataId),v=m.values,w=0;w<i.batchSize;++w)for(var _=w*t.strides[0],x=w*m.strides[0],C=0;C<i.outDepth;++C)for(var A=x+C*m.strides[1],T=C*i.strideDepth-h,E=0;E<o;E++){var I=T+E*u;if(!(I<0||I>=i.inDepth))for(var S=E*r.strides[0],N=_+I*t.strides[1],P=0;P<i.outHeight;++P)for(var k=A+P*m.strides[2],j=P*i.strideHeight-p,B=0;B<a;B++){var W=j+B*l;if(!(W<0||W>=i.inHeight))for(var X=S+B*r.strides[1],V=N+W*t.strides[2],$=0;$<i.outWidth;++$)for(var G=k+$*i.outChannels,te=$*i.strideWidth-d,re=0;re<s;re++){var oe=te+re*c;if(!(oe<0||oe>=i.inWidth))for(var _e=X+re*r.strides[2],pe=V+oe*i.inChannels,xe=_e,Te=0;Te<i.inChannels;++Te){for(var De=g[pe+Te],Fe=0;Fe<i.outChannels;++Fe)v[G+Fe]+=De*y[xe+Fe];xe+=i.outChannels}}}}return m.toTensor()},e.prototype.conv2dDerInput=function(t,r,i){Z([t,r],"conv2dDerInput");for(var o=Se(i.inShape,"float32"),a=o.values,s=this.readSync(t.dataId),u=this.readSync(r.dataId),l=r.strides,c=l[0],h=l[1],d=l[2],p=i.batchSize,m=i.filterHeight,g=i.filterWidth,y=i.inChannels,v=i.inHeight,w=i.inWidth,_=i.outChannels,x=i.outHeight,C=i.outWidth,A=i.strideHeight,T=i.strideWidth,E=i.dataFormat,I=m-1-i.padInfo.top,S=g-1-i.padInfo.left,N=E==="channelsLast",P=o.strides[0],k=N?o.strides[1]:o.strides[2],j=N?o.strides[2]:1,B=N?1:o.strides[1],W=t.strides[0],X=N?t.strides[1]:t.strides[2],V=N?t.strides[2]:1,$=N?1:t.strides[1],G=0;G<p;++G)for(var te=0;te<y;++te)for(var re=0;re<v;++re)for(var oe=re-I,_e=Math.max(0,Math.ceil(oe/A)),pe=Math.min(x,(m+oe)/A),xe=0;xe<w;++xe){for(var Te=xe-S,De=Math.max(0,Math.ceil(Te/T)),Fe=Math.min(C,(g+Te)/T),Ye=0,Ae=_e;Ae<pe;++Ae)for(var We=Ae*A-oe,Be=De;Be<Fe;++Be)for(var Je=W*G+X*Ae+V*Be,Xe=c*(m-1-We)+h*(g-1-(Be*T-Te))+d*te,Ze=0;Ze<_;++Ze)Ye+=s[Je+$*Ze]*u[Xe+Ze];a[P*G+k*re+j*xe+B*te]=Ye}return o.toTensor()},e.prototype.conv3dDerInput=function(t,r,i){for(var o=Se(i.inShape,"float32"),a=o.values,s=o.strides,u=s[0],l=s[1],c=s[2],h=s[3],d=this.readSync(t.dataId),p=t.strides,m=p[0],g=p[1],y=p[2],v=p[3],w=this.readSync(r.dataId),_=r.strides,x=_[0],C=_[1],A=_[2],T=_[3],E=i.batchSize,I=i.filterDepth,S=i.filterHeight,N=i.filterWidth,P=i.inChannels,k=i.inDepth,j=i.inHeight,B=i.inWidth,W=i.outChannels,X=i.outDepth,V=i.outHeight,$=i.outWidth,G=i.strideDepth,te=i.strideHeight,re=i.strideWidth,oe=I-1-i.padInfo.front,_e=S-1-i.padInfo.top,pe=N-1-i.padInfo.left,xe=0;xe<E;++xe)for(var Te=0;Te<P;++Te)for(var De=0;De<k;++De)for(var Fe=De-oe,Ye=Math.max(0,Math.ceil(Fe/G)),Ae=Math.min(X,(I+Fe)/G),We=0;We<j;++We)for(var Be=We-_e,Je=Math.max(0,Math.ceil(Be/te)),Xe=Math.min(V,(S+Be)/te),Ze=0;Ze<B;++Ze){for(var rr=Ze-pe,ir=Math.max(0,Math.ceil(rr/re)),tn=Math.min($,(N+rr)/re),jr=0,or=Ye;or<Ae;++or)for(var zr=or*G-Fe,Un=Je;Un<Xe;++Un)for(var Wr=Un*te-Be,ar=ir;ar<tn;++ar)for(var bt=m*xe+g*or+y*Un+v*ar,mt=x*(I-1-zr)+C*(S-1-Wr)+A*(N-1-(ar*re-rr))+T*Te,xn=0;xn<W;++xn)jr+=d[bt+xn]*w[mt+xn];a[u*xe+l*De+c*We+h*Ze+Te]=jr}return o.toTensor()},e.prototype.conv2dDerFilter=function(t,r,i){Z([t,r],"conv2dDerFilter");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,u=i.filterWidth,l=i.dataFormat==="channelsLast",c=Se(i.filterShape,"float32"),h=i.padInfo.left,d=i.padInfo.top,p=this.bufferSync(t),m=this.bufferSync(r),g=0;g<s;++g)for(var y=Math.max(0,Math.ceil((d-g)/o)),v=Math.min(i.outHeight,(i.inHeight+d-g)/o),w=0;w<u;++w)for(var _=Math.max(0,Math.ceil((h-w)/a)),x=Math.min(i.outWidth,(i.inWidth+h-w)/a),C=0;C<i.inChannels;++C)for(var A=0;A<i.outChannels;++A){for(var T=0,E=0;E<i.batchSize;++E)for(var I=y;I<v;++I)for(var S=g+I*o-d,N=_;N<x;++N){var P=w+N*a-h;T+=l?p.get(E,S,P,C)*m.get(E,I,N,A):p.get(E,C,S,P)*m.get(E,A,I,N)}c.set(T,g,w,C,A)}return c.toTensor()},e.prototype.conv3dDerFilter=function(t,r,i){for(var o=i.strideDepth,a=i.strideHeight,s=i.strideWidth,u=i.filterDepth,l=i.filterHeight,c=i.filterWidth,h=Se(i.filterShape,"float32"),d=h.values,p=h.strides,m=p[0],g=p[1],y=p[2],v=p[3],w=this.readSync(r.dataId),_=r.strides,x=_[0],C=_[1],A=_[2],T=_[3],E=this.readSync(t.dataId),I=t.strides,S=I[0],N=I[1],P=I[2],k=I[3],j=i.padInfo.front,B=i.padInfo.left,W=i.padInfo.top,X=0;X<u;++X)for(var V=Math.max(0,Math.ceil((j-X)/o)),$=Math.min(i.outDepth,(i.inDepth+j-X)/o),G=X*m,te=0;te<l;++te)for(var re=Math.max(0,Math.ceil((W-te)/a)),oe=Math.min(i.outHeight,(i.inHeight+W-te)/a),_e=te*g+G,pe=0;pe<c;++pe)for(var xe=Math.max(0,Math.ceil((B-pe)/s)),Te=Math.min(i.outWidth,(i.inWidth+B-pe)/s),De=pe*y+_e,Fe=0;Fe<i.inChannels;++Fe)for(var Ye=Fe*v+De,Ae=0;Ae<i.outChannels;++Ae){for(var We=0,Be=0;Be<i.batchSize;++Be)for(var Je=Be*S,Xe=Be*x,Ze=V;Ze<$;++Ze)for(var rr=(X+Ze*o-j)*N+Je,ir=Ze*C+Xe,tn=re;tn<oe;++tn)for(var jr=(te+tn*a-W)*P+rr,or=tn*A+ir,zr=xe;zr<Te;++zr){var Un=zr*T+or;We+=E[(pe+zr*s-B)*k+jr+Fe]*w[Un+Ae]}d[Ye+Ae]=We}return h.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var r=t.input,i=t.filter,o=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights,l=this.depthwiseConv2D(r,i,o);return a&&(l=this.add(l,a)),s&&(l=pv(this,l,s,u)),l},e.prototype.depthwiseConv2D=function(t,r,i){Z([t,r],"depthwiseConv2D");for(var o=i.filterHeight,a=i.filterWidth,s=i.dilationHeight,u=i.dilationWidth,l=i.padInfo.left,c=i.padInfo.top,h=i.outChannels/i.inChannels,d=Se(i.outShape,t.dtype),p=this.readSync(t.dataId),m=this.readSync(r.dataId),g=d.values,y=0;y<i.batchSize;++y)for(var v=y*t.strides[0],w=y*d.strides[0],_=0;_<i.outHeight;++_)for(var x=w+_*d.strides[1],C=_*i.strideHeight-l,A=0;A<o;++A){var T=C+A*s;if(!(T<0||T>=i.inHeight))for(var E=A*r.strides[0],I=v+T*t.strides[1],S=0;S<i.outWidth;++S)for(var N=x+S*d.strides[2],P=S*i.strideWidth-c,k=0;k<a;++k){var j=P+k*u;if(!(j<0||j>=i.inWidth))for(var B=E+k*r.strides[1],W=I+j*i.inChannels,X=N,V=B,$=0;$<i.inChannels;++$){for(var G=p[W+$],te=0;te<h;++te)g[X+te]+=G*m[V+te];X+=h,V+=h}}}return d.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,r,i){Z([t,r],"depthwiseConv2DDerInput");for(var o=Se(i.inShape,"float32"),a=o.values,s=o.strides,u=s[0],l=s[1],c=s[2],h=this.readSync(t.dataId),d=t.strides,p=d[0],m=d[1],g=d[2],y=this.readSync(r.dataId),v=r.strides,w=v[0],_=v[1],x=v[2],C=i.batchSize,A=i.filterHeight,T=i.filterWidth,E=i.inChannels,I=i.inHeight,S=i.inWidth,N=i.outChannels,P=i.outHeight,k=i.outWidth,j=i.strideHeight,B=i.strideWidth,W=A-1-i.padInfo.top,X=T-1-i.padInfo.left,V=N/E,$=0;$<C;++$)for(var G=0;G<E;++G)for(var te=0;te<I;++te)for(var re=te-W,oe=Math.max(0,Math.ceil(re/j)),_e=Math.min(P,(A+re)/j),pe=0;pe<S;++pe){for(var xe=pe-X,Te=Math.max(0,Math.ceil(xe/B)),De=Math.min(k,(T+xe)/B),Fe=0,Ye=oe;Ye<_e;++Ye)for(var Ae=Ye*j-re,We=Te;We<De;++We)for(var Be=p*$+m*Ye+g*We,Je=w*(A-1-Ae)+_*(T-1-(We*B-xe))+x*G,Xe=0;Xe<V;++Xe)Fe+=h[Be+(G*V+Xe)]*y[Je+Xe];a[u*$+l*te+c*pe+G]=Fe}return o.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,r,i){Z([t,r],"depthwiseConv2DDerFilter");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,u=i.filterWidth,l=Se(i.filterShape,"float32"),c=i.padInfo.left,h=i.padInfo.top,d=i.outChannels/i.inChannels,p=this.bufferSync(t),m=this.bufferSync(r),g=0;g<s;++g)for(var y=Math.max(0,Math.ceil((h-g)/o)),v=Math.min(i.outHeight,(i.inHeight+h-g)/o),w=0;w<u;++w)for(var _=Math.max(0,Math.ceil((c-w)/a)),x=Math.min(i.outWidth,(i.inWidth+c-w)/a),C=0;C<i.outChannels;++C){for(var A=Math.trunc(C/d),T=C%d,E=0,I=0;I<i.batchSize;++I)for(var S=y;S<v;++S)for(var N=g+S*o-h,P=_;P<x;++P){var k=w+P*a-c;E+=p.get(I,N,k,A)*m.get(I,S,P,C)}l.set(E,g,w,A,T)}return l.toTensor()},e.prototype.tile=function(t,r){return Z(t,"tile"),Ek(this.bufferSync(t),r)},e.prototype.pad=function(t,r,i){Z(t,"pad");var o=r.map(function(d,p){return d[0]+t.shape[p]+d[1]}),a=r.map(function(d){return d[0]}),s=this.bufferSync(t),u=Se(o,t.dtype);i!==0&&u.values.fill(i);for(var l=0;l<t.size;l++){var c=s.indexToLoc(l),h=c.map(function(d,p){return d+a[p]});u.set.apply(u,[s.get.apply(s,c)].concat(h))}return u.toTensor()},e.prototype.transpose=function(t,r){Z(t,"transpose");for(var i=new Array(t.rank),o=0;o<i.length;o++)i[o]=t.shape[r[o]];var a=this.readSync(t.dataId),s=Se(i,t.dtype),u=this.bufferSync(t);for(o=0;o<t.size;++o){for(var l=u.indexToLoc(o),c=new Array(l.length),h=0;h<c.length;h++)c[h]=l[r[h]];var d=s.locToIndex(c);s.values[d]=a[o]}return s.toTensor()},e.prototype.gather=function(t,r,i){Z([t,r],"gather");var o=t.shape.slice(),a=this.readSync(r.dataId);o[i]=a.length;for(var s=Se(o,t.dtype),u=this.bufferSync(t),l=0;l<s.size;++l){var c=s.indexToLoc(l),h=c.slice();h[i]=a[c[i]];var d=u.locToIndex(h);s.values[l]=u.values[d]}return s.toTensor()},e.prototype.batchToSpaceND=function(t,r,i){Z([t],"batchToSpaceND");var o=r.reduce(function(h,d){return h*d}),a=Af(t.shape,r,o),s=Pf(a.length,r.length),u=Nf(t.shape,r,o),l=ck(i,r.length),c=hk(u,i,r.length);return t.reshape(a).transpose(s).reshape(u).slice(l,c)},e.prototype.spaceToBatchND=function(t,r,i){Z([t],"spaceToBatchND");var o=r.reduce(function(d,p){return d*p}),a=[[0,0]];a.push.apply(a,i);for(var s=1+r.length;s<t.shape.length;++s)a.push([0,0]);var u=t.pad(a),l=Af(u.shape,r,o,!1),c=Pf(l.length,r.length,!1),h=Nf(u.shape,r,o,!1);return u.reshape(l).transpose(c).reshape(h)},e.prototype.pool=function(t,r,i){Z(t,"pool");for(var o=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,h=r.padInfo.top,d=r.padInfo.left,p=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=this.readSync(t.dataId),g=Se(r.outShape,t.dtype),y=g.values,v=r.outShape[1]*r.outShape[2]*r.outShape[3],w=r.outShape[2]*r.outShape[3],_=r.outShape[3],x=0;x<r.batchSize;++x)for(var C=x*v,A=x*t.strides[0],T=0;T<r.inChannels;++T)for(var E=0;E<r.outHeight;++E)for(var I=E*o-h,S=Math.max(0,I),N=Math.min(r.inHeight,l+I),P=C+E*w,k=0;k<r.outWidth;++k){for(var j=k*a-d,B=Math.max(0,j),W=Math.min(r.inWidth,c+j),X=p,V=0,$=0,G=S;G<N;G+=s){for(var te=A+G*t.strides[1],re=B;re<W;re+=u){var oe=m[te+re*t.strides[2]+T];i==="max"&&oe>X?X=oe:i==="avg"&&(V+=oe,$++)}if(isNaN(X))break}y[P+k*_+T]=i==="avg"?V/$:X}return g.toTensor()},e.prototype.maxPool=function(t,r){return this.pool(t,r,"max")},e.prototype.maxPoolPositions=function(t,r){for(var i=Se(r.outShape,"int32"),o=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,h=r.padInfo.top,d=r.padInfo.left,p=this.bufferSync(t),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var v=y*o-h,w=v;w<0;)w+=s;for(var _=Math.min(r.inHeight,l+v),x=0;x<r.outWidth;++x){for(var C=x*a-d,A=C;A<0;)A+=u;for(var T=Math.min(r.inWidth,c+C),E=Number.NEGATIVE_INFINITY,I=-1,S=w;S<_;S+=s)for(var N=S-v,P=A;P<T;P+=u){var k=P-C,j=p.get(m,S,P,g);j>E&&(E=j,I=N*c+k)}i.set(I,m,y,x,g)}}return i.toTensor()},e.prototype.maxPoolBackprop=function(t,r,i,o){Z([r,i],"maxPoolBackprop");for(var a=this.maxPoolPositions(r,o),s=o.strideHeight,u=o.strideWidth,l=o.dilationHeight,c=o.dilationWidth,h=o.effectiveFilterHeight,d=o.effectiveFilterWidth,p=d-1-o.padInfo.left,m=h-1-o.padInfo.top,g=Se(r.shape,"float32"),y=this.bufferSync(a),v=this.bufferSync(t),w=0;w<o.batchSize;++w)for(var _=0;_<o.inChannels;++_)for(var x=0;x<o.inHeight;++x)for(var C=0;C<o.inWidth;++C){for(var A=x-m,T=C-p,E=0,I=0;I<h;I+=l){var S=(A+I)/s;if(!(S<0||S>=o.outHeight||Math.floor(S)!==S))for(var N=0;N<d;N+=c){var P=(T+N)/u;if(!(P<0||P>=o.outWidth||Math.floor(P)!==P)){var k=h*d-1-y.get(w,S,P,_)===I*d+N?1:0;k!==0&&(E+=v.get(w,S,P,_)*k)}}}g.set(E,w,x,C,_)}return g.toTensor()},e.prototype.avgPoolBackprop=function(t,r,i){Z([t,r],"avgPoolBackprop");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,u=i.filterWidth,l=i.dilationHeight,c=i.dilationWidth,h=i.effectiveFilterHeight,d=i.effectiveFilterWidth,p=d-1-i.padInfo.left,m=h-1-i.padInfo.top,g=Se(r.shape,"float32"),y=1/(s*u),v=this.bufferSync(t),w=0;w<i.batchSize;++w)for(var _=0;_<i.inChannels;++_)for(var x=0;x<i.inHeight;++x)for(var C=0;C<i.inWidth;++C){for(var A=x-m,T=C-p,E=0,I=0;I<h;I+=l){var S=(A+I)/o;if(!(S<0||S>=i.outHeight||Math.floor(S)!==S))for(var N=0;N<d;N+=c){var P=(T+N)/a;P<0||P>=i.outWidth||Math.floor(P)!==P||(E+=v.get(w,S,P,_))}}g.set(E*y,w,x,C,_)}return g.toTensor()},e.prototype.pool3d=function(t,r,i){Z(t,"pool3d");for(var o=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterDepth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,m=r.padInfo.front,g=r.padInfo.top,y=r.padInfo.left,v=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=this.readSync(t.dataId),_=Se(r.outShape,t.dtype),x=_.values,C=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],A=r.outShape[2]*r.outShape[3]*r.outShape[4],T=r.outShape[3]*r.outShape[4],E=r.outShape[4],I=0;I<r.batchSize;++I)for(var S=I*C,N=I*t.strides[0],P=0;P<r.inChannels;++P)for(var k=0;k<r.outDepth;++k){for(var j=k*o-m,B=j;B<0;)B+=u;for(var W=Math.min(r.inDepth,h+j),X=S+k*A,V=0;V<r.outHeight;++V){for(var $=V*a-g,G=$;G<0;)G+=l;for(var te=Math.min(r.inHeight,d+$),re=X+V*T,oe=0;oe<r.outWidth;++oe){for(var _e=oe*s-y,pe=_e;pe<0;)pe+=c;for(var xe=Math.min(r.inWidth,p+_e),Te=re+oe*E,De=v,Fe=0,Ye=0,Ae=B;Ae<W;Ae+=u){for(var We=N+Ae*t.strides[1],Be=G;Be<te;Be+=l){for(var Je=We+Be*t.strides[2],Xe=pe;Xe<xe;Xe+=c){var Ze=w[Je+Xe*t.strides[3]+P];if(i==="max"&&Ze>De?De=Ze:i==="avg"&&(Fe+=Ze,Ye++),isNaN(De))break}if(isNaN(De))break}if(isNaN(De))break}x[Te+P]=i==="avg"?Fe/Ye:De}}}return _.toTensor()},e.prototype.avgPool3d=function(t,r){return Z(t,"avgPool3d"),this.pool3d(t,r,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,r,i){Z([t,r],"avgPool3dBackprop");for(var o=i.strideDepth,a=i.strideHeight,s=i.strideWidth,u=i.filterDepth,l=i.filterHeight,c=i.filterWidth,h=i.dilationDepth,d=i.dilationHeight,p=i.dilationWidth,m=i.effectiveFilterDepth,g=i.effectiveFilterHeight,y=i.effectiveFilterWidth,v=m-1-i.padInfo.front,w=y-1-i.padInfo.left,_=g-1-i.padInfo.top,x=Se(r.shape,"float32"),C=1/(u*l*c),A=this.bufferSync(t),T=0;T<i.batchSize;++T)for(var E=0;E<i.inChannels;++E)for(var I=0;I<i.inDepth;++I)for(var S=0;S<i.inHeight;++S)for(var N=0;N<i.inWidth;++N){for(var P=I-v,k=S-_,j=N-w,B=0,W=0;W<m;W+=h){var X=(P+W)/o;if(!(X<0||X>=i.outDepth||Math.floor(X)!==X))for(var V=0;V<g;V+=d){var $=(k+V)/a;if(!($<0||$>=i.outHeight||Math.floor($)!==$))for(var G=0;G<y;G+=p){var te=(j+G)/s;te<0||te>=i.outWidth||Math.floor(te)!==te||(B+=A.get(T,X,$,te,E))}}}x.set(B*C,T,I,S,N,E)}return x.toTensor()},e.prototype.maxPool3d=function(t,r){return Z(t,"maxPool3d"),this.pool3d(t,r,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,r){for(var i=Se(r.outShape,"int32"),o=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterDepth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,m=r.padInfo.front,g=r.padInfo.top,y=r.padInfo.left,v=this.bufferSync(t),w=0;w<r.batchSize;++w)for(var _=0;_<r.inChannels;++_)for(var x=0;x<r.outDepth;++x){for(var C=x*o-m,A=C;A<0;)A+=u;for(var T=Math.min(r.inDepth,h+C),E=0;E<r.outHeight;++E){for(var I=E*a-g,S=I;S<0;)S+=l;for(var N=Math.min(r.inHeight,d+I),P=0;P<r.outWidth;++P){for(var k=P*s-y,j=k;j<0;)j+=c;for(var B=Math.min(r.inWidth,p+k),W=Number.NEGATIVE_INFINITY,X=-1,V=A;V<T;V+=u)for(var $=V-C,G=S;G<N;G+=l)for(var te=G-I,re=j;re<B;re+=c){var oe=re-k,_e=v.get(w,V,G,re,_);_e>=W&&(W=_e,X=$*d*p+te*d+oe)}i.set(X,w,x,E,P,_)}}}return i.toTensor()},e.prototype.maxPool3dBackprop=function(t,r,i,o){Z([r,i],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(r,o),s=o.strideDepth,u=o.strideHeight,l=o.strideWidth,c=o.dilationDepth,h=o.dilationHeight,d=o.dilationWidth,p=o.effectiveFilterDepth,m=o.effectiveFilterHeight,g=o.effectiveFilterWidth,y=p-1-o.padInfo.front,v=g-1-o.padInfo.left,w=m-1-o.padInfo.top,_=Se(r.shape,"float32"),x=this.bufferSync(a),C=this.bufferSync(t),A=0;A<o.batchSize;++A)for(var T=0;T<o.inChannels;++T)for(var E=0;E<o.inDepth;++E)for(var I=0;I<o.inHeight;++I)for(var S=0;S<o.inWidth;++S){for(var N=E-y,P=I-w,k=S-v,j=0,B=0;B<p;B+=c){var W=(N+B)/s;if(!(W<0||W>=o.outDepth||Math.floor(W)!==W))for(var X=0;X<m;X+=h){var V=(P+X)/u;if(!(V<0||V>=o.outHeight||Math.floor(V)!==V))for(var $=0;$<g;$+=d){var G=(k+$)/l;if(!(G<0||G>=o.outWidth||Math.floor(G)!==G)){var te=p*m*g-1-x.get(A,W,V,G,T)===B*m*g+X*g+$?1:0;te!==0&&(j+=C.get(A,W,V,G,T)*te)}}}}_.set(j,A,E,I,S,T)}return _.toTensor()},e.prototype.cast=function(t,r){return wk(t,r,this)},e.prototype.reshape=function(t,r){return hy(t,r)},e.prototype.avgPool=function(t,r){return Z(t,"avgPool"),this.pool(t,r,"avg").toFloat()},e.prototype.resizeBilinear=function(t,r,i,o){Z(t,"resizeBilinear");for(var a=t.shape,s=a[0],u=a[1],l=a[2],c=a[3],h=this.readSync(t.dataId),d=new Float32Array(fe([s,r,i,c])),p=[o&&r>1?u-1:u,o&&i>1?l-1:l],m=[o&&r>1?r-1:r,o&&i>1?i-1:i],g=0,y=p[0]/m[0],v=p[1]/m[1],w=0;w<s;w++)for(var _=0;_<r;_++)for(var x=y*_,C=Math.floor(x),A=x-C,T=Math.min(u-1,Math.ceil(x)),E=w*t.strides[0]+C*t.strides[1],I=w*t.strides[0]+T*t.strides[1],S=0;S<i;S++)for(var N=v*S,P=Math.floor(N),k=N-P,j=Math.min(l-1,Math.ceil(N)),B=E+P*t.strides[2],W=I+P*t.strides[2],X=E+j*t.strides[2],V=I+j*t.strides[2],$=0;$<c;$++){var G=h[B+$],te=h[W+$],re=G+(h[X+$]-G)*k,oe=re+(te+(h[V+$]-te)*k-re)*A;d[g++]=oe}return Qt(d,[s,r,i,c])},e.prototype.resizeBilinearBackprop=function(t,r,i){Z([t,r],"resizeBilinearBackprop");for(var o=r.shape,a=o[0],s=o[1],u=o[2],l=o[3],c=t.shape,h=c[1],d=c[2],p=new Float32Array(a*s*u*l),m=[i&&h>1?s-1:s,i&&d>1?u-1:u],g=[i&&h>1?h-1:h,i&&d>1?d-1:d],y=m[0]/g[0],v=m[1]/g[1],w=this.readSync(t.dataId),_=0,x=0;x<a;x++)for(var C=x*r.strides[0],A=0;A<h;A++)for(var T=A*y,E=Math.floor(T),I=Math.min(Math.ceil(T),s-1),S=C+E*r.strides[1],N=C+I*r.strides[1],P=T-E,k=1-P,j=0;j<d;j++)for(var B=j*v,W=Math.floor(B),X=Math.min(Math.ceil(B),u-1),V=B-W,$=1-V,G=S+W*r.strides[2],te=S+X*r.strides[2],re=N+W*r.strides[2],oe=N+X*r.strides[2],_e=k*$,pe=k*V,xe=P*$,Te=P*V,De=0;De<l;De++){var Fe=w[_++];p[G+De]+=Fe*_e,p[te+De]+=Fe*pe,p[re+De]+=Fe*xe,p[oe+De]+=Fe*Te}return An(p,[a,u,s,l],r.dtype)},e.prototype.resizeNearestNeighbor=function(t,r,i,o){Z(t,"resizeNearestNeighbor");for(var a=t.shape,s=a[0],u=a[1],l=a[2],c=a[3],h=this.readSync(t.dataId),d=new Float32Array(s*r*i*c),p=[o&&r>1?u-1:u,o&&i>1?l-1:l],m=[o&&r>1?r-1:r,o&&i>1?i-1:i],g=p[0]/m[0],y=p[1]/m[1],v=0,w=0;w<s;w++)for(var _=w*t.strides[0],x=0;x<r;x++)for(var C=g*x,A=_+Math.min(u-1,o?Math.round(C):Math.floor(C))*t.strides[1],T=0;T<i;T++)for(var E=y*T,I=A+Math.min(l-1,o?Math.round(E):Math.floor(E))*t.strides[2],S=0;S<c;S++){var N=h[I+S];d[v++]=N}return Qt(d,[s,r,i,c],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,r,i){Z([t,r],"resizeNearestNeighborBackprop");for(var o=r.shape,a=o[0],s=o[1],u=o[2],l=o[3],c=t.shape,h=c[1],d=c[2],p=new Float32Array(a*s*u*l),m=this.readSync(t.dataId),g=[i&&h>1?s-1:s,i&&d>1?u-1:u],y=[i&&h>1?h-1:h,i&&d>1?d-1:d],v=g[0]/y[0],w=g[1]/y[1],_=1/v,x=1/w,C=2*Math.ceil(_)+2,A=2*Math.ceil(x)+2,T=0;T<a;T++)for(var E=T*r.strides[0],I=0;I<s;I++)for(var S=E+I*r.strides[1],N=Math.floor(I*_),P=Math.floor(N-C/2),k=0;k<u;k++)for(var j=S+k*r.strides[2],B=Math.floor(k*x),W=Math.floor(B-A/2),X=0;X<l;X++){for(var V=0,$=0;$<C;$++){var G=$+P;if(!(G<0||G>=h)){var te=E+G*t.strides[1],re=G*v;if(I===Math.min(s-1,i?Math.round(re):Math.floor(re)))for(var oe=0;oe<A;oe++){var _e=oe+W;if(!(_e<0||_e>=d)){var pe=te+_e*t.strides[2],xe=_e*w;k===Math.min(u-1,i?Math.round(xe):Math.floor(xe))&&(V+=m[pe+X])}}}}p[j+X]=V}return An(p,r.shape,r.dtype)},e.prototype.batchNormalization=function(t,r,i,o,a,s){Z([t,r,i,a,s],"batchNorm");for(var u=this.readSync(t.dataId),l=this.readSync(r.dataId),c=this.readSync(i.dataId),h=a?this.readSync(a.dataId):new Float32Array([1]),d=s?this.readSync(s.dataId):new Float32Array([0]),p=new Float32Array(u.length),m=d.length,g=h.length,y=c.length,v=l.length,w=0,_=0,x=0,C=0,A=0;A<u.length;++A)p[A]=d[w++]+(u[A]-l[_++])*h[x++]/Math.sqrt(c[C++]+o),w>=m&&(w=0),_>=v&&(_=0),x>=g&&(x=0),C>=y&&(C=0);return An(p,t.shape)},e.prototype.localResponseNormalization4D=function(t,r,i,o,a){Z(t,"localResponseNormalization4D");var s=t.shape[3],u=s-1,l=this.readSync(t.dataId),c=t.size,h=new Float32Array(c);function d(y){for(var v=y%s,w=y-v+Math.max(0,v-r),_=y-v+Math.min(v+r,u),x=0;w<=_;w++){var C=l[w];x+=C*C}return x}for(var p=0;p<c;p++){var m=d(p),g=l[p]*Math.pow(i+o*m,-a);h[p]=g}return An(h,t.shape)},e.prototype.LRNGrad=function(t,r,i,o,a,s,u){Z(t,"LRNGrad");for(var l=t.shape[3],c=this.readSync(t.dataId),h=this.readSync(r.dataId),d=this.readSync(i.dataId),p=new Float32Array(t.size),m=t.size,g=0;g<m;g++){for(var y=g%l,v=g-y+Math.max(0,y-o),w=g-y+Math.min(l,y+o+1),_=0,x=v;x<w;x++)_+=Math.pow(h[x],2);for(_=s*_+a,x=v;x<w;x++){var C=-2*s*u*h[x]*d[g]/_;g===x&&(C+=Math.pow(_,-u)),C*=c[g],p[x]+=C}}return An(p,t.shape)},e.prototype.multinomial=function(t,r,i,o){Z(t,"multinomial");for(var a=r?t:Hi(t),s=a.shape[0],u=a.shape[1],l=it([s,i],"int32"),c=this.readSync(l.dataId),h=this.readSync(a.dataId),d=0;d<s;++d){var p=d*u,m=new Float32Array(u-1);m[0]=h[p];for(var g=1;g<m.length;++g)m[g]=m[g-1]+h[p+g];for(var y=Dp(o.toString()),v=d*i,w=0;w<i;++w){var _=y();c[v+w]=m.length;for(var x=0;x<m.length;x++)if(_<m[x]){c[v+w]=x;break}}}return l},e.prototype.oneHot=function(t,r,i,o){Z(t,"oneHot");var a=new Float32Array(t.size*r);a.fill(o);for(var s=this.readSync(t.dataId),u=0;u<t.size;++u)s[u]>=0&&s[u]<r&&(a[u*r+s[u]]=i);return Oo(a,[t.size,r],"int32")},e.prototype.nonMaxSuppression=function(t,r,i,o,a){return Z(t,"nonMaxSuppression"),E1(this.readSync(t.dataId),this.readSync(r.dataId),i,o,a)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,r){for(var i=t.shape[0],o=t.shape[1],a=Se(t.shape,"float32"),s=Se(t.shape,"float32"),u=dr(t).as2D(i,o),l=Jr(t).as2D(i,o),c=0;c<i;c++)for(var h=u.slice([c,0],[1,o]),d=l.slice([c,0],[1,o]),p=qt(h,d),m=this.readSync(this.fftImpl(p,r).dataId),g=0;g<o;g++){var y=kE(m,g);a.values[c*o+g]=y.real,s.values[c*o+g]=y.imag}return qt(a.toTensor(),s.toTensor()).as2D(i,o)},e.prototype.fftImpl=function(t,r){var i=t.as1D(),o=i.size;if(this.isExponentOf2(o)){var a=this.fftRadix2(i,o,r).as2D(t.shape[0],t.shape[1]);return r&&(a=qt(dr(a).div(ae(o)),Jr(a).div(ae(o)))),a}var s=this.readSync(t.dataId),u=function(l){for(var c=new Float32Array(l.length/2),h=new Float32Array(l.length/2),d=0;d<l.length;d+=2)c[d/2]=l[d],h[d/2]=l[d+1];return{real:c,imag:h}}(this.fourierTransformByMatmul(s,o,r));return qt(u.real,u.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return(t&t-1)==0},e.prototype.fftRadix2=function(t,r,i){if(r===1)return t;var o=this.readSync(t.dataId),a=r/2,s=function(v){for(var w=Math.ceil(v.length/4),_=new Float32Array(w),x=new Float32Array(w),C=0;C<v.length;C+=4)_[Math.floor(C/4)]=v[C],x[Math.floor(C/4)]=v[C+1];return{real:_,imag:x}}(o),u=qt(s.real,s.imag).as1D(),l=function(v){for(var w=Math.floor(v.length/4),_=new Float32Array(w),x=new Float32Array(w),C=2;C<v.length;C+=4)_[Math.floor(C/4)]=v[C],x[Math.floor(C/4)]=v[C+1];return{real:_,imag:x}}(o),c=qt(l.real,l.imag).as1D();u=this.fftRadix2(u,a,i),c=this.fftRadix2(c,a,i);var h=function(v,w){for(var _=new Float32Array(v/2),x=new Float32Array(v/2),C=0;C<Math.ceil(v/2);C++){var A=(w?2:-2)*Math.PI*(C/v);_[C]=Math.cos(A),x[C]=Math.sin(A)}return{real:_,imag:x}}(r,i),d=qt(h.real,h.imag).mul(c),p=u.add(d),m=u.sub(d),g=dr(p).concat(dr(m)),y=Jr(p).concat(Jr(m));return qt(g,y).as1D()},e.prototype.fourierTransformByMatmul=function(t,r,i){for(var o=new Float32Array(2*r),a=0;a<r;a++){for(var s=0,u=0,l=0;l<r;l++){var c=F5(a*l,r,i),h=kE(t,l);s+=h.real*c.real-h.imag*c.imag,u+=h.real*c.imag+h.imag*c.real}i&&(s/=r,u/=r),M5(o,s,u,a)}return o},e.prototype.depthToSpace=function(t,r,i){F(i==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+i}),F(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var o=t.shape[0],a=t.shape[1],s=t.shape[2],u=t.shape[3],l=a*r,c=s*r,h=u/(r*r),d=this.readSync(t.dataId),p=new Float32Array(o*l*c*h),m=0,g=0;g<o;++g)for(var y=0;y<l;++y)for(var v=Math.floor(y/r),w=y%r,_=0;_<c;++_)for(var x=Math.floor(_/r),C=(w*r+_%r)*h,A=0;A<h;++A){var T=A+C+u*(x+s*(v+a*g));p[m++]=d[T]}return An(p,[o,l,c,h])},e.prototype.broadcastedBinaryOp=function(t,r,i,o){var a=Oe(t.shape,r.shape),s=Se(a,i),u=this.readSync(t.dataId),l=this.readSync(r.dataId),c=go(t.shape,a),h=go(r.shape,a),d=s.values;if(c.length+h.length===0)for(var p=0;p<d.length;++p)d[p]=o(u[p%u.length],l[p%l.length]);else{var m=this.bufferSync(t),g=this.bufferSync(r),y=function(v){var w=s.indexToLoc(v),_=w.slice(-t.rank);c.forEach(function(T){return _[T]=0});var x=m.locToIndex(_),C=w.slice(-r.rank);h.forEach(function(T){return C[T]=0});var A=g.locToIndex(C);d[v]=o(u[x],l[A])};for(p=0;p<d.length;++p)y(p)}return s.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,r,i){var o=Oe(t.shape,r.shape),a=Se(o,"float32"),s=Se(o,"float32"),u=this.readSync(t.dataId),l=this.readSync(r.dataId),c=go(t.shape,o),h=go(r.shape,o),d=a.values,p=s.values;if(c.length+h.length===0)for(var m=0;m<d.length;m++){var g=m%u.length,y=m%l.length,v=i(u[2*g],u[2*g+1],l[2*y],l[2*y+1]);d[m]=v.real,p[m]=v.imag}else{var w=this.bufferSync(this.data.get(t.dataId).complexTensors.real),_=this.bufferSync(this.data.get(r.dataId).complexTensors.real),x=function(C){var A=a.indexToLoc(C),T=A.slice(-t.rank);c.forEach(function(P){return T[P]=0});var E=w.locToIndex(T),I=A.slice(-r.rank);h.forEach(function(P){return I[P]=0});var S=_.locToIndex(I),N=i(u[2*E],u[2*E+1],l[2*S],l[2*S+1]);d[C]=N.real,p[C]=N.imag};for(m=0;m<d.length;m++)x(m)}return this.complex(a.toTensor(),s.toTensor())},e.prototype.split=function(t,r,i){return bk(t,r,i)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,r,i,o,a,s){for(var u=t.shape,l=u[0],c=u[1],h=u[2],d=u[3],p=r.shape[0],m=o[0],g=o[1],y=Se([p,m,g,d],"float32"),v=this.readSync(r.dataId),w=this.readSync(i.dataId),_=this.readSync(t.dataId),x=t.strides,C=y.strides,A=0;A<p;A++){var T=4*A,E=v[T],I=v[T+1],S=v[T+2],N=v[T+3],P=w[A];if(!(P>=l))for(var k=m>1?(S-E)*(c-1)/(m-1):0,j=g>1?(N-I)*(h-1)/(g-1):0,B=0;B<m;B++){var W=m>1?E*(c-1)+B*k:.5*(E+S)*(c-1);if(W<0||W>c-1)for(var X=0;X<g;X++)for(var V=0;V<d;V++){var $=V+X*C[2]+B*C[1]+A*C[0];y.values[$]=s}else if(a==="bilinear"){var G=Math.floor(W),te=Math.ceil(W),re=W-G;for(X=0;X<g;X++)if((Ae=g>1?I*(h-1)+X*j:.5*(I+N)*(h-1))<0||Ae>h-1)for(V=0;V<d;V++)$=V+X*C[2]+B*C[1]+A*C[0],y.values[$]=s;else{var oe=Math.floor(Ae),_e=Math.ceil(Ae),pe=Ae-oe;for(V=0;V<d;V++){var xe=_[$=V+oe*x[2]+G*x[1]+P*x[0]],Te=_[$=V+_e*x[2]+G*x[1]+P*x[0]],De=_[$=V+oe*x[2]+te*x[1]+P*x[0]],Fe=xe+(Te-xe)*pe,Ye=De+(_[$=V+_e*x[2]+te*x[1]+P*x[0]]-De)*pe;$=V+X*C[2]+B*C[1]+A*C[0],y.values[$]=Fe+(Ye-Fe)*re}}}else for(X=0;X<g;++X){var Ae;if((Ae=g>1?I*(h-1)+X*j:.5*(I+N)*(h-1))<0||Ae>h-1)for(V=0;V<d;V++)$=V+X*C[2]+B*C[1]+A*C[0],y.values[$]=s;else{var We=Math.round(Ae),Be=Math.round(W);for(V=0;V<d;V++){var Je=V+We*x[2]+Be*x[1]+P*x[0],Xe=V+X*C[2]+B*C[1]+A*C[0];y.values[Xe]=_[Je]}}}}}return y.toTensor()},e.prototype.sparseToDense=function(t,r,i,o){var a=Df(0,t,i),s=a.sliceRank,u=a.numUpdates,l=a.sliceSize,c=a.strides,h=a.outputSize;return this.scatter(t,r,i,h,l,u,s,c,o,!1)},e.prototype.gatherND=function(t,r){var i=r.shape,o=i[i.length-1],a=dk(t,r),s=a[0],u=a[1],l=a[2],c=a[3];if(u===0)return Qt([],s,t.dtype);for(var h=new hc([u,l],t.dtype),d=this.readSync(r.dataId),p=this.readSync(t.dataId),m=0;m<u;m++){for(var g=[],y=0,v=0;v<o;v++){var w=d[m*o+v];y+=w*c[v],g.push(w)}if(y<0||y>=t.size/l)throw new Error("Invalid indices: "+g+" does not index into "+t.shape);for(var _=0;_<l;_++)h.values[m*l+_]=p[y*l+_]}return h.toTensor().reshape(s)},e.prototype.scatterND=function(t,r,i){var o=Df(0,t,i),a=o.sliceRank,s=o.numUpdates,u=o.sliceSize,l=o.strides,c=o.outputSize,h=ae(0);return this.scatter(t,r,i,c,u,s,a,l,h,!0)},e.prototype.fill=function(t,r,i){var o=Ef(i=i||Vc(r),fe(t));return o.fill(r),U.makeTensor(o,t,i,this)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var r=Ef(t.dtype,fe(t.shape));return this.makeOutput(r,t.shape,t.dtype)},e.prototype.linspace=function(t,r,i){return _k(t,r,i)},e.prototype.scatter=function(t,r,i,o,a,s,u,l,c,h){var d=[o/a,a],p=this.readSync(t.dataId),m=this.readSync(r.dataId);if(o===0)return Qt([],i,r.dtype);var g=new hc(d,r.dtype);g.values.fill(this.readSync(c.dataId)[0]);for(var y=0;y<s;y++){for(var v=[],w=0,_=0;_<u;_++){var x=p[y*u+_];v.push(x),w+=x*l[_]}if(w<0||w>=o/a)throw new Error("Invalid indices: "+v+" does not index into "+i);for(var C=0;C<a;C++)h?g.values[w*a+C]+=m[y*a+C]:g.values[w*a+C]=r.rank===0?m[0]:m[y*a+C]}return g.toTensor().reshape(i)},e}(gk);U.registerBackend("cpu",function(){return new n8},1);for(var mv=0,YE=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,i=e,o=i.boxes,a=i.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,h=s.softNmsSigma,d=t;Z(o,"NonMaxSuppressionWithScore");var p=C1(d.data.get(o.dataId).values,d.data.get(a.dataId).values,u,l,c,h);return[p.selectedIndices,p.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,i=t;Z(r,"square");for(var o=i.data.get(r.dataId).values,a=new Float32Array(o.length),s=0;s<o.length;++s){var u=o[s];a[s]=u*u}return{dataId:i.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:pc,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e,i=r.a,o=r.b,a=t;Z([i,o],pc);var s=a.data.get(i.dataId).values,u=a.data.get(o.dataId).values,l=function(d,p,m,g,y,v){var w=Oe(d,p),_=w.length,x=ui(w),C=cc(y,fe(w)),A=d.length,T=p.length,E=ui(d),I=ui(p),S=go(d,w),N=go(p,w);if(S.length+N.length===0)for(var P=0;P<C.length;++P)C[P]=v(m[P%m.length],g[P%g.length]);else{var k=function(j){var B=dj(j,_,x),W=B.slice(-A);S.forEach(function(G){return W[G]=0});var X=_E(W,A,E),V=B.slice(-T);N.forEach(function(G){return V[G]=0});var $=_E(V,T,I);C[j]=v(m[X],g[$])};for(P=0;P<C.length;++P)k(P)}return[C,w]}(i.shape,o.shape,s,u,i.dtype,function(d,p){var m=d-p;return m*m}),c=l[0],h=l[1];return{dataId:a.write(c,h,i.dtype),shape:h,dtype:i.dtype}}}];mv<YE.length;mv++)HR(YE[mv]);var cs,r8=function(n){this.variableNames=["A"];var e=fn(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+t+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},i8=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=fn(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+t+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `};for(var vv=0,JE=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,i=e.pixels,o=r.numChannels,a=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,u=a?[i.videoWidth,i.videoHeight]:[i.width,i.height],l=u[0],c=u[1],h=[c,l],d=[c,l,o];(s||a)&&(cs==null&&(cs=document.createElement("canvas").getContext("2d")),cs.canvas.width=l,cs.canvas.height=c,cs.drawImage(i,0,0,l,c),i=cs.canvas);var p=t.makeTensorInfo(h,"int32");t.texData.get(p.dataId).usage=qn.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(p.dataId),i);var m=Y().getBool("WEBGL_PACK")?new i8(d):new r8(d),g=t.runWebGLProgram(m,[p],"int32");return t.disposeData(p.dataId),g}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs;Sf("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=e,o=i.boxes,a=i.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,h=s.softNmsSigma,d=t,p=C1(d.readSync(o.dataId),d.readSync(a.dataId),u,l,c,h);return[p.selectedIndices,p.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,i=t,o=new ke(r.shape,"return x * x;");return i.runWebGLProgram(o,[r],r.dtype)}},{kernelName:pc,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e,i=r.a,o=r.b,a=t,s=Y().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _i("return (a - b) * (a - b);",i.shape,o.shape):new gt("return (a - b) * (a - b);",i.shape,o.shape);return a.compileAndRun(s,[i,o])}}];vv<JE.length;vv++)HR(JE[vv]);for(var gv=0,ZE=[{kernelName:"Square",gradFunc:function(n,e){var t=e[0];return{x:function(){return n.mul(t.toFloat().mul(2))}}}},{kernelName:pc,gradFunc:function(n,e){var t=e[0],r=e[1],i=ae(2);return{a:function(){return vn(n,vn(i,Ft(t,r)))},b:function(){return vn(n,vn(i,Ft(r,t)))}}}}];gv<ZE.length;gv++)tj(ZE[gv]);var o8=function(){function n(){}return n.prototype.fetch=function(e,t){return fetch(e,t)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},n}();Y().get("IS_BROWSER")&&Y().setPlatform("browser",new o8);var yv,a8=function(){return require("node-fetch")},s8=function(){function n(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(e,t){return Y().global.fetch!=null?Y().global.fetch(e,t):(yv==null&&(yv=a8()),yv(e,t))},n.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},n}();Y().get("IS_NODE")&&Y().setPlatform("node",new s8);var py={float32:4,int32:4,uint16:2,uint8:1,bool:1},Uf=4;function pA(n,e){for(var t={},r=0,i=function(s){var u=s.name,l=s.dtype,c=s.shape,h=fe(c),d=void 0;if("quantization"in s){var p=s.quantization;if(p.dtype!=="uint8"&&p.dtype!=="uint16")throw new Error("Weight "+s.name+" has unknown quantization dtype "+p.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var m=py[p.dtype],g=n.slice(r,r+h*m),y=p.dtype==="uint8"?new Uint8Array(g):new Uint16Array(g);if(l==="float32")d=Float32Array.from(y,function(A){return A*p.scale+p.min});else{if(l!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+l);d=Int32Array.from(y,function(A){return Math.round(A*p.scale+p.min)})}r+=h*m}else if(l==="string"){var v=fe(s.shape);d=[];for(var w=0;w<v;w++){var _=new Uint32Array(n.slice(r,r+Uf))[0];r+=Uf;var x=new Uint8Array(n.slice(r,r+_));d.push(x),r+=_}}else{var C=py[l];if(g=n.slice(r,r+h*C),l==="float32")d=new Float32Array(g);else if(l==="int32")d=new Int32Array(g);else{if(l!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+l);d=new Uint8Array(g)}r+=h*C}t[u]=Qt(d,c,l)},o=0,a=e;o<a.length;o++)i(a[o]);return t}function u8(n){if(n===null)throw new Error("Invalid input value: "+JSON.stringify(n));var e=0,t=[];n.forEach(function(o){if(e+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+o.constructor.name)});var r=new Uint8Array(e),i=0;return t.forEach(function(o){r.set(new Uint8Array(o.buffer),i),i+=o.byteLength}),r.buffer}var my=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function e2(n){return my?Buffer.byteLength(n):new Blob([n]).size}function W1(n){var e=0;n.forEach(function(i){e+=i.byteLength});var t=new Uint8Array(e),r=0;return n.forEach(function(i){t.set(new Uint8Array(i),r),r+=i.byteLength}),t.buffer}function t2(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);var e=n.split("/");return e[e.length-1]}function Hc(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:e2(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:e2(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}var Kn=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var i=[];return(t==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach(function(o){var a=o(e,r);a!==null&&i.push(a)}),i},n}(),qs="://",Mo=function(){function n(){this.managers={}}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerManager=function(e,t){F(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(qs)&&(e=e.slice(0,e.indexOf(qs))),F(e.length>0,function(){return"scheme must not be an empty string."});var r=n.getInstance();F(r.managers[e]==null,function(){return"A model store manager is already registered for scheme '"+e+"'."}),r.managers[e]=t},n.getManager=function(e){var t=this.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n}();function gd(n){if(n.indexOf(qs)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Mo.getSchemes().join(","));return{scheme:n.split(qs)[0],path:n.split(qs)[1]}}function n2(n,e,t){return t===void 0&&(t=!1),ce(this,void 0,void 0,function(){var r,i,o,a,s,u,l,c,h;return he(this,function(d){switch(d.label){case 0:return F(n!==e,function(){return"Old path and new path are the same: '"+n+"'"}),F((r=Kn.getLoadHandlers(n)).length>0,function(){return"Copying failed because no load handler is found for source URL "+n+"."}),F(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+n+"."}),i=r[0],F((o=Kn.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),F(o.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."}),a=o[0],s=gd(n).scheme,u=gd(n).path,l=s===gd(n).scheme,[4,i.load()];case 1:return c=d.sent(),t&&l?[4,Mo.getManager(s).removeModel(u)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[4,a.save(c)];case 4:return h=d.sent(),!t||l?[3,6]:[4,Mo.getManager(s).removeModel(u)];case 5:d.sent(),d.label=6;case 6:return[2,h.modelArtifactsInfo]}})})}var xa="models_store",yo="model_info_store";function mA(){if(!Y().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window||self,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function vy(n){var e=n.result;e.createObjectStore(xa,{keyPath:"modelPath"}),e.createObjectStore(yo,{keyPath:"modelPath"})}var Ks=function(){function n(e){if(this.indexedDB=mA(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return ce(this,void 0,void 0,function(){return he(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},n.prototype.load=function(){return ce(this,void 0,void 0,function(){return he(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(e,t){var r=this;return new Promise(function(i,o){var a=r.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return vy(a)},a.onsuccess=function(){var s=a.result;if(t==null){var u=s.transaction(xa,"readonly"),l=u.objectStore(xa).get(r.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),o(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));i(l.result.modelArtifacts)},l.onerror=function(g){return s.close(),o(l.error)},u.oncomplete=function(){return s.close()}}else{var c,h=Hc(t),d=s.transaction(yo,"readwrite"),p=d.objectStore(yo),m=p.put({modelPath:r.modelPath,modelArtifactsInfo:h});m.onsuccess=function(){var g=(c=s.transaction(xa,"readwrite")).objectStore(xa).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:h});g.onsuccess=function(){return i({modelArtifactsInfo:h})},g.onerror=function(y){var v=(p=d.objectStore(yo)).delete(r.modelPath);v.onsuccess=function(){return s.close(),o(g.error)},v.onerror=function(w){return s.close(),o(g.error)}}},m.onerror=function(g){return s.close(),o(m.error)},d.oncomplete=function(){c==null?s.close():c.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return o(a.error)}})},n.URL_SCHEME="indexeddb://",n}(),r2=function(n){return Y().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Ks.URL_SCHEME)?(e=n.slice(Ks.URL_SCHEME.length),new Ks(e)):null;var e};Kn.registerSaveRouter(r2),Kn.registerLoadRouter(r2);var l8=function(){function n(){this.indexedDB=mA()}return n.prototype.listModels=function(){return ce(this,void 0,void 0,function(){var e=this;return he(this,function(t){return[2,new Promise(function(r,i){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return vy(o)},o.onsuccess=function(){var a=o.result,s=a.transaction(yo,"readonly"),u=s.objectStore(yo).getAll();u.onsuccess=function(){for(var l={},c=0,h=u.result;c<h.length;c++){var d=h[c];l[d.modelPath]=d.modelArtifactsInfo}r(l)},u.onerror=function(l){return a.close(),i(u.error)},s.oncomplete=function(){return a.close()}},o.onerror=function(a){return i(o.error)}})]})})},n.prototype.removeModel=function(e){return ce(this,void 0,void 0,function(){var t=this;return he(this,function(r){var i;return e=(i=e).startsWith(Ks.URL_SCHEME)?i.slice(Ks.URL_SCHEME.length):i,[2,new Promise(function(o,a){var s=t.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return vy(s)},s.onsuccess=function(){var u,l=s.result,c=l.transaction(yo,"readwrite"),h=c.objectStore(yo),d=h.get(e);d.onsuccess=function(){if(d.result==null)return l.close(),a(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var p=h.delete(e),m=function(){var g=(u=l.transaction(xa,"readwrite")).objectStore(xa).delete(e);g.onsuccess=function(){return o(d.result.modelArtifactsInfo)},g.onerror=function(y){return a(d.error)}};p.onsuccess=m,p.onerror=function(g){return m(),l.close(),a(d.error)}},d.onerror=function(p){return l.close(),a(d.error)},c.oncomplete=function(){u==null?l.close():u.oncomplete=function(){return l.close()}}},s.onerror=function(u){return a(s.error)}})]})})},n}();if(Y().getBool("IS_BROWSER"))try{Mo.registerManager(Ks.URL_SCHEME,new l8)}catch{}var Ei="/",_s="tensorflowjs_models",vA="info",c8="model_topology",h8="weight_specs",d8="weight_data",f8="model_metadata";function gA(n){return{info:[_s,n,vA].join(Ei),topology:[_s,n,c8].join(Ei),weightSpecs:[_s,n,h8].join(Ei),weightData:[_s,n,d8].join(Ei),modelMetadata:[_s,n,f8].join(Ei)}}function p8(n){var e=n.split(Ei);if(e.length<3)throw new Error("Invalid key format: "+n);return e.slice(1,e.length-1).join(Ei)}var Xs=function(){function n(e){if(!Y().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=gA(this.modelPath)}return n.prototype.save=function(e){return ce(this,void 0,void 0,function(){var t,r,i;return he(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),i=Hc(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(a){if(my)return Buffer.from(a).toString("base64");for(var s=new Uint8Array(a),u="",l=0,c=s.length;l<c;l++)u+=String.fromCharCode(s[l]);return btoa(u)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}return[2]})})},n.prototype.load=function(){return ce(this,void 0,void 0,function(){var e,t,r,i,o,a,s;return he(this,function(u){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=i,(o=this.LS.getItem(this.keys.modelMetadata))!=null&&(a=JSON.parse(o),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,t.userDefinedMetadata=a.userDefinedMetadata),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(l){if(my){var c=Buffer.from(l,"base64");return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}for(var h=atob(l),d=new Uint8Array(h.length),p=0;p<h.length;++p)d.set([h.charCodeAt(p)],p);return d.buffer}(s),[2,t]})})},n.URL_SCHEME="localstorage://",n}(),i2=function(n){return Y().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Xs.URL_SCHEME)?(e=n.slice(Xs.URL_SCHEME.length),new Xs(e)):null;var e};Kn.registerSaveRouter(i2),Kn.registerLoadRouter(i2);var m8=function(){function n(){F(Y().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),F(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return n.prototype.listModels=function(){return ce(this,void 0,void 0,function(){var e,t,r,i,o,a;return he(this,function(s){for(e={},t=_s+Ei,r=Ei+vA,i=0;i<this.LS.length;++i)(o=this.LS.key(i)).startsWith(t)&&o.endsWith(r)&&(a=p8(o),e[a]=JSON.parse(this.LS.getItem(o)));return[2,e]})})},n.prototype.removeModel=function(e){return ce(this,void 0,void 0,function(){var t,r;return he(this,function(i){var o;if(e=(o=e).startsWith(Xs.URL_SCHEME)?o.slice(Xs.URL_SCHEME.length):o,t=gA(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]})})},n}();if(Y().getBool("IS_BROWSER"))try{Mo.registerManager(Xs.URL_SCHEME,new m8)}catch{}var v8="model",g8=".json",y8=".weights.bin";function o2(n){return new Promise(function(e){return setTimeout(e)}).then(n)}var wv=function(){function n(e){if(!Y().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),e!=null&&e.length!==0||(e=v8),this.modelTopologyFileName=e+g8,this.weightDataFileName=e+y8}return n.prototype.save=function(e){return ce(this,void 0,void 0,function(){var t,r,i,o,a,s;return he(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=o,[4,o2(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=t,[4,o2(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:Hc(e)}]}})})},n.URL_SCHEME="downloads://",n}(),w8=function(){function n(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return n.prototype.load=function(){return ce(this,void 0,void 0,function(){var e,t,r=this;return he(this,function(i){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(o,a){var s=new FileReader;s.onload=function(u){var l=JSON.parse(u.target.result),c=l.modelTopology;if(c!=null){t.length===0&&o({modelTopology:c});var h=l.weightsManifest;if(h!=null){var d;try{d=r.checkManifestAndWeightFiles(h,t)}catch(y){return void a(y)}var p=[],m=[],g=[];h.forEach(function(y){y.paths.forEach(function(v){m.push(v),g.push(null)}),p.push.apply(p,y.weights)}),h.forEach(function(y){y.paths.forEach(function(v){var w=new FileReader;w.onload=function(_){var x=_.target.result,C=m.indexOf(v);g[C]=x,g.indexOf(null)===-1&&o({modelTopology:c,weightSpecs:p,weightData:W1(g),format:l.format,generatedBy:l.generatedBy,convertedBy:l.convertedBy,userDefinedMetadata:l.userDefinedMetadata})},w.onerror=function(_){return a("Failed to weights data from file of path '"+v+"'.")},w.readAsArrayBuffer(d[v])})})}else a(new Error("weightManifest field is missing from file "+e.name))}else a(new Error("modelTopology field is missing from file "+e.name))},s.onerror=function(u){return a("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(e)})]})})},n.prototype.checkManifestAndWeightFiles=function(e,t){for(var r=[],i=t.map(function(u){return t2(u.name)}),o={},a=0,s=e;a<s.length;a++)s[a].paths.forEach(function(u){var l=t2(u);if(r.indexOf(l)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+l+"'");if(r.push(l),i.indexOf(l)===-1)throw new Error("Weight file with basename '"+l+"' is not provided.");o[u]=t[i.indexOf(l)]});if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+t.length+").");return o},n}();function a2(n,e,t,r){(function(o){F(o!=null&&Array.isArray(o)&&o.length>0,function(){return"promises must be a none empty array"})})(n),function(o,a){F(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o}),F(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a}),F(a>=o,function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+a})}(t=t??0,r=r??1);var i=0;return Promise.all(n.map(function(o){return o.then(function(a){var s=t+ ++i/n.length*(r-t);return e(s),a}),o}))}function yA(n,e){return ce(this,void 0,void 0,function(){var t,r,i,o,a,s,u,l,c;return he(this,function(h){switch(h.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?Y().platform.fetch:e.fetchFunc,r=n.map(function(d){return t(d,e.requestInit,{isBinary:!0})}),i=0,o=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return a=h.sent(),[3,4];case 2:return[4,a2(r,e.onProgress,i,o)];case 3:a=h.sent(),h.label=4;case 4:return s=a.map(function(d){return d.arrayBuffer()}),u=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return c=h.sent(),[3,8];case 6:return[4,a2(s,e.onProgress,u,l)];case 7:c=h.sent(),h.label=8;case 8:return[2,c]}})})}function s2(n){var e=this;return function(t,r,i){return r===void 0&&(r=""),ce(e,void 0,void 0,function(){var o,a,s,u,l,c,h,d,p,m;return he(this,function(g){switch(g.label){case 0:if(o=t.map(function(){return!1}),a={},s=i!=null?i.map(function(){return!1}):[],u=[],t.forEach(function(y,v){var w=0;y.weights.forEach(function(_){var x="quantization"in _?_.quantization.dtype:_.dtype,C=py[x]*fe(_.shape),A=function(){o[v]=!0,a[v]==null&&(a[v]=[]),a[v].push({manifestEntry:_,groupOffset:w,sizeBytes:C})};i!=null?i.forEach(function(T,E){T===_.name&&(A(),s[E]=!0)}):A(),u.push(_.name),w+=C})}),!s.every(function(y){return y}))throw l=i.filter(function(y,v){return!s[v]}),new Error("Could not find weights in manifest with names: "+l.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return c=o.reduce(function(y,v,w){return v&&y.push(w),y},[]),h=[],c.forEach(function(y){t[y].paths.forEach(function(v){var w=r+(r.endsWith("/")?"":"/")+v;h.push(w)})}),[4,n(h)];case 1:return d=g.sent(),p={},m=0,c.forEach(function(y){for(var v=t[y].paths.length,w=0,_=0;_<v;_++)w+=d[m+_].byteLength;for(var x=new ArrayBuffer(w),C=new Uint8Array(x),A=0,T=0;T<v;T++){var E=new Uint8Array(d[m+T]);C.set(E,A),A+=E.byteLength}a[y].forEach(function(I){var S=pA(x.slice(I.groupOffset,I.groupOffset+I.sizeBytes),[I.manifestEntry]);for(var N in S)p[N]=S[N]}),m+=v}),[2,p]}})})}}Kn.registerSaveRouter(function(n){return Y().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(wv.URL_SCHEME)?function(e){return e===void 0&&(e="model"),new wv(e)}(n.slice(wv.URL_SCHEME.length)):null});var wA=function(){function n(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(F(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=Y().platform.fetch,F(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&F(e.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return ce(this,void 0,void 0,function(){var t,r,i,o;return he(this,function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:r},t.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=a.sent()).ok)return[2,{modelArtifactsInfo:Hc(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},n.prototype.load=function(){return ce(this,void 0,void 0,function(){var e,t,r,i,o,a,s,u,l,c,h,d;return he(this,function(p){switch(p.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=p.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");p.label=2;case 2:return p.trys.push([2,4,,5]),[4,e.json()];case 3:return t=p.sent(),[3,5];case 4:throw p.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(i=t.modelTopology,o=t.weightsManifest,a=t.generatedBy,s=t.convertedBy,u=t.format,l=t.userDefinedMetadata,i==null&&o==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return o==null?[3,7]:[4,this.loadWeights(o)];case 6:d=p.sent(),c=d[0],h=d[1],p.label=7;case 7:return[2,{modelTopology:i,weightSpecs:c,weightData:h,userDefinedMetadata:l,generatedBy:a,convertedBy:s,format:u}]}})})},n.prototype.loadWeights=function(e){return ce(this,void 0,void 0,function(){var t,r,i,o,a,s,u,l,c,h,d;return he(this,function(p){switch(p.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,r=function(m){var g=m.lastIndexOf("/"),y=m.lastIndexOf("?"),v=m.substring(0,g),w=y>g?m.substring(y):"";return[v+"/",w]}(t),i=r[0],o=r[1],a=this.weightPathPrefix||i,s=[],u=0,l=e;u<l.length;u++)c=l[u],s.push.apply(s,c.weights);return h=[],e.forEach(function(m){m.paths.forEach(function(g){h.push(a+g+o)})}),[4,yA(h,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return d=p.sent(),[2,[s,W1(d)]]}})})},n.URL_SCHEME_REGEX=/^https?:\/\//,n}();function gy(n){return n.match(wA.URL_SCHEME_REGEX)!=null}var u2=function(n,e){return typeof fetch>"u"?null:(Array.isArray(n)?n.every(function(t){return gy(t)}):gy(n))?yy(n,{onProgress:e}):null};function yy(n,e){return new wA(n,e)}Kn.registerSaveRouter(u2),Kn.registerLoadRouter(u2);var _v=function(){function n(e){this.modelArtifacts=e}return n.prototype.load=function(){return ce(this,void 0,void 0,function(){return he(this,function(e){return[2,this.modelArtifacts]})})},n}(),_8=function(){function n(e){this.saveHandler=e}return n.prototype.save=function(e){return ce(this,void 0,void 0,function(){return he(this,function(t){return[2,this.saveHandler(e)]})})},n}(),_A=Object.freeze({browserFiles:function(n){return new w8(n)},browserHTTPRequest:function(n,e){return yy(n,e)},concatenateArrayBuffers:W1,decodeWeights:pA,encodeWeights:function(n,e){return ce(this,void 0,void 0,function(){var t,r,i,o,a,s=this;return he(this,function(u){switch(u.label){case 0:for(t=[],r=[],i=Array.isArray(n)?n.map(function(l){return l.name}):Object.keys(n),o=function(l){var c=i[l],h=Array.isArray(n)?n[l].tensor:n[c];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string")throw new Error("Unsupported dtype in weight '"+c+"': "+h.dtype);var d={name:c,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var p=new Promise(function(m){return ce(s,void 0,void 0,function(){var g,y,v,w,_,x,C;return he(this,function(A){switch(A.label){case 0:return[4,h.bytes()];case 1:for(g=A.sent(),y=g.reduce(function(T,E){return T+E.length},0)+Uf*g.length,v=new Uint8Array(y),w=0,_=0;_<g.length;_++)x=g[_],C=new Uint8Array(new Uint32Array([x.length]).buffer),v.set(C,w),w+=Uf,v.set(x,w),w+=x.length;return m(v),[2]}})})});r.push(p)}else r.push(h.data());e!=null&&(d.group=e),t.push(d)},a=0;a<i.length;++a)o(a);return[4,Promise.all(r)];case 1:return[2,{data:u8(u.sent()),specs:t}]}})})},fromMemory:function(n,e,t,r){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new _v(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new _v({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new _v({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:r}))},getLoadHandlers:function(n,e){return Kn.getLoadHandlers(n,e)},getModelArtifactsInfoForJSON:Hc,getSaveHandlers:function(n){return Kn.getSaveHandlers(n)},http:yy,isHTTPScheme:gy,loadWeights:function(n,e,t,r){return e===void 0&&(e=""),ce(this,void 0,void 0,function(){return he(this,function(i){return[2,s2(function(o){return yA(o,{requestInit:r})})(n,e,t)]})})},registerLoadRouter:function(n){return Kn.registerLoadRouter(n)},registerSaveRouter:function(n){return Kn.registerSaveRouter(n)},weightsLoaderFactory:s2,withSaveHandler:function(n){return new _8(n)},copyModel:function(n,e){return ce(this,void 0,void 0,function(){return he(this,function(t){return[2,n2(n,e,!1)]})})},listModels:function(){return ce(this,void 0,void 0,function(){var n,e,t,r,i,o,a;return he(this,function(s){switch(s.label){case 0:n=Mo.getSchemes(),e={},t=0,r=n,s.label=1;case 1:return t<r.length?(i=r[t],[4,Mo.getManager(i).listModels()]):[3,4];case 2:for(a in o=s.sent())e[i+qs+a]=o[a];s.label=3;case 3:return t++,[3,1];case 4:return[2,e]}})})},moveModel:function(n,e){return ce(this,void 0,void 0,function(){return he(this,function(t){return[2,n2(n,e,!0)]})})},removeModel:function(n){return ce(this,void 0,void 0,function(){var e;return he(this,function(t){return e=gd(n),[2,Mo.getManager(e.scheme).removeModel(e.path)]})})}}),hs;L({confusionMatrix_:function(n,e,t){var r=M(n,"labels","confusionMatrix"),i=M(e,"predictions","confusionMatrix");F(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),F(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),F(i.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),F(r.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),F(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+t});var o=ly(r.asType("int32"),t),a=ly(i.asType("int32"),t);return o.transpose().matMul(a).asType("int32")}});var x8=L({fromPixels_:function(n,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,r=!1,i=!1,o=!1,a=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)o=!0;else{if(n.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+n.constructor.name);a=!0}if(i&&i&&n.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if($R("FromPixels",U.backendName)!=null)return U.runKernel("FromPixels",{pixels:n},{numChannels:e});var s,u,l=i?[n.videoWidth,n.videoHeight]:[n.width,n.height],c=l[0],h=l[1];if(a?s=n.getContext("2d").getImageData(0,0,c,h).data:r||t?s=n.data:(o||i)&&(hs==null&&(hs=document.createElement("canvas").getContext("2d")),hs.canvas.width=c,hs.canvas.height=h,hs.drawImage(n,0,0,c,h),s=hs.getImageData(0,0,c,h).data),e===4)u=new Int32Array(s);else{var d=c*h;u=new Int32Array(d*e);for(var p=0;p<d;p++)for(var m=0;m<e;++m)u[p*e+m]=s[4*p+m]}return y1(u,[h,c,e],"int32")}}),$1=Object.freeze({toPixels:function(n,e){return ce(this,void 0,void 0,function(){var t,r,i,o,a,s,u,l,c,h,d,p,m,g,y,v,w,_,x,C,A,T,E;return he(this,function(I){switch(I.label){case 0:if(t=M(n,"img","toPixels"),n instanceof lt||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(r=t.shape.slice(0,2),i=r[0],o=r[1],(a=t.rank===2?1:t.shape[2])>4||a===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,t.data()];case 1:return s=I.sent(),u=t.min(),l=t.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=I.sent(),h=c[0],d=c[1],p=h[0],m=d[0],u.dispose(),l.dispose(),t.dtype==="float32"){if(p<0||m>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+p+" - "+m+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(p<0||m>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+p+" - "+m+"].")}for(g=t.dtype==="float32"?255:1,y=new Uint8ClampedArray(o*i*4),v=0;v<i*o;++v)w=void 0,_=void 0,x=void 0,C=void 0,a===1?(w=s[v]*g,_=s[v]*g,x=s[v]*g,C=255):a===3?(w=s[3*v]*g,_=s[3*v+1]*g,x=s[3*v+2]*g,C=255):a===4&&(w=s[4*v]*g,_=s[4*v+1]*g,x=s[4*v+2]*g,C=s[4*v+3]*g),y[(A=4*v)+0]=Math.round(w),y[A+1]=Math.round(_),y[A+2]=Math.round(x),y[A+3]=Math.round(C);return e!=null&&(e.width=o,e.height=i,T=e.getContext("2d"),E=new ImageData(y,o,i),T.putImageData(E,0,0)),t!==n&&t.dispose(),[2,y]}})})},fromPixels:x8}),b8=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n}(),E8=function(){function n(){this.classNameMap={}}return n.getMap=function(){return n.instance==null&&(n.instance=new n),n.instance},n.register=function(e){n.getMap().classNameMap[e.className]=[e,e.fromConfig]},n}();function Za(n){F(n.className!=null,function(){return"Class being registered does not have the static className property defined."}),F(typeof n.className=="string",function(){return"className is required to be a string, but got type "+typeof n.className}),F(n.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),E8.register(n)}var es=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return Br(e,n),e.prototype.minimize=function(t,r,i){r===void 0&&(r=!1);var o=this.computeGradients(t,i),a=o.value,s=o.grads;if(i!=null){var u=i.map(function(l){return{name:l.name,tensor:s[l.name]}});this.applyGradients(u)}else this.applyGradients(s);return Fn(s),r?a:(a.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return D5(t,r)},e.prototype.dispose=function(){this.iterations_!=null&&Fn(this.iterations_)},e.prototype.saveIterations=function(){return ce(this,void 0,void 0,function(){return he(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:ae(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return ce(this,void 0,void 0,function(){return he(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return ce(this,void 0,void 0,function(){return he(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return ce(this,void 0,void 0,function(){var r;return he(this,function(i){switch(i.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=i.sent()[0],[2,t.slice(1)]}})})},e}(b8);Object.defineProperty(es,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});var C8=function(n){function e(t,r,i){i===void 0&&(i=null);var o=n.call(this)||this;return o.learningRate=t,o.rho=r,o.epsilon=i,o.accumulatedGrads=[],o.accumulatedUpdates=[],i==null&&(o.epsilon=U.backend.epsilon()),o}return Br(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=U.registeredVariables[i];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:ue(function(){return je(a).variable(!1)})}),r.accumulatedUpdates[o]==null&&(r.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:ue(function(){return je(a).variable(!1)})});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=r.accumulatedGrads[o].variable,l=r.accumulatedUpdates[o].variable;ue(function(){var c=u.mul(r.rho).add(s.square().mul(1-r.rho)),h=l.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(s),d=l.mul(r.rho).add(h.square().mul(1-r.rho));u.assign(c),l.assign(d);var p=h.mul(-r.learningRate).add(a);a.assign(p)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Fn(this.accumulatedGrads.map(function(t){return t.variable})),Fn(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return ce(this,void 0,void 0,function(){var t;return he(this,function(r){switch(r.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return ce(this,void 0,void 0,function(){var r;return he(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=t.length/2,this.accumulatedGrads=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e.className="Adadelta",e}(es);Za(C8);var I8=function(n){function e(t,r){r===void 0&&(r=.1);var i=n.call(this)||this;return i.learningRate=t,i.initialAccumulatorValue=r,i.accumulatedGrads=[],i}return Br(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=U.registeredVariables[i];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:i+"/accumulator",variable:ue(function(){return li(a.shape,r.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=r.accumulatedGrads[o].variable;ue(function(){var l=u.add(s.square());u.assign(l);var c=s.div(l.add(U.backend.epsilon()).sqrt()).mul(-r.learningRate).add(a);a.assign(c)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&Fn(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return ce(this,void 0,void 0,function(){return he(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return ce(this,void 0,void 0,function(){return he(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e.className="Adagrad",e}(es);Za(I8);var T8=function(n){function e(t,r,i,o){o===void 0&&(o=null);var a=n.call(this)||this;return a.learningRate=t,a.beta1=r,a.beta2=i,a.epsilon=o,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],ue(function(){a.accBeta1=ae(r).variable(),a.accBeta2=ae(i).variable()}),o==null&&(a.epsilon=U.backend.epsilon()),a}return Br(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t);ue(function(){var o=Ft(1,r.accBeta1),a=Ft(1,r.accBeta2);i.forEach(function(s,u){var l=U.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:ue(function(){return je(l).variable(!1)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:s+"/v",variable:ue(function(){return je(l).variable(!1)})});var c=Array.isArray(t)?t[u].tensor:t[s];if(c!=null){var h=r.accumulatedFirstMoment[u].variable,d=r.accumulatedSecondMoment[u].variable,p=h.mul(r.beta1).add(c.mul(1-r.beta1)),m=d.mul(r.beta2).add(c.square().mul(1-r.beta2)),g=p.div(o),y=m.div(a);h.assign(p),d.assign(m);var v=g.div(y.sqrt().add(r.epsilon)).mul(-r.learningRate).add(l);l.assign(v)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Fn(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&Fn(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return ce(this,void 0,void 0,function(){var t;return he(this,function(r){switch(r.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return ce(this,void 0,void 0,function(){var r,i=this;return he(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),ue(function(){i.accBeta1.assign(Vf(i.beta1,i.iterations_+1)),i.accBeta2.assign(Vf(i.beta2,i.iterations_+1))}),r=t.length/2,this.accumulatedFirstMoment=t.slice(0,r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(r,2*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e.className="Adam",e}(es);Za(T8);var S8=function(n){function e(t,r,i,o,a){o===void 0&&(o=null),a===void 0&&(a=0);var s=n.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=i,s.epsilon=o,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],ue(function(){s.iteration=ae(0).variable(),s.accBeta1=ae(r).variable()}),o==null&&(s.epsilon=U.backend.epsilon()),s}return Br(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t);ue(function(){var o=Ft(1,r.accBeta1),a=Tr(-r.learningRate,r.iteration.mul(r.decay).add(1));i.forEach(function(s,u){var l=U.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:je(l).variable(!1)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:je(l).variable(!1)});var c=Array.isArray(t)?t[u].tensor:t[s];if(c!=null){var h=r.accumulatedFirstMoment[u].variable,d=r.accumulatedWeightedInfNorm[u].variable,p=h.mul(r.beta1).add(c.mul(1-r.beta1)),m=d.mul(r.beta2),g=c.abs(),y=m.maximum(g);h.assign(p),d.assign(y);var v=a.div(o).mul(p.div(y.add(r.epsilon))).add(l);l.assign(v)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Fn(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&Fn(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return ce(this,void 0,void 0,function(){return he(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return ce(this,void 0,void 0,function(){return he(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e.className="Adamax",e}(es);Za(S8);var xA=function(n){function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return Br(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=Array.isArray(t)?t[o].tensor:t[i];if(a!=null){var s=U.registeredVariables[i];ue(function(){var u=r.c.mul(a).add(s);s.assign(u)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=qj(ae(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return ce(this,void 0,void 0,function(){return he(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return ce(this,void 0,void 0,function(){return he(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e.className="SGD",e}(es);Za(xA);var R8=function(n){function e(t,r,i){i===void 0&&(i=!1);var o=n.call(this,t)||this;return o.learningRate=t,o.momentum=r,o.useNesterov=i,o.accumulations=[],o.m=ae(o.momentum),o}return Br(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=U.registeredVariables[i];r.accumulations[o]==null&&(r.accumulations[o]={originalName:i+"/momentum",variable:ue(function(){return je(a).variable(!1)})});var s=r.accumulations[o].variable,u=Array.isArray(t)?t[o].tensor:t[i];u!=null&&ue(function(){var l,c=r.m.mul(s).add(u);l=r.useNesterov?r.c.mul(u.add(c.mul(r.m))).add(a):r.c.mul(c).add(a),s.assign(c),a.assign(l)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Fn(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return ce(this,void 0,void 0,function(){return he(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return ce(this,void 0,void 0,function(){return he(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e.className="Momentum",e}(xA);Za(R8);var k8=function(n){function e(t,r,i,o,a){r===void 0&&(r=.9),i===void 0&&(i=0),o===void 0&&(o=null),a===void 0&&(a=!1);var s=n.call(this)||this;if(s.learningRate=t,s.decay=r,s.momentum=i,s.epsilon=o,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,o==null&&(s.epsilon=U.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Br(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=U.registeredVariables[i];r.accumulatedMeanSquares[o]==null&&(r.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:ue(function(){return je(a).variable(!1)})}),r.accumulatedMoments[o]==null&&(r.accumulatedMoments[o]={originalName:i+"/momentum",variable:ue(function(){return je(a).variable(!1)})}),r.accumulatedMeanGrads[o]==null&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:ue(function(){return je(a).variable(!1)})});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=r.accumulatedMeanSquares[o].variable,l=r.accumulatedMoments[o].variable;ue(function(){var c=u.mul(r.decay).add(s.square().mul(1-r.decay));if(r.centered){var h=r.accumulatedMeanGrads[o].variable,d=h.mul(r.decay).add(s.mul(1-r.decay)),p=l.mul(r.momentum).add(s.mul(r.learningRate).div(c.sub(d.square().add(r.epsilon)).sqrt()));u.assign(c),h.assign(d),l.assign(p);var m=a.sub(p);a.assign(m)}else{var g=u.mul(r.decay).add(s.square().mul(1-r.decay));p=l.mul(r.momentum).add(s.mul(r.learningRate).div(g.add(r.epsilon).sqrt())),u.assign(g),l.assign(p),m=a.sub(p),a.assign(m)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Fn(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Fn(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&Fn(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return ce(this,void 0,void 0,function(){var t;return he(this,function(r){switch(r.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return ce(this,void 0,void 0,function(){var r;return he(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*r,3*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e.className="RMSProp",e}(es);Za(k8);lt.prototype.squaredDifference=function(n){return Fk(this,n)},q=t8;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var wy=function(n,e){return wy=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},wy(n,e)};function Ie(n,e){wy(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var dn=function(){return dn=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},dn.apply(this,arguments)};function ve(n,e,t,r){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function s(c){try{l(r.next(c))}catch(h){a(h)}}function u(c){try{l(r.throw(c))}catch(h){a(h)}}function l(c){c.done?o(c.value):i(c.value).then(s,u)}l((r=r.apply(n,[])).next())})}function ge(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(l){return function(c){return u([l,c])}}function u(l){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(c){l=[6,c],i=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Al(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}var Qs=function(){function n(e,t){if(!Ta(e)||!Ta(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),n.prototype.reverse=function(){return new n(1/this.width,1/this.height)},n}();function jp(n,e){return n instanceof lt&&n.shape.length===e}function A8(n){return jp(n,2)}function zp(n){return jp(n,3)}function Fo(n){return jp(n,4)}function P8(n){return n%1!==0}function l2(n){return n%2===0}function N8(n,e){e===void 0&&(e=2);var t=Math.pow(10,e);return Math.floor(n*t)/t}function c2(n){return n&&n.width&&n.height}function D8(n,e){var t=n.width,r=n.height,i=e/Math.max(r,t);return new Qs(Math.round(t*i),Math.round(r*i))}function H1(n){return n.reduce(function(e,t){return e.add(t)},new He(0,0)).div(new He(n.length,n.length))}function mc(n,e,t){return Array(n).fill(0).map(function(r,i){return e+i*t})}function Ta(n){return!!n&&n!==1/0&&n!==-1/0&&!isNaN(n)||n===0}function h2(n){return Ta(n)&&0<=n&&n<=1}var He=function(){function n(e,t){this._x=e,this._y=t}return Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),n.prototype.add=function(e){return new n(this.x+e.x,this.y+e.y)},n.prototype.sub=function(e){return new n(this.x-e.x,this.y-e.y)},n.prototype.mul=function(e){return new n(this.x*e.x,this.y*e.y)},n.prototype.div=function(e){return new n(this.x/e.x,this.y/e.y)},n.prototype.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},n.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},n}(),qo=function(){function n(e,t){t===void 0&&(t=!0);var r=e||{},i=[r.left,r.top,r.right,r.bottom].every(Ta),o=[r.x,r.y,r.width,r.height].every(Ta);if(!o&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=o?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],u=a[1],l=a[2],c=a[3];n.assertIsValidBox({x:s,y:u,width:l,height:c},"Box.constructor",t),this._x=s,this._y=u,this._width=l,this._height=c}return n.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(Ta)},n.assertIsValidBox=function(e,t,r){if(r===void 0&&(r=!1),!n.isRect(e))throw new Error(t+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(t+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topLeft",{get:function(){return new He(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topRight",{get:function(){return new He(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomLeft",{get:function(){return new He(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRight",{get:function(){return new He(this.right,this.bottom)},enumerable:!0,configurable:!0}),n.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(a){return Math.round(a)}),t=e[0],r=e[1],i=e[2],o=e[3];return new n({x:t,y:r,width:i,height:o})},n.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(a){return Math.floor(a)}),t=e[0],r=e[1],i=e[2],o=e[3];return new n({x:t,y:r,width:i,height:o})},n.prototype.toSquare=function(){var e=this,t=e.x,r=e.y,i=e.width,o=e.height,a=Math.abs(i-o);return i<o&&(t-=a/2,i+=a),o<i&&(r-=a/2,o+=a),new n({x:t,y:r,width:i,height:o})},n.prototype.rescale=function(e){var t=c2(e)?e.width:e,r=c2(e)?e.height:e;return new n({x:this.x*t,y:this.y*r,width:this.width*t,height:this.height*r})},n.prototype.pad=function(e,t){var r=[this.x-e/2,this.y-t/2,this.width+e,this.height+t],i=r[0],o=r[1],a=r[2],s=r[3];return new n({x:i,y:o,width:a,height:s})},n.prototype.clipAtImageBorders=function(e,t){var r=this,i=r.x,o=r.y,a=r.right,s=r.bottom,u=Math.max(i,0),l=Math.max(o,0),c=a-u,h=s-l,d=Math.min(c,e-u),p=Math.min(h,t-l);return new n({x:u,y:l,width:d,height:p}).floor()},n.prototype.shift=function(e,t){var r=this,i=r.width,o=r.height,a=this.x+e,s=this.y+t;return new n({x:a,y:s,width:i,height:o})},n.prototype.padAtBorders=function(e,t){var r=this.width+1,i=this.height+1,o=1,a=1,s=r,u=i,l=this.left,c=this.top,h=this.right,d=this.bottom;return h>t&&(s=-h+t+r,h=t),d>e&&(u=-d+e+i,d=e),l<1&&(u=2-l,l=1),c<1&&(u=2-c,c=1),{dy:a,edy:u,dx:o,edx:s,y:c,ey:d,x:l,ex:h,w:r,h:i}},n.prototype.calibrate=function(e){return new n({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},n}(),Wp=function(n){Ie(e,n);function e(t,r,i,o,a){return a===void 0&&(a=!1),n.call(this,{left:t,top:r,right:i,bottom:o},a)||this}return e}(qo),bA=function(){function n(e,t,r,i,o){this._imageDims=new Qs(o.width,o.height),this._score=e,this._classScore=t,this._className=r,this._box=new qo(i).rescale(this._imageDims)}return Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativeBox",{get:function(){return new qo(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new n(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:t})},n}(),mi=function(n){Ie(e,n);function e(t,r,i){return n.call(this,t,t,"",r,i)||this}return e.prototype.forSize=function(t,r){var i=n.prototype.forSize.call(this,t,r),o=i.score,a=i.relativeBox,s=i.imageDims;return new e(o,a,s)},e}(bA);function O8(n,e,t){t===void 0&&(t=!0);var r=Math.max(0,Math.min(n.right,e.right)-Math.max(n.left,e.left)),i=Math.max(0,Math.min(n.bottom,e.bottom)-Math.max(n.top,e.top)),o=r*i;return t?o/(n.area+e.area-o):o/Math.min(n.area,e.area)}function M8(n){var e=n.map(function(s){return s.x}),t=n.map(function(s){return s.y}),r=e.reduce(function(s,u){return u<s?u:s},1/0),i=t.reduce(function(s,u){return u<s?u:s},1/0),o=e.reduce(function(s,u){return s<u?u:s},0),a=t.reduce(function(s,u){return s<u?u:s},0);return new Wp(r,i,o,a)}function vc(n,e,t,r){r===void 0&&(r=!0);for(var i=e.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),o=[],a=function(){var s=i.pop();o.push(s);for(var u=i,l=[],c=0;c<u.length;c++){var h=u[c],d=n[s],p=n[h];l.push(O8(d,p,r))}i=i.filter(function(m,g){return l[g]<=t})};i.length>0;)a();return o}function Gc(n,e){return ue(function(){var t=e[0],r=e[1],i=e[2],o=li(Al(n.shape.slice(0,3),[1]),t),a=li(Al(n.shape.slice(0,3),[1]),r),s=li(Al(n.shape.slice(0,3),[1]),i),u=Dt([o,a,s],3);return Ft(n,u)})}function F8(n,e){return e===void 0&&(e=!1),ue(function(){var t=n.shape.slice(1),r=t[0],i=t[1];if(r===i)return n;var o=Math.abs(r-i),a=Math.round(o*(e?.5:1)),s=r>i?2:1,u=function(p){var m=n.shape.slice();return m[s]=p,li(m,0)},l=u(a),c=o-l.shape[s],h=e&&c?u(c):null,d=[h,n,l].filter(function(p){return!!p}).map(function(p){return p.toFloat()});return Dt(d,s)})}function xv(n){return 1/(1+Math.exp(-n))}var G1=function(n){Ie(e,n);function e(t,r,i,o,a){return a===void 0&&(a=!1),n.call(this,{x:t,y:r,width:i,height:o},a)||this}return e}(qo),L8=.5,V8=.43,B8=.45,jf=function(){function n(e,t,r){r===void 0&&(r=new He(0,0));var i=t.width,o=t.height;this._imgDims=new Qs(i,o),this._shift=r,this._positions=e.map(function(a){return a.mul(new He(i,o)).add(r)})}return Object.defineProperty(n.prototype,"shift",{get:function(){return new He(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new He(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},n.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new He(e,t))},n.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},n.prototype.align=function(e,t){if(t===void 0&&(t={}),e){var r=e instanceof mi?e.box.floor():new qo(e);return this.shiftBy(r.x,r.y).align(null,t)}var i=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),o=i.useDlibAlignment,a=i.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(a)},n.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],r=e[1],i=e[2],o=function(h){return i.sub(h).magnitude()},a=(o(t)+o(r))/2,s=Math.floor(a/B8),u=H1(e),l=Math.floor(Math.max(0,u.x-L8*s)),c=Math.floor(Math.max(0,u.y-V8*s));return new G1(l,c,Math.min(s,this.imageWidth+l),Math.min(s,this.imageHeight+c))},n.prototype.alignMinBbox=function(e){var t=M8(this.positions);return t.pad(t.width*e,t.height*e)},n.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},n}(),U8=function(n){Ie(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],H1([t[3],t[4]])]},e}(jf),j8=function(n){Ie(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(H1)},e}(jf),d2=function(){function n(e,t){this._label=e,this._distance=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){return e===void 0&&(e=!0),""+this.label+(e?" ("+N8(this.distance)+")":"")},n}(),f2=function(n){Ie(e,n);function e(t,r){var i=n.call(this,t)||this;return i._label=r,i}return e.assertIsValidLabeledBox=function(t,r){if(qo.assertIsValidBox(t,r),!Ta(t.label))throw new Error(r+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(qo),$h=function(){function n(e,t){if(typeof e!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),n.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(e){return Array.from(e)})}},n.fromJSON=function(e){var t=e.descriptors.map(function(r){return new Float32Array(r)});return new n(e.label,t)},n}();(function(n){Ie(e,n);function e(t,r,i,o){var a=n.call(this,t,r)||this;return a._score=i,a._classScore=o,a}return e.assertIsValidPredictedBox=function(t,r){if(f2.assertIsValidLabeledBox(t,r),!h2(t.score)||!h2(t.classScore))throw new Error(r+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),e})(f2);function z8(n){return n.detection instanceof mi}function q1(n,e){var t={detection:e};return Object.assign({},n,t)}function EA(){var n=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},e=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:n,readFile:e}}function CA(n){var e="";if(!n)try{n=require("fs")}catch(r){e=r.toString()}var t=n?function(r){return new Promise(function(i,o){n.readFile(r,function(a,s){return a?o(a):i(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)};return{readFile:t}}function IA(){var n=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,t=function(){if(n)return new n;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},i=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=CA();return dn({Canvas:n||function(){function a(){}return a}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function a(){}return a}(),Image:e||function(){function a(){}return a}(),ImageData:global.ImageData||function(){function a(){}return a}(),Video:global.HTMLVideoElement||function(){function a(){}return a}(),createCanvasElement:t,createImageElement:r,fetch:i},o)}function TA(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function SA(){return typeof global=="object"&&typeof require=="function"&&typeof iP<"u"&&typeof process<"u"&&!!process.version}var Rt;function W8(){if(!Rt)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Rt}function _y(n){Rt=n}function K1(){TA()&&_y(EA()),SA()&&_y(IA())}function $8(n){if(Rt||K1(),!Rt)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=n.Canvas,t=e===void 0?Rt.Canvas:e,r=n.Image,i=r===void 0?Rt.Image:r;Rt.Canvas=t,Rt.Image=i,Rt.createCanvasElement=n.createCanvasElement||function(){return new t},Rt.createImageElement=n.createImageElement||function(){return new i},Rt.ImageData=n.ImageData||Rt.ImageData,Rt.Video=n.Video||Rt.Video,Rt.fetch=n.fetch||Rt.fetch,Rt.readFile=n.readFile||Rt.readFile}var _n={getEnv:W8,setEnv:_y,initialize:K1,createBrowserEnv:EA,createFileSystem:CA,createNodejsEnv:IA,monkeyPatch:$8,isBrowser:TA,isNodejs:SA};K1();function RA(n){return!_n.isNodejs()&&typeof n=="string"?document.getElementById(n):n}function ja(n){var e=_n.getEnv(),t=e.Canvas,r=e.CanvasRenderingContext2D;if(n instanceof r)return n;var i=RA(n);if(!(i instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=i.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}var p2;(function(n){n.TOP_LEFT="TOP_LEFT",n.TOP_RIGHT="TOP_RIGHT",n.BOTTOM_LEFT="BOTTOM_LEFT",n.BOTTOM_RIGHT="BOTTOM_RIGHT"})(p2||(p2={}));function kA(n){var e=_n.getEnv(),t=e.Image,r=e.Video;return n instanceof t&&n.complete||n instanceof r&&n.readyState>=3}function H8(n){return new Promise(function(e,t){if(n instanceof _n.getEnv().Canvas||kA(n))return e();function r(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),e(o))}function i(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),t(o))}n.addEventListener("load",r),n.addEventListener("error",i)})}function AA(n){var e=_n.getEnv(),t=e.Image,r=e.Video;return n instanceof t?new Qs(n.naturalWidth,n.naturalHeight):n instanceof r?new Qs(n.videoWidth,n.videoHeight):new Qs(n.width,n.height)}function $p(n){var e=n.width,t=n.height,r=_n.getEnv().createCanvasElement,i=r();return i.width=e,i.height=t,i}function X1(n,e){var t=_n.getEnv().ImageData;if(!(n instanceof t)&&!kA(n))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=AA(n),i=r.width,o=r.height,a=$p({width:i,height:o});return n instanceof t?ja(a).putImageData(n,0,0):ja(a).drawImage(n,0,0,i,o),a}function G8(n,e){return ve(this,void 0,void 0,function(){var t,r,i,o,a,s;return ge(this,function(u){switch(u.label){case 0:return t=_n.getEnv().createCanvasElement(),r=n.shape.slice(Fo(n)?1:0),i=r[0],o=r[1],a=r[2],s=ue(function(){return n.as3D(i,o,a).toInt()}),[4,$1.toPixels(s,t)];case 1:return u.sent(),s.dispose(),[2,t]}})})}function m2(n){var e=_n.getEnv(),t=e.Image,r=e.Canvas,i=e.Video;return n instanceof t||n instanceof r||n instanceof i}function q8(n,e,t){t===void 0&&(t=!1);var r=_n.getEnv(),i=r.Image,o=r.Canvas;if(!(n instanceof i||n instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=AA(n),s=e/Math.max(a.height,a.width),u=s*a.width,l=s*a.height,c=$p({width:e,height:e}),h=n instanceof o?n:X1(n),d=Math.abs(u-l)/2,p=t&&u<l?d:0,m=t&&l<u?d:0;return ja(c).drawImage(h,p,m,u,l),c}var zf=function(){function n(e,t){var r=this;if(t===void 0&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(i,o){if(zp(i)){r._imageTensors[o]=i,r._inputDimensions[o]=i.shape;return}if(Fo(i)){var a=i.shape[0];if(a!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+a+" passed, but not supported in input array");r._imageTensors[o]=i,r._inputDimensions[o]=i.shape.slice(1);return}var s=i instanceof _n.getEnv().Canvas?i:X1(i);r._canvases[o]=s,r._inputDimensions[o]=[s.height,s.width,3]})}return Object.defineProperty(n.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"reshapedInputDimensions",{get:function(){var e=this;return mc(this.batchSize,0,1).map(function(t,r){return e.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),n.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},n.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},n.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},n.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},n.prototype.getReshapedInputDimensions=function(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(e),r=this.getInputHeight(e);return D8({width:t,height:r},this.inputSize)},n.prototype.toBatchTensor=function(e,t){var r=this;return t===void 0&&(t=!0),this._inputSize=e,ue(function(){var i=mc(r.batchSize,0,1).map(function(a){var s=r.getInput(a);if(s instanceof lt){var u=Fo(s)?s:s.expandDims();return u=F8(u,t),(u.shape[1]!==e||u.shape[2]!==e)&&(u=V1.resizeBilinear(u,[e,e])),u.as3D(e,e,3)}if(s instanceof _n.getEnv().Canvas)return $1.fromPixels(q8(s,e,t));throw new Error("toBatchTensor - at batchIdx "+a+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)}),o=Yn(i.map(function(a){return a.toFloat()})).as4D(r.batchSize,e,e,3);return o})},n}();function Wt(n){return ve(this,void 0,void 0,function(){var e,t,r;return ge(this,function(i){switch(i.label){case 0:if(n instanceof zf)return[2,n];if(e=Array.isArray(n)?n:[n],!e.length)throw new Error("toNetInput - empty array passed as input");return t=function(o){return Array.isArray(n)?" at input index "+o+":":""},r=e.map(RA),r.forEach(function(o,a){if(!m2(o)&&!zp(o)&&!Fo(o))throw typeof e[a]=="string"?new Error("toNetInput -"+t(a)+" string passed, but could not resolve HTMLElement for element id "+e[a]):new Error("toNetInput -"+t(a)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(Fo(o)){var s=o.shape[0];if(s!==1)throw new Error("toNetInput -"+t(a)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(o){return m2(o)&&H8(o)}))];case 1:return i.sent(),[2,new zf(r,Array.isArray(n))]}})})}function Q1(n,e){return ve(this,void 0,void 0,function(){var t,r,i,o,a,s,u;return ge(this,function(l){switch(l.label){case 0:return t=_n.getEnv().Canvas,r=n,n instanceof t?[3,5]:[4,Wt(n)];case 1:if(i=l.sent(),i.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return o=i.getInput(0),o instanceof t?(a=o,[3,4]):[3,2];case 2:return[4,G8(o)];case 3:a=l.sent(),l.label=4;case 4:r=a,l.label=5;case 5:return s=ja(r),u=e.map(function(c){return c instanceof mi?c.forSize(r.width,r.height).box.floor():c}).map(function(c){return c.clipAtImageBorders(r.width,r.height)}),[2,u.map(function(c){var h=c.x,d=c.y,p=c.width,m=c.height,g=$p({width:p,height:m});return ja(g).putImageData(s.getImageData(h,d,p,m),0,0),g})]}})})}function Y1(n,e){return ve(this,void 0,void 0,function(){return ge(this,function(t){if(!zp(n)&&!Fo(n))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Fo(n)&&n.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,ue(function(){var r=n.shape.slice(Fo(n)?1:0),i=r[0],o=r[1],a=r[2],s=e.map(function(l){return l instanceof mi?l.forSize(o,i).box:l}).map(function(l){return l.clipAtImageBorders(o,i)}),u=s.map(function(l){var c=l.x,h=l.y,d=l.width,p=l.height;return rA(n.as3D(i,o,a),[h,c,0],[p,d,a])});return u})]})})}function K8(n,e){return ve(this,void 0,void 0,function(){var t,r;return ge(this,function(i){switch(i.label){case 0:return t=_n.getEnv().fetch,[4,t(n,e)];case 1:if(r=i.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function X8(n){return ve(this,void 0,void 0,function(){return ge(this,function(e){switch(e.label){case 0:return[4,K8(n)];case 1:return[2,e.sent().json()]}})})}function PA(n,e){var t=e+"-weights_manifest.json";if(!n)return{modelBaseUri:"",manifestUri:t};if(n==="/")return{modelBaseUri:"/",manifestUri:"/"+t};var r=n.startsWith("http://")?"http://":n.startsWith("https://")?"https://":"";n=n.replace(r,"");var i=n.split("/").filter(function(s){return s}),o=n.endsWith(".json")?i[i.length-1]:t,a=r+(n.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return a=n.startsWith("/")?"/"+a:a,{modelBaseUri:a,manifestUri:a==="/"?"/"+o:a+"/"+o}}function Q8(n,e){return ve(this,void 0,void 0,function(){var t,r,i,o;return ge(this,function(a){switch(a.label){case 0:return t=PA(n,e),r=t.manifestUri,i=t.modelBaseUri,[4,X8(r)];case 1:return o=a.sent(),[2,_A.loadWeights(o,i)]}})})}var qi=function(){function n(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(n.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),n.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e),r=t.obj,i=t.objProp;return r[i]},n.prototype.reassignParamFromPath=function(e,t){var r=this.traversePropertyPath(e),i=r.obj,o=r.objProp;i[o].dispose(),i[o]=t},n.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var r=t.paramPath;return{path:r,tensor:e.getParamFromPath(r)}})},n.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof mu})},n.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof mu)})},n.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var r=t.path,i=t.tensor;e.reassignParamFromPath(r,i.variable())})},n.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var r=t.path,i=t.tensor,o=Qt(i.dataSync());i.dispose(),e.reassignParamFromPath(r,o)})},n.prototype.dispose=function(e){e===void 0&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},n.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},n.prototype.load=function(e){return ve(this,void 0,void 0,function(){return ge(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},n.prototype.loadFromUri=function(e){return ve(this,void 0,void 0,function(){var t;return ge(this,function(r){switch(r.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,Q8(e,this.getDefaultModelName())];case 1:return t=r.sent(),this.loadFromWeightMap(t),[2]}})})},n.prototype.loadFromDisk=function(e){return ve(this,void 0,void 0,function(){var t,r,i,o,a,s,u,l,c,h;return ge(this,function(d){switch(d.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return t=_n.getEnv().readFile,r=PA(e,this.getDefaultModelName()),i=r.manifestUri,o=r.modelBaseUri,a=function(p){return Promise.all(p.map(function(m){return t(m).then(function(g){return g.buffer})}))},s=_A.weightsLoaderFactory(a),c=(l=JSON).parse,[4,t(i)];case 1:return u=c.apply(l,[d.sent().toString()]),[4,s(u,o)];case 2:return h=d.sent(),this.loadFromWeightMap(h),[2]}})})},n.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),r=t.paramMappings,i=t.params;this._paramMappings=r,this._params=i},n.prototype.extractWeights=function(e){var t=this.extractParams(e),r=t.paramMappings,i=t.params;this._paramMappings=r,this._params=i},n.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(o,a){if(!o.nextObj.hasOwnProperty(a))throw new Error("traversePropertyPath - object does not have property "+a+", for path "+e);return{obj:o.nextObj,objProp:a,nextObj:o.nextObj[a]}},{nextObj:this.params}),r=t.obj,i=t.objProp;if(!r||!i||!(r[i]instanceof lt))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:r,objProp:i}},n}();function Xn(n,e,t){return ue(function(){var r=D1(n,e.depthwise_filter,e.pointwise_filter,t,"same");return r=Ne(r,e.bias),r})}function bv(n,e,t){return t===void 0&&(t=!1),ue(function(){var r=ct(t?Ne(_r(n,e.conv0.filters,[2,2],"same"),e.conv0.bias):Xn(n,e.conv0,[2,2])),i=Xn(r,e.conv1,[1,1]),o=ct(Ne(r,i)),a=Xn(o,e.conv2,[1,1]);return ct(Ne(r,Ne(i,a)))})}function Hh(n,e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!0),ue(function(){var i=ct(t?Ne(_r(n,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):Xn(n,e.conv0,r?[2,2]:[1,1])),o=Xn(i,e.conv1,[1,1]),a=ct(Ne(i,o)),s=Xn(a,e.conv2,[1,1]),u=ct(Ne(i,Ne(o,s))),l=Xn(u,e.conv3,[1,1]);return ct(Ne(i,Ne(o,Ne(s,l))))})}function Mr(n,e,t,r){return t===void 0&&(t="same"),r===void 0&&(r=!1),ue(function(){var i=Ne(_r(n,e.filters,[1,1],t),e.bias);return r?ct(i):i})}function Ki(n,e){Object.keys(n).forEach(function(t){e.some(function(r){return r.originalPath===t})||n[t].dispose()})}function Hp(n,e){return function(t,r,i,o){var a=An(n(t*r*i*i),[i,i,t,r]),s=Tt(n(r));return e.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:a,bias:s}}}function J1(n,e){return function(t,r,i){var o=Oo(n(t*r),[t,r]),a=Tt(n(r));return e.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:o,bias:a}}}var NA=function(){function n(e,t,r){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=r}return n}();function Z1(n,e){return function(t,r,i){var o=An(n(9*t),[3,3,t,1]),a=An(n(t*r),[1,1,t,r]),s=Tt(n(r));return e.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new NA(o,a,s)}}function ew(n){return function(e){var t=n(e+"/depthwise_filter",4),r=n(e+"/pointwise_filter",4),i=n(e+"/bias",1);return new NA(t,r,i)}}function ta(n,e){return function(t,r,i){var o=n[t];if(!jp(o,r))throw new Error("expected weightMap["+t+"] to be a Tensor"+r+"D, instead have "+o);return e.push({originalPath:t,paramPath:i||t}),o}}function Xi(n){var e=n;function t(i){var o=e.slice(0,i);return e=e.slice(i),o}function r(){return e}return{extractWeights:t,getRemainingWeights:r}}function DA(n,e){var t=Hp(n,e),r=Z1(n,e);function i(a,s,u,l){l===void 0&&(l=!1);var c=l?t(a,s,3,u+"/conv0"):r(a,s,u+"/conv0"),h=r(s,s,u+"/conv1"),d=r(s,s,u+"/conv2");return{conv0:c,conv1:h,conv2:d}}function o(a,s,u,l){l===void 0&&(l=!1);var c=i(a,s,u,l),h=c.conv0,d=c.conv1,p=c.conv2,m=r(s,s,u+"/conv3");return{conv0:h,conv1:d,conv2:p,conv3:m}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:o}}function Y8(n){var e=[],t=Xi(n),r=t.extractWeights,i=t.getRemainingWeights,o=DA(r,e).extractDenseBlock4Params,a=o(3,32,"dense0",!0),s=o(32,64,"dense1"),u=o(64,128,"dense2"),l=o(128,256,"dense3");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:u,dense3:l}}}function OA(n){return function(e){var t=n(e+"/filters",4),r=n(e+"/bias",1);return{filters:t,bias:r}}}function MA(n,e){var t=ta(n,e),r=OA(t),i=ew(t);function o(s,u){u===void 0&&(u=!1);var l=u?r(s+"/conv0"):i(s+"/conv0"),c=i(s+"/conv1"),h=i(s+"/conv2");return{conv0:l,conv1:c,conv2:h}}function a(s,u){u===void 0&&(u=!1);var l=u?r(s+"/conv0"):i(s+"/conv0"),c=i(s+"/conv1"),h=i(s+"/conv2"),d=i(s+"/conv3");return{conv0:l,conv1:c,conv2:h,conv3:d}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:a}}function J8(n){var e=[],t=MA(n,e).extractDenseBlock4Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return Ki(n,e),{params:r,paramMappings:e}}var FA=function(n){Ie(e,n);function e(){return n.call(this,"FaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return ue(function(){var i=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],a=Gc(i,o).div(ae(255)),s=Hh(a,r.dense0,!0);return s=Hh(s,r.dense1),s=Hh(s,r.dense2),s=Hh(s,r.dense3),s=$c(s,[7,7],[2,2],"valid"),s})},e.prototype.forward=function(t){return ve(this,void 0,void 0,function(){var r;return ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Wt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return J8(t)},e.prototype.extractParams=function(t){return Y8(t)},e}(qi);function Zr(n,e){return ue(function(){return Ne(Vp(n,e.weights),e.bias)})}function Z8(n,e,t){var r=[],i=Xi(n),o=i.extractWeights,a=i.getRemainingWeights,s=J1(o,r),u=s(e,t,"fc");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:r,params:{fc:u}}}function e7(n){var e=[],t=ta(n,e);function r(o){var a=t(o+"/weights",2),s=t(o+"/bias",1);return{weights:a,bias:s}}var i={fc:r("fc")};return Ki(n,e),{params:i,paramMappings:e}}function LA(n){var e={},t={};return Object.keys(n).forEach(function(r){var i=r.startsWith("fc")?t:e;i[r]=n[r]}),{featureExtractorMap:e,classifierMap:t}}var VA=function(n){Ie(e,n);function e(t,r){var i=n.call(this,t)||this;return i._faceFeatureExtractor=r,i}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return ue(function(){var o=t instanceof zf?r.faceFeatureExtractor.forwardInput(t):t;return Zr(o.as2D(o.shape[0],-1),i.fc)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),i=r.params,o=r.paramMappings;this._params=i,this._paramMappings=o},e.prototype.extractClassifierParams=function(t){return Z8(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var r=LA(t),i=r.featureExtractorMap,o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),e7(o)},e.prototype.extractParams=function(t){var r=this.getClassifierChannelsIn(),i=this.getClassifierChannelsOut(),o=i*r+i,a=t.slice(0,t.length-o),s=t.slice(t.length-o);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)},e}(qi),v2=["neutral","happy","sad","angry","fearful","disgusted","surprised"],t7=function(){function n(e){var t=this;if(e.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);v2.forEach(function(r,i){t[r]=e[i]})}return n.prototype.asSortedArray=function(){var e=this;return v2.map(function(t){return{expression:t,probability:e[t]}}).sort(function(t,r){return r.probability-t.probability})},n}(),n7=function(n){Ie(e,n);function e(t){return t===void 0&&(t=new FA),n.call(this,"FaceExpressionNet",t)||this}return e.prototype.forwardInput=function(t){var r=this;return ue(function(){return Hi(r.runNet(t))})},e.prototype.forward=function(t){return ve(this,void 0,void 0,function(){var r;return ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Wt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictExpressions=function(t){return ve(this,void 0,void 0,function(){var r,i,o,a,s=this;return ge(this,function(u){switch(u.label){case 0:return[4,Wt(t)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return i=u.sent(),[4,Promise.all(Ot(i).map(function(l){return ve(s,void 0,void 0,function(){var c;return ge(this,function(h){switch(h.label){case 0:return[4,l.data()];case 1:return c=h.sent(),l.dispose(),[2,c]}})})}))];case 3:return o=u.sent(),i.dispose(),a=o.map(function(l){return new t7(l)}),[2,r.isBatchInput?a:a[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(VA);function BA(n,e){var t={expressions:e};return Object.assign({},n,t)}function r7(n){return z8(n)&&n.landmarks instanceof jf&&n.unshiftedLandmarks instanceof jf&&n.alignedRect instanceof mi}function tw(n,e){var t=n.detection.box,r=e.shiftBy(t.x,t.y),i=r.align(),o=n.detection.imageDims,a=new mi(n.detection.score,i.rescale(o.reverse()),o),s={landmarks:r,unshiftedLandmarks:e,alignedRect:a};return Object.assign({},n,s)}function i7(n,e){var t=Hp(n,e),r=Z1(n,e);function i(a,s,u){var l=r(a,s,u+"/separable_conv0"),c=r(s,s,u+"/separable_conv1"),h=t(a,s,1,u+"/expansion_conv");return{separable_conv0:l,separable_conv1:c,expansion_conv:h}}function o(a,s){var u=r(a,a,s+"/separable_conv0"),l=r(a,a,s+"/separable_conv1"),c=r(a,a,s+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:t,extractSeparableConvParams:r,extractReductionBlockParams:i,extractMainBlockParams:o}}function o7(n,e){var t=[],r=Xi(n),i=r.extractWeights,o=r.getRemainingWeights,a=i7(i,t),s=a.extractConvParams,u=a.extractSeparableConvParams,l=a.extractReductionBlockParams,c=a.extractMainBlockParams,h=s(3,32,3,"entry_flow/conv_in"),d=l(32,64,"entry_flow/reduction_block_0"),p=l(64,128,"entry_flow/reduction_block_1"),m={conv_in:h,reduction_block_0:d,reduction_block_1:p},g={};mc(e,0,1).forEach(function(_){g["main_block_"+_]=c(128,"middle_flow/main_block_"+_)});var y=l(128,256,"exit_flow/reduction_block"),v=u(256,512,"exit_flow/separable_conv"),w={reduction_block:y,separable_conv:v};if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{entry_flow:m,middle_flow:g,exit_flow:w}}}function a7(n,e){var t=ta(n,e),r=OA(t),i=ew(t);function o(s){var u=i(s+"/separable_conv0"),l=i(s+"/separable_conv1"),c=r(s+"/expansion_conv");return{separable_conv0:u,separable_conv1:l,expansion_conv:c}}function a(s){var u=i(s+"/separable_conv0"),l=i(s+"/separable_conv1"),c=i(s+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:o,extractMainBlockParams:a}}function s7(n,e){var t=[],r=a7(n,t),i=r.extractConvParams,o=r.extractSeparableConvParams,a=r.extractReductionBlockParams,s=r.extractMainBlockParams,u=i("entry_flow/conv_in"),l=a("entry_flow/reduction_block_0"),c=a("entry_flow/reduction_block_1"),h={conv_in:u,reduction_block_0:l,reduction_block_1:c},d={};mc(e,0,1).forEach(function(y){d["main_block_"+y]=s("middle_flow/main_block_"+y)});var p=a("exit_flow/reduction_block"),m=o("exit_flow/separable_conv"),g={reduction_block:p,separable_conv:m};return Ki(n,t),{params:{entry_flow:h,middle_flow:d,exit_flow:g},paramMappings:t}}function UA(n,e,t){return Ne(_r(n,e.filters,t,"same"),e.bias)}function Ev(n,e,t){t===void 0&&(t=!0);var r=t?ct(n):n;return r=Xn(r,e.separable_conv0,[1,1]),r=Xn(ct(r),e.separable_conv1,[1,1]),r=Vt(r,[3,3],[2,2],"same"),r=Ne(r,UA(n,e.expansion_conv,[2,2])),r}function u7(n,e){var t=Xn(ct(n),e.separable_conv0,[1,1]);return t=Xn(ct(t),e.separable_conv1,[1,1]),t=Xn(ct(t),e.separable_conv2,[1,1]),t=Ne(t,n),t}var l7=function(n){Ie(e,n);function e(t){var r=n.call(this,"TinyXception")||this;return r._numMainBlocks=t,r}return e.prototype.forwardInput=function(t){var r=this,i=this.params;if(!i)throw new Error("TinyXception - load model before inference");return ue(function(){var o=t.toBatchTensor(112,!0),a=[122.782,117.001,104.298],s=Gc(o,a).div(ae(256)),u=ct(UA(s,i.entry_flow.conv_in,[2,2]));return u=Ev(u,i.entry_flow.reduction_block_0,!1),u=Ev(u,i.entry_flow.reduction_block_1),mc(r._numMainBlocks,0,1).forEach(function(l){u=u7(u,i.middle_flow["main_block_"+l])}),u=Ev(u,i.exit_flow.reduction_block),u=ct(Xn(u,i.exit_flow.separable_conv,[1,1])),u})},e.prototype.forward=function(t){return ve(this,void 0,void 0,function(){var r;return ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Wt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return s7(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return o7(t,this._numMainBlocks)},e}(qi);function c7(n){var e=[],t=Xi(n),r=t.extractWeights,i=t.getRemainingWeights,o=J1(r,e),a=o(512,1,"fc/age"),s=o(512,2,"fc/gender");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{fc:{age:a,gender:s}}}}function h7(n){var e=[],t=ta(n,e);function r(o){var a=t(o+"/weights",2),s=t(o+"/bias",1);return{weights:a,bias:s}}var i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Ki(n,e),{params:i,paramMappings:e}}var Wf;(function(n){n.FEMALE="female",n.MALE="male"})(Wf||(Wf={}));var d7=function(n){Ie(e,n);function e(t){t===void 0&&(t=new l7(2));var r=n.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=t,r}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return ue(function(){var o=t instanceof zf?r.faceFeatureExtractor.forwardInput(t):t,a=$c(o,[7,7],[2,2],"valid").as2D(o.shape[0],-1),s=Zr(a,i.fc.age).as1D(),u=Zr(a,i.fc.gender);return{age:s,gender:u}})},e.prototype.forwardInput=function(t){var r=this;return ue(function(){var i=r.runNet(t),o=i.age,a=i.gender;return{age:o,gender:Hi(a)}})},e.prototype.forward=function(t){return ve(this,void 0,void 0,function(){var r;return ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Wt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return ve(this,void 0,void 0,function(){var r,i,o,a,s,u,l=this;return ge(this,function(c){switch(c.label){case 0:return[4,Wt(t)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return i=c.sent(),o=Ot(i.age),a=Ot(i.gender),s=o.map(function(h,d){return{ageTensor:h,genderTensor:a[d]}}),[4,Promise.all(s.map(function(h){var d=h.ageTensor,p=h.genderTensor;return ve(l,void 0,void 0,function(){var m,g,y,v,w;return ge(this,function(_){switch(_.label){case 0:return[4,d.data()];case 1:return m=_.sent()[0],[4,p.data()];case 2:return g=_.sent()[0],y=g>.5,v=y?Wf.MALE:Wf.FEMALE,w=y?g:1-g,d.dispose(),p.dispose(),[2,{age:m,gender:v,genderProbability:w}]}})})}))];case 3:return u=c.sent(),i.age.dispose(),i.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),i=r.params,o=r.paramMappings;this._params=i,this._paramMappings=o},e.prototype.extractClassifierParams=function(t){return c7(t)},e.prototype.extractParamsFromWeigthMap=function(t){var r=LA(t),i=r.featureExtractorMap,o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),h7(o)},e.prototype.extractParams=function(t){var r=1539,i=t.slice(0,t.length-r),o=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(o)},e}(qi),jA=function(n){Ie(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.postProcess=function(t,r,i){var o=i.map(function(s){var u=s.width,l=s.height,c=r/Math.max(l,u);return{width:u*c,height:l*c}}),a=o.length;return ue(function(){var s=function(d,p){return Yn([li([68],d),li([68],p)],1).as2D(1,136).as1D()},u=function(d,p){var m=o[d],g=m.width,y=m.height;return p(g,y)?Math.abs(g-y)/2:0},l=function(d){return u(d,function(p,m){return p<m})},c=function(d){return u(d,function(p,m){return m<p})},h=t.mul(li([a,136],r)).sub(Yn(Array.from(Array(a),function(d,p){return s(l(p),c(p))}))).div(Yn(Array.from(Array(a),function(d,p){return s(o[p].width,o[p].height)})));return h})},e.prototype.forwardInput=function(t){var r=this;return ue(function(){var i=r.runNet(t);return r.postProcess(i,t.inputSize,t.inputDimensions.map(function(o){var a=o[0],s=o[1];return{height:a,width:s}}))})},e.prototype.forward=function(t){return ve(this,void 0,void 0,function(){var r;return ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Wt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.detectLandmarks=function(t){return ve(this,void 0,void 0,function(){var r,i,o,a=this;return ge(this,function(s){switch(s.label){case 0:return[4,Wt(t)];case 1:return r=s.sent(),i=ue(function(){return Ot(a.forwardInput(r))}),[4,Promise.all(i.map(function(u,l){return ve(a,void 0,void 0,function(){var c,h,d,p,m;return ge(this,function(g){switch(g.label){case 0:return d=(h=Array).from,[4,u.data()];case 1:return c=d.apply(h,[g.sent()]),p=c.filter(function(y,v){return l2(v)}),m=c.filter(function(y,v){return!l2(v)}),[2,new j8(Array(68).fill(0).map(function(y,v){return new He(p[v],m[v])}),{height:r.getInputHeight(l),width:r.getInputWidth(l)})]}})})}))];case 2:return o=s.sent(),i.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(VA),zA=function(n){Ie(e,n);function e(t){return t===void 0&&(t=new FA),n.call(this,"FaceLandmark68Net",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(jA);function f7(n){var e=[],t=MA(n,e).extractDenseBlock3Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return Ki(n,e),{params:r,paramMappings:e}}function p7(n){var e=[],t=Xi(n),r=t.extractWeights,i=t.getRemainingWeights,o=DA(r,e).extractDenseBlock3Params,a=o(3,32,"dense0",!0),s=o(32,64,"dense1"),u=o(64,128,"dense2");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:u}}}var m7=function(n){Ie(e,n);function e(){return n.call(this,"TinyFaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return ue(function(){var i=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],a=Gc(i,o).div(ae(255)),s=bv(a,r.dense0,!0);return s=bv(s,r.dense1),s=bv(s,r.dense2),s=$c(s,[14,14],[2,2],"valid"),s})},e.prototype.forward=function(t){return ve(this,void 0,void 0,function(){var r;return ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Wt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return f7(t)},e.prototype.extractParams=function(t){return p7(t)},e}(qi),v7=function(n){Ie(e,n);function e(t){return t===void 0&&(t=new m7),n.call(this,"FaceLandmark68TinyNet",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(jA);(function(n){Ie(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(zA);function g7(n,e){return Ne(vn(n,e.weights),e.biases)}function nw(n,e,t,r,i){i===void 0&&(i="same");var o=e.conv,a=o.filters,s=o.bias,u=_r(n,a,t,i);return u=Ne(u,s),u=g7(u,e.scale),r?ct(u):u}function y7(n,e){return nw(n,e,[1,1],!0)}function WA(n,e){return nw(n,e,[1,1],!1)}function $A(n,e){return nw(n,e,[2,2],!0,"valid")}function w7(n,e){function t(s,u,l){var c=n(s),h=c.length/(u*l*l);if(P8(h))throw new Error("depth has to be an integer: "+h+", weights.length: "+c.length+", numFilters: "+u+", filterSize: "+l);return ue(function(){return Go(An(c,[u,h,l,l]),[2,3,1,0])})}function r(s,u,l,c){var h=t(s,u,l),d=Tt(n(u));return e.push({paramPath:c+"/filters"},{paramPath:c+"/bias"}),{filters:h,bias:d}}function i(s,u){var l=Tt(n(s)),c=Tt(n(s));return e.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:l,biases:c}}function o(s,u,l,c){var h=r(s,u,l,c+"/conv"),d=i(u,c+"/scale");return{conv:h,scale:d}}function a(s,u,l,c,h){h===void 0&&(h=!1);var d=o((h?.5:1)*s,u,l,c+"/conv1"),p=o(s,u,l,c+"/conv2");return{conv1:d,conv2:p}}return{extractConvLayerParams:o,extractResidualLayerParams:a}}function _7(n){var e=Xi(n),t=e.extractWeights,r=e.getRemainingWeights,i=[],o=w7(t,i),a=o.extractConvLayerParams,s=o.extractResidualLayerParams,u=a(4704,32,7,"conv32_down"),l=s(9216,32,3,"conv32_1"),c=s(9216,32,3,"conv32_2"),h=s(9216,32,3,"conv32_3"),d=s(36864,64,3,"conv64_down",!0),p=s(36864,64,3,"conv64_1"),m=s(36864,64,3,"conv64_2"),g=s(36864,64,3,"conv64_3"),y=s(147456,128,3,"conv128_down",!0),v=s(147456,128,3,"conv128_1"),w=s(147456,128,3,"conv128_2"),_=s(589824,256,3,"conv256_down",!0),x=s(589824,256,3,"conv256_1"),C=s(589824,256,3,"conv256_2"),A=s(589824,256,3,"conv256_down_out"),T=ue(function(){return Go(Oo(t(256*128),[128,256]),[1,0])});if(i.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var E={conv32_down:u,conv32_1:l,conv32_2:c,conv32_3:h,conv64_down:d,conv64_1:p,conv64_2:m,conv64_3:g,conv128_down:y,conv128_1:v,conv128_2:w,conv256_down:_,conv256_1:x,conv256_2:C,conv256_down_out:A,fc:T};return{params:E,paramMappings:i}}function x7(n,e){var t=ta(n,e);function r(a){var s=t(a+"/scale/weights",1),u=t(a+"/scale/biases",1);return{weights:s,biases:u}}function i(a){var s=t(a+"/conv/filters",4),u=t(a+"/conv/bias",1),l=r(a);return{conv:{filters:s,bias:u},scale:l}}function o(a){return{conv1:i(a+"/conv1"),conv2:i(a+"/conv2")}}return{extractConvLayerParams:i,extractResidualLayerParams:o}}function b7(n){var e=[],t=x7(n,e),r=t.extractConvLayerParams,i=t.extractResidualLayerParams,o=r("conv32_down"),a=i("conv32_1"),s=i("conv32_2"),u=i("conv32_3"),l=i("conv64_down"),c=i("conv64_1"),h=i("conv64_2"),d=i("conv64_3"),p=i("conv128_down"),m=i("conv128_1"),g=i("conv128_2"),y=i("conv256_down"),v=i("conv256_1"),w=i("conv256_2"),_=i("conv256_down_out"),x=n.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!A8(x))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+x);var C={conv32_down:o,conv32_1:a,conv32_2:s,conv32_3:u,conv64_down:l,conv64_1:c,conv64_2:h,conv64_3:d,conv128_down:p,conv128_1:m,conv128_2:g,conv256_down:y,conv256_1:v,conv256_2:w,conv256_down_out:_,fc:x};return Ki(n,e),{params:C,paramMappings:e}}function Hr(n,e){var t=y7(n,e.conv1);return t=WA(t,e.conv2),t=Ne(t,n),t=ct(t),t}function Gh(n,e){var t=$A(n,e.conv1);t=WA(t,e.conv2);var r=$c(n,2,2,"valid"),i=it(r.shape),o=r.shape[3]!==t.shape[3],a=r.shape[1]!==t.shape[1]||r.shape[2]!==t.shape[2];if(a){var s=Al(t.shape);s[1]=1;var u=it(s);t=Dt([t,u],1);var l=Al(t.shape);l[2]=1;var c=it(l);t=Dt([t,c],2)}return r=o?Dt([r,i],3):r,t=Ne(r,t),t=ct(t),t}var E7=function(n){Ie(e,n);function e(){return n.call(this,"FaceRecognitionNet")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return ue(function(){var i=t.toBatchTensor(150,!0).toFloat(),o=[122.782,117.001,104.298],a=Gc(i,o).div(ae(256)),s=$A(a,r.conv32_down);s=Vt(s,3,2,"valid"),s=Hr(s,r.conv32_1),s=Hr(s,r.conv32_2),s=Hr(s,r.conv32_3),s=Gh(s,r.conv64_down),s=Hr(s,r.conv64_1),s=Hr(s,r.conv64_2),s=Hr(s,r.conv64_3),s=Gh(s,r.conv128_down),s=Hr(s,r.conv128_1),s=Hr(s,r.conv128_2),s=Gh(s,r.conv256_down),s=Hr(s,r.conv256_1),s=Hr(s,r.conv256_2),s=Gh(s,r.conv256_down_out);var u=s.mean([1,2]),l=Vp(u,r.fc);return l})},e.prototype.forward=function(t){return ve(this,void 0,void 0,function(){var r;return ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Wt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return ve(this,void 0,void 0,function(){var r,i,o,a=this;return ge(this,function(s){switch(s.label){case 0:return[4,Wt(t)];case 1:return r=s.sent(),i=ue(function(){return Ot(a.forwardInput(r))}),[4,Promise.all(i.map(function(u){return u.data()}))];case 2:return o=s.sent(),i.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return b7(t)},e.prototype.extractParams=function(t){return _7(t)},e}(qi);function HA(n,e){var t={descriptor:e};return Object.assign({},n,t)}function GA(n,e){var t={age:e};return Object.assign({},n,t)}function qA(n,e,t){var r={gender:e,genderProbability:t};return Object.assign({},n,r)}var KA=function(){function n(e){var t=e===void 0?{}:e,r=t.minFaceSize,i=t.scaleFactor,o=t.maxNumScales,a=t.scoreThresholds,s=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=i||.709,this._maxNumScales=o||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=s,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(u){return typeof u!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return typeof u!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(n.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),n}();function C7(n,e){function t(u,l){var c=An(n(9*u),[3,3,u,1]),h=Tt(n(u)),d=Tt(n(u)),p=Tt(n(u)),m=Tt(n(u));return e.push({paramPath:l+"/filters"},{paramPath:l+"/batch_norm_scale"},{paramPath:l+"/batch_norm_offset"},{paramPath:l+"/batch_norm_mean"},{paramPath:l+"/batch_norm_variance"}),{filters:c,batch_norm_scale:h,batch_norm_offset:d,batch_norm_mean:p,batch_norm_variance:m}}function r(u,l,c,h,d){var p=An(n(u*l*c*c),[c,c,u,l]),m=Tt(n(l));return e.push({paramPath:h+"/filters"},{paramPath:h+"/"+(d?"batch_norm_offset":"bias")}),{filters:p,bias:m}}function i(u,l,c,h){var d=r(u,l,c,h,!0),p=d.filters,m=d.bias;return{filters:p,batch_norm_offset:m}}function o(u,l,c){var h=t(u,c+"/depthwise_conv"),d=i(u,l,1,c+"/pointwise_conv");return{depthwise_conv:h,pointwise_conv:d}}function a(){var u=i(3,32,3,"mobilenetv1/conv_0"),l=o(32,64,"mobilenetv1/conv_1"),c=o(64,128,"mobilenetv1/conv_2"),h=o(128,128,"mobilenetv1/conv_3"),d=o(128,256,"mobilenetv1/conv_4"),p=o(256,256,"mobilenetv1/conv_5"),m=o(256,512,"mobilenetv1/conv_6"),g=o(512,512,"mobilenetv1/conv_7"),y=o(512,512,"mobilenetv1/conv_8"),v=o(512,512,"mobilenetv1/conv_9"),w=o(512,512,"mobilenetv1/conv_10"),_=o(512,512,"mobilenetv1/conv_11"),x=o(512,1024,"mobilenetv1/conv_12"),C=o(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:l,conv_2:c,conv_3:h,conv_4:d,conv_5:p,conv_6:m,conv_7:g,conv_8:y,conv_9:v,conv_10:w,conv_11:_,conv_12:x,conv_13:C}}function s(){var u=i(1024,256,1,"prediction_layer/conv_0"),l=i(256,512,3,"prediction_layer/conv_1"),c=i(512,128,1,"prediction_layer/conv_2"),h=i(128,256,3,"prediction_layer/conv_3"),d=i(256,128,1,"prediction_layer/conv_4"),p=i(128,256,3,"prediction_layer/conv_5"),m=i(256,64,1,"prediction_layer/conv_6"),g=i(64,128,3,"prediction_layer/conv_7"),y=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),v=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),w=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),_=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),x=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),C=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),A=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),T=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),E=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),I=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),S=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),N=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),P={box_encoding_predictor:y,class_predictor:v},k={box_encoding_predictor:w,class_predictor:_},j={box_encoding_predictor:x,class_predictor:C},B={box_encoding_predictor:A,class_predictor:T},W={box_encoding_predictor:E,class_predictor:I},X={box_encoding_predictor:S,class_predictor:N};return{conv_0:u,conv_1:l,conv_2:c,conv_3:h,conv_4:d,conv_5:p,conv_6:m,conv_7:g,box_predictor_0:P,box_predictor_1:k,box_predictor_2:j,box_predictor_3:B,box_predictor_4:W,box_predictor_5:X}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:s}}function I7(n){var e=[],t=Xi(n),r=t.extractWeights,i=t.getRemainingWeights,o=C7(r,e),a=o.extractMobilenetV1Params,s=o.extractPredictionLayerParams,u=a(),l=s(),c=y1(r(5118*4),[1,5118,4]),h={extra_dim:c};if(e.push({paramPath:"output_layer/extra_dim"}),i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:u,prediction_layer:l,output_layer:h},paramMappings:e}}function T7(n,e){var t=ta(n,e);function r(l,c,h){var d=t(l+"/Conv2d_"+c+"_pointwise/weights",4,h+"/filters"),p=t(l+"/Conv2d_"+c+"_pointwise/convolution_bn_offset",1,h+"/batch_norm_offset");return{filters:d,batch_norm_offset:p}}function i(l){var c="mobilenetv1/conv_"+l,h="MobilenetV1/Conv2d_"+l+"_depthwise",d=c+"/depthwise_conv",p=c+"/pointwise_conv",m=t(h+"/depthwise_weights",4,d+"/filters"),g=t(h+"/BatchNorm/gamma",1,d+"/batch_norm_scale"),y=t(h+"/BatchNorm/beta",1,d+"/batch_norm_offset"),v=t(h+"/BatchNorm/moving_mean",1,d+"/batch_norm_mean"),w=t(h+"/BatchNorm/moving_variance",1,d+"/batch_norm_variance");return{depthwise_conv:{filters:m,batch_norm_scale:g,batch_norm_offset:y,batch_norm_mean:v,batch_norm_variance:w},pointwise_conv:r("MobilenetV1",l,p)}}function o(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}}function a(l,c){var h=t(l+"/weights",4,c+"/filters"),d=t(l+"/biases",1,c+"/bias");return{filters:h,bias:d}}function s(l){var c=a("Prediction/BoxPredictor_"+l+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+l+"/box_encoding_predictor"),h=a("Prediction/BoxPredictor_"+l+"/ClassPredictor","prediction_layer/box_predictor_"+l+"/class_predictor");return{box_encoding_predictor:c,class_predictor:h}}function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:u}}function S7(n){var e=[],t=T7(n,e),r=t.extractMobilenetV1Params,i=t.extractPredictionLayerParams,o=n["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!zp(o))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+o);var a={mobilenetv1:r(),prediction_layer:i(),output_layer:{extra_dim:o}};return Ki(n,e),{params:a,paramMappings:e}}function qr(n,e,t){return ue(function(){var r=_r(n,e.filters,t,"same");return r=Ne(r,e.batch_norm_offset),k1(r,0,6)})}var R7=.0010000000474974513;function k7(n,e,t){return ue(function(){var r=Lp(n,e.filters,t,"same");return r=zk(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,R7),k1(r,0,6)})}function A7(n){return[2,4,6,12].some(function(e){return e===n})?[2,2]:[1,1]}function P7(n,e){return ue(function(){var t=null,r=qr(n,e.conv_0,[2,2]),i=[e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13];if(i.forEach(function(o,a){var s=a+1,u=A7(s);r=k7(r,o.depthwise_conv,u),r=qr(r,o.pointwise_conv,[1,1]),s===11&&(t=r)}),t===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:t}})}function N7(n,e,t,r,i){var o=n.shape[0],a=Math.min(t,o),s=e.map(function(c,h){return{score:c,boxIndex:h}}).filter(function(c){return c.score>i}).sort(function(c,h){return h.score-c.score}),u=function(c){return c<=r?1:0},l=[];return s.forEach(function(c){if(!(l.length>=a)){for(var h=c.score,d=l.length-1;d>=0;--d){var p=D7(n,c.boxIndex,l[d]);if(p!==0&&(c.score*=u(p),c.score<=i))break}h===c.score&&l.push(c.boxIndex)}}),l}function D7(n,e,t){var r=n.arraySync(),i=Math.min(r[e][0],r[e][2]),o=Math.min(r[e][1],r[e][3]),a=Math.max(r[e][0],r[e][2]),s=Math.max(r[e][1],r[e][3]),u=Math.min(r[t][0],r[t][2]),l=Math.min(r[t][1],r[t][3]),c=Math.max(r[t][0],r[t][2]),h=Math.max(r[t][1],r[t][3]),d=(a-i)*(s-o),p=(c-u)*(h-l);if(d<=0||p<=0)return 0;var m=Math.max(i,u),g=Math.max(o,l),y=Math.min(a,c),v=Math.min(s,h),w=Math.max(y-m,0)*Math.max(v-g,0);return w/(d+p-w)}function O7(n){var e=Ot(Go(n,[1,0])),t=[Ft(e[2],e[0]),Ft(e[3],e[1])],r=[Ne(e[0],Tr(t[0],ae(2))),Ne(e[1],Tr(t[1],ae(2)))];return{sizes:t,centers:r}}function M7(n,e){var t=O7(n),r=t.sizes,i=t.centers,o=Ot(Go(e,[1,0])),a=Tr(vn(fy(Tr(o[2],ae(5))),r[0]),ae(2)),s=Ne(vn(Tr(o[0],ae(10)),r[0]),i[0]),u=Tr(vn(fy(Tr(o[3],ae(5))),r[1]),ae(2)),l=Ne(vn(Tr(o[1],ae(10)),r[1]),i[1]);return Go(Yn([Ft(s,a),Ft(l,u),Ne(s,a),Ne(l,u)]),[1,0])}function F7(n,e,t){return ue(function(){var r=n.shape[0],i=M7(Pr(Hs(t.extra_dim,[r,1,1]),[-1,4]),Pr(n,[-1,4]));i=Pr(i,[r,i.shape[0]/r,4]);var o=Vk(hi(e,[0,0,1],[-1,-1,-1])),a=hi(o,[0,0,0],[-1,-1,1]);a=Pr(a,[r,a.shape[1]]);var s=Ot(i),u=Ot(a);return{boxes:s,scores:u}})}function ds(n,e){return ue(function(){var t=n.shape[0],r=Pr(Mr(n,e.box_encoding_predictor),[t,-1,1,4]),i=Pr(Mr(n,e.class_predictor),[t,-1,3]);return{boxPredictionEncoding:r,classPrediction:i}})}function L7(n,e,t){return ue(function(){var r=qr(n,t.conv_0,[1,1]),i=qr(r,t.conv_1,[2,2]),o=qr(i,t.conv_2,[1,1]),a=qr(o,t.conv_3,[2,2]),s=qr(a,t.conv_4,[1,1]),u=qr(s,t.conv_5,[2,2]),l=qr(u,t.conv_6,[1,1]),c=qr(l,t.conv_7,[2,2]),h=ds(e,t.box_predictor_0),d=ds(n,t.box_predictor_1),p=ds(i,t.box_predictor_2),m=ds(a,t.box_predictor_3),g=ds(u,t.box_predictor_4),y=ds(c,t.box_predictor_5),v=Dt([h.boxPredictionEncoding,d.boxPredictionEncoding,p.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding,y.boxPredictionEncoding],1),w=Dt([h.classPrediction,d.classPrediction,p.classPrediction,m.classPrediction,g.classPrediction,y.classPrediction],1);return{boxPredictions:v,classPredictions:w}})}var Gp=function(){function n(e){var t=e===void 0?{}:e,r=t.minConfidence,i=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=i||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(n.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),n}(),XA=function(n){Ie(e,n);function e(){return n.call(this,"SsdMobilenetv1")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return ue(function(){var i=t.toBatchTensor(512,!1).toFloat(),o=Ft(vn(i,ae(.007843137718737125)),ae(1)),a=P7(o,r.mobilenetv1),s=L7(a.out,a.conv11,r.prediction_layer),u=s.boxPredictions,l=s.classPredictions;return F7(u,l,r.output_layer)})},e.prototype.forward=function(t){return ve(this,void 0,void 0,function(){var r;return ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Wt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.locateFaces=function(t,r){return r===void 0&&(r={}),ve(this,void 0,void 0,function(){var i,o,a,s,u,l,c,h,d,p,m,g,y,v,w,_,x,C,A,T,E;return ge(this,function(I){switch(I.label){case 0:return i=new Gp(r),o=i.maxResults,a=i.minConfidence,[4,Wt(t)];case 1:for(s=I.sent(),u=this.forwardInput(s),l=u.boxes,c=u.scores,h=l[0],d=c[0],p=1;p<l.length;p++)l[p].dispose(),c[p].dispose();return y=(g=Array).from,[4,d.data()];case 2:return m=y.apply(g,[I.sent()]),v=.5,w=N7(h,m,o,v,a),_=s.getReshapedInputDimensions(0),x=s.inputSize,C=x/_.width,A=x/_.height,T=h.arraySync(),E=w.map(function(S){var N=[Math.max(0,T[S][0]),Math.min(1,T[S][2])].map(function(X){return X*A}),P=N[0],k=N[1],j=[Math.max(0,T[S][1]),Math.min(1,T[S][3])].map(function(X){return X*C}),B=j[0],W=j[1];return new mi(m[S],new G1(B,P,W-B,k-P),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),h.dispose(),d.dispose(),[2,E]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return S7(t)},e.prototype.extractParams=function(t){return I7(t)},e}(qi);(function(n){Ie(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(XA);var V7=.4,B7=[new He(.738768,.874946),new He(2.42204,2.65704),new He(4.30971,7.04493),new He(10.246,4.59428),new He(12.6868,11.8741)],U7=[new He(1.603231,2.094468),new He(6.041143,7.080126),new He(2.882459,3.518061),new He(4.266906,5.178857),new He(9.041765,10.66308)],j7=[117.001,114.697,97.404],z7="tiny_yolov2_model",W7="tiny_yolov2_separable_conv_model",qh=function(n){return typeof n=="number"};function $7(n){if(!n)throw new Error("invalid config: "+n);if(typeof n.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+n.withSeparableConvs);if(!qh(n.iouThreshold)||n.iouThreshold<0||n.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+n.iouThreshold);if(!Array.isArray(n.classes)||!n.classes.length||!n.classes.every(function(e){return typeof e=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(n.classes));if(!Array.isArray(n.anchors)||!n.anchors.length||!n.anchors.map(function(e){return e||{}}).every(function(e){return qh(e.x)&&qh(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(n.anchors));if(n.meanRgb&&(!Array.isArray(n.meanRgb)||n.meanRgb.length!==3||!n.meanRgb.every(qh)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(n.meanRgb))}function rw(n){return ue(function(){var e=vn(n,ae(.10000000149011612));return Ne(ct(Ft(n,e)),e)})}function to(n,e){return ue(function(){var t=Ya(n,[[0,0],[1,1],[1,1],[0,0]]);return t=_r(t,e.conv.filters,[1,1],"valid"),t=Ft(t,e.bn.sub),t=vn(t,e.bn.truediv),t=Ne(t,e.conv.bias),rw(t)})}function no(n,e){return ue(function(){var t=Ya(n,[[0,0],[1,1],[1,1],[0,0]]);return t=D1(t,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),t=Ne(t,e.bias),rw(t)})}function H7(n,e){var t=Hp(n,e);function r(a,s){var u=Tt(n(a)),l=Tt(n(a));return e.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:l}}function i(a,s,u){var l=t(a,s,3,u+"/conv"),c=r(s,u+"/bn");return{conv:l,bn:c}}var o=Z1(n,e);return{extractConvParams:t,extractConvWithBatchNormParams:i,extractSeparableConvParams:o}}function G7(n,e,t,r){var i=Xi(n),o=i.extractWeights,a=i.getRemainingWeights,s=[],u=H7(o,s),l=u.extractConvParams,c=u.extractConvWithBatchNormParams,h=u.extractSeparableConvParams,d;if(e.withSeparableConvs){var p=r[0],m=r[1],g=r[2],y=r[3],v=r[4],w=r[5],_=r[6],x=r[7],C=r[8],A=e.isFirstLayerConv2d?l(p,m,3,"conv0"):h(p,m,"conv0"),T=h(m,g,"conv1"),E=h(g,y,"conv2"),I=h(y,v,"conv3"),S=h(v,w,"conv4"),N=h(w,_,"conv5"),P=x?h(_,x,"conv6"):void 0,k=C?h(x,C,"conv7"):void 0,j=l(C||x||_,5*t,1,"conv8");d={conv0:A,conv1:T,conv2:E,conv3:I,conv4:S,conv5:N,conv6:P,conv7:k,conv8:j}}else{var p=r[0],m=r[1],g=r[2],y=r[3],v=r[4],w=r[5],_=r[6],x=r[7],C=r[8],A=c(p,m,"conv0"),T=c(m,g,"conv1"),E=c(g,y,"conv2"),I=c(y,v,"conv3"),S=c(v,w,"conv4"),N=c(w,_,"conv5"),P=c(_,x,"conv6"),k=c(x,C,"conv7"),j=l(C,5*t,1,"conv8");d={conv0:A,conv1:T,conv2:E,conv3:I,conv4:S,conv5:N,conv6:P,conv7:k,conv8:j}}if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{params:d,paramMappings:s}}function q7(n,e){var t=ta(n,e);function r(s){var u=t(s+"/sub",1),l=t(s+"/truediv",1);return{sub:u,truediv:l}}function i(s){var u=t(s+"/filters",4),l=t(s+"/bias",1);return{filters:u,bias:l}}function o(s){var u=i(s+"/conv"),l=r(s+"/bn");return{conv:u,bn:l}}var a=ew(t);return{extractConvParams:i,extractConvWithBatchNormParams:o,extractSeparableConvParams:a}}function K7(n,e){var t=[],r=q7(n,t),i=r.extractConvParams,o=r.extractConvWithBatchNormParams,a=r.extractSeparableConvParams,s;if(e.withSeparableConvs){var u=e.filterSizes&&e.filterSizes.length||9;s={conv0:e.isFirstLayerConv2d?i("conv0"):a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:u>7?a("conv6"):void 0,conv7:u>8?a("conv7"):void 0,conv8:i("conv8")}}else s={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return Ki(n,t),{params:s,paramMappings:t}}var g2;(function(n){n[n.XS=224]="XS",n[n.SM=320]="SM",n[n.MD=416]="MD",n[n.LG=608]="LG"})(g2||(g2={}));var iw=function(){function n(e){var t=e===void 0?{}:e,r=t.inputSize,i=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=i||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),n}(),QA=function(n){Ie(e,n);function e(t){var r=n.call(this,"TinyYolov2")||this;return $7(t),r._config=t,r}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,r){var i=to(t,r.conv0);return i=Vt(i,[2,2],[2,2],"same"),i=to(i,r.conv1),i=Vt(i,[2,2],[2,2],"same"),i=to(i,r.conv2),i=Vt(i,[2,2],[2,2],"same"),i=to(i,r.conv3),i=Vt(i,[2,2],[2,2],"same"),i=to(i,r.conv4),i=Vt(i,[2,2],[2,2],"same"),i=to(i,r.conv5),i=Vt(i,[2,2],[1,1],"same"),i=to(i,r.conv6),i=to(i,r.conv7),Mr(i,r.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,r){var i=this.config.isFirstLayerConv2d?rw(Mr(t,r.conv0,"valid",!1)):no(t,r.conv0);return i=Vt(i,[2,2],[2,2],"same"),i=no(i,r.conv1),i=Vt(i,[2,2],[2,2],"same"),i=no(i,r.conv2),i=Vt(i,[2,2],[2,2],"same"),i=no(i,r.conv3),i=Vt(i,[2,2],[2,2],"same"),i=no(i,r.conv4),i=Vt(i,[2,2],[2,2],"same"),i=no(i,r.conv5),i=Vt(i,[2,2],[1,1],"same"),i=r.conv6?no(i,r.conv6):i,i=r.conv7?no(i,r.conv7):i,Mr(i,r.conv8,"valid",!1)},e.prototype.forwardInput=function(t,r){var i=this,o=this.params;if(!o)throw new Error("TinyYolov2 - load model before inference");return ue(function(){var a=t.toBatchTensor(r,!1).toFloat();return a=i.config.meanRgb?Gc(a,i.config.meanRgb):a,a=a.div(ae(256)),i.config.withSeparableConvs?i.runMobilenet(a,o):i.runTinyYolov2(a,o)})},e.prototype.forward=function(t,r){return ve(this,void 0,void 0,function(){var i;return ge(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,Wt(t)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent()]}})})},e.prototype.detect=function(t,r){return r===void 0&&(r={}),ve(this,void 0,void 0,function(){var i,o,a,s,u,l,c,h,d,p,m,g,y,v,w=this;return ge(this,function(_){switch(_.label){case 0:return i=new iw(r),o=i.inputSize,a=i.scoreThreshold,[4,Wt(t)];case 1:return s=_.sent(),[4,this.forwardInput(s,o)];case 2:return u=_.sent(),l=ue(function(){return Ot(u)[0].expandDims()}),c={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(l,s.getReshapedInputDimensions(0),a)];case 3:return h=_.sent(),u.dispose(),l.dispose(),d=h.map(function(x){return x.box}),p=h.map(function(x){return x.score}),m=h.map(function(x){return x.classScore}),g=h.map(function(x){return w.config.classes[x.label]}),y=vc(d.map(function(x){return x.rescale(o)}),p,this.config.iouThreshold,!0),v=y.map(function(x){return new bA(p[x],m[x],g[x],d[x],c)}),[2,v]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return K7(t,this.config)},e.prototype.extractParams=function(t){var r=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,i=r?r.length:void 0;if(i!==7&&i!==8&&i!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+i+" filterSizes in config");return G7(t,this.config,this.boxEncodingSize,r)},e.prototype.extractBoxes=function(t,r,i){return ve(this,void 0,void 0,function(){var o,a,s,u,l,c,h,d,p,m,g,y,v,w,_,x,C,A,T,E,I,S,N,P,k,j,B,W,X,V=this;return ge(this,function($){switch($.label){case 0:return o=r.width,a=r.height,s=Math.max(o,a),u=s/o,l=s/a,c=t.shape[1],h=this.config.anchors.length,d=ue(function(){var G=t.reshape([c,c,h,V.boxEncodingSize]),te=G.slice([0,0,0,0],[c,c,h,4]),re=G.slice([0,0,0,4],[c,c,h,1]),oe=V.withClassScores?Hi(G.slice([0,0,0,5],[c,c,h,V.config.classes.length]),3):ae(0);return[te,re,oe]}),p=d[0],m=d[1],g=d[2],y=[],[4,m.array()];case 1:return v=$.sent(),[4,p.array()];case 2:w=$.sent(),_=0,$.label=3;case 3:if(!(_<c))return[3,12];x=0,$.label=4;case 4:if(!(x<c))return[3,11];C=0,$.label=5;case 5:return C<h?(A=xv(v[_][x][C][0]),!i||A>i?(T=(x+xv(w[_][x][C][0]))/c*u,E=(_+xv(w[_][x][C][1]))/c*l,I=Math.exp(w[_][x][C][2])*this.config.anchors[C].x/c*u,S=Math.exp(w[_][x][C][3])*this.config.anchors[C].y/c*l,N=T-I/2,P=E-S/2,k={row:_,col:x,anchor:C},this.withClassScores?[4,this.extractPredictedClass(g,k)]:[3,7]):[3,9]):[3,10];case 6:return X=$.sent(),[3,8];case 7:X={classScore:1,label:0},$.label=8;case 8:j=X,B=j.classScore,W=j.label,y.push(dn({box:new Wp(N,P,N+I,P+S),score:A,classScore:A*B,label:W},k)),$.label=9;case 9:return C++,[3,5];case 10:return x++,[3,4];case 11:return _++,[3,3];case 12:return p.dispose(),m.dispose(),g.dispose(),[2,y]}})})},e.prototype.extractPredictedClass=function(t,r){return ve(this,void 0,void 0,function(){var i,o,a,s;return ge(this,function(u){switch(u.label){case 0:return i=r.row,o=r.col,a=r.anchor,[4,t.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(l,c){return s[i][o][a][c]}).map(function(l,c){return{classScore:l,label:c}}).reduce(function(l,c){return l.classScore>c.classScore?l:c})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(qi),X7=function(n){Ie(e,n);function e(t){t===void 0&&(t=!0);var r=this,i=Object.assign({},{withSeparableConvs:t,iouThreshold:V7,classes:["face"]},t?{anchors:U7,meanRgb:j7}:{anchors:B7,withClassScores:!0});return r=n.call(this,i)||this,r}return Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return ve(this,void 0,void 0,function(){var i;return ge(this,function(o){switch(o.label){case 0:return[4,this.detect(t,r)];case 1:return i=o.sent(),[2,i.map(function(a){return new mi(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?W7:z7},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e}(QA),xy=function(n){Ie(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return e}(iw),qc=function(){function n(){}return n.prototype.then=function(e){return ve(this,void 0,void 0,function(){var t;return ge(this,function(r){switch(r.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[r.sent()])]}})})},n.prototype.run=function(){return ve(this,void 0,void 0,function(){return ge(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},n}();function qp(n,e,t,r,i){return i===void 0&&(i=function(o){var a=o.alignedRect;return a}),ve(this,void 0,void 0,function(){var o,a,s,u,l;return ge(this,function(c){switch(c.label){case 0:return o=n.map(function(h){return r7(h)?i(h):h.detection}),s=r,s?[3,5]:e instanceof lt?[4,Y1(e,o)]:[3,2];case 1:return u=c.sent(),[3,4];case 2:return[4,Q1(e,o)];case 3:u=c.sent(),c.label=4;case 4:s=u,c.label=5;case 5:return a=s,[4,t(a)];case 6:return l=c.sent(),a.forEach(function(h){return h instanceof lt&&h.dispose()}),[2,l]}})})}function ow(n,e,t,r,i){return ve(this,void 0,void 0,function(){var o=this;return ge(this,function(a){return[2,qp([n],e,function(s){return ve(o,void 0,void 0,function(){return ge(this,function(u){return[2,t(s[0])]})})},r,i)]})})}function Q7(n){return ue(function(){return Yn(Ot(n,3).reverse(),3)})}var Kh=2,$f=12;function Y7(n,e){var t=Hp(n,e),r=J1(n,e);function i(l,c){var h=Tt(n(l));return e.push({paramPath:c}),h}function o(l,c,h){h===void 0&&(h=!1);var d=t(l[0],l[1],3,c+"/conv1"),p=i(l[1],c+"/prelu1_alpha"),m=t(l[1],l[2],3,c+"/conv2"),g=i(l[2],c+"/prelu2_alpha"),y=t(l[2],l[3],h?2:3,c+"/conv3"),v=i(l[3],c+"/prelu3_alpha");return{conv1:d,prelu1_alpha:p,conv2:m,prelu2_alpha:g,conv3:y,prelu3_alpha:v}}function a(){var l=o([3,10,16,32],"pnet"),c=t(32,2,1,"pnet/conv4_1"),h=t(32,4,1,"pnet/conv4_2");return dn(dn({},l),{conv4_1:c,conv4_2:h})}function s(){var l=o([3,28,48,64],"rnet",!0),c=r(576,128,"rnet/fc1"),h=i(128,"rnet/prelu4_alpha"),d=r(128,2,"rnet/fc2_1"),p=r(128,4,"rnet/fc2_2");return dn(dn({},l),{fc1:c,prelu4_alpha:h,fc2_1:d,fc2_2:p})}function u(){var l=o([3,32,64,64],"onet"),c=t(64,128,2,"onet/conv4"),h=i(128,"onet/prelu4_alpha"),d=r(1152,256,"onet/fc1"),p=i(256,"onet/prelu5_alpha"),m=r(256,2,"onet/fc2_1"),g=r(256,4,"onet/fc2_2"),y=r(256,10,"onet/fc2_3");return dn(dn({},l),{conv4:c,prelu4_alpha:h,fc1:d,prelu5_alpha:p,fc2_1:m,fc2_2:g,fc2_3:y})}return{extractPNetParams:a,extractRNetParams:s,extractONetParams:u}}function J7(n){var e=Xi(n),t=e.extractWeights,r=e.getRemainingWeights,i=[],o=Y7(t,i),a=o.extractPNetParams,s=o.extractRNetParams,u=o.extractONetParams,l=a(),c=s(),h=u();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:l,rnet:c,onet:h},paramMappings:i}}function Z7(n,e){var t=ta(n,e);function r(c){var h=t(c+"/weights",4,c+"/filters"),d=t(c+"/bias",1);return{filters:h,bias:d}}function i(c){var h=t(c+"/weights",2),d=t(c+"/bias",1);return{weights:h,bias:d}}function o(c){return t(c,1)}function a(c){var h=r(c+"/conv1"),d=o(c+"/prelu1_alpha"),p=r(c+"/conv2"),m=o(c+"/prelu2_alpha"),g=r(c+"/conv3"),y=o(c+"/prelu3_alpha");return{conv1:h,prelu1_alpha:d,conv2:p,prelu2_alpha:m,conv3:g,prelu3_alpha:y}}function s(){var c=a("pnet"),h=r("pnet/conv4_1"),d=r("pnet/conv4_2");return dn(dn({},c),{conv4_1:h,conv4_2:d})}function u(){var c=a("rnet"),h=i("rnet/fc1"),d=o("rnet/prelu4_alpha"),p=i("rnet/fc2_1"),m=i("rnet/fc2_2");return dn(dn({},c),{fc1:h,prelu4_alpha:d,fc2_1:p,fc2_2:m})}function l(){var c=a("onet"),h=r("onet/conv4"),d=o("onet/prelu4_alpha"),p=i("onet/fc1"),m=o("onet/prelu5_alpha"),g=i("onet/fc2_1"),y=i("onet/fc2_2"),v=i("onet/fc2_3");return dn(dn({},c),{conv4:h,prelu4_alpha:d,fc1:p,prelu5_alpha:m,fc2_1:g,fc2_2:y,fc2_3:v})}return{extractPNetParams:s,extractRNetParams:u,extractONetParams:l}}function eH(n){var e=[],t=Z7(n,e),r=t.extractPNetParams,i=t.extractRNetParams,o=t.extractONetParams,a=r(),s=i(),u=o();return Ki(n,e),{params:{pnet:a,rnet:s,onet:u},paramMappings:e}}function by(n,e){var t=e[0],r=e[1];return{height:Math.floor(t*n),width:Math.floor(r*n)}}function tH(n,e,t){for(var r=t[0],i=t[1],o=$f/n,a=[],s=Math.min(r,i)*o,u=0;s>=12;)a.push(o*Math.pow(e,u)),s=s*e,u+=1;return a}var aw=function(n){Ie(e,n);function e(t,r,i,o){return n.call(this,{left:t,top:r,right:i,bottom:o},!0)||this}return e}(qo);function YA(n){return ue(function(){return vn(Ft(n,ae(127.5)),ae(.0078125))})}function Ys(n,e){return ue(function(){return Ne(ct(n),vn(e,Lf(ct(Lf(n)))))})}function sw(n,e,t){return t===void 0&&(t=!1),ue(function(){var r=Mr(n,e.conv1,"valid");return r=Ys(r,e.prelu1_alpha),r=Vt(r,t?[2,2]:[3,3],[2,2],"same"),r=Mr(r,e.conv2,"valid"),r=Ys(r,e.prelu2_alpha),r=t?r:Vt(r,[3,3],[2,2],"valid"),r=Mr(r,e.conv3,"valid"),r=Ys(r,e.prelu3_alpha),r})}function nH(n,e){return ue(function(){var t=sw(n,e,!0),r=Mr(t,e.conv4_1,"valid"),i=lr(Bp(r,3),3),o=Hi(Ft(r,i),3),a=Mr(t,e.conv4_2,"valid");return{prob:o,regions:a}})}function rH(n,e){return ue(function(){var t=by(e,n.shape.slice(1)),r=t.height,i=t.width,o=V1.resizeBilinear(n,[r,i]),a=YA(o);return Go(a,[0,2,1,3])})}function iH(n,e,t,r){for(var i=[],o=n.arraySync(),a=0;a<n.shape[0];a++)for(var s=0;s<n.shape[1];s++)o[a][s]>=r&&i.push(new He(s,a));var u=i.map(function(l){var c=new Wp(Math.round((l.y*Kh+1)/t),Math.round((l.x*Kh+1)/t),Math.round((l.y*Kh+$f)/t),Math.round((l.x*Kh+$f)/t)),h=o[l.y][l.x],d=e.arraySync(),p=new aw(d[l.y][l.x][0],d[l.y][l.x][1],d[l.y][l.x][2],d[l.y][l.x][3]);return{cell:c,score:h,region:p}});return u}function oH(n,e,t,r,i){i.stage1=[];var o=e.map(function(d){return ue(function(){var p={scale:d},m=rH(n,d),g=Date.now(),y=nH(m,r),v=y.prob,w=y.regions;p.pnet=Date.now()-g;var _=Ot(Ot(v,3)[1])[0],x=Ot(w)[0];return{scoresTensor:_,regionsTensor:x,scale:d,statsForScale:p}})}),a=o.map(function(d){var p=d.scoresTensor,m=d.regionsTensor,g=d.scale,y=d.statsForScale,v=iH(p,m,g,t);if(p.dispose(),m.dispose(),!v.length)return i.stage1.push(y),[];var w=Date.now(),_=vc(v.map(function(x){return x.cell}),v.map(function(x){return x.score}),.5);return y.nms=Date.now()-w,y.numBoxes=_.length,i.stage1.push(y),_.map(function(x){return v[x]})}),s=a.reduce(function(d,p){return d.concat(p)},[]),u=[],l=[];if(s.length>0){var c=Date.now(),h=vc(s.map(function(d){return d.cell}),s.map(function(d){return d.score}),.7);i.stage1_nms=Date.now()-c,l=h.map(function(d){return s[d].score}),u=h.map(function(d){return s[d]}).map(function(d){var p=d.cell,m=d.region;return new Wp(p.left+m.left*p.width,p.top+m.top*p.height,p.right+m.right*p.width,p.bottom+m.bottom*p.height).toSquare().round()})}return{boxes:u,scores:l}}function JA(n,e,t){var r=t.width,i=t.height;return ve(this,void 0,void 0,function(){var o,a,s,u=this;return ge(this,function(l){switch(l.label){case 0:return o=ja(n),[4,Promise.all(e.map(function(c){return ve(u,void 0,void 0,function(){var h,d,p,m,g,y,v,w;return ge(this,function(_){return h=c.padAtBorders(n.height,n.width),d=h.y,p=h.ey,m=h.x,g=h.ex,y=m-1,v=d-1,w=o.getImageData(y,v,g-y,p-v),[2,_n.isNodejs()?X1(w):createImageBitmap(w)]})})}))];case 1:return a=l.sent(),s=[],a.forEach(function(c){var h=$p({width:r,height:i}),d=ja(h);d.drawImage(c,0,0,r,i);for(var p=d.getImageData(0,0,r,i).data,m=[],g=0;g<p.length;g+=4)m.push(p[g+2]),m.push(p[g+1]),m.push(p[g]);s.push(m)}),[2,s.map(function(c){var h=ue(function(){var d=Go(An(c,[1,r,i,3]),[0,2,1,3]).toFloat();return YA(d)});return h})]}})})}function aH(n,e){return ue(function(){var t=sw(n,e),r=Pr(t,[t.shape[0],e.fc1.weights.shape[0]]),i=Zr(r,e.fc1),o=Ys(i,e.prelu4_alpha),a=Zr(o,e.fc2_1),s=lr(Bp(a,1),1),u=Hi(Ft(a,s),1),l=Zr(o,e.fc2_2),c=Ot(u,1)[1];return{scores:c,regions:l}})}function sH(n,e,t,r,i){return ve(this,void 0,void 0,function(){var o,a,s,u,l,c,h,d,p,m,g,y,v,w;return ge(this,function(_){switch(_.label){case 0:return o=Date.now(),[4,JA(n,e,{width:24,height:24})];case 1:return a=_.sent(),i.stage2_extractImagePatches=Date.now()-o,o=Date.now(),s=a.map(function(x){var C=aH(x,r);return x.dispose(),C}),i.stage2_rnet=Date.now()-o,u=s.length>1?Dt(s.map(function(x){return x.scores})):s[0].scores,h=(c=Array).from,[4,u.data()];case 2:return l=h.apply(c,[_.sent()]),u.dispose(),d=l.map(function(x,C){return{score:x,idx:C}}).filter(function(x){return x.score>t}).map(function(x){var C=x.idx;return C}),p=d.map(function(x){return e[x]}),m=d.map(function(x){return l[x]}),g=[],y=[],p.length>0&&(o=Date.now(),v=vc(p,m,.7),i.stage2_nms=Date.now()-o,w=v.map(function(x){var C=s[d[x]].regions.arraySync();return new aw(C[0][0],C[0][1],C[0][2],C[0][3])}),y=v.map(function(x){return m[x]}),g=v.map(function(x,C){return p[x].calibrate(w[C])})),s.forEach(function(x){x.regions.dispose(),x.scores.dispose()}),[2,{boxes:g,scores:y}]}})})}function uH(n,e){return ue(function(){var t=sw(n,e);t=Vt(t,[2,2],[2,2],"same"),t=Mr(t,e.conv4,"valid"),t=Ys(t,e.prelu4_alpha);var r=Pr(t,[t.shape[0],e.fc1.weights.shape[0]]),i=Zr(r,e.fc1),o=Ys(i,e.prelu5_alpha),a=Zr(o,e.fc2_1),s=lr(Bp(a,1),1),u=Hi(Ft(a,s),1),l=Zr(o,e.fc2_2),c=Zr(o,e.fc2_3),h=Ot(u,1)[1];return{scores:h,regions:l,points:c}})}function lH(n,e,t,r,i){return ve(this,void 0,void 0,function(){var o,a,s,u,l,c,h,d,p,m,g,y,v,w,_;return ge(this,function(x){switch(x.label){case 0:return o=Date.now(),[4,JA(n,e,{width:48,height:48})];case 1:return a=x.sent(),i.stage3_extractImagePatches=Date.now()-o,o=Date.now(),s=a.map(function(C){var A=uH(C,r);return C.dispose(),A}),i.stage3_onet=Date.now()-o,u=s.length>1?Dt(s.map(function(C){return C.scores})):s[0].scores,h=(c=Array).from,[4,u.data()];case 2:return l=h.apply(c,[x.sent()]),u.dispose(),d=l.map(function(C,A){return{score:C,idx:A}}).filter(function(C){return C.score>t}).map(function(C){var A=C.idx;return A}),p=d.map(function(C){var A=s[C].regions.arraySync();return new aw(A[0][0],A[0][1],A[0][2],A[0][3])}),m=d.map(function(C,A){return e[C].calibrate(p[A])}),g=d.map(function(C){return l[C]}),y=[],v=[],w=[],m.length>0&&(o=Date.now(),_=vc(m,g,.7,!1),i.stage3_nms=Date.now()-o,y=_.map(function(C){return m[C]}),v=_.map(function(C){return g[C]}),w=_.map(function(C,A){return Array(5).fill(0).map(function(T,E){var I=s[C].points.arraySync();return new He(I[0][E]*(y[A].width+1)+y[A].left,I[0][E+5]*(y[A].height+1)+y[A].top)})})),s.forEach(function(C){C.regions.dispose(),C.scores.dispose(),C.points.dispose()}),[2,{boxes:y,scores:v,points:w}]}})})}var cH=function(n){Ie(e,n);function e(){return n.call(this,"Mtcnn")||this}return e.prototype.load=function(t){return ve(this,void 0,void 0,function(){return ge(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.load.call(this,t)]})})},e.prototype.loadFromDisk=function(t){return ve(this,void 0,void 0,function(){return ge(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.loadFromDisk.call(this,t)]})})},e.prototype.forwardInput=function(t,r){return r===void 0&&(r={}),ve(this,void 0,void 0,function(){var i,o,a,s,u,l,c,h,d,p,m,g,y,v,w,_,x,C,A,T,E;return ge(this,function(I){switch(I.label){case 0:if(i=this.params,!i)throw new Error("Mtcnn - load model before inference");if(o=t.canvases[0],!o)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},s=Date.now(),u=ue(function(){return Q7(lr($1.fromPixels(o)).toFloat())}),l=function(S){return u.dispose(),a.total=Date.now()-s,S},c=u.shape.slice(1),h=c[0],d=c[1],p=new KA(r),m=p.minFaceSize,g=p.scaleFactor,y=p.maxNumScales,v=p.scoreThresholds,w=p.scaleSteps,_=(w||tH(m,g,[h,d])).filter(function(S){var N=by(S,[h,d]);return Math.min(N.width,N.height)>$f}).slice(0,y),a.scales=_,a.pyramid=_.map(function(S){return by(S,[h,d])}),x=Date.now(),[4,oH(u,_,v[0],i.pnet,a)];case 1:return C=I.sent(),a.total_stage1=Date.now()-x,C.boxes.length?(a.stage2_numInputBoxes=C.boxes.length,x=Date.now(),[4,sH(o,C.boxes,v[1],i.rnet,a)]):[2,l({results:[],stats:a})];case 2:return A=I.sent(),a.total_stage2=Date.now()-x,A.boxes.length?(a.stage3_numInputBoxes=A.boxes.length,x=Date.now(),[4,lH(o,A.boxes,v[2],i.onet,a)]):[2,l({results:[],stats:a})];case 3:return T=I.sent(),a.total_stage3=Date.now()-x,E=T.boxes.map(function(S,N){return tw(q1({},new mi(T.scores[N],new G1(S.left/d,S.top/h,S.width/d,S.height/h),{height:h,width:d})),new U8(T.points[N].map(function(P){return P.sub(new He(S.left,S.top)).div(new He(S.width,S.height))}),{width:S.width,height:S.height}))}),[2,l({results:E,stats:a})]}})})},e.prototype.forward=function(t,r){return r===void 0&&(r={}),ve(this,void 0,void 0,function(){var i;return ge(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,Wt(t)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent().results]}})})},e.prototype.forwardWithStats=function(t,r){return r===void 0&&(r={}),ve(this,void 0,void 0,function(){var i;return ge(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,Wt(t)];case 1:return[2,i.apply(this,[o.sent(),r])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return eH(t)},e.prototype.extractParams=function(t){return J7(t)},e}(qi),hH=.4,dH=[new He(1.603231,2.094468),new He(6.041143,7.080126),new He(2.882459,3.518061),new He(4.266906,5.178857),new He(9.041765,10.66308)],fH=[117.001,114.697,97.404],pH=function(n){Ie(e,n);function e(){var t=this,r={withSeparableConvs:!0,iouThreshold:hH,classes:["face"],anchors:dH,meanRgb:fH,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t=n.call(this,r)||this,t}return Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return ve(this,void 0,void 0,function(){var i;return ge(this,function(o){switch(o.label){case 0:return[4,this.detect(t,r)];case 1:return i=o.sent(),[2,i.map(function(a){return new mi(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e}(QA),gn={ssdMobilenetv1:new XA,tinyFaceDetector:new pH,tinyYolov2:new X7,mtcnn:new cH,faceLandmark68Net:new zA,faceLandmark68TinyNet:new v7,faceRecognitionNet:new E7,faceExpressionNet:new n7,ageGenderNet:new d7},ZA=function(n){Ie(e,n);function e(t,r,i){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.extractedFaces=i,o}return e}(qc),uw=function(n){Ie(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ve(this,void 0,void 0,function(){var t,r,i=this;return ge(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,qp(t,this.input,function(a){return ve(i,void 0,void 0,function(){return ge(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return gn.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,t.map(function(a,s){return BA(a,r[s])})]}})})},e.prototype.withAgeAndGender=function(){return new dw(this,this.input)},e}(ZA),lw=function(n){Ie(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ve(this,void 0,void 0,function(){var t,r;return ge(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,ow(t,this.input,function(o){return gn.faceExpressionNet.predictExpressions(o)},this.extractedFaces)]:[2];case 2:return r=i.sent(),[2,BA(t,r)]}})})},e.prototype.withAgeAndGender=function(){return new fw(this,this.input)},e}(ZA),cw=function(n){Ie(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new pw(this,this.input)},e.prototype.withFaceDescriptors=function(){return new vw(this,this.input)},e}(uw),hw=function(n){Ie(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new mw(this,this.input)},e.prototype.withFaceDescriptor=function(){return new gw(this,this.input)},e}(lw),eP=function(n){Ie(e,n);function e(t,r,i){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.extractedFaces=i,o}return e}(qc),dw=function(n){Ie(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ve(this,void 0,void 0,function(){var t,r,i=this;return ge(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,qp(t,this.input,function(a){return ve(i,void 0,void 0,function(){return ge(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return gn.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,t.map(function(a,s){var u=r[s],l=u.age,c=u.gender,h=u.genderProbability;return GA(qA(a,c,h),l)})]}})})},e.prototype.withFaceExpressions=function(){return new uw(this,this.input)},e}(eP),fw=function(n){Ie(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ve(this,void 0,void 0,function(){var t,r,i,o,a;return ge(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?[4,ow(t,this.input,function(u){return gn.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=s.sent(),i=r.age,o=r.gender,a=r.genderProbability,[2,GA(qA(t,o,a),i)]}})})},e.prototype.withFaceExpressions=function(){return new lw(this,this.input)},e}(eP),pw=function(n){Ie(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new cw(this,this.input)},e.prototype.withFaceDescriptors=function(){return new vw(this,this.input)},e}(dw),mw=function(n){Ie(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new hw(this,this.input)},e.prototype.withFaceDescriptor=function(){return new gw(this,this.input)},e}(fw),tP=function(n){Ie(e,n);function e(t,r){var i=n.call(this)||this;return i.parentTask=t,i.input=r,i}return e}(qc),vw=function(n){Ie(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ve(this,void 0,void 0,function(){var t,r;return ge(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),[4,qp(t,this.input,function(o){return Promise.all(o.map(function(a){return gn.faceRecognitionNet.computeFaceDescriptor(a)}))},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=i.sent(),[2,r.map(function(o,a){return HA(t[a],o)})]}})})},e.prototype.withFaceExpressions=function(){return new cw(this,this.input)},e.prototype.withAgeAndGender=function(){return new pw(this,this.input)},e}(tP),gw=function(n){Ie(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ve(this,void 0,void 0,function(){var t,r;return ge(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,ow(t,this.input,function(o){return gn.faceRecognitionNet.computeFaceDescriptor(o)},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=i.sent(),[2,HA(t,r)]}})})},e.prototype.withFaceExpressions=function(){return new hw(this,this.input)},e.prototype.withAgeAndGender=function(){return new mw(this,this.input)},e}(tP),nP=function(n){Ie(e,n);function e(t,r,i){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.useTinyLandmarkNet=i,o}return Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?gn.faceLandmark68TinyNet:gn.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(qc),mH=function(n){Ie(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ve(this,void 0,void 0,function(){var t,r,i,o,a,s=this;return ge(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return t=u.sent(),r=t.map(function(l){return l.detection}),this.input instanceof lt?[4,Y1(this.input,r)]:[3,3];case 2:return o=u.sent(),[3,5];case 3:return[4,Q1(this.input,r)];case 4:o=u.sent(),u.label=5;case 5:return i=o,[4,Promise.all(i.map(function(l){return s.landmarkNet.detectLandmarks(l)}))];case 6:return a=u.sent(),i.forEach(function(l){return l instanceof lt&&l.dispose()}),[2,t.map(function(l,c){return tw(l,a[c])})]}})})},e.prototype.withFaceExpressions=function(){return new cw(this,this.input)},e.prototype.withAgeAndGender=function(){return new pw(this,this.input)},e.prototype.withFaceDescriptors=function(){return new vw(this,this.input)},e}(nP),vH=function(n){Ie(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ve(this,void 0,void 0,function(){var t,r,i,o,a;return ge(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?(r=t.detection,this.input instanceof lt?[4,Y1(this.input,[r])]:[3,3]):[2];case 2:return o=s.sent(),[3,5];case 3:return[4,Q1(this.input,[r])];case 4:o=s.sent(),s.label=5;case 5:return i=o,[4,this.landmarkNet.detectLandmarks(i[0])];case 6:return a=s.sent(),i.forEach(function(u){return u instanceof lt&&u.dispose()}),[2,tw(t,a)]}})})},e.prototype.withFaceExpressions=function(){return new hw(this,this.input)},e.prototype.withAgeAndGender=function(){return new mw(this,this.input)},e.prototype.withFaceDescriptor=function(){return new gw(this,this.input)},e}(nP),rP=function(n){Ie(e,n);function e(t,r){r===void 0&&(r=new Gp);var i=n.call(this)||this;return i.input=t,i.options=r,i}return e}(qc),gH=function(n){Ie(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ve(this,void 0,void 0,function(){var t,r,i,o;return ge(this,function(a){switch(a.label){case 0:return t=this,r=t.input,i=t.options,i instanceof KA?[4,gn.mtcnn.forward(r,i)]:[3,2];case 1:return[2,a.sent().map(function(s){return s.detection})];case 2:if(o=i instanceof xy?function(s){return gn.tinyFaceDetector.locateFaces(s,i)}:i instanceof Gp?function(s){return gn.ssdMobilenetv1.locateFaces(s,i)}:i instanceof iw?function(s){return gn.tinyYolov2.locateFaces(s,i)}:null,!o)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,o(r)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(r){return ve(t,void 0,void 0,function(){var i;return ge(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i.map(function(a){return q1({},a)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new mH(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new uw(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new dw(this.runAndExtendWithFaceDetections(),this.input)},e}(rP),yH=function(n){Ie(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ve(this,void 0,void 0,function(){var t,r;return ge(this,function(i){switch(i.label){case 0:return[4,new gH(this.input,this.options)];case 1:return t=i.sent(),r=t[0],t.forEach(function(o){o.score>r.score&&(r=o)}),[2,r]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(r){return ve(t,void 0,void 0,function(){var i;return ge(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i?q1({},i):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new vH(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new lw(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new fw(this.runAndExtendWithFaceDetection(),this.input)},e}(rP);function y2(n,e){return e===void 0&&(e=new Gp),new yH(n,e)}function wH(n,e){if(n.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(n),r=Array.from(e);return Math.sqrt(t.map(function(i,o){return i-r[o]}).reduce(function(i,o){return i+Math.pow(o,2)},0))}(function(){function n(e,t){t===void 0&&(t=.6),this._distanceThreshold=t;var r=Array.isArray(e)?e:[e];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var i=1,o=function(){return"person "+i++};this._labeledDescriptors=r.map(function(a){if(a instanceof $h)return a;if(a instanceof Float32Array)return new $h(o(),[a]);if(a.descriptor&&a.descriptor instanceof Float32Array)return new $h(o(),[a.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(n.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),n.prototype.computeMeanDistance=function(e,t){return t.map(function(r){return wH(r,e)}).reduce(function(r,i){return r+i},0)/(t.length||1)},n.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(r){var i=r.descriptors,o=r.label;return new d2(o,t.computeMeanDistance(e,i))}).reduce(function(r,i){return r.distance<i.distance?r:i})},n.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new d2("unknown",t.distance)},n.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(e){return e.toJSON()})}},n.fromJSON=function(e){var t=e.labeledDescriptors.map(function(r){return $h.fromJSON(r)});return new n(t,e.distanceThreshold)},n})();const yw=({animeRecs:n=[],bookRecs:e=[],emotion:t="",onClose:r})=>{const{isAuthenticated:i,user:o}=Ec(A=>A.auth),[a,s]=Q.useState("anime"),[u,l]=Q.useState(0),[c,h]=Q.useState([]),[d,p]=Q.useState(null),m=a==="anime"?n:e,g=3,y=Math.max(1,Math.ceil(m.length/g));Q.useEffect(()=>{if(!i||!(o!=null&&o.email))return;(async()=>{try{const E=(await Ia(Ca(Ar(kn,"favorite"),vo("email","==",o.email)))).docs.map(N=>`anime-${N.data().name}`),S=(await Ia(Ca(Ar(kn,"favoriteBook"),vo("email","==",o.email)))).docs.map(N=>`books-${N.data().name}`);h([...E,...S])}catch(T){console.error("Error loading favorites:",T)}})()},[i,o==null?void 0:o.email]),Q.useEffect(()=>{if(y<=1)return;const A=setInterval(()=>{l(T=>(T+1)%y)},7e3);return()=>clearInterval(A)},[y,a]);const v=m.slice(u*g,(u+1)*g),w=()=>l(A=>(A+1)%y),_=()=>l(A=>(A-1+y)%y),x=A=>A?A.length>100?`${A.substring(0,100)}...`:A:"No description available",C=async(A,T)=>{if(!i||!(o!=null&&o.email)){alert("Please login to add favorites");return}const E=`${T}-${A.title}`,I=T==="anime"?"favorite":"favoriteBook";p(E);try{const S=Ca(Ar(kn,I),vo("email","==",o.email),vo("name","==",A.title)),N=await Ia(S);N.empty?(await _f(Ar(kn,I),{email:o.email,name:A.title,description:A.description,rating:A.rating,image:A.thumbnail,link:A.previewlink,createdAt:BR()}),h(P=>[...P,E])):(N.forEach(async P=>{await wf(P.ref)}),h(P=>P.filter(k=>k!==E)))}catch(S){console.error("Error toggling favorite:",S)}finally{p(null)}};return D.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4",children:D.jsxs("div",{className:"relative w-full max-w-4xl max-h-[90vh] overflow-y-auto overflow-x-hidden bg-purple-950 rounded-xl border border-purple-700",children:[D.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-purple-700",children:[D.jsxs("h2",{className:"text-2xl font-bold text-purple-200",children:["Recommended ",t," Content"]}),D.jsxs("div",{className:"flex items-center space-x-4",children:[D.jsxs("div",{className:"flex bg-purple-900 rounded-full p-1",children:[D.jsx("button",{className:`px-4 py-1 rounded-full text-sm font-medium ${a==="anime"?"bg-purple-600 text-white":"text-purple-300 hover:bg-purple-800"}`,onClick:()=>{s("anime"),l(0)},children:"Anime"}),D.jsx("button",{className:`px-4 py-1 rounded-full text-sm font-medium ${a==="books"?"bg-purple-600 text-white":"text-purple-300 hover:bg-purple-800"}`,onClick:()=>{s("books"),l(0)},children:"Books"})]}),D.jsx("button",{onClick:r,className:"text-purple-300 hover:text-white text-2xl",children:""})]})]}),D.jsxs("div",{className:"p-6 pb-8",children:[D.jsxs("div",{className:"relative",children:[D.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6",children:v.map(A=>{const T=`${a}-${A.title}`,E=c.includes(T),I=d===T;return D.jsxs("div",{className:"bg-purple-900 rounded-lg p-4 flex flex-col items-center",children:[D.jsx("div",{className:"h-60 mb-4 flex justify-center",children:D.jsx("img",{src:A.thumbnail,alt:A.title,className:"w-52 h-60 object-cover rounded-lg",onError:S=>{S.target.onerror=null,S.target.src="/placeholder-image.jpg"}})}),D.jsx("h3",{className:"text-lg font-bold text-white mb-1 line-clamp-1 text-center",children:A.title}),D.jsxs("p",{className:"text-purple-300 text-sm mb-2 text-center",children:["Rating: ",A.rating||"N/A"]}),D.jsx("div",{className:"flex-grow",children:D.jsx("p",{className:"text-purple-200 text-xs mb-3 text-center h-16 flex items-center justify-center",children:x(A.description)})}),D.jsxs("div",{className:"flex justify-center items-center space-x-3",children:[D.jsx(mn,{to:A.previewlink,target:"_blank",className:"bg-purple-600 hover:bg-purple-500 text-white px-4 py-1 rounded text-sm",children:a==="anime"?"Watch Now":"Read Now"}),D.jsx("button",{onClick:()=>C(A,a),className:"text-xl text-red-500 hover:text-red-400",disabled:I,children:I?D.jsx("div",{className:"animate-spin h-5 w-5 border-t-2 border-b-2 border-red-500 rounded-full"}):E?D.jsx(Jl,{className:"fill-current"}):D.jsx(Sg,{className:"fill-current"})})]})]},T)})}),y>1&&D.jsxs(D.Fragment,{children:[D.jsx("button",{onClick:_,className:"absolute left-0 top-1/2 -translate-y-1/2 -translate-x-8 bg-purple-600 hover:bg-purple-500 text-white p-2 rounded-full shadow-lg",children:D.jsx(RO,{})}),D.jsx("button",{onClick:w,className:"absolute right-0 top-1/2 -translate-y-1/2 translate-x-8 bg-purple-600 hover:bg-purple-500 text-white p-2 rounded-full shadow-lg",children:D.jsx(kO,{})})]})]}),y>1&&D.jsx("div",{className:"flex justify-center mt-6",children:Array.from({length:y}).map((A,T)=>D.jsx("button",{className:`mx-2 w-2 h-2 rounded-full transition-all ${u===T?"bg-purple-400 w-4":"bg-purple-800"}`,onClick:()=>l(T)},T))}),D.jsx("div",{className:"mt-6 text-center text-purple-300 text-sm",children:a==="anime"?D.jsxs(D.Fragment,{children:["You can also explore these anime at"," ",D.jsx("a",{href:"https://9animetv.to/",target:"_blank",rel:"noopener noreferrer",className:"text-purple-400 hover:underline",children:"9AnimeTV"}),"."]}):D.jsxs(D.Fragment,{children:["You can also explore these books at"," ",D.jsx("a",{href:"https://oceanofpdf.com/",target:"_blank",rel:"noopener noreferrer",className:"text-purple-400 hover:underline",children:"Ocean of PDF"}),"."]})})]})]})})};yw.propTypes={animeRecs:pr.array,bookRecs:pr.array,emotion:pr.string,onClose:pr.func.isRequired};yw.defaultProps={animeRecs:[],bookRecs:[],emotion:""};const _H=()=>{const[n,e]=Q.useState(!1),[t,r]=Q.useState(null),[i,o]=Q.useState(""),[a,s]=Q.useState(!1),[u,l]=Q.useState(!1),[c,h]=Q.useState(""),[d,p]=Q.useState(!1),[m,g]=Q.useState(null),[y,v]=Q.useState([]),w=Q.useRef(null),_=Q.useRef(null);Q.useEffect(()=>((async()=>{l(!0),h("");try{const k="/models";await Promise.all([gn.tinyFaceDetector.loadFromUri(k),gn.faceExpressionNet.loadFromUri(k),gn.faceLandmark68Net.loadFromUri(k),gn.faceRecognitionNet.loadFromUri(k)]),console.log("Face-api.js models loaded successfully"),s(!0)}catch(k){console.error("Error loading models:",k),h(`Failed to load facial recognition models: ${k.message}`)}finally{l(!1)}})(),()=>{_.current&&clearInterval(_.current)}),[]);const x=async()=>{try{h("");const P={video:{width:{ideal:640},height:{ideal:480},facingMode:"user",frameRate:{ideal:30},advanced:[{exposureMode:"continuous",brightness:128}]}},k=await navigator.mediaDevices.getUserMedia(P);r(k),e(!0)}catch(P){console.error("Error accessing camera:",P),h(`Unable to access the camera: ${P.message}`)}},C=()=>{_.current&&(clearInterval(_.current),_.current=null),t&&(t.getTracks().forEach(P=>P.stop()),r(null)),e(!1),o("")};Q.useEffect(()=>(w.current&&t&&n&&(w.current.srcObject=t,w.current.play().catch(P=>{console.error("Error playing video:",P),h("Error starting video stream. Please try again.")})),()=>{_.current&&clearInterval(_.current)}),[n,t]),Q.useEffect(()=>()=>{t&&t.getTracks().forEach(P=>P.stop()),_.current&&clearInterval(_.current)},[t]);const A=async()=>{if(!w.current||!a||w.current.paused||w.current.ended||!w.current.videoWidth)return null;try{const P=new xy({inputSize:512,scoreThreshold:.4});return await y2(w.current,P).withFaceLandmarks().withFaceExpressions()}catch(P){return console.error("Error in face detection:",P),null}},T=()=>{_.current&&clearInterval(_.current),_.current=setInterval(async()=>{const P=await A();if(P&&P.expressions){const k=Object.entries(P.expressions).sort((W,X)=>X[1]-W[1]),j=k[0][0],B=k[0][1].toFixed(2);o(`${j} (${B})`)}else o("No face detected. Please sit facing the light.")},1e3)},E=async P=>{try{const k=await fetch("http://localhost:5000/api/emotion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(P)});if(!k.ok)throw new Error(`HTTP error! status: ${k.status}`);const j=await k.json();return console.log("Successfully sent to backend:",j),j}catch(k){throw console.error("Error sending to backend:",k),k}},I=async()=>{if(!w.current||!a){h("Camera not ready or models not loaded yet");return}l(!0),h(""),g(null);try{if(w.current.paused||w.current.ended||!w.current.videoWidth||!w.current.videoHeight)throw new Error("Video stream is not ready");console.log("Attempting to detect face...");const P=new xy({inputSize:512,scoreThreshold:.4}),k=await y2(w.current,P).withFaceLandmarks().withFaceExpressions();if(k&&k.expressions){const j=Object.entries(k.expressions).sort((pe,xe)=>xe[1]-pe[1]),B=j[0][0],W=j[0][1].toFixed(2),X=`${B} (${W})`;o(X),console.log(`Detected Emotion: ${B} with confidence ${W}`);const V=document.createElement("canvas");V.width=w.current.videoWidth,V.height=w.current.videoHeight;const $=V.getContext("2d");if($.drawImage(w.current,0,0,V.width,V.height),k.detection){const{box:pe}=k.detection;$.strokeStyle="#FF0000",$.lineWidth=2,$.strokeRect(pe.x,pe.y,pe.width,pe.height),$.font="20px Arial",$.fillStyle="red",$.fillText(`${B} (${W})`,pe.x,pe.y-10)}const G=V.toDataURL("image/jpeg",.7),te={emotion:B,confidence:parseFloat(W),timestamp:new Date().toISOString(),imageUrl:G},re=await E(te);g(re),p(!0);const _e=sS().currentUser;if(_e)try{await _f(Ar(kn,"emotions"),{emotion:B,confidence:parseFloat(W),timestamp:BR(),email:_e.email,imageUrl:G}),console.log("Emotion saved to Firestore")}catch(pe){console.error("Error saving emotion:",pe),h("Emotion detected but failed to save to database.")}else h("User not authenticated. Sign in to save emotions.")}else o("No face detected"),h("No face was detected. Adjust your position and lighting.")}catch(P){console.error("Error during face detection:",P),h(`Detection failed: ${P.message}`)}finally{l(!1)}},S=(P,k)=>{const j=`${k}-${P.title}`;v(B=>B.includes(j)?B.filter(W=>W!==j):[...B,j])},N=()=>{p(!1),g(null)};return Q.useEffect(()=>{if(n&&a&&w.current){const P=setTimeout(()=>{T()},1e3);return()=>clearTimeout(P)}},[n,a]),D.jsxs("div",{className:"min-h-screen flex flex-col bg-black text-gray-200 relative",children:[D.jsx("nav",{className:"bg-dark-blue py-4 px-6 shadow-md",children:D.jsx(bu,{})}),D.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center p-6",children:[D.jsxs("div",{className:"text-center mb-6",children:[D.jsx("h1",{className:"text-4xl font-bold text-gray-100",children:"Scanning Mode"}),D.jsx("p",{className:"text-gray-400 mt-2",children:"Activate your laptop camera to start scanning."}),!a&&!c&&D.jsx("p",{className:"text-yellow-400 mt-2",children:"Loading facial recognition models..."}),a&&D.jsx("p",{className:"text-green-400 mt-2",children:"Models loaded successfully!"}),c&&D.jsx("p",{className:"text-red-400 mt-2",children:c})]}),D.jsx("div",{className:"w-full max-w-md h-72 bg-gray-800 rounded-lg flex items-center justify-center mb-6 relative",children:n?D.jsxs(D.Fragment,{children:[D.jsx("video",{ref:w,className:"w-full h-full object-cover rounded-lg",autoPlay:!0,playsInline:!0}),u&&D.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50",children:D.jsx("p",{className:"text-white",children:"Processing..."})})]}):D.jsx("p",{className:"text-gray-500",children:"Camera is currently inactive."})}),i&&D.jsxs("div",{className:"text-lg font-semibold text-green-400 mb-4",children:["Current Emotion: ",i]}),D.jsx("div",{className:"flex space-x-4",children:n?D.jsxs(D.Fragment,{children:[D.jsx("button",{onClick:I,className:"bg-yellow-500 text-white px-6 py-3 rounded-lg font-bold transition duration-300 hover:bg-yellow-600",disabled:!a||u,children:u?"Processing...":"Capture Image"}),D.jsx("button",{onClick:C,className:"bg-red-600 text-white px-6 py-3 rounded-lg font-bold transition duration-300 hover:bg-red-800",disabled:u,children:"Close Camera"})]}):D.jsx("button",{onClick:x,className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-bold transition duration-300 hover:bg-blue-800",disabled:u,children:"Open Camera"})})]}),d&&m&&D.jsx(yw,{animeRecs:m.anime_recommendations||[],bookRecs:m.book_recommendations||[],emotion:m.emotion,onClose:N,favorites:y,toggleFavorite:S}),D.jsx("footer",{className:"bg-dark-blue py-4 text-center text-gray-300",children:D.jsx(Tc,{})})]})},xH=()=>{const{isAuthenticated:n,user:e}=Ec(h=>h.auth),[t,r]=Q.useState([]),[i,o]=Q.useState([]),[a,s]=Q.useState(!1),[u,l]=Q.useState(null);Q.useEffect(()=>{if(!n||!(e!=null&&e.email))return;(async()=>{s(!0);try{const p=(await Ia(Ca(Ar(kn,"favorite"),vo("email","==",e.email)))).docs.map(y=>({id:y.id,...y.data()}));r(p);const g=(await Ia(Ca(Ar(kn,"favoriteBook"),vo("email","==",e.email)))).docs.map(y=>({id:y.id,...y.data()}));o(g)}catch(d){console.error("Error fetching favorites:",d)}finally{s(!1)}})()},[n,e==null?void 0:e.email]);const c=async(h,d)=>{try{l(h),await wf(gf(kn,d==="anime"?"favorite":"favoriteBook",h)),d==="anime"?r(m=>m.filter(g=>g.id!==h)):o(m=>m.filter(g=>g.id!==h))}catch(p){console.error("Error removing favorite:",p)}finally{l(null)}};return a?D.jsx("div",{className:"flex justify-center items-center min-h-screen bg-gray-900",children:D.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"})}):D.jsxs("div",{className:"min-h-screen bg-gray-900 text-white",children:[D.jsx(bu,{}),D.jsxs("div",{className:"container mx-auto px-4 py-8",children:[D.jsxs("section",{className:"mb-12",children:[D.jsx("h2",{className:"text-2xl font-semibold mb-6 border-b border-purple-700 pb-2",children:"Fav Anime"}),D.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:t.length>0?t.map(h=>D.jsxs("div",{className:"bg-gray-800 rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow relative",children:[D.jsx("button",{onClick:()=>c(h.id,"anime"),className:"absolute top-3 right-3 z-20 p-1 rounded-full backdrop-blur-md bg-black/50 hover:bg-black/70 text-red-500 hover:text-red-400 transition-colors","aria-label":"Remove from favorites",children:u===h.id?D.jsx("div",{className:"animate-spin h-5 w-5 border-t-2 border-b-2 border-red-500 rounded-full"}):D.jsx(Jl,{className:"text-red-500 opacity-100 fill-current text-2xl shadow-lg drop-shadow-md hover:scale-110 transition-transform duration-200"})}),D.jsx(mn,{to:h.link||"#",target:"_blank",rel:"noopener noreferrer",children:D.jsx("img",{src:h.image,alt:h.name,className:"w-60 h-60 object-bottom rounded-lg mb-4 mx-auto hover:opacity-90 transition-opacity"})}),D.jsxs("div",{className:"p-4",children:[D.jsx("h3",{className:"text-lg font-bold mb-1 line-clamp-1",children:h.name}),D.jsx("p",{className:"text-gray-400 text-sm mb-2 line-clamp-3",children:h.description}),D.jsxs("div",{className:"flex justify-between items-center",children:[D.jsxs("span",{className:"text-yellow-400 text-sm",children:["Rating: ",h.rating]}),D.jsx(mn,{to:h.link||"#",target:"_blank",rel:"noopener noreferrer",className:"text-purple-400 hover:text-purple-300 text-sm font-medium",children:"Watch Now"})]})]})]},h.id)):D.jsx("div",{className:"col-span-full text-center py-8",children:D.jsx("p",{className:"text-gray-400",children:"No favorite anime yet"})})})]}),D.jsxs("section",{className:"mb-12",children:[D.jsx("h2",{className:"text-2xl font-semibold mb-6 border-b border-purple-700 pb-2",children:"Fav Books"}),D.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:i.length>0?i.map(h=>D.jsxs("div",{className:"bg-gray-800 rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow relative",children:[D.jsx("button",{onClick:()=>c(h.id,"book"),className:"absolute top-3 right-3 z-20 p-1 rounded-full backdrop-blur-md bg-black/50 hover:bg-black/70 text-red-500 hover:text-red-400 transition-colors","aria-label":"Remove from favorites",children:u===h.id?D.jsx("div",{className:"animate-spin h-5 w-5 border-t-2 border-b-2 border-red-500 rounded-full"}):D.jsx(Jl,{className:"text-red-500 opacity-100 fill-current text-2xl shadow-lg drop-shadow-md hover:scale-110 transition-transform duration-200"})}),D.jsx(mn,{to:h.link||"#",target:"_blank",rel:"noopener noreferrer",children:D.jsx("img",{src:h.image,alt:h.name,className:"w-60 h-60 object-bottom rounded-lg mb-4 mx-auto hover:opacity-90 transition-opacity"})}),D.jsxs("div",{className:"p-4",children:[D.jsx("h3",{className:"text-lg font-bold mb-1 line-clamp-1",children:h.name}),D.jsx("p",{className:"text-gray-400 text-sm mb-2 line-clamp-3",children:h.description}),D.jsxs("div",{className:"flex justify-between items-center",children:[D.jsxs("span",{className:"text-yellow-400 text-sm",children:["Rating: ",h.rating]}),D.jsx(mn,{to:h.link||"#",target:"_blank",rel:"noopener noreferrer",className:"text-purple-400 hover:text-purple-300 text-sm font-medium",children:"Read Now"})]})]})]},h.id)):D.jsx("div",{className:"col-span-full text-center py-8",children:D.jsx("p",{className:"text-gray-400",children:"No favorite books yet"})})})]})]}),D.jsx(Tc,{})]})},bH=()=>{const[n,e]=Q.useState(!1),[t,r]=Q.useState(""),[i,o]=Q.useState([{role:"assistant",content:"Hi  How can I help you today?"}]),a=Q.useRef(null);Q.useEffect(()=>{a.current&&a.current.scrollIntoView({behavior:"smooth"})},[i,n]);const s=l=>l.replace(/\*\*/g,"").replace(/\s+/g," ").replace(/([,.!?])([^\s])/g,"$1 $2"),u=async l=>{if(l.preventDefault(),!t.trim())return;const c=[...i,{role:"user",content:t}];o(c),r("");try{const d=await(await fetch("http://localhost:5000/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t})})).json(),p=s(d.reply);o([...c,{role:"assistant",content:p}])}catch{o([...c,{role:"assistant",content:"Sorry, something went wrong."}])}};return D.jsxs(D.Fragment,{children:[D.jsx("div",{className:"fixed bottom-24 right-6 z-50",children:D.jsxs("button",{onClick:()=>e(!n),className:"relative focus:outline-none",children:[D.jsx("div",{className:"bg-purple-500 rounded-full p-2 shadow-lg",children:D.jsx("img",{src:"/logo.jpeg",alt:"MoodConexus",className:"w-10 h-10 rounded-full"})}),D.jsx("div",{className:`absolute inset-0 rounded-full border-2 border-purple-400 opacity-70 \r
            animate-[ping_3s_cubic-bezier(0,0,0.2,1)_infinite] -z-10`}),D.jsx("div",{className:`absolute inset-0 rounded-full border-2 border-purple-300 opacity-50 \r
            animate-[ping_3s_cubic-bezier(0,0,0.2,1)_infinite] -z-20`,style:{animationDelay:"0.5s"}}),D.jsx("div",{className:`absolute inset-0 rounded-full border-2 border-purple-200 opacity-30 \r
            animate-[ping_3s_cubic-bezier(0,0,0.2,1)_infinite] -z-30`,style:{animationDelay:"1s"}})]})}),n&&D.jsxs("div",{className:"fixed bottom-40 right-6 w-80 h-96 bg-white border border-gray-200 shadow-xl rounded-xl flex flex-col z-40",children:[D.jsxs("div",{className:"bg-purple-500 text-white p-3 rounded-t-xl flex items-center",children:[D.jsx("div",{className:"w-8 h-8 rounded-full bg-white overflow-hidden mr-2 flex items-center justify-center",children:D.jsx("img",{src:"/logo.jpeg",alt:"MoodConexus",className:"w-7 h-7 object-cover rounded-full"})}),D.jsx("h3",{className:"font-semibold",children:"MoodConexus Assistant"}),D.jsx("button",{onClick:()=>e(!1),className:"ml-auto text-white hover:text-gray-200 text-xl","aria-label":"Close chat",children:""})]}),D.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 bg-white",children:[i.map((l,c)=>D.jsx("div",{className:`flex ${l.role==="user"?"justify-end":"justify-start"}`,children:D.jsx("span",{className:`px-3 py-2 rounded-lg max-w-[75%] ${l.role==="user"?"bg-blue-100 text-gray-800":"bg-gray-100 text-gray-800"}`,children:l.content})},c)),D.jsx("div",{ref:a})]}),D.jsx("div",{className:"p-4 bg-white rounded-b-xl",children:D.jsxs("form",{onSubmit:u,className:"flex rounded-lg overflow-hidden border border-gray-300 focus-within:ring-2 focus-within:ring-purple-500 focus-within:border-transparent",children:[D.jsx("input",{className:"flex-1 px-4 py-2 focus:outline-none",value:t,onChange:l=>r(l.target.value),placeholder:"Type a message...","aria-label":"Type your message"}),D.jsx("button",{className:"bg-purple-400 text-black px-4 hover:bg-purple-800 transition-colors",type:"submit",children:"Send"})]})})]})]})};function EH(){return D.jsx(LI,{store:jR,children:D.jsx(I3,{children:D.jsx(CH,{})})})}function CH(){const n=Ic(),[e,t]=Q.useState("purple"),o=Ec(s=>s.auth.isAuthenticated)&&["/home","/contact","/about","/favorites"].includes(n.pathname),a=()=>{t(e==="purple"?"blue":e==="blue"?"grey":e==="grey"?"green":e==="green"?"red":"purple")};return D.jsxs(D.Fragment,{children:[o&&D.jsx(bH,{}),D.jsxs(y3,{children:[D.jsx(wi,{path:"/",element:D.jsx(vE,{})}),D.jsx(wi,{path:"/home",element:D.jsx(K6,{theme:e,changeTheme:a})}),D.jsx(wi,{path:"/register",element:D.jsx(X6,{})}),D.jsx(wi,{path:"/login",element:D.jsx(vE,{})}),D.jsx(wi,{path:"/about",element:D.jsx(Q6,{theme:e,changeTheme:a})}),D.jsx(wi,{path:"/contact",element:D.jsx(Y6,{theme:e,changeTheme:a})}),D.jsx(wi,{path:"/capture",element:D.jsx(_H,{})}),D.jsx(wi,{path:"/favorites",element:D.jsx(xH,{})})]})]})}NI(document.getElementById("root")).render(D.jsx(LI,{store:jR,children:D.jsx(EH,{})}))});export default IH();
